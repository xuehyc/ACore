local _G = _G; local GameTooltip = GameTooltip; local ItemRefTooltip = ItemRefTooltip; local ShoppingTooltip1 = ShoppingTooltip1; local ShoppingTooltip2 = ShoppingTooltip2; local ShoppingTooltip2 = ShoppingTooltip3; aaDzFrame = {}; aaDzFrame.selectItemId = 0; aaDzFrame.selectItemEntry = 0; aaDzFrame.mainView = {}; local itemLinks = {}; local itemName = ""; local selectItemDBName = ""; local selectItemName = ""; local selectIndex = 1; local menuBtns = {}; local fwitemBtns = {}; local fwitems = {}; local fwitemids = {"0\f0","0\f0","0\f0","0\f0","0\f0","0\f0","0\f0","0\f0","0\f0"}; local detailTitles = {"强化成功预览","重铸说明","洗练说明","符文成功预览","装备改名"}; aaDzFrame.fwTitles1 = {"Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw1-1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw2-1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw3-1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw4-1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw5-1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw6-1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw7-1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw8-1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw9-1"}; aaDzFrame.fwTitles2 = {"Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw1-2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw2-2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw3-2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw4-2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw5-2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw6-2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw7-2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw8-2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw9-2"}; local buttonTitles1 = {"Interface\\AddOns\\aaAddon\\Icons\\aa-dz-ksqh1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-kscz1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-ksxl1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-ksxq1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-ksgm1"}; local buttonTitles2 = {"Interface\\AddOns\\aaAddon\\Icons\\aa-dz-ksqh2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-kscz2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-ksxl2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-ksxq2","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-ksgm2"}; local menuBtn_1 = {}; local buttonWidth = 128; local buttonHeight = 64; local buttonTop = 0; local ClickDoneBtn = function(tag) PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if tag == 9 then aaData:sendAddonMsg(9,aaDzFrame.selectItemId.."\t"..aaDzFrame.selectItemEntry, "GUILD"); elseif tag == 10 then aaData:sendAddonMsg(10,aaDzFrame.selectItemId.."\t"..aaDzFrame.selectItemEntry, "GUILD"); else if selectIndex == 1 then aaData:sendAddonMsg(1,aaDzFrame.selectItemId.."\t"..aaDzFrame.selectItemEntry, "GUILD"); elseif selectIndex == 3 then aaData:sendAddonMsg(3,aaDzFrame.selectItemId.."\t"..aaDzFrame.selectItemEntry, "GUILD"); elseif selectIndex == 4 then local fwitemstr = ""; for i=1,8 do if fwitemids[i] ~= nil then fwitemstr = fwitemstr..fwitemids[i]..","; else fwitemstr = fwitemstr.."0\f0"..","; end; end; if fwitemids[9] == nil then fwitemstr = fwitemstr.."0"; else fwitemstr = fwitemstr..fwitemids[9]; end; if fwitemstr ~= "" then aaData:sendAddonMsg(8,aaDzFrame.selectItemId.."\t"..aaDzFrame.selectItemEntry.."\t"..fwitemstr, "GUILD"); end; elseif selectIndex == 5 then aaData:sendAddonMsg(4,aaDzFrame.selectItemId.."\t"..aaDzFrame.selectItemEntry.."\t"..aaDzFrame.mainView.bgView.detailView51.nameEditBox:GetText() , "GUILD"); end; end; end; local ClickFuwenKaiChaoBtn = function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if selectIndex == 4 then aaData:sendAddonMsg(7,aaDzFrame.selectItemId.."\t"..aaDzFrame.selectItemEntry, "GUILD"); end; end; function aaDzFrame:CallBack(tag) tag = tag + 0; if tag == 1 or tag == 2 or tag == 3 or tag == 4 or tag == 5 or tag == 6 or tag == 7 or tag == 8 or tag == 9 or tag == 10 then aaData:GetHttpItem(aaDzFrame.selectItemId, aaDzFrame.selectItemEntry); if tag == 7 then aaData.reload_dz[aaDzFrame.selectItemId+0] = "aaDzFrame"; end; end; end; function aaDzFrame:ClearData() aaDzFrame.mainView.bgView.detailView1.stattext:SetText(""); aaDzFrame.mainView.bgView.detailView51.gaimingnametext:SetText(""); aaDzFrame.mainView.bgView.detailView51.nameEditBox:SetText(""); aaDzFrame.mainView.bgView.detailView2.needtext:SetText(""); aaDzFrame.mainView.bgView.detailView51.needtext:SetText(""); aaDzFrame.selectItemId = 0; aaDzFrame.selectItemEntry = 0; aaDzFrame.mainView.bgView.ItemButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-cao"); fwitems = {}; itemLinks = {}; fwitemids = {"0\f0","0\f0","0\f0","0\f0","0\f0","0\f0","0\f0","0\f0","0\f0"}; for i=1,9 do fwitemBtns[i]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw-1"); end; ClearCursor(); aaDzFrame:reload(); end; local ClickMenuBtn = function(index,menuBtn) PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if index ~= 6 then selectIndex = index; if index == 1 then aaDzFrame.mainView.bgView.detailView1:Show(); aaDzFrame.mainView.bgView.detailView2:Show(); aaDzFrame.mainView.bgView.detailView41:Hide(); aaDzFrame.mainView.bgView.detailView42:Hide(); aaDzFrame.mainView.bgView.detailView51:Hide(); aaDzFrame.mainView.bgView.detailView52:Hide(); aaDzFrame.mainView.bgView.DoneButton:Show(); aaDzFrame.mainView.bgView.DoneButton1:Hide(); aaDzFrame.mainView.bgView.DoneButton2:Hide(); elseif index == 2 then aaDzFrame.mainView.bgView.detailView1:Show(); aaDzFrame.mainView.bgView.detailView2:Show(); aaDzFrame.mainView.bgView.detailView41:Hide(); aaDzFrame.mainView.bgView.detailView42:Hide(); aaDzFrame.mainView.bgView.detailView51:Hide(); aaDzFrame.mainView.bgView.detailView52:Hide(); aaDzFrame.mainView.bgView.DoneButton:Hide(); aaDzFrame.mainView.bgView.DoneButton1:Show(); aaDzFrame.mainView.bgView.DoneButton2:Show(); elseif index == 3 then aaDzFrame.mainView.bgView.detailView1:Show(); aaDzFrame.mainView.bgView.detailView2:Show(); aaDzFrame.mainView.bgView.detailView41:Hide(); aaDzFrame.mainView.bgView.detailView42:Hide(); aaDzFrame.mainView.bgView.detailView51:Hide(); aaDzFrame.mainView.bgView.detailView52:Hide(); aaDzFrame.mainView.bgView.DoneButton:Show(); aaDzFrame.mainView.bgView.DoneButton1:Hide(); aaDzFrame.mainView.bgView.DoneButton2:Hide(); elseif index == 4 then aaDzFrame.mainView.bgView.detailView1:Hide(); aaDzFrame.mainView.bgView.detailView2:Hide(); aaDzFrame.mainView.bgView.detailView41:Show(); aaDzFrame.mainView.bgView.detailView42:Show(); aaDzFrame.mainView.bgView.detailView51:Hide(); aaDzFrame.mainView.bgView.detailView52:Hide(); aaDzFrame.mainView.bgView.DoneButton:Show(); aaDzFrame.mainView.bgView.DoneButton1:Hide(); aaDzFrame.mainView.bgView.DoneButton2:Hide(); elseif index == 5 then aaDzFrame.mainView.bgView.detailView1:Hide(); aaDzFrame.mainView.bgView.detailView2:Hide(); aaDzFrame.mainView.bgView.detailView41:Hide(); aaDzFrame.mainView.bgView.detailView42:Hide(); aaDzFrame.mainView.bgView.detailView51:Show(); aaDzFrame.mainView.bgView.detailView52:Show(); aaDzFrame.mainView.bgView.DoneButton:Show(); aaDzFrame.mainView.bgView.DoneButton1:Hide(); aaDzFrame.mainView.bgView.DoneButton2:Hide(); end; for i = 1,#menuBtns do menuBtns[i]:SetAlpha(0.5); end; menuBtn:SetAlpha(1); aaDzFrame.mainView.bgView.DoneButton:SetNormalTexture(buttonTitles1[index]); aaDzFrame.mainView.bgView.DoneButton:SetDisabledTexture(buttonTitles2[index]); aaDzFrame.mainView.bgView.DoneButton:SetHighlightTexture(buttonTitles1[index]); aaDzFrame.mainView.bgView.DoneButton:SetPushedTexture(buttonTitles1[index]); aaDzFrame:reload(); else local infoType, _, itemLink = GetCursorInfo(); aaDzFrame:ClearData(); if (infoType == "item") then itemLinks[10] = itemLink; local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itementry, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; aaDzFrame.selectItemId = suffixId - 0; aaDzFrame.selectItemEntry = itementry + 0; local item = aaData:getItem(aaDzFrame.selectItemId, aaDzFrame.selectItemEntry); if aaDzFrame.selectItemId > 0 and item then itemName = aaData:getItemName(itementry); local icon = GetItemIcon(itementry); aaDzFrame.mainView.bgView.ItemButton:SetNormalTexture(icon); ClearCursor(); aaDzFrame:reload(); end; end; aaDzFrame:UpdateFwzhStr(); end; end; function aaDzFrame:show() aaDzFrame.mainView:Show(); ClickMenuBtn(1,menuBtn_1); end; function aaDzFrame:hide() aaDzFrame.mainView:Hide(); aaDzFrame:ClearData(); end; function aaDzFrame:UpdateFwzhStr() local fwzhstr = ""; for k,v in pairs(aa_fwzh) do local fwzhid = k; if aa_fwzh[fwzhid] ~= nil and aa_fwzh[fwzhid][1] ~= nil and aa_fwzh[fwzhid][2] ~= nil then local fwstr = aa_fwzh[fwzhid][1]; local fwidstr = aa_fwzh[fwzhid][2]; local fwids = aaData:toVectorInt(fwidstr); local isOk = true; for i=1,#fwids do local fwid = fwids[i] + 0; if fwid > 0 then if aaData:in_Vector(fwid, fwitems) == false then isOk = false; end; end; end; if isOk == true then fwzhstr = fwzhstr..fwstr.."\n"; end; end; end; if fwzhstr == "" then aaDzFrame.mainView.bgView.detailView42.needtext:SetText(aaData.color_blue.."符文组合效果：|r\n"..aaData.color_red.."无"); else aaDzFrame.mainView.bgView.detailView42.needtext:SetText(aaData.color_blue.."符文组合效果：|r\n"..fwzhstr); end; return fwzhstr; end; function aaDzFrame:reload() local count_show = 5; if worldconf[6] == 0 then menuBtns[1]:Hide(); count_show = count_show -1; else menuBtns[1]:Show(); end; if worldconf[5] == 0 then menuBtns[2]:Hide(); count_show = count_show -1; else menuBtns[2]:Show(); end; if worldconf[7] == 0 then menuBtns[3]:Hide(); count_show = count_show -1; else menuBtns[3]:Show(); end; if worldconf[8] == 0 then menuBtns[4]:Hide(); count_show = count_show -1; else menuBtns[4]:Show(); end; if worldconf[22] == 0 then menuBtns[5]:Hide(); count_show = count_show -1; else menuBtns[5]:Show(); end; local count_index = 0; for i=1,#menuBtns do if count_index <= count_show then if menuBtns[i]:IsShown() then count_index = count_index + 1; menuBtns[i]:SetPoint('TOPLEFT', aaDzFrame.mainView.bgView, 'TOPLEFT', (((768 - count_show * buttonWidth) / (count_show + 1)) * count_index) + (count_index - 1)*buttonWidth,  -390); end; end; end; if aaDzFrame.selectItemId > 0 then aaDzFrame.mainView.bgView.DoneButton:Enable(); aaDzFrame.mainView.bgView.DoneButton1:Enable(); aaDzFrame.mainView.bgView.DoneButton2:Enable(); selectItemName = aaData:get_name(aaDzFrame.selectItemId, aaDzFrame.selectItemEntry, itemName); selectItemDBName = aaData:get_dbname(aaDzFrame.selectItemId, aaDzFrame.selectItemEntry, itemName); local item = aaData:getItem(aaDzFrame.selectItemId, aaDzFrame.selectItemEntry); if selectIndex == 1 then if worldconf[6] == 0 or item[10] == 0 then aaDzFrame.mainView.bgView.DoneButton:Disable(); else local upgroup = item[10]; if upgroup > 0 then local upgradeid1 = item[11]; local upgradeid2 = 0; local isok = 0; if upgradeid1 == 0 then for i=1,#upgrade do local up = upgrade[i]; if up then if up[12] == upgroup then upgradeid2 = i; break; end; end; end; isok = 1; else upgradeid2 = upgradeid1 + 1; end; if upgrade[upgradeid1] and upgrade[upgradeid2] then if upgrade[upgradeid2][1] > upgrade[upgradeid1][1] then isok = 1; end; end; if  isok == 1 and upgrade[upgradeid2] then local value = ""; if upgrade[upgradeid2][5] > upgrade[upgradeid2][6] then value = value.."+".." "..upgrade[upgradeid2][5].."%"; elseif upgrade[upgradeid2][6] > upgrade[upgradeid2][5] then value = value.."+".." "..upgrade[upgradeid2][5].."% ~ "..upgrade[upgradeid2][6].."%\n"; end; if upgrade[upgradeid2][3] > upgrade[upgradeid2][4] then value = value.."+".." "..upgrade[upgradeid2][3]; elseif upgrade[upgradeid2][4] > upgrade[upgradeid2][3] then value = value.."+".." "..upgrade[upgradeid2][3].." ~ "..upgrade[upgradeid2][4].."\n"; end; local qhtext = aaData.color_blue..detailTitles[selectIndex].."\n\n"..aaData.color_blue.."强化等级：\n"..aaData:get_star(upgrade[upgradeid2][1]).."\n"..aaData.color_blue.."强化属性继续提升：\n"..aaData.color_green..value; if upgrade[upgradeid2][9] ~= nil and upgrade[upgradeid2][9] ~= "" then qhtext = aaData.color_blue..detailTitles[selectIndex].."\n\n"..aaData.color_blue.."强化等级：\n"..aaData:get_star(upgrade[upgradeid2][1]).."\n"..aaData.color_blue.."强化属性继续提升：\n"..aaData.color_green..value..aaData.color_reds.."\n强化会提升技能"; end; aaDzFrame.mainView.bgView.detailView1.stattext:SetText(qhtext); local needid = upgrade[upgradeid2][11]; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaDzFrame"; local need = aaData:getNeed(needid, 1); if need ~= "" then local destroy = ""; if upgrade[upgradeid2][10] == 0 then destroy = aaData.color_blue.."无变化"; elseif upgrade[upgradeid2][10] == 1 then destroy = aaData.color_red.."强化等级清零"; elseif upgrade[upgradeid2][10] == 2 then destroy = aaData.color_red.."装备销毁"; end; local jilv = ""; if worldconf[11] + 0 > 0 then jilv = aaData.color_white..upgrade[upgradeid2][2].."% "..aaData.color_green.."（会员 + "..worldconf[11].."%）|r"; else jilv = aaData.color_white..upgrade[upgradeid2][2].."% |r"; end; aaDzFrame.mainView.bgView.detailView2.needtext:SetText(selectItemDBName.."\n\n"..aaData.color_blue.."强化条件：\n"..aaData.color_yellow..need.."\n"..aaData.color_blue.."成功几率：\n"..jilv.."\n\n"..aaData.color_blue.."强化失败："..destroy); end; end; else aaDzFrame.mainView.bgView.DoneButton:Disable(); aaDzFrame.mainView.bgView.detailView1.stattext:SetText("装备无法强化"); aaDzFrame.mainView.bgView.detailView2.needtext:SetText(""); end; else aaDzFrame.mainView.bgView.DoneButton:Disable(); aaDzFrame.mainView.bgView.detailView1.stattext:SetText("装备无法强化"); aaDzFrame.mainView.bgView.detailView2.needtext:SetText(""); end; end; elseif selectIndex == 2 and item then if worldconf[5] == 0  or item[6] == 0 then aaDzFrame.mainView.bgView.DoneButton1:Disable(); aaDzFrame.mainView.bgView.DoneButton2:Disable(); else aaDzFrame.mainView.bgView.detailView1.stattext:SetText(aaData.color_blue..detailTitles[selectIndex].."\n\n"..aaData.color_yellow.."1.点击不同的重铸按钮，可以对放入装备的随机属性和随机技能进行重铸；\n2.每次重铸需要消耗一定重铸道具，根据装备的不同，消耗的重铸道具类型和数量不同；\n3.每件装备的重铸次数不同，越稀有的装备重铸次数越多。"); local need1 = ""; if item[30] then local needid = item[30]; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaDzFrame"; need1 = aaData:getNeed(needid, 1); end; end; local need2 = ""; if item[31] then local needid = item[31]; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaDzFrame"; need2 = aaData:getNeed(needid, 1); end; end; local cishu = aaData.color_yellow..item[29].."次"; aaDzFrame.mainView.bgView.detailView2.needtext:SetText(selectItemDBName.."\n\n"..aaData.color_reds.."剩余重铸次数："..cishu.."\n\n"..aaData.color_blue.."重铸属性条件：\n"..aaData.color_yellow..need1..aaData.color_blue.."\n\n".."重铸技能条件：\n"..aaData.color_yellow..need2); end; elseif selectIndex == 3 then if worldconf[7] == 0  or item[6] == 0 then aaDzFrame.mainView.bgView.DoneButton1:Disable(); aaDzFrame.mainView.bgView.DoneButton2:Disable(); else aaDzFrame.mainView.bgView.detailView1.stattext:SetText(aaData.color_blue..detailTitles[selectIndex].."\n\n"..aaData.color_yellow.."洗练会重置物品所有属性！"); local need = ""; if worldconf[1] then local needid = worldconf[1]; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaDzFrame"; need = aaData:getNeed(needid, 1); end; end; aaDzFrame.mainView.bgView.detailView2.needtext:SetText(selectItemDBName.."\n\n"..aaData.color_blue.."洗练条件：\n"..aaData.color_yellow..need); end; elseif selectIndex == 4 then if worldconf[8] == 0 then aaDzFrame.mainView.bgView.DoneButton:Disable(); end; if item then local itemCount = item[32]+0; if itemCount == 9 then aaDzFrame.mainView.bgView.detailView41.xqBtn:Disable(); else aaDzFrame.mainView.bgView.detailView41.xqBtn:Enable(); end; local fwids = aaData:toVectorInt(item[33]); for i=1,#fwids do local itemEntry = fwids[i]+0; fwitems[i] = itemEntry; end; for i=1,9,1 do if fwitems[i] and fwitems[i]+0 > 0 then local icon = GetItemIcon(fwitems[i]+0); fwitemBtns[i]:SetNormalTexture(icon); elseif i <= itemCount then fwitemBtns[i]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw-2"); else fwitemBtns[i]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw-1"); end; end; if worldconf[10] then local needids = worldconf[10]; if needids and needids ~= "" and needids ~= "0" and needids ~= 0  then local needidv = aaData:toVectorInt(needids); local needid = needidv[itemCount+1]; if needid and needid + 0 > 0 then local need = aaData:getNeed(needid, 1); aaData.reload_need[needid] = "aaDzFrame"; if need and need ~= "" then aaDzFrame.mainView.bgView.detailView41.kcText:SetText(aaData.color_yellows.."需要："..need); end; end; end; end; if worldconf[9] then local needid = worldconf[9]; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaDzFrame"; local cxneed = aaData:getNeed(needid, 1); aaDzFrame.mainView.bgView.detailView41.cxText2:SetText(aaData.color_yellows.."需要：|r"..cxneed); end; end; local fwzhidstr = item[34]; local fwzhids = {}; string.gsub(fwzhidstr,'[^'..","..']+',function (w) table.insert(fwzhids,w); end); local fwzhstr = ""; for i=1,#fwzhids do local fwzhid = fwzhids[i] + 0; if fwzhid > 0 then if aa_fwzh[fwzhid] ~= nil and aa_fwzh[fwzhid][1] ~= nil then fwzhstr = fwzhstr..aa_fwzh[fwzhid][1].."\n"; end; end; end; if fwzhstr == "" then aaDzFrame.mainView.bgView.detailView42.needtext:SetText(aaData.color_blue.."符文组合效果：|r\n"..aaData.color_red.."无"); else aaDzFrame.mainView.bgView.detailView42.needtext:SetText(aaData.color_blue.."符文组合效果：|r\n"..fwzhstr); end; end; elseif selectIndex == 5 then aaDzFrame.mainView.bgView.detailView51.gaimingnametext:SetText(selectItemDBName); aaDzFrame.mainView.bgView.detailView51.nameEditBox:SetText(selectItemName); local need = ""; if worldconf[2] then local needid = worldconf[2]; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaDzFrame"; need = aaData:getNeed(needid, 1); end; end; aaDzFrame.mainView.bgView.detailView51.needtext:SetText(aaData.color_blue.."改名条件：\n"..aaData.color_yellow..need); end; else aaDzFrame.mainView.bgView.DoneButton:Disable(); aaDzFrame.mainView.bgView.DoneButton1:Disable(); aaDzFrame.mainView.bgView.DoneButton2:Disable(); end; end; aaDzFrame.mainView = CreateFrame("Frame","aaDzFrame.mainView",UIParent) do aaDzFrame.mainView:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView:SetWidth(768); aaDzFrame.mainView:SetHeight(512); aaDzFrame.mainView:SetPoint("CENTER"); aaDzFrame.mainView:SetToplevel(true); aaDzFrame.mainView:SetClampedToScreen(true); aaDzFrame.mainView:SetMovable(true); aaDzFrame.mainView:EnableMouse(true); aaDzFrame.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDzFrame.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDzFrame.mainView:Hide(); tinsert(UISpecialFrames, "aaDzFrame.mainView"); end; aaDzFrame.mainView.bgView1 = CreateFrame("Frame",nil,aaDzFrame.mainView) do aaDzFrame.mainView.bgView1:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView.bgView1:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-dz-dz1"}); aaDzFrame.mainView.bgView1:SetWidth(512); aaDzFrame.mainView.bgView1:SetHeight(512); aaDzFrame.mainView.bgView1:SetPoint("TOPLEFT",0,0); aaDzFrame.mainView.bgView1:Show(); end; aaDzFrame.mainView.bgView2 = CreateFrame("Frame",nil,aaDzFrame.mainView) do aaDzFrame.mainView.bgView2:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView.bgView2:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-dz-dz2"}); aaDzFrame.mainView.bgView2:SetWidth(256); aaDzFrame.mainView.bgView2:SetHeight(512); aaDzFrame.mainView.bgView2:SetPoint("TOPLEFT",512,0); aaDzFrame.mainView.bgView2:Show(); end; aaDzFrame.mainView.bgView = CreateFrame("Frame",nil,aaDzFrame.mainView) do aaDzFrame.mainView.bgView:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView.bgView:SetWidth(768); aaDzFrame.mainView.bgView:SetHeight(512); aaDzFrame.mainView.bgView:SetPoint("TOPLEFT",0,0); aaDzFrame.mainView.bgView:Show(); end; local CreateMenuBtn = function(index,image1,image2,left) local menuBtn = CreateFrame('Button', nil, aaDzFrame.mainView.bgView, '') do menuBtn:SetPoint('TOPLEFT', aaDzFrame.mainView.bgView, 'TOPLEFT', left,  -390); menuBtn:SetSize(buttonWidth, buttonHeight); menuBtn:SetNormalTexture(image1); menuBtn:SetDisabledTexture(image2); menuBtn:SetHighlightTexture(image1); menuBtn:SetPushedTexture(image1); if index == 1 then menuBtn:SetAlpha(1); menuBtn_1 = menuBtn; else menuBtn:SetAlpha(0.5); end; menuBtn:SetScript('OnClick', function() ClickMenuBtn(index,menuBtn); end); end; return menuBtn; end; local CreateFwBtn = function(index,x,y) local menuBtn = CreateFrame('Button', nil, aaDzFrame.mainView.bgView.detailView41, '') do menuBtn:SetPoint('TOPLEFT', aaDzFrame.mainView.bgView.detailView41, 'TOPLEFT', x,  y); menuBtn:SetSize(40, 40); local _, _, icon, _, _, _ = GetSpellInfo(37407); menuBtn:SetNormalTexture(icon); menuBtn:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); local item = aaData:getItem(aaDzFrame.selectItemId, aaDzFrame.selectItemEntry); if item and index <= item[32] then local fwids = aaData:toVectorInt(item[33]); if fwids[index] == nil or fwids[index]+0 == 0 then local infoType, _, itemLink = GetCursorInfo(); if (infoType == "item") then itemLinks[index] = itemLink; local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itementry, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; local icon = GetItemIcon(itementry); menuBtn:SetNormalTexture(icon); ClearCursor(); fwitems[index] = itementry + 0; fwitemids[index] = suffixId.."\f"..itementry; aaDzFrame:UpdateFwzhStr(); end; end; end; end); menuBtn:SetScript('OnDoubleClick', function() local item = aaData:getItem(aaDzFrame.selectItemId, aaDzFrame.selectItemEntry); local fwids = aaData:toVectorInt(item[33]); if fwids[index] and fwids[index]+0 > 0 then local i = index - 1; if i >= 0 and i <= 8 then aaData:sendAddonMsg(6,aaDzFrame.selectItemId.."\t"..aaDzFrame.selectItemEntry.."\t"..i, "GUILD"); end; local itemCount = item[32]; fwitems[index] = 0; fwitemids[index] = "0\f0"; if index <= itemCount then menuBtn:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw-2"); end; else fwitems[index] = 0; fwitemids[index] = "0\f0"; menuBtn:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw-2"); end; aaDzFrame:UpdateFwzhStr(); end); menuBtn:SetScript('OnEnter', function() local itemid = 0; if fwitems[index] then itemid = fwitems[index] + 0; end; if itemid > 0 then local itemLink = itemLinks[index]; local itemname = aaData:getItemName(itemid); if itemLink == nil then itemLink = "|Hitem:"..itemid..":0:0:0:0:0:0:0:0:0|h["..itemname.."]|h|r"; end; if itemLink then GameTooltip:SetToplevel(true); if (not GameTooltip:IsVisible()) then GameTooltip:SetOwner(menuBtn, "ANCHOR_NONE"); end GameTooltip:SetPoint("BOTTOMLEFT",menuBtn,"TOPRIGHT"); GameTooltip:SetHyperlink(itemLink); GameTooltip:Show(); end; end; end); menuBtn:SetScript('OnLeave', function() GameTooltip:Hide(); end); end; return menuBtn; end;  menuBtns[1] = CreateMenuBtn(1,"Interface\\AddOns\\aaAddon\\Icons\\aa-dz-qh1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-qh2",(((768 - 5 * buttonWidth) / 6) * 1) + (1 - 1)*buttonWidth); menuBtns[1]:SetAlpha(1); menuBtns[2] = CreateMenuBtn(2,"Interface\\AddOns\\aaAddon\\Icons\\aa-dz-cz1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-cz2",(((768 - 5 * buttonWidth) / 6) * 2) + (2 - 1)*buttonWidth); menuBtns[3] = CreateMenuBtn(3,"Interface\\AddOns\\aaAddon\\Icons\\aa-dz-xl1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-xl2",(((768 - 5 * buttonWidth) / 6) * 3) + (3 - 1)*buttonWidth); menuBtns[4] = CreateMenuBtn(4,"Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw2",(((768 - 5 * buttonWidth) / 6) * 4) + (4 - 1)*buttonWidth); menuBtns[5] = CreateMenuBtn(5,"Interface\\AddOns\\aaAddon\\Icons\\aa-dz-gm1","Interface\\AddOns\\aaAddon\\Icons\\aa-dz-gm2",(((768 - 5 * buttonWidth) / 6) * 5) + (5 - 1)*buttonWidth); aaDzFrame.mainView.bgView.ItemButton = CreateFrame('Button', nil, aaDzFrame.mainView.bgView, '') do aaDzFrame.mainView.bgView.ItemButton:SetPoint('CENTER', aaDzFrame.mainView.bgView, 'CENTER', 3, 65); aaDzFrame.mainView.bgView.ItemButton:SetSize(64, 64); aaDzFrame.mainView.bgView.ItemButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-cao"); aaDzFrame.mainView.bgView.ItemButton:SetScript('OnClick', function() ClickMenuBtn(6); end); aaDzFrame.mainView.bgView.ItemButton:SetScript('OnEnter', function() local item = aaData:getItem(aaDzFrame.selectItemId, aaDzFrame.selectItemEntry); if aaDzFrame.selectItemId > 0 and item then local itemLink = itemLinks[10]; GameTooltip:SetToplevel(true); if (not GameTooltip:IsVisible()) then GameTooltip:SetOwner(aaDzFrame.mainView.bgView.ItemButton, "ANCHOR_NONE"); end GameTooltip:SetPoint("BOTTOMLEFT",aaDzFrame.mainView.bgView.ItemButton,"TOPRIGHT"); GameTooltip:SetHyperlink(itemLink); GameTooltip:Show(); end; end); aaDzFrame.mainView.bgView.ItemButton:SetScript('OnLeave', function() GameTooltip:Hide(); end); aaDzFrame.mainView.bgView.ItemButton:Show(); end; aaDzFrame.mainView.bgView.DoneButton = CreateFrame('Button', nil, aaDzFrame.mainView.bgView, '') do aaDzFrame.mainView.bgView.DoneButton:SetPoint('CENTER', aaDzFrame.mainView.bgView, 'CENTER', 3, -50); aaDzFrame.mainView.bgView.DoneButton:SetSize(128, 32); aaDzFrame.mainView.bgView.DoneButton:SetNormalTexture(buttonTitles2[1]); aaDzFrame.mainView.bgView.DoneButton:SetDisabledTexture(buttonTitles1[1]); aaDzFrame.mainView.bgView.DoneButton:SetHighlightTexture(buttonTitles2[1]); aaDzFrame.mainView.bgView.DoneButton:SetPushedTexture(buttonTitles2[1]); aaDzFrame.mainView.bgView.DoneButton:Disable(); aaDzFrame.mainView.bgView.DoneButton:SetScript('OnClick', function() ClickDoneBtn(0); end); aaDzFrame.mainView.bgView.DoneButton:Show(); end; aaDzFrame.mainView.bgView.DoneButton1 = CreateFrame('Button', nil, aaDzFrame.mainView.bgView, '') do aaDzFrame.mainView.bgView.DoneButton1:SetPoint('CENTER', aaDzFrame.mainView.bgView, 'CENTER', 3, -30); aaDzFrame.mainView.bgView.DoneButton1:SetSize(138, 32); aaDzFrame.mainView.bgView.DoneButton1:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-czsx1"); aaDzFrame.mainView.bgView.DoneButton1:SetDisabledTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-czsx2"); aaDzFrame.mainView.bgView.DoneButton1:SetHighlightTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-czsx1"); aaDzFrame.mainView.bgView.DoneButton1:SetPushedTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-czsx1"); aaDzFrame.mainView.bgView.DoneButton1:Disable(); aaDzFrame.mainView.bgView.DoneButton1:SetScript('OnClick', function() ClickDoneBtn(9); end); aaDzFrame.mainView.bgView.DoneButton1:Hide(); end; aaDzFrame.mainView.bgView.DoneButton2 = CreateFrame('Button', nil, aaDzFrame.mainView.bgView, '') do aaDzFrame.mainView.bgView.DoneButton2:SetPoint('CENTER', aaDzFrame.mainView.bgView, 'CENTER', 3, -70); aaDzFrame.mainView.bgView.DoneButton2:SetSize(138, 32); aaDzFrame.mainView.bgView.DoneButton2:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-czjn1"); aaDzFrame.mainView.bgView.DoneButton2:SetDisabledTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-czjn2"); aaDzFrame.mainView.bgView.DoneButton2:SetHighlightTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-czjn1"); aaDzFrame.mainView.bgView.DoneButton2:SetPushedTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-czjn1"); aaDzFrame.mainView.bgView.DoneButton2:Disable(); aaDzFrame.mainView.bgView.DoneButton2:SetScript('OnClick', function() ClickDoneBtn(10); end); aaDzFrame.mainView.bgView.DoneButton2:Hide(); end; aaDzFrame.mainView.bgView.CancelButton = CreateFrame('Button', nil, aaDzFrame.mainView.bgView, 'UIPanelCloseButton') do aaDzFrame.mainView.bgView.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDzFrame.mainView.bgView.CancelButton:SetPoint('TOPRIGHT', aaDzFrame.mainView.bgView, 'TOPRIGHT', -8, -25); aaDzFrame.mainView.bgView.CancelButton:SetSize(44, 44); aaDzFrame.mainView.bgView.CancelButton:SetScript('OnClick', function() aaDzFrame:hide(); end); end; aaDzFrame.mainView.bgView.detailView1 = CreateFrame("Frame",nil,aaDzFrame.mainView.bgView) do aaDzFrame.mainView.bgView.detailView1:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView.bgView.detailView1:SetWidth(260); aaDzFrame.mainView.bgView.detailView1:SetHeight(225); aaDzFrame.mainView.bgView.detailView1:SetPoint("TOPLEFT",aaDzFrame.mainView.bgView,'TOPLEFT',40,-130); aaDzFrame.mainView.bgView.detailView1:Hide(); aaDzFrame.mainView.bgView.detailView1.stattext = aaDzFrame.mainView.bgView.detailView1:CreateFontString("aaDzFrame.mainView.bgView.detailView1.stattext", "OVERLAY", "GameFontNormal") do aaDzFrame.mainView.bgView.detailView1.stattext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDzFrame.mainView.bgView.detailView1.stattext:SetPoint("TOPLEFT", aaDzFrame.mainView.bgView.detailView1, "TOPLEFT", 5, -10); aaDzFrame.mainView.bgView.detailView1.stattext:SetAllPoints(aaDzFrame.mainView.bgView.detailView1); aaDzFrame.mainView.bgView.detailView1.stattext:SetSpacing(5); end; end; aaDzFrame.mainView.bgView.detailView2 = CreateFrame("Frame",nil,aaDzFrame.mainView.bgView) do aaDzFrame.mainView.bgView.detailView2:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView.bgView.detailView2:SetWidth(260); aaDzFrame.mainView.bgView.detailView2:SetHeight(225); aaDzFrame.mainView.bgView.detailView2:SetPoint("TOPLEFT",aaDzFrame.mainView.bgView,'TOPLEFT',40+260+170,-130); aaDzFrame.mainView.bgView.detailView2:Hide(); aaDzFrame.mainView.bgView.detailView2.needtext = aaDzFrame.mainView.bgView.detailView2:CreateFontString("aaDzFrame.mainView.bgView.detailView2.needtext", "OVERLAY", "GameFontNormal") do aaDzFrame.mainView.bgView.detailView2.needtext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDzFrame.mainView.bgView.detailView2.needtext:SetPoint("TOP", aaDzFrame.mainView.bgView.detailView2, "TOP", 0, -10); aaDzFrame.mainView.bgView.detailView2.needtext:SetAllPoints(aaDzFrame.mainView.bgView.detailView2); aaDzFrame.mainView.bgView.detailView2.needtext:SetSpacing(5); end; end; aaDzFrame.mainView.bgView.detailView41 = CreateFrame("Frame",nil,aaDzFrame.mainView.bgView) do aaDzFrame.mainView.bgView.detailView41:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView.bgView.detailView41:SetWidth(260); aaDzFrame.mainView.bgView.detailView41:SetHeight(225); aaDzFrame.mainView.bgView.detailView41:SetPoint("TOPLEFT",aaDzFrame.mainView.bgView,'TOPLEFT',40,-130); aaDzFrame.mainView.bgView.detailView41:Hide(); local left = 10; local top = -5; local width = 40; local space = 10; local topspace = 5; fwitemBtns[1] = CreateFwBtn(1,left+width+space,top); fwitemBtns[2] = CreateFwBtn(2,left,top-width-topspace); fwitemBtns[3] = CreateFwBtn(3,left,top-width-topspace*2-width); fwitemBtns[4] = CreateFwBtn(4,left+width+space,top-width*3-topspace*3); fwitemBtns[5] = CreateFwBtn(5,left+width*2+space*2,top-width*2-topspace*2); fwitemBtns[6] = CreateFwBtn(6,left+width*3+space*3,top-width*3-topspace*3); fwitemBtns[7] = CreateFwBtn(7,left+width*4+space*4,top-width*2-topspace*2); fwitemBtns[8] = CreateFwBtn(8,left+width*4+space*4,top-width-topspace); fwitemBtns[9] = CreateFwBtn(9,left+width*3+space*3,top); aaDzFrame.mainView.bgView.detailView41.xqBtn = CreateFrame('Button', nil, aaDzFrame.mainView.bgView.detailView41, '') do aaDzFrame.mainView.bgView.detailView41.xqBtn:SetPoint('CENTER', aaDzFrame.mainView.bgView.detailView41, 'CENTER', 0, -95); aaDzFrame.mainView.bgView.detailView41.xqBtn:SetSize(128, 32); aaDzFrame.mainView.bgView.detailView41.xqBtn:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-kqcc"); aaDzFrame.mainView.bgView.detailView41.xqBtn:SetDisabledTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-kqcc"); aaDzFrame.mainView.bgView.detailView41.xqBtn:SetHighlightTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-kqcc"); aaDzFrame.mainView.bgView.detailView41.xqBtn:SetPushedTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-kqcc"); aaDzFrame.mainView.bgView.detailView41.xqBtn:SetScript('OnClick', function() ClickFuwenKaiChaoBtn(); end); end; aaDzFrame.mainView.bgView.detailView41.kcText = aaDzFrame.mainView.bgView.detailView41:CreateFontString("aaDzFrame.mainView.bgView.detailView2.needtext", "OVERLAY", "GameFontNormal") do aaDzFrame.mainView.bgView.detailView41.kcText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDzFrame.mainView.bgView.detailView41.kcText:SetPoint("TOPLEFT", aaDzFrame.mainView.bgView.detailView41, "TOPLEFT", 0, -205); aaDzFrame.mainView.bgView.detailView41.kcText:SetSize(230, 70); aaDzFrame.mainView.bgView.detailView41.kcText:SetSpacing(5); end; aaDzFrame.mainView.bgView.detailView41.cxText1 = aaDzFrame.mainView.bgView.detailView41:CreateFontString("aaDzFrame.mainView.bgView.detailView2.needtext", "OVERLAY", "GameFontNormal") do aaDzFrame.mainView.bgView.detailView41.cxText1:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDzFrame.mainView.bgView.detailView41.cxText1:SetPoint("TOPLEFT", aaDzFrame.mainView.bgView.detailView41, "TOPLEFT", 0, 47); aaDzFrame.mainView.bgView.detailView41.cxText1:SetText(aaData.color_yellows.."提示：双击鼠标可以拆卸符文。"); aaDzFrame.mainView.bgView.detailView41.cxText1:SetHeight(20); aaDzFrame.mainView.bgView.detailView41.cxText1:SetSpacing(5); end; aaDzFrame.mainView.bgView.detailView41.cxText2 = aaDzFrame.mainView.bgView.detailView41:CreateFontString("aaDzFrame.mainView.bgView.detailView2.needtext", "OVERLAY", "GameFontNormal") do aaDzFrame.mainView.bgView.detailView41.cxText2:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDzFrame.mainView.bgView.detailView41.cxText2:SetPoint("TOPLEFT", aaDzFrame.mainView.bgView.detailView41, "TOPLEFT", 0, 22); aaDzFrame.mainView.bgView.detailView41.cxText2:SetSpacing(5); end; end; aaDzFrame.mainView.bgView.detailView42 = CreateFrame("Frame",nil,aaDzFrame.mainView.bgView) do aaDzFrame.mainView.bgView.detailView42:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView.bgView.detailView42:SetWidth(260); aaDzFrame.mainView.bgView.detailView42:SetHeight(225); aaDzFrame.mainView.bgView.detailView42:SetPoint("TOPLEFT",aaDzFrame.mainView.bgView,'TOPLEFT',40+260+170,-130); aaDzFrame.mainView.bgView.detailView42:Show(); aaDzFrame.mainView.bgView.detailView42.needtext = aaDzFrame.mainView.bgView.detailView42:CreateFontString("aaDzFrame.mainView.bgView.detailView2.needtext", "OVERLAY", "GameFontNormal") do aaDzFrame.mainView.bgView.detailView42.needtext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDzFrame.mainView.bgView.detailView42.needtext:SetPoint("TOP", aaDzFrame.mainView.bgView.detailView42, "TOP", 0, -10); aaDzFrame.mainView.bgView.detailView42.needtext:SetAllPoints(aaDzFrame.mainView.bgView.detailView42); aaDzFrame.mainView.bgView.detailView42.needtext:SetSpacing(5); end; end; aaDzFrame.mainView.bgView.detailView51 = CreateFrame("Frame",nil,aaDzFrame.mainView.bgView) do aaDzFrame.mainView.bgView.detailView51:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView.bgView.detailView51:SetWidth(260); aaDzFrame.mainView.bgView.detailView51:SetHeight(225); aaDzFrame.mainView.bgView.detailView51:SetPoint("TOPLEFT",aaDzFrame.mainView.bgView,'TOPLEFT',40,-130); aaDzFrame.mainView.bgView.detailView51:Hide(); aaDzFrame.mainView.bgView.detailView51.gaimingnametext = aaDzFrame.mainView.bgView.detailView51:CreateFontString("aaDzFrame.mainView.bgView.detailView51.gaimingnametext", "OVERLAY", "GameFontNormal") do aaDzFrame.mainView.bgView.detailView51.gaimingnametext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDzFrame.mainView.bgView.detailView51.gaimingnametext:SetPoint("TOPLEFT", aaDzFrame.mainView.bgView.detailView51, "TOPLEFT", 0, 0); aaDzFrame.mainView.bgView.detailView51.gaimingnametext:SetWidth(260); aaDzFrame.mainView.bgView.detailView51.gaimingnametext:SetHeight(44); end; aaDzFrame.mainView.bgView.detailView51.nameEditBox = CreateFrame('EditBox', "aaDzFrame.mainView.bgView.detailView51.nameEditBox", aaDzFrame.mainView.bgView.detailView51, 'InputBoxTemplate') do aaDzFrame.mainView.bgView.detailView51.nameEditBox:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDzFrame.mainView.bgView.detailView51.nameEditBox:SetWidth(230); aaDzFrame.mainView.bgView.detailView51.nameEditBox:SetHeight(80); aaDzFrame.mainView.bgView.detailView51.nameEditBox:SetMaxLetters(36); aaDzFrame.mainView.bgView.detailView51.nameEditBox:SetPoint("TOPLEFT", aaDzFrame.mainView.bgView.detailView51, "TOPLEFT", 20, -44); aaDzFrame.mainView.bgView.detailView51.nameEditBox:SetText("请输入改名后装备名称。"); end; aaDzFrame.mainView.bgView.detailView51.needtext = aaDzFrame.mainView.bgView.detailView51:CreateFontString("aaDzFrame.mainView.bgView.detailView51.needtext", "OVERLAY", "GameFontNormal") do aaDzFrame.mainView.bgView.detailView51.needtext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDzFrame.mainView.bgView.detailView51.needtext:SetPoint("TOPLEFT", aaDzFrame.mainView.bgView.detailView51, "TOPLEFT", 0, -88); aaDzFrame.mainView.bgView.detailView51.needtext:SetWidth(260); aaDzFrame.mainView.bgView.detailView51.needtext:SetHeight(300-88-44); aaDzFrame.mainView.bgView.detailView51.needtext:SetSpacing(5); end; end; aaDzFrame.mainView.bgView.detailView52 = CreateFrame("Frame",nil,aaDzFrame.mainView.bgView) do aaDzFrame.mainView.bgView.detailView52:SetFrameStrata("TOOLTIP"); aaDzFrame.mainView.bgView.detailView52:SetWidth(260); aaDzFrame.mainView.bgView.detailView52:SetHeight(225); aaDzFrame.mainView.bgView.detailView52:SetPoint("TOPLEFT",aaDzFrame.mainView.bgView,'TOPLEFT',40+260+170,-130); aaDzFrame.mainView.bgView.detailView52:Hide(); aaDzFrame.mainView.bgView.detailView52.needtext = aaDzFrame.mainView.bgView.detailView52:CreateFontString("aaDzFrame.mainView.bgView.detailView52.needtext", "OVERLAY", "GameFontNormal") do aaDzFrame.mainView.bgView.detailView52.needtext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDzFrame.mainView.bgView.detailView52.needtext:SetPoint("TOP", aaDzFrame.mainView.bgView.detailView52, "TOP", 0, -10); aaDzFrame.mainView.bgView.detailView52.needtext:SetAllPoints(aaDzFrame.mainView.bgView.detailView52); aaDzFrame.mainView.bgView.detailView52.needtext:SetSpacing(5); aaDzFrame.mainView.bgView.detailView52.needtext:SetText("改名说明：\n\n1.改名需要消耗改名道具；\n2.个别特殊符号无法使用，尽量使用常用字符；\n3.改名后的装备在其他玩家查看、聊天发送和拍卖也同样生效。"); end; end;  function MoneyInputFrame_ResetMoney(moneyFrame) _G[moneyFrame:GetName().."Gold"]:SetText(""); _G[moneyFrame:GetName().."Silver"]:SetText(""); _G[moneyFrame:GetName().."Copper"]:SetText(""); end; function MoneyInputFrame_ClearFocus(moneyFrame) _G[moneyFrame:GetName().."Gold"]:ClearFocus(); _G[moneyFrame:GetName().."Silver"]:ClearFocus(); _G[moneyFrame:GetName().."Copper"]:ClearFocus(); end; local MoneyInputFrame_GetCopper_gold = "0"; function MoneyInputFrame_GetCopper(moneyFrame) local totalCopper = 0; local aa_totalCopper = 0; local copper = _G[moneyFrame:GetName().."Copper"]:GetText(); local silver = _G[moneyFrame:GetName().."Silver"]:GetText(); local gold = _G[moneyFrame:GetName().."Gold"]:GetText(); if ( copper ~= "" ) then totalCopper = totalCopper + copper; end; if ( silver ~= "" ) then totalCopper = totalCopper + (silver * COPPER_PER_SILVER); end; if ( gold ~= "" ) then aa_totalCopper = gold + 0; totalCopper = totalCopper + (gold * COPPER_PER_GOLD); end; local isTongbi = aaData:getAuctionName(); if isTongbi ~= "铜币" and (moneyFrame == StartPrice or moneyFrame == BuyoutPrice) then if moneyFrame == StartPrice then local editbox = _G[moneyFrame:GetName().."Gold"]; editbox:SetText(MoneyInputFrame_GetCopper_gold); elseif moneyFrame == BuyoutPrice then local editbox = _G[moneyFrame:GetName().."Gold"]; MoneyInputFrame_GetCopper_gold = editbox:GetText(); end; return aa_totalCopper; else return totalCopper; end; end; function MoneyInputFrame_SetTextColor(moneyFrame, r, g, b) _G[moneyFrame:GetName().."Copper"]:SetTextColor(r, g, b); _G[moneyFrame:GetName().."Silver"]:SetTextColor(r, g, b); _G[moneyFrame:GetName().."Gold"]:SetTextColor(r, g, b); end; function MoneyInputFrame_SetCopper(moneyFrame, money) local isTongbi = aaData:getAuctionName(); if isTongbi ~= "铜币" then local gold = floor(money / (COPPER_PER_GOLD)); local silver = floor((money - (gold * COPPER_PER_GOLD)) / COPPER_PER_SILVER); local copper = mod(money, COPPER_PER_SILVER); local editbox = nil; moneyFrame.expectChanges = 0; editbox = _G[moneyFrame:GetName().."Copper"]; if ( editbox:GetNumber() ~= copper ) then editbox:SetNumber(copper); moneyFrame.expectChanges = moneyFrame.expectChanges + 1; end; editbox = _G[moneyFrame:GetName().."Silver"]; if ( editbox:GetNumber() ~= silver ) then editbox:SetNumber(0); moneyFrame.expectChanges = moneyFrame.expectChanges + 1; end; editbox = _G[moneyFrame:GetName().."Gold"]; if ( editbox:GetNumber() ~= gold ) then editbox:SetNumber(0); moneyFrame.expectChanges = moneyFrame.expectChanges + 1; end; end; end; function MoneyInputFrame_OnTextChanged(self) local moneyFrame = self:GetParent(); if ( moneyFrame.expectChanges ) then if ( moneyFrame.expectChanges > 1 ) then moneyFrame.expectChanges = moneyFrame.expectChanges - 1; return; end; moneyFrame.expectChanges = nil; end if ( self:GetParent().onValueChangedFunc ) then self:GetParent().onValueChangedFunc(); end; if TokenAuctionEnable and (moneyFrame == StartPrice or moneyFrame == BuyoutPrice or moneyFrame == BidBidPrice or moneyFrame == BrowseBidPrice) then moneyFrame.silver:SetText("0"); moneyFrame.copper:SetText("0"); end; end; function MoneyInputFrame_SetMode(frame, mode) local frameName = frame:GetName(); if ( mode == "compact" ) then _G[frameName.."Gold"]:SetWidth(56); end; end; function MoneyInputFrame_SetPreviousFocus(moneyFrame, focus) moneyFrame.previousFocus = focus; end; function MoneyInputFrame_SetNextFocus(moneyFrame, focus) moneyFrame.nextFocus = focus; end; function MoneyInputFrame_SetOnValueChangedFunc(moneyFrame, func) moneyFrame.onValueChangedFunc = func; end; function MoneyInputFrame_OnShow(moneyFrame) local isTongbi = aaData:getAuctionName(); if isTongbi ~= "铜币" then if moneyFrame == StartPrice then moneyFrame:Hide(); end; if moneyFrame == BuyoutPrice then point, relativeTo, relativePoint, xOfs, yOfs = moneyFrame:GetPoint(); moneyFrame:SetPoint(point, relativeTo, relativePoint, xOfs, 145); moneyFrame.gold.texture:Hide(); moneyFrame.gold.label:SetText(aaData.color_blue.."["..aaData:getAuctionName().."]|r"); moneyFrame.gold.label:Show(); moneyFrame.gold.label:SetWidth(100); moneyFrame.silver:Hide(); moneyFrame.copper:Hide(); local editbox = _G[moneyFrame:GetName().."Gold"]; editbox:SetWidth(110); editbox:SetMaxLetters(12); elseif moneyFrame == BrowseBidPrice then moneyFrame:Hide(); end; end; end;