aaDesktop = {}; aaDesktop.aaDialog = {}; aaDesktop.aaMapFrame = {}; aaDesktop.aaChoujiang = {}; aaDesktop.aaBoss = {}; aaDesktop.aaJLLicai = {}; aaDesktop.aaJLShouchong = {}; aaDesktop.aaCode = {}; aaDesktop.IconButtons = {}; aaDesktop.IconBtton99 = {}; aaDesktop.aaHuodong = {}; aaDesktop.aaFanpai = {}; aaDesktop.aaShop = {}; aaDesktop.aaHunyu = {}; aaDesktop.aaChuansong = {}; aaDesktop.aaBianshen = {}; aaDesktop.aaShenqi = {}; aaDesktop.aaJuanxian = {}; aaDesktop.aaJiJieHao = {}; aaDesktop.aaXilian = {}; aaDesktop.aaZiyuan = {}; aaDesktop.aaGongcheng = {}; aaDesktop.aaHuoyue = {}; function aaDesktop:ClickMenuBtn(id) PlaySound("igPlayerInviteDecline", "Master") aaDzFrame:hide(); aaPetFrame:hide(); aaDesktop.aaJLLevel:hide(); aaDesktop.aaJLLicai:hide(); aaDesktop.aaJLShouchong:hide(); aaDesktop.aaJLLeichong:hide(); aaDesktop.aaJLQiandao:hide(); aaDesktop.aaChoujiang:hide(); aaDesktop.aaHuodong:hide(); aaDesktop.aaShop:hide(); aaDesktop.aaHunyu:hide(); aaDesktop.aaBianshen:hide(); aaDesktop.aaShenqi:hide(); aaDesktop.aaJuanxian:hide(); aaDesktop.aaJiJieHao:hide(); aaDesktop.aaJiJieHao:hideMenu(); aaDesktop.aaXilian:hide(); aaDesktop.aaHuoyue:hide(); if id ~= 10 then aaData:sendAddonMsg(10110,"2", "GUILD"); end; if id == 1 then aaDzFrame:show(); elseif id == 2 then aaPetFrame:show(); elseif id == 4 then aaDesktop.aaJLLevel:show(); elseif id == 5 then aaDesktop.aaJLLicai:show(); elseif id == 6 then aaDesktop.aaJLShouchong:show(); elseif id == 7 then aaData:sendAddonMsg(1005, "0", "GUILD"); aaDesktop.aaJLLeichong:show(); elseif id == 8 then aaDesktop.aaJLQiandao:show(); elseif id == 9 then aaDesktop.aaChoujiang:show(); elseif id == 10 then aaDesktop.aaHuodong:show(); elseif id == 11 then aaDesktop.aaShop:show(); aaDesktop.aaShop:ClickBiaoqian(1); elseif id == 12 then aaDesktop.aaHunyu:show(); aaDesktop.aaHunyu:ClickCell(1); elseif id == 13 then aaData:sendAddonMsg(3023, aaDesktop.aaBianshen.selectLan.."\t"..aaDesktop.aaBianshen.selectIndex, "GUILD"); elseif id == 14 then aaData:sendAddonMsg(3031, aaDesktop.aaShenqi.selectLan.."\t"..aaDesktop.aaShenqi.selectIndex, "GUILD"); elseif id == 15 then aaDesktop.aaJuanxian:show(); elseif id == 16 then aaDesktop.aaJiJieHao:show(); aaData:sendAddonMsg(3050, "1", "GUILD"); elseif id == 17 then aaDesktop.aaXilian:show(); aaDesktop.aaXilian:reload(); elseif id == 18 then aaDesktop.aaHuoyue:show(); aaData:sendAddonMsg(3091, "0", "GUILD"); elseif id == 99 then for key, value in ipairs(aaDesktop.IconButtons) do if value:IsShown() then value:Hide(); else value:Show(); end; end; end; for k,v in pairs(aa_desktop) do if k>0 and v~=nil and v~="" and v~={} then local typestr = v[1]; if typestr ~= nil and typestr ~= "" and id == typestr+0 and v[7] ~= "" then local www = v[7]..""; if www ~= nil and www ~= "" then aa_shangdi = v[7]; ReloadUI(); break; end; end; end; end; end; local GetSpellIcon = function(index) local _, _, icon, _, _, _ = GetSpellInfo(index); return icon; end; local IconView = function(index,x,y,icon,text) local menuSize = 60; local textHeight = 25; local buttonSize = 35; local menuView = CreateFrame("Frame",nil,UIParent) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(menuSize); menuView:SetHeight(menuSize); menuView:SetToplevel(true); menuView:SetClampedToScreen(true); menuView:SetPoint("BOTTOMRIGHT",UIParent,'BOTTOMRIGHT',x,y); menuView:Show(); end; if text then local IconText = menuView:CreateFontString("IconText", "OVERLAY", "GameFontNormal") do IconText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 0, -buttonSize); IconText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 13); IconText:SetWidth(menuSize); IconText:SetHeight(textHeight); IconText:SetSpacing(0); IconText:SetText(text); end; end; if icon then local IconButton = CreateFrame('Button', "OVERLAY", menuView, '') do IconButton:SetPoint('CENTER', menuView, 'CENTER', 0, (menuSize-buttonSize)/2-5); IconButton:SetButtonState('NORMAL'); IconButton:IsEnabled(); IconButton:SetNormalTexture(icon); IconButton:SetDisabledTexture(icon); IconButton:SetHighlightTexture(icon); IconButton:SetPushedTexture(icon); IconButton:SetWidth(buttonSize); IconButton:SetHeight(buttonSize); IconButton:SetScript('OnClick', function() aaDesktop:ClickMenuBtn(index); end); IconButton:SetScript("OnEnter", function(self) GameTooltip:SetOwner(self, "ANCHOR_RIGHT"); GameTooltip.default = 1; GameTooltip:SetText("|cFF99FF33单击显示功能|r\n|cFF00CCFF再次单击隐藏|r\n|cFF00CCFF按 Esc 键退出|r"); GameTooltip:Show(); GameTooltip:SetToplevel(true); end); IconButton:SetScript("OnLeave",function(self) GameTooltip:Hide(); end); end; end; return menuView; end; local rightspace = -180; local space = -55; aaDesktop.IconBtton99 = CreateFrame('Button', nil, UIParent, '') do aaDesktop.IconBtton99:SetFrameStrata("TOOLTIP"); aaDesktop.IconBtton99:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\yincang"}); aaDesktop.IconBtton99:SetWidth(50); aaDesktop.IconBtton99:SetHeight(50); aaDesktop.IconBtton99:SetToplevel(true); aaDesktop.IconBtton99:SetClampedToScreen(true); aaDesktop.IconBtton99:SetMovable(true); aaDesktop.IconBtton99:EnableMouse(true); aaDesktop.IconBtton99:RegisterForDrag("LeftButton"); aaDesktop.IconBtton99:SetPoint("BOTTOMRIGHT",UIParent,'BOTTOMRIGHT',-220,110); aaDesktop.IconBtton99:SetScript("OnEnter", function(self) GameTooltip:SetOwner(self, "ANCHOR_RIGHT"); GameTooltip.default = 1; GameTooltip:SetText("|cFFFF0033按钮显示隐藏|r\n|cFFFFCC66按住拖动图标|r\n|cFF99FF33单击显示功能|r\n|cFF00CCFF再次单击隐藏|r\n|cFF00CCFF按 Esc 键退出|r"); GameTooltip:Show(); end); aaDesktop.IconBtton99:SetScript("OnLeave",function(self) GameTooltip:Hide(); end); aaDesktop.IconBtton99:SetScript("OnDragStart",function() this:StartMoving(); end); aaDesktop.IconBtton99:SetScript("OnDragStop",function() this:StopMovingOrSizing(); end); aaDesktop.IconBtton99:SetScript("OnMouseUp",  function(self) aaDesktop:ClickMenuBtn(99); end); aaDesktop.IconBtton99:Hide(); end; function aaDesktop:show() local index = 1; local hideBtn = 0; for k,v in pairs(aa_desktop) do if k>0 and v~=nil and v~="" and v~={} then local open = v[2]; if open == 1 then hideBtn = 1; local type = v[1]; local title = v[3]; local iconpath = v[4]; local iconspell = v[5]; local iconitem = v[6]; if iconpath ~= "" then icon = iconpath; end if iconspell > 0 then icon = GetSpellIcon(iconspell); end if iconitem > 0 then icon = GetItemIcon(iconitem); end if title == "" then title = "未知"; end local top = 100; local left = -50; local count = 6; if index > count then top = 158; left = 55*count - 50; end aaDesktop.IconButtons[index] = IconView(type,left+rightspace+space*index,top,icon,title); index = index + 1; end end; end; if hideBtn == 1 then aaDesktop.IconBtton99:Show(); else aaDesktop.IconBtton99:Hide(); end; end;    aaDesktop.aaDialog.msgdata = {}; aaDesktop.aaDialog.mainView = CreateFrame("Frame",nil,UIParent) do aaDesktop.aaDialog.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaDialog.mainView:SetBackdrop( { bgFile = "Interface\\DialogFrame\\UI-DialogBox-Background", edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border", edgeSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); aaDesktop.aaDialog.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaDialog.mainView:SetWidth(430); aaDesktop.aaDialog.mainView:SetHeight(200); aaDesktop.aaDialog.mainView:SetPoint("CENTER",0,0); aaDesktop.aaDialog.mainView:SetToplevel(true); aaDesktop.aaDialog.mainView:SetClampedToScreen(true); aaDesktop.aaDialog.mainView:SetMovable(true); aaDesktop.aaDialog.mainView:EnableMouse(true); aaDesktop.aaDialog.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaDialog.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaDialog.mainView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaDialog.mainView"); end; aaDesktop.aaDialog.titletext = {}; aaDesktop.aaDialog.detailText = {}; aaDesktop.aaDialog.DoneButton = {}; aaDesktop.aaDialog.CancelButton = {}; aaDesktop.aaDialog.ClickDoneBtn = function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if aaDesktop.aaDialog.msgdata[1] > 0 then aaData:sendAddonMsg(200, aaDesktop.aaDialog.msgdata[1].."\t"..aaDesktop.aaDialog.msgdata[2], "GUILD"); elseif aaDesktop.aaDialog.msgdata[1] == -1 then local aafunc = loadstring("return "..aaDesktop.aaDialog.msgdata[5])(); if aafunc then aafunc(); end; end; aaDesktop.aaDialog:hide(); end; aaDesktop.aaDialog.ClickCancelBtn = function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if aaDesktop.aaDialog.msgdata[1] > 0 then aaData:sendAddonMsg(201, aaDesktop.aaDialog.msgdata[1].."\t"..aaDesktop.aaDialog.msgdata[2], "GUILD"); elseif aaDesktop.aaDialog.msgdata[1] == -1 then local aafunc = loadstring("return "..aaDesktop.aaDialog.msgdata[6])(); if aafunc then aafunc(); end; end; aaDesktop.aaDialog:hide(); end; function aaDesktop.aaDialog:show(msg) if msg == "{}" then else aaDesktop.aaDialog.msgdata = loadstring("return " .. msg)(); if aaDesktop.aaDialog.msgdata[3] ~= "" or aaDesktop.aaDialog.msgdata[4] ~= "" then aaDesktop.aaDialog.titletext:SetText(aaDesktop.aaDialog.msgdata[3]); aaDesktop.aaDialog.detailText:SetText(aaDesktop.aaDialog.msgdata[4]); aaDesktop.aaDialog.mainView:Show(); aaDesktop.aaDialog.mainView:SetHeight(aaDesktop.aaDialog.detailText:GetHeight()+44+60); end; end; end; function aaDesktop.aaDialog:hide() aaDesktop.aaDialog.mainView:Hide(); end; aaDesktop.aaDialog.titletext = aaDesktop.aaDialog.mainView:CreateFontString("titletext", "OVERLAY", "GameFontNormal") do aaDesktop.aaDialog.titletext:SetPoint("TOPLEFT", aaDesktop.aaDialog.mainView, "TOPLEFT", 0, -10); aaDesktop.aaDialog.titletext:SetWidth(430); aaDesktop.aaDialog.titletext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 24); end; aaDesktop.aaDialog.DoneButton = CreateFrame('Button', nil, aaDesktop.aaDialog.mainView, 'UIPanelButtonTemplate') do aaDesktop.aaDialog.DoneButton:SetPoint('BOTTOMLEFT', aaDesktop.aaDialog.mainView, 'BOTTOMLEFT', 50, 15); aaDesktop.aaDialog.DoneButton:SetSize(120, 30); aaDesktop.aaDialog.DoneButton:SetText("接受"); aaDesktop.aaDialog.DoneButton:SetScript('OnClick', function() aaDesktop.aaDialog.ClickDoneBtn(); end); end; aaDesktop.aaDialog.CancelButton = CreateFrame('Button', nil, aaDesktop.aaDialog.mainView, 'UIPanelButtonTemplate') do aaDesktop.aaDialog.CancelButton:SetPoint('BOTTOMRIGHT', aaDesktop.aaDialog.mainView, 'BOTTOMRIGHT', -50, 15); aaDesktop.aaDialog.CancelButton:SetSize(120, 30); aaDesktop.aaDialog.CancelButton:SetText("取消"); aaDesktop.aaDialog.CancelButton:SetScript('OnClick', function() aaDesktop.aaDialog.ClickCancelBtn(); end); end; aaDesktop.aaDialog.detailText = aaDesktop.aaDialog.mainView:CreateFontString("detailText", "OVERLAY", "GameFontNormal") do aaDesktop.aaDialog.detailText:SetPoint("TOPLEFT", aaDesktop.aaDialog.mainView, "TOPLEFT", 15, -44); aaDesktop.aaDialog.detailText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaDialog.detailText:SetWidth(400); aaDesktop.aaDialog.detailText:SetSpacing(5); end;   aaDesktop.aaMapFrame.toolText = "|cFFFFCC66按住可以拖动进度条|r"; aaDesktop.aaMapFrame.time = 0; local mapTime1 = GetTime(); local function aaMapFrameUpdateTime(btn, elapsed) local time2 = GetTime()-mapTime1; if aaDesktop.aaMapFrame.time > 0 then aaDesktop.aaMapFrame.mainView.titletext2:Show(); else aaDesktop.aaMapFrame.mainView.titletext2:Hide(); end; if time2 >= 1 then mapTime1 = GetTime(); aaDesktop.aaMapFrame.time = aaDesktop.aaMapFrame.time - 1000; aaDesktop.aaMapFrame.mainView.titletext2:SetText(aaData.color_reds.."剩余挑战时间："..aaData.color_red..aaData:secondsTox(aaDesktop.aaMapFrame.time/1000)); end; end; aaDesktop.aaMapFrame.mainView = CreateFrame("Frame",nil,UIParent) do aaDesktop.aaMapFrame.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaMapFrame.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaMapFrame.mainView:SetWidth(400); aaDesktop.aaMapFrame.mainView:SetHeight(47); aaDesktop.aaMapFrame.mainView:SetPoint('CENTER', UIParent, 'TOP', 0, -90); aaDesktop.aaMapFrame.mainView:SetToplevel(true); aaDesktop.aaMapFrame.mainView:SetClampedToScreen(true); aaDesktop.aaMapFrame.mainView:SetMovable(true); aaDesktop.aaMapFrame.mainView:EnableMouse(true); aaDesktop.aaMapFrame.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaMapFrame.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaMapFrame.mainView:Hide(); aaDesktop.aaMapFrame.mainView:SetScript("OnEnter", function(self) GameTooltip:SetOwner(self, "ANCHOR_BOTTOM"); GameTooltip.default = 1; GameTooltip:SetText(aaDesktop.aaMapFrame.toolText); GameTooltip:Show(); end); aaDesktop.aaMapFrame.mainView:SetScript("OnLeave", function(self) GameTooltip:Hide(); end); end; aaDesktop.aaMapFrame.mainView.titletext1 = aaDesktop.aaMapFrame.mainView:CreateFontString("aaDesktop.aaMapFrame.mainView.titletext1", "OVERLAY", "GameFontNormal") do aaDesktop.aaMapFrame.mainView.titletext1:SetPoint("TOPLEFT", aaDesktop.aaMapFrame.mainView, "TOPLEFT", 0, 0); aaDesktop.aaMapFrame.mainView.titletext1:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaMapFrame.mainView.titletext1:SetText(aaData.color_reds.."死亡次数："..aaData.color_red.."0/0"); end; aaDesktop.aaMapFrame.mainView.titletext2 = aaDesktop.aaMapFrame.mainView:CreateFontString("aaDesktop.aaMapFrame.mainView.titletext2", "OVERLAY", "GameFontNormal") do aaDesktop.aaMapFrame.mainView.titletext2:SetPoint("TOPRIGHT", aaDesktop.aaMapFrame.mainView, "TOPRIGHT", 0, 0); aaDesktop.aaMapFrame.mainView.titletext2:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaMapFrame.mainView.titletext2:SetText(aaData.color_reds.."剩余挑战时间："..aaData.color_red..aaData:secondsTox(0)); end; aaDesktop.aaMapFrame.mainView.QueryProgressBar = CreateFrame("StatusBar", nil, aaDesktop.aaMapFrame.mainView); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetHeight(21); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetWidth(400); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetPoint("TOPLEFT", aaDesktop.aaMapFrame.mainView, "TOPLEFT", 0, -26); local title = aaDesktop.aaMapFrame.mainView.QueryProgressBar:CreateFontString(nil, "OVERLAY", "GameFontNormal"); title:SetPoint("CENTER", 6, 4); title:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); title:SetText("鼠标停留查看奖励"); aaDesktop.aaMapFrame.mainView.QueryProgressBar.title = title; local progress = aaDesktop.aaMapFrame.mainView.QueryProgressBar:CreateFontString(nil, "OVERLAY", "GameFontHighlight"); progress:SetHeight(14); progress:SetPoint("RIGHT", -5, 3); aaDesktop.aaMapFrame.mainView.QueryProgressBar.progress = progress; local leftProgressTexture = aaDesktop.aaMapFrame.mainView.QueryProgressBar:CreateTexture(nil, "OVERLAY") leftProgressTexture:SetTexture([[Interface\AchievementFrame\UI-Achievement-Header]]) leftProgressTexture:SetWidth(32); leftProgressTexture:SetHeight(48); leftProgressTexture:SetPoint("TOPLEFT", -15, 16); leftProgressTexture:SetTexCoord(0.423828125, 0.486, 0.56640625, 0.75); aaDesktop.aaMapFrame.mainView.QueryProgressBar.leftProgressTexture = leftProgressTexture; local rightProgressTexture = aaDesktop.aaMapFrame.mainView.QueryProgressBar:CreateTexture(nil, "OVERLAY") rightProgressTexture:SetTexture([[Interface\AchievementFrame\UI-Achievement-Header]]); rightProgressTexture:SetWidth(32); rightProgressTexture:SetHeight(48); rightProgressTexture:SetPoint("TOPRIGHT", 15, 16); rightProgressTexture:SetTexCoord(0.486, 0.423828125, 0.56640625, 0.75); aaDesktop.aaMapFrame.mainView.QueryProgressBar.rightProgressTexture = rightProgressTexture; local middleProgressTexture = aaDesktop.aaMapFrame.mainView.QueryProgressBar:CreateTexture(nil, "OVERLAY"); middleProgressTexture:SetTexture([[Interface\AchievementFrame\UI-Achievement-Header]]); middleProgressTexture:SetPoint("TOPLEFT", leftProgressTexture, "TOPRIGHT"); middleProgressTexture:SetPoint("BOTTOMRIGHT", rightProgressTexture, "BOTTOMLEFT"); middleProgressTexture:SetTexCoord(0.486, 0.889224609375, 0.75, 0.56640625); aaDesktop.aaMapFrame.mainView.QueryProgressBar.middleProgressTexture = middleProgressTexture; local bgProgressTexture = aaDesktop.aaMapFrame.mainView.QueryProgressBar:CreateTexture(nil, "BACKGROUND"); bgProgressTexture:SetTexture(0,0,0,.5); bgProgressTexture:SetAllPoints(aaDesktop.aaMapFrame.mainView.QueryProgressBar); aaDesktop.aaMapFrame.mainView.QueryProgressBar.bgProgressTexture = bgProgressTexture; aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetStatusBarTexture([[Interface\PaperDollInfoFrame\UI-Character-Skills-Bar]]); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetStatusBarColor(0, 1, 0); aaDesktop.aaMapFrame.mainView.QueryProgressBar:Show(); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetMinMaxValues(0, 0); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetValue(0); aaDesktop.aaMapFrame.mainView.QueryProgressBar.progress:SetText('当前进度0'..'/'..'0'); function aaDesktop.aaMapFrame:show() aaDesktop.aaMapFrame.mainView:Show(); local t = aa_jindu[3] + 0; aaDesktop.aaMapFrame.time = t; if aa_jindu[2] == 0 and t == 0 then aaDesktop.aaMapFrame.mainView.titletext1:Hide(); aaDesktop.aaMapFrame.mainView.titletext2:Hide(); aaDesktop.aaMapFrame.mainView:SetPoint('CENTER', UIParent, 'TOP', 0, -70); else aaDesktop.aaMapFrame.mainView.titletext1:Show(); aaDesktop.aaMapFrame.mainView.titletext2:Show(); aaDesktop.aaMapFrame.mainView.titletext1:SetText(aaData.color_reds.."死亡次数："..aaData.color_red..aa_jindu[1].."/"..aa_jindu[2]); aaDesktop.aaMapFrame.mainView.titletext2:SetText(aaData.color_reds.."剩余挑战时间："..aaData.color_red..aaData:secondsTox(aaDesktop.aaMapFrame.time/1000)); aaDesktop.aaMapFrame.mainView:SetPoint('CENTER', UIParent, 'TOP', 0, -90); end; if aa_jindu[5] == nil or aa_jindu[5] == 0 then aaDesktop.aaMapFrame.mainView.QueryProgressBar.progress:Hide(); else aaDesktop.aaMapFrame.mainView.QueryProgressBar.progress:SetText("当前进度"..aa_jindu[4].."/"..aa_jindu[5]); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetMinMaxValues(0, aa_jindu[5]); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetValue(aa_jindu[4]); end; local fugaikey = {}; local fugai = aaData:toVectorInt2(aa_jindu[6]); for i,v in pairs(fugai) do local value = fugai[i]+0; if value > 0 then table.insert(fugaikey,i); end; end; table.sort(fugaikey,function(a,b)return (tonumber(a)<tonumber(b)) end); local rewardtext = ""; for i=1,#fugaikey do local exp = fugaikey[i]; local rewardid = fugai[exp]; if rewardid and rewardid ~= "" and rewardid > 0 then aaData.reload_reward[rewardid] = "aaMapFrame"; rewardtext = rewardtext..aaData.color_blues.."\n进度"..exp.."：|r\n"..aaData:getReward(rewardid); end; end; if rewardtext ~= "" then aaDesktop.aaMapFrame.toolText = "|cFFFFCC66按住可以拖动进度条|r\n"..aaData.color_reds.."达到进度获得奖励|r"..rewardtext; end; end; function aaDesktop.aaMapFrame:hide() aaDesktop.aaMapFrame.toolText = "|cFFFFCC66按住可以拖动进度条|r"; aaDesktop.aaMapFrame.mainView.titletext1:SetText(aaData.color_reds.."死亡次数："..aaData.color_red.."0/0"); aaDesktop.aaMapFrame.mainView.titletext2:SetText(aaData.color_reds.."剩余挑战时间："..aaData.color_red..aaData:secondsTox(0)); aaDesktop.aaMapFrame.mainView.QueryProgressBar.progress:SetText("当前进度".."0/0"); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetMinMaxValues(0, 0); aaDesktop.aaMapFrame.mainView.QueryProgressBar:SetValue(0); aaDesktop.aaMapFrame.mainView:Hide(); end;      aaDesktop.aaChoujiang.mainView = CreateFrame("Frame","aaDesktop.aaChoujiang.mainView",UIParent) do aaDesktop.aaChoujiang.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaChoujiang.mainView:SetWidth(758); aaDesktop.aaChoujiang.mainView:SetHeight(512); aaDesktop.aaChoujiang.mainView:SetPoint("CENTER"); aaDesktop.aaChoujiang.mainView:SetToplevel(true); aaDesktop.aaChoujiang.mainView:SetClampedToScreen(true); aaDesktop.aaChoujiang.mainView:SetMovable(true); aaDesktop.aaChoujiang.mainView:EnableMouse(true); aaDesktop.aaChoujiang.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaChoujiang.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaChoujiang.mainView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaChoujiang.mainView"); end; aaDesktop.aaChoujiang.mainView.bgView1 = CreateFrame("Frame",nil,aaDesktop.aaChoujiang.mainView) do aaDesktop.aaChoujiang.mainView.bgView1:SetFrameStrata("TOOLTIP"); aaDesktop.aaChoujiang.mainView.bgView1:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-cj1"}); aaDesktop.aaChoujiang.mainView.bgView1:SetWidth(512); aaDesktop.aaChoujiang.mainView.bgView1:SetHeight(512); aaDesktop.aaChoujiang.mainView.bgView1:SetPoint("TOPLEFT",0,0); aaDesktop.aaChoujiang.mainView.bgView1:Show(); end; aaDesktop.aaChoujiang.mainView.bgView2 = CreateFrame("Frame",nil,aaDesktop.aaChoujiang.mainView) do aaDesktop.aaChoujiang.mainView.bgView2:SetFrameStrata("TOOLTIP"); aaDesktop.aaChoujiang.mainView.bgView2:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-cj2"}); aaDesktop.aaChoujiang.mainView.bgView2:SetWidth(256); aaDesktop.aaChoujiang.mainView.bgView2:SetHeight(512); aaDesktop.aaChoujiang.mainView.bgView2:SetPoint("TOPLEFT",512,0); aaDesktop.aaChoujiang.mainView.bgView2:Show(); end; aaDesktop.aaChoujiang.mainView.bgView = CreateFrame("Frame",nil,aaDesktop.aaChoujiang.mainView) do aaDesktop.aaChoujiang.mainView.bgView:SetFrameStrata("TOOLTIP"); aaDesktop.aaChoujiang.mainView.bgView:SetWidth(758); aaDesktop.aaChoujiang.mainView.bgView:SetHeight(512); aaDesktop.aaChoujiang.mainView.bgView:SetPoint("TOPLEFT",0,0); aaDesktop.aaChoujiang.mainView.bgView:Show(); end; aaDesktop.aaChoujiang.mainView.bgView.jpView = CreateFrame("Frame",nil,aaDesktop.aaChoujiang.mainView.bgView) do aaDesktop.aaChoujiang.mainView.bgView.jpView:SetFrameStrata("TOOLTIP"); aaDesktop.aaChoujiang.mainView.bgView.jpView:SetWidth(290); aaDesktop.aaChoujiang.mainView.bgView.jpView:SetHeight(290); aaDesktop.aaChoujiang.mainView.bgView.jpView:SetPoint("TOPLEFT",55,-98); aaDesktop.aaChoujiang.mainView.bgView.jpView:Show(); end; aaDesktop.aaChoujiang.mainView.bgView.xtView = CreateFrame("Frame",nil,aaDesktop.aaChoujiang.mainView.bgView) do aaDesktop.aaChoujiang.mainView.bgView.xtView:SetFrameStrata("TOOLTIP"); aaDesktop.aaChoujiang.mainView.bgView.xtView:SetWidth(360); aaDesktop.aaChoujiang.mainView.bgView.xtView:SetHeight(60); aaDesktop.aaChoujiang.mainView.bgView.xtView:SetPoint("TOPLEFT",381,-90); aaDesktop.aaChoujiang.mainView.bgView.xtView:Show(); end; aaDesktop.aaChoujiang.mainView.bgView.ggView = CreateFrame("Frame",nil,aaDesktop.aaChoujiang.mainView.bgView) do aaDesktop.aaChoujiang.mainView.bgView.ggView:SetFrameStrata("TOOLTIP"); aaDesktop.aaChoujiang.mainView.bgView.ggView:SetWidth(360); aaDesktop.aaChoujiang.mainView.bgView.ggView:SetHeight(290); aaDesktop.aaChoujiang.mainView.bgView.ggView:SetPoint("TOPLEFT",381,-90-10-59); aaDesktop.aaChoujiang.mainView.bgView.ggView:Show(); end; aaDesktop.aaChoujiang.mainView.bgView.rewardView = CreateFrame("Frame",nil,aaDesktop.aaChoujiang.mainView.bgView) do aaDesktop.aaChoujiang.mainView.bgView.rewardView:SetFrameStrata("TOOLTIP"); aaDesktop.aaChoujiang.mainView.bgView.rewardView:SetWidth(360); aaDesktop.aaChoujiang.mainView.bgView.rewardView:SetHeight(100); aaDesktop.aaChoujiang.mainView.bgView.rewardView:SetPoint("TOPLEFT",381,-90-10-59-165); aaDesktop.aaChoujiang.mainView.bgView.rewardView:Show(); end; aaDesktop.aaChoujiang.mainView.bgView.jpView.btns = {}; for i=1,25 do aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i] = CreateFrame('Button', nil, aaDesktop.aaChoujiang.mainView.bgView.jpView, '') do local row,tmp2 = math.modf((i-1)/5); local col = math.floor((i-1)%5); aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i]:SetPoint('TOPLEFT', aaDesktop.aaChoujiang.mainView.bgView.jpView, 'TOPLEFT', col*(50+10), -row*(50+10)); aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i]:SetSize(50, 50); aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-choujiang-cao"); aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i]:SetScript('OnEnter', function() if aa_choujiang1 then local itemLink = aa_choujiang1[i+1]; if itemLink then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i], "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i],"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end; end); aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i]:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); end; end; aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns = {}; for i=1,10 do aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i] = CreateFrame('Button', nil, aaDesktop.aaChoujiang.mainView.bgView.rewardView, '') do local row,tmp2 = math.modf((i-1)/5); local col = math.floor((i-1)%5); aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i]:SetPoint('TOPLEFT', aaDesktop.aaChoujiang.mainView.bgView.rewardView, 'TOPLEFT', 15+col*(50+20), -row*(50+19)); aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i]:SetSize(50, 50); aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-choujiang-cao"); aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i]:SetScript('OnEnter', function() if aa_choujiang3 then local itemLink = aa_choujiang3[i]; if itemLink then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i], "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i],"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end; end); aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i]:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); end; end; aaDesktop.aaChoujiang.mainView.bgView.xtView.detailText = aaDesktop.aaChoujiang.mainView.bgView.xtView:CreateFontString("detailText", "", "GameFontNormal") do aaDesktop.aaChoujiang.mainView.bgView.xtView.detailText:SetText(aaData.color_blue.."系统提示：\n累计抽奖次数达到10次，奖励白金宝箱x1\n累计抽奖次数达到20次，奖励黄金宝箱x1\n累计抽奖次数达到50次，奖励白金宝箱x2"); aaDesktop.aaChoujiang.mainView.bgView.xtView.detailText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDesktop.aaChoujiang.mainView.bgView.xtView.detailText:SetPoint("CENTER", aaDesktop.aaChoujiang.mainView.bgView.xtView, "CENTER", 0, 0); aaDesktop.aaChoujiang.mainView.bgView.xtView.detailText:SetWidth(360); aaDesktop.aaChoujiang.mainView.bgView.xtView.detailText:SetHeight(60); end; aaDesktop.aaChoujiang.mainView.bgView.cancelBtn = CreateFrame('Button', nil, aaDesktop.aaChoujiang.mainView.bgView, 'UIPanelCloseButton') do  aaDesktop.aaChoujiang.mainView.bgView.cancelBtn:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaChoujiang.mainView.bgView.cancelBtn:SetPoint('TOPRIGHT', aaDesktop.aaChoujiang.mainView.bgView, 'TOPRIGHT', -8, -25); aaDesktop.aaChoujiang.mainView.bgView.cancelBtn:SetSize(44, 44); aaDesktop.aaChoujiang.mainView.bgView.cancelBtn:SetScript('OnClick', function() aaDesktop.aaChoujiang:hide(); end); end; aaDesktop.aaChoujiang.mainView.bgView.doneBtn = CreateFrame('Button', nil, aaDesktop.aaChoujiang.mainView.bgView, '') do aaDesktop.aaChoujiang.mainView.bgView.doneBtn:SetPoint('BOTTOMLEFT', aaDesktop.aaChoujiang.mainView.bgView, 'BOTTOMLEFT', 40, 50); aaDesktop.aaChoujiang.mainView.bgView.doneBtn:SetSize(160, 60); aaDesktop.aaChoujiang.mainView.bgView.doneBtn:SetBackdropColor(0, 0, 0, 1); aaDesktop.aaChoujiang.mainView.bgView.doneBtn:SetText("抽奖一次"); aaDesktop.aaChoujiang.mainView.bgView.doneBtn:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaData:sendAddonMsg(1007,1, "GUILD"); end); end; aaDesktop.aaChoujiang.mainView.bgView.doneBtn = CreateFrame('Button', nil, aaDesktop.aaChoujiang.mainView.bgView, '') do aaDesktop.aaChoujiang.mainView.bgView.doneBtn:SetPoint('BOTTOMLEFT', aaDesktop.aaChoujiang.mainView.bgView, 'BOTTOMLEFT', 215, 50); aaDesktop.aaChoujiang.mainView.bgView.doneBtn:SetSize(160, 60); aaDesktop.aaChoujiang.mainView.bgView.doneBtn:SetText("抽奖十次"); aaDesktop.aaChoujiang.mainView.bgView.doneBtn:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaData:sendAddonMsg(1007,10, "GUILD"); end); end; aaDesktop.aaChoujiang.mainView.bgView.ggView.detailTexts = {}; for i=1,15 do aaDesktop.aaChoujiang.mainView.bgView.ggView.detailTexts[i] = aaDesktop.aaChoujiang.mainView.bgView.ggView:CreateFontString("detailText", "", "GameFontNormal") do aaDesktop.aaChoujiang.mainView.bgView.ggView.detailTexts[i]:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDesktop.aaChoujiang.mainView.bgView.ggView.detailTexts[i]:SetPoint("TOPLEFT", aaDesktop.aaChoujiang.mainView.bgView.ggView, "TOPLEFT", 10, -(i-1)*19); aaDesktop.aaChoujiang.mainView.bgView.ggView.detailTexts[i]:SetWidth(360); aaDesktop.aaChoujiang.mainView.bgView.ggView.detailTexts[i]:SetHeight(19); aaDesktop.aaChoujiang.mainView.bgView.ggView.detailTexts[i]:SetText("啦啦啦啦啦 获得了 哈哈哈哈哈哈啊哈"); end; end; function aaDesktop.aaChoujiang:reload() if aa_choujiang1 then local text = aa_choujiang1[1]; if text then aaDesktop.aaChoujiang.mainView.bgView.xtView.detailText:SetText(text); end; for i=1,25 do local text = aa_choujiang1[i+1]; if text then local icon = GetItemIcon(text); aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i]:SetNormalTexture(icon); else aaDesktop.aaChoujiang.mainView.bgView.jpView.btns[i]:SetNormalTexture(0); end; end; end; if aa_choujiang2 then for i=1,15 do local text = aa_choujiang2[i]; if text then aaDesktop.aaChoujiang.mainView.bgView.ggView.detailTexts[i]:SetText(text); else aaDesktop.aaChoujiang.mainView.bgView.ggView.detailTexts[i]:SetText(""); end; end; end; if aa_choujiang3 then for i=1,10 do local itemLink = aa_choujiang3[i]; if itemLink then local icon = GetItemIcon(itemLink); aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i]:SetNormalTexture(icon); else aaDesktop.aaChoujiang.mainView.bgView.rewardView.btns[i]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-choujiang-cao"); end; end; end; end; function aaDesktop.aaChoujiang:show() aa_choujiang3 = {}; aaDesktop.aaChoujiang.mainView:Show(); aaData:sendAddonMsg(10071,"0", "GUILD"); aaData:sendAddonMsg(10072,"0", "GUILD"); aaDesktop.aaChoujiang:reload(); end; function aaDesktop.aaChoujiang:hide() aaDesktop.aaChoujiang.mainView:Hide(); aaDesktop.aaChoujiang:reload(); end;    aaDesktop.aaBoss.width = 400; aaDesktop.aaBoss.height = 380; aaDesktop.aaBoss.paihang = {}; aaDesktop.aaBoss.mainView = CreateFrame("Frame",nil,UIParent) do aaDesktop.aaBoss.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaBoss.mainView:SetBackdrop ({bgFile = "Interface\\Tooltips\\UI-Tooltip-Background",edgeFile="Interface\\Tooltips\\UI-Tooltip-Border" ,edgeSize="16", tile = true}); aaDesktop.aaBoss.mainView:SetBackdropColor(0,0,0,0.5); aaDesktop.aaBoss.mainView:SetWidth(aaDesktop.aaBoss.width); aaDesktop.aaBoss.mainView:SetHeight(aaDesktop.aaBoss.height); aaDesktop.aaBoss.mainView:SetPoint("RIGHT",0,0); aaDesktop.aaBoss.mainView:SetToplevel(true); aaDesktop.aaBoss.mainView:SetClampedToScreen(true); aaDesktop.aaBoss.mainView:SetMovable(true); aaDesktop.aaBoss.mainView:EnableMouse(true); aaDesktop.aaBoss.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaBoss.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaBoss.mainView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaBoss.mainView"); end; function aaDesktop.aaBoss:CreateCell(index,x,y,colorstr,iconstr,namestr,dmgstr,rewardstr) local menuView = CreateFrame("Frame",nil,aaDesktop.aaBoss.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(aaDesktop.aaBoss.width); menuView:SetHeight(24); menuView:SetPoint("TOPLEFT",aaDesktop.aaBoss.mainView,'TOPLEFT',x,y); menuView:Show(); end; menuView.noText = menuView:CreateFontString("menuView.noText", "OVERLAY", "GameFontNormal") do menuView.noText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.noText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 0,-2); menuView.noText:SetWidth(30); menuView.noText:SetHeight(20); menuView.noText:SetText(""); end; menuView.iconView = CreateFrame('Button', nil, menuView, '') do menuView.iconView:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 20+10, -4); menuView.iconView:SetButtonState('NORMAL'); menuView.iconView:IsEnabled(); menuView.iconView:SetNormalTexture(iconstr); menuView.iconView:SetDisabledTexture(iconstr); menuView.iconView:SetHighlightTexture(iconstr); menuView.iconView:SetPushedTexture(iconstr); menuView.iconView:SetWidth(16); menuView.iconView:SetHeight(16); end; menuView.nameText = menuView:CreateFontString("menuView.nameText", "OVERLAY", "GameFontNormal") do menuView.nameText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.nameText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 20+10+18+2,-2); menuView.nameText:SetHeight(20); menuView.nameText:SetText(""); end; menuView.dmgText = menuView:CreateFontString("menuView.dmgText", "OVERLAY", "GameFontNormal") do menuView.dmgText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.dmgText:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaBoss.width/3,-2); menuView.dmgText:SetWidth(aaDesktop.aaBoss.width/3); menuView.dmgText:SetHeight(20); menuView.dmgText:SetText(""); end; menuView.rewardText = menuView:CreateFontString("menuView.rewardText", "OVERLAY", "GameFontNormal") do menuView.rewardText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.rewardText:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaBoss.width/3*2,-2); menuView.rewardText:SetWidth(aaDesktop.aaBoss.width/3); menuView.rewardText:SetHeight(20); menuView.rewardText:SetText(""); end; return menuView; end; aaDesktop.aaBoss.CancelButton = CreateFrame('Button', nil, aaDesktop.aaBoss.mainView, 'UIPanelCloseButton') do aaDesktop.aaBoss.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaBoss.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaBoss.mainView, 'TOPRIGHT', 0, 0); aaDesktop.aaBoss.CancelButton:SetSize(44, 44); aaDesktop.aaBoss.CancelButton:SetScript('OnClick', function() aaDesktop.aaBoss:hide(); end); end; aaDesktop.aaBoss.timeText = aaDesktop.aaBoss.mainView:CreateFontString("timeText", "OVERLAY", "GameFontNormal") do aaDesktop.aaBoss.timeText:SetText(aaData.color_white.."挑战剩余时间：0分钟"); aaDesktop.aaBoss.timeText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaBoss.timeText:SetPoint("TOPLEFT", aaDesktop.aaBoss.mainView, "TOPLEFT", 10, -10); aaDesktop.aaBoss.timeText:SetHeight(20); end; aaDesktop.aaBoss.peopleText = aaDesktop.aaBoss.mainView:CreateFontString("peopleText", "OVERLAY", "GameFontNormal") do aaDesktop.aaBoss.peopleText:SetText(aaData.color_white.."参与人数：0"); aaDesktop.aaBoss.peopleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaBoss.peopleText:SetPoint("TOPLEFT", aaDesktop.aaBoss.mainView, "TOPLEFT", 10, -10-20-10); aaDesktop.aaBoss.peopleText:SetHeight(20); end; aaDesktop.aaBoss.dmgText = aaDesktop.aaBoss.mainView:CreateFontString("dmgText", "OVERLAY", "GameFontNormal") do aaDesktop.aaBoss.dmgText:SetText(aaData.color_yellows.."你未造成伤害"); aaDesktop.aaBoss.dmgText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDesktop.aaBoss.dmgText:SetPoint("TOPLEFT", aaDesktop.aaBoss.mainView, "TOPLEFT", 10, -10-20-10-20-10); aaDesktop.aaBoss.dmgText:SetHeight(20); end; aaDesktop.aaBoss.lineFrame = CreateFrame("Frame",nil,aaDesktop.aaBoss.mainView) do aaDesktop.aaBoss.lineFrame:SetFrameStrata("TOOLTIP"); aaDesktop.aaBoss.lineFrame:SetBackdrop ({bgFile="Interface\\TutorialFrame\\TutorialFrameBackground"}); aaDesktop.aaBoss.lineFrame:SetBackdropColor(1, 1, 1, 1); aaDesktop.aaBoss.lineFrame:SetWidth(aaDesktop.aaBoss.width-8); aaDesktop.aaBoss.lineFrame:SetHeight(2); aaDesktop.aaBoss.lineFrame:SetPoint("TOPLEFT",4,-10-20-10-20-10-20-10); end; aaDesktop.aaBoss.leveltitle = aaDesktop.aaBoss.mainView:CreateFontString("aaDesktop.aaBoss.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaBoss.leveltitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaBoss.leveltitle:SetPoint("TOPLEFT", aaDesktop.aaBoss.mainView, "TOPLEFT", 0,-10-20-10-20-10-20-10-2); aaDesktop.aaBoss.leveltitle:SetWidth(aaDesktop.aaBoss.width/3); aaDesktop.aaBoss.leveltitle:SetHeight(20); aaDesktop.aaBoss.leveltitle:SetSpacing(5); aaDesktop.aaBoss.leveltitle:SetText(aaData.color_green.."角色名"); end; aaDesktop.aaBoss.jltitle = aaDesktop.aaBoss.mainView:CreateFontString("aaDesktop.aaBoss.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaBoss.jltitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaBoss.jltitle:SetPoint("TOPLEFT", aaDesktop.aaBoss.mainView, "TOPLEFT", aaDesktop.aaBoss.width/3,-10-20-10-20-10-20-10-2); aaDesktop.aaBoss.jltitle:SetWidth(aaDesktop.aaBoss.width/3); aaDesktop.aaBoss.jltitle:SetHeight(20); aaDesktop.aaBoss.jltitle:SetSpacing(5); aaDesktop.aaBoss.jltitle:SetText(aaData.color_green.."伤害值"); end; aaDesktop.aaBoss.zttitle = aaDesktop.aaBoss.mainView:CreateFontString("aaDesktop.aaBoss.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaBoss.zttitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaBoss.zttitle:SetPoint("TOPLEFT", aaDesktop.aaBoss.mainView, "TOPLEFT", aaDesktop.aaBoss.width/3*2,-10-20-10-20-10-20-10-2); aaDesktop.aaBoss.zttitle:SetWidth(aaDesktop.aaBoss.width/3); aaDesktop.aaBoss.zttitle:SetHeight(20); aaDesktop.aaBoss.zttitle:SetSpacing(5); aaDesktop.aaBoss.zttitle:SetText(aaData.color_green.."获得奖励"); end; aaDesktop.aaBoss.leveltitle = aaDesktop.aaBoss.mainView:CreateFontString("aaDesktop.aaBoss.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaBoss.leveltitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaBoss.leveltitle:SetPoint("TOPLEFT", aaDesktop.aaBoss.mainView, "TOPLEFT", 0,-10-20-10-20-10-20-10-2); aaDesktop.aaBoss.leveltitle:SetWidth(aaDesktop.aaBoss.width/3); aaDesktop.aaBoss.leveltitle:SetHeight(20); aaDesktop.aaBoss.leveltitle:SetSpacing(5); aaDesktop.aaBoss.leveltitle:SetText(aaData.color_green.."角色名"); end; aaDesktop.aaBoss.paihang[1] = aaDesktop.aaBoss:CreateCell(1,0,-10-20-10-20-10-20-10-2-20,aaData.color_yellows,GetSpellIcon(0),"","",""); aaDesktop.aaBoss.paihang[2] = aaDesktop.aaBoss:CreateCell(2,0,-10-20-10-20-10-20-10-2-20-24*1,aaData.color_blues,GetSpellIcon(0),"","",""); aaDesktop.aaBoss.paihang[3] = aaDesktop.aaBoss:CreateCell(3,0,-10-20-10-20-10-20-10-2-20-24*2,aaData.color_green,GetSpellIcon(0),"","",""); aaDesktop.aaBoss.paihang[4] = aaDesktop.aaBoss:CreateCell(4,0,-10-20-10-20-10-20-10-2-20-24*3,aaData.color_white,GetSpellIcon(0),"","",""); aaDesktop.aaBoss.paihang[5] = aaDesktop.aaBoss:CreateCell(5,0,-10-20-10-20-10-20-10-2-20-24*4,aaData.color_white,GetSpellIcon(0),"","",""); aaDesktop.aaBoss.paihang[6] = aaDesktop.aaBoss:CreateCell(6,0,-10-20-10-20-10-20-10-2-20-24*5,aaData.color_white,GetSpellIcon(0),"","",""); aaDesktop.aaBoss.paihang[7] = aaDesktop.aaBoss:CreateCell(7,0,-10-20-10-20-10-20-10-2-20-24*6,aaData.color_white,GetSpellIcon(0),"","",""); aaDesktop.aaBoss.paihang[8] = aaDesktop.aaBoss:CreateCell(8,0,-10-20-10-20-10-20-10-2-20-24*7,aaData.color_white,GetSpellIcon(0),"","",""); aaDesktop.aaBoss.paihang[9] = aaDesktop.aaBoss:CreateCell(9,0,-10-20-10-20-10-20-10-2-20-24*8,aaData.color_white,GetSpellIcon(0),"","",""); aaDesktop.aaBoss.paihang[10] = aaDesktop.aaBoss:CreateCell(10,0,-10-20-10-20-10-20-10-2-20-24*9,aaData.color_white,GetSpellIcon(0),"","",""); function aaDesktop.aaBoss:reload() local rewardkey = nil; if aa_bosstitle then if aa_bosstitle[2] then aaDesktop.aaBoss.timeText:SetText("挑战剩余时间："..aa_bosstitle[2].."分钟"); else aaDesktop.aaBoss.timeText:SetText("挑战剩余时间：0分钟"); end; if aa_bosstitle[3] then aaDesktop.aaBoss.peopleText:SetText("参与人数："..aa_bosstitle[3]); else aaDesktop.aaBoss.peopleText:SetText("参与人数：0"); end; aaDesktop.aaBoss.dmgText:SetText("你未造成伤害"); if aa_bosstitle[4] and aa_bosstitle[5] then if aa_bosstitle[4]+0 > 0 then aaDesktop.aaBoss.dmgText:SetText("你造成的伤害："..aa_bosstitle[4].."("..aa_bosstitle[5].."%)"); end; end; if aa_bosstitle[6] then rewardkey = aaData:toVectorInt2(aa_bosstitle[6]); end; end; if aa_bossdetail then for i=1,10 do local color = aaData.color_white; if i == 1 then color = aaData.color_yellows; end; if i == 2 then color = aaData.color_blues; end; if i == 3 then color = aaData.color_green; end; if aa_bossdetail[i] then local class1 = aa_bossdetail[i][2]; local icontxt = aaData.class_spellicon[class1]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; aaDesktop.aaBoss.paihang[i].noText:SetText(color..aa_bossdetail[i][1].."."); aaDesktop.aaBoss.paihang[i].iconView:SetNormalTexture(icon); aaDesktop.aaBoss.paihang[i].iconView:SetDisabledTexture(icon); aaDesktop.aaBoss.paihang[i].iconView:SetHighlightTexture(icon); aaDesktop.aaBoss.paihang[i].iconView:SetPushedTexture(icon); aaDesktop.aaBoss.paihang[i].iconView:Show(); aaDesktop.aaBoss.paihang[i].nameText:SetText(color..aa_bossdetail[i][3]); aaDesktop.aaBoss.paihang[i].dmgText:SetText(color..aa_bossdetail[i][4].."("..aa_bossdetail[i][5].."%)"); aaDesktop.aaBoss.paihang[i].rewardText:SetText(""); if rewardkey ~= nil then if rewardkey[i] then local rewardid = rewardkey[i]+0; if rewardid and rewardid ~= "" and rewardid > 0 then aaData.reload_reward[rewardid] = "aaBoss"; local reward = aaData:getReward(rewardid); if reward ~= "" then aaDesktop.aaBoss.paihang[i].rewardText:SetText(reward); end; end; end; end; else aaDesktop.aaBoss.paihang[i].noText:SetText(""); aaDesktop.aaBoss.paihang[i].iconView:Hide(); aaDesktop.aaBoss.paihang[i].nameText:SetText(""); aaDesktop.aaBoss.paihang[i].dmgText:SetText(""); aaDesktop.aaBoss.paihang[i].rewardText:SetText(""); end; end; end; end; function aaDesktop.aaBoss:show() aaDesktop.aaBoss.mainView:Show(); aaDesktop.aaBoss:reload(); end; function aaDesktop.aaBoss:hide() aaDesktop.aaBoss.mainView:Hide(); aaDesktop.aaBoss:reload(); aa_bossdetail = {}; aa_bosstitle = {}; end;    aaDesktop.aaJLLicai.LevelViews = {}; aaDesktop.aaJLLicai.levels = {}; local titletop = -100;local titleleft = 50; function aaDesktop.aaJLLicai:ClickDoneBtn() aaData:sendAddonMsg(10003, "0", "GUILD"); end; aaDesktop.aaJLLicai.mainView = CreateFrame("Frame","aaDesktop.aaJLLicai.mainView",UIParent) do aaDesktop.aaJLLicai.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaJLLicai.mainView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-grlc"}); aaDesktop.aaJLLicai.mainView:SetWidth(512); aaDesktop.aaJLLicai.mainView:SetHeight(512); aaDesktop.aaJLLicai.mainView:SetPoint("CENTER"); aaDesktop.aaJLLicai.mainView:SetToplevel(true); aaDesktop.aaJLLicai.mainView:SetClampedToScreen(true); aaDesktop.aaJLLicai.mainView:SetMovable(true); aaDesktop.aaJLLicai.mainView:EnableMouse(true); aaDesktop.aaJLLicai.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaJLLicai.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaJLLicai.mainView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaJLLicai.mainView"); end; local titlewidth = 422;local titletop = -150; aaDesktop.aaJLLicai.title = aaDesktop.aaJLLicai.mainView:CreateFontString("aaDesktop.aaJLLicai.title", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLLicai.title:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 25); aaDesktop.aaJLLicai.title:SetPoint("TOPLEFT", aaDesktop.aaJLLicai.mainView, "TOPLEFT", 45,-81); aaDesktop.aaJLLicai.title:SetWidth(titlewidth); aaDesktop.aaJLLicai.title:SetHeight(25); aaDesktop.aaJLLicai.title:SetSpacing(5); end; aaDesktop.aaJLLicai.detail = aaDesktop.aaJLLicai.mainView:CreateFontString("aaDesktop.aaJLLicai.detail", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLLicai.detail:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 22); aaDesktop.aaJLLicai.detail:SetPoint("TOPLEFT", aaDesktop.aaJLLicai.mainView, "TOPLEFT", 45,titletop-25); aaDesktop.aaJLLicai.detail:SetWidth(titlewidth); aaDesktop.aaJLLicai.detail:SetHeight(200); aaDesktop.aaJLLicai.detail:SetSpacing(5); end; aaDesktop.aaJLLicai.btn = CreateFrame('Button', nil, aaDesktop.aaJLLicai.mainView, 'UIPanelButtonTemplate') do aaDesktop.aaJLLicai.btn:SetPoint('TOPLEFT', aaDesktop.aaJLLicai.mainView, 'TOPLEFT', 512/2-100/2, titletop-30-10-230); aaDesktop.aaJLLicai.btn:SetSize(100, 40); aaDesktop.aaJLLicai.btn:Disable(); aaDesktop.aaJLLicai.btn:SetScript('OnClick', function() aaDesktop.aaJLLicai:ClickDoneBtn(); end); end; function aaDesktop.aaJLLicai:reload() if aa_jllicai~=nil and aa_jllicai~="" and aa_jllicai~={} then local isOk = aa_jllicai[1]; local day = aa_jllicai[2]; local level = aa_jllicai[3]; aaDesktop.aaJLLicai.title:SetText("你还可以领取："..aaData.color_blue..day.."天"); aaDesktop.aaJLLicai.detail:SetText(level); if isOk == 0 then aaDesktop.aaJLLicai.btn:SetText("领取奖励"); aaDesktop.aaJLLicai.btn:Enable(); elseif isOk == 1 then aaDesktop.aaJLLicai.btn:SetText("已领取"); aaDesktop.aaJLLicai.btn:Disable(); elseif isOk == 2 then aaDesktop.aaJLLicai.btn:SetText("我要续费"); aaDesktop.aaJLLicai.btn:Enable(); end; else aaDesktop.aaJLLicai.LevelViews[index]:Hide(); end; end; aaDesktop.aaJLLicai.CancelButton = CreateFrame('Button', nil, aaDesktop.aaJLLicai.mainView, 'UIPanelCloseButton') do aaDesktop.aaJLLicai.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaJLLicai.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaJLLicai.mainView, 'TOPRIGHT', -10, -10); aaDesktop.aaJLLicai.CancelButton:SetSize(44, 44); aaDesktop.aaJLLicai.CancelButton:SetScript('OnClick', function() aaDesktop.aaJLLicai:hide(); end); end; function aaDesktop.aaJLLicai:show() aaDesktop.aaJLLicai.mainView:Show(); aaDesktop.aaJLLicai:reload(); end; function aaDesktop.aaJLLicai:hide() aaDesktop.aaJLLicai.mainView:Hide(); aaDesktop.aaJLLicai:reload(); end;     aaDesktop.aaJLShouchong.LevelViews = {}; aaDesktop.aaJLShouchong.levels = {}; aaDesktop.aaJLShouchong.CancelButton = {}; local titletop = -100;local titleleft = 50; function aaDesktop.aaJLShouchong:ClickDoneBtn() aaData:sendAddonMsg(10004, "0", "GUILD"); end; aaDesktop.aaJLShouchong.mainView = CreateFrame("Frame","aaDesktop.aaJLShouchong.mainView",UIParent) do aaDesktop.aaJLShouchong.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaJLShouchong.mainView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-scjl"}); aaDesktop.aaJLShouchong.mainView:SetWidth(512); aaDesktop.aaJLShouchong.mainView:SetHeight(512); aaDesktop.aaJLShouchong.mainView:SetPoint("CENTER"); aaDesktop.aaJLShouchong.mainView:SetToplevel(true); aaDesktop.aaJLShouchong.mainView:SetClampedToScreen(true); aaDesktop.aaJLShouchong.mainView:SetMovable(true); aaDesktop.aaJLShouchong.mainView:EnableMouse(true); aaDesktop.aaJLShouchong.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaJLShouchong.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaJLShouchong.mainView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaJLShouchong.mainView"); end; local titlewidth = 422;local titletop = -82; aaDesktop.aaJLShouchong.title = aaDesktop.aaJLShouchong.mainView:CreateFontString("aaDesktop.aaJLShouchong.title", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLShouchong.title:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 21); aaDesktop.aaJLShouchong.title:SetPoint("TOPLEFT", aaDesktop.aaJLShouchong.mainView, "TOPLEFT", 45,titletop); aaDesktop.aaJLShouchong.title:SetWidth(titlewidth); aaDesktop.aaJLShouchong.title:SetHeight(20); aaDesktop.aaJLShouchong.title:SetSpacing(5); end; aaDesktop.aaJLShouchong.detail = aaDesktop.aaJLShouchong.mainView:CreateFontString("aaDesktop.aaJLShouchong.detail", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLShouchong.detail:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLShouchong.detail:SetPoint("TOPLEFT", aaDesktop.aaJLShouchong.mainView, "TOPLEFT", 45,titletop-30); aaDesktop.aaJLShouchong.detail:SetWidth(titlewidth); aaDesktop.aaJLShouchong.detail:SetHeight(298); aaDesktop.aaJLShouchong.detail:SetSpacing(5); end; aaDesktop.aaJLShouchong.btn = CreateFrame('Button', nil, aaDesktop.aaJLShouchong.mainView, 'UIPanelButtonTemplate') do aaDesktop.aaJLShouchong.btn:SetPoint('TOPLEFT', aaDesktop.aaJLShouchong.mainView, 'TOPLEFT', 512/2-100/2, titletop-30-10-298); aaDesktop.aaJLShouchong.btn:SetSize(100, 40); aaDesktop.aaJLShouchong.btn:Disable(); aaDesktop.aaJLShouchong.btn:SetScript('OnClick', function() aaDesktop.aaJLShouchong:ClickDoneBtn(); end); end; function aaDesktop.aaJLShouchong:reload() if aa_jlshouchong~=nil and aa_jlshouchong~="" and aa_jlshouchong~={} then local isOk = aa_jlshouchong[1]; local level = aa_jlshouchong[2]; local reward = aa_jlshouchong[3]; aaDesktop.aaJLShouchong.title:SetText(aaData.color_yellows.."今日首次充值"..aaData.color_blue..level..worldconf[15].."|r，可获得以下奖励："); aaDesktop.aaJLShouchong.detail:SetText(reward); if isOk == 0 then aaDesktop.aaJLShouchong.btn:SetText("领取奖励"); aaDesktop.aaJLShouchong.btn:Enable(); elseif isOk == 1 then aaDesktop.aaJLShouchong.btn:SetText("已领取"); aaDesktop.aaJLShouchong.btn:Disable(); elseif isOk == 2 then aaDesktop.aaJLShouchong.btn:SetText("未完成"); aaDesktop.aaJLShouchong.btn:Disable(); end; else aaDesktop.aaJLShouchong.LevelViews[index]:Hide(); end; end; aaDesktop.aaJLShouchong.CancelButton = CreateFrame('Button', nil, aaDesktop.aaJLShouchong.mainView, 'UIPanelCloseButton') do aaDesktop.aaJLShouchong.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaJLShouchong.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaJLShouchong.mainView, 'TOPRIGHT', -10, -10); aaDesktop.aaJLShouchong.CancelButton:SetSize(44, 44); aaDesktop.aaJLShouchong.CancelButton:SetScript('OnClick', function() aaDesktop.aaJLShouchong:hide(); end); end; function aaDesktop.aaJLShouchong:show() aaDesktop.aaJLShouchong.mainView:Show(); aaDesktop.aaJLShouchong:reload(); end; function aaDesktop.aaJLShouchong:hide() aaDesktop.aaJLShouchong.mainView:Hide(); aaDesktop.aaJLShouchong:reload(); end;   aaDesktop.aaCode.mainView = {}; aaDesktop.aaCode.btns = {}; aaDesktop.aaCode.width = 400; aaDesktop.aaCode.height = 280; aaDesktop.aaCode.btnWidth = 120; aaDesktop.aaCode.btnHeight = 50; aaDesktop.aaCode.margin = 10; aaDesktop.aaCode.codes = {[1]=0,[2]=0,[3]=0,[4]=0,[5]=0,[6]=0,[7]=0,[8]=0,[9]=0}; aaDesktop.aaCode.coders = { [1]="万象更新", [2]="抱头鼠窜", [3]="鸡鸣狗盗", [4]="千军万马", [5]="亡羊补牢", [6]="杯弓蛇影", [7]="鹤立鸡群", [8]="对牛弹琴", [9]="如鱼得水", [10]="鸟语花香", [11]="为虎作伥", [12]="黔驴技穷", [13]="画龙点睛", [14]="鼠目寸光", [15]="虎背熊腰", [16]="守株待兔", [17]="鹤发童颜", [18]="狗急跳墙", [19]="盲人摸象", [20]="画蛇添足", [21]="鹤立鸡群", [22]="鸡鸣狗盗", [23]="鹬蚌相争", [24]="蚕食鲸吞", [25]="蛛丝马迹", [26]="龙争虎斗", [27]="龙马精神", [28]="龙飞凤舞", [29]="龙腾虎跃", [30]="龙骧虎步", [31]="龙潭虎穴", [32]="龙跃凤鸣", [33]="车水马龙", [34]="指鹿为马", [35]="兔死狐悲", [36]="鸡犬不宁", [37]="心猿意马", [38]="狼吞虎咽", [39]="眼高手低", [40]="目瞪口呆", [41]="胸无点墨", [42]="头重脚轻", [43]="手足情深", [44]="口是心非", [45]="手疾眼快", [46]="耳闻目睹", [47]="头破血流", [48]="眉清目秀", [49]="袖手傍观", [50]="口出不逊", [51]="飞蛾扑火", [52]="金蝉脱壳", [53]="积蚊成雷", [54]="蟾宫折桂", [55]="蚕食鲸吞", [56]="蜻蜓点水", [57]="螳臂挡车", [58]="蛛丝马迹", [59]="螳螂捕蝉", [60]="黄雀在后", [61]="见多识广", [62]="察言观色", [63]="高瞻远瞩", [64]="左顾右盼", [65]="调兵遣将", [66]="粉身碎骨", [67]="狂风暴雨", [68]="旁敲侧击", [69]="千辛万苦", [70]="眼疾手快", [71]="生龙活虎", [72]="惊天动地", [73]="七拼八凑", [74]="胡言乱语", [75]="改朝换代", [76]="道听途说", [77]="前呼后拥", [78]="东倒西歪", [79]="眼高手低", [80]="口是心非", [81]="头重脚轻", [82]="有头无尾", [83]="前倨后恭", [84]="东逃西散", [85]="南辕北辙", [86]="左顾右盼", [87]="积少成多", [88]="同甘共苦", [89]="半信半疑", [90]="大材小用", [91]="先人后己", [92]="有口无心", [93]="天经地义", [94]="弄假成真", [95]="举足轻重", [96]="南腔北调", [97]="声东击西", [98]="转危为安", [99]="东倒西歪", [100]="反败为胜", [101]="以少胜多", [102]="由此及彼", [103]="千钧一发", [104]="刻不容缓", [105]="迫不及待", [106]="十万火急", [107]="火烧眉毛", [108]="燃眉之急", [109]="心旷神怡", [110]="心平气和", [111]="目不转睛", [112]="呆若木鸡", [113]="眉开眼笑", [114]="愁眉苦脸", [115]="愁眉紧锁", [116]="目瞪口呆", [117]="垂头丧气", [118]="嬉皮笑脸", [119]="一身正气", [120]="临危不惧", [121]="光明磊落", [122]="堂堂正正", [123]="大智大勇", [124]="力挽狂澜", [125]="急中生智", [126]="仰不愧天", [127]="镇定自若", [128]="化险为夷", [129]="春光明媚", [130]="万紫千红", [131]="春雨如油", [132]="生机勃勃", [133]="春色满园", [134]="春意盎然", [135]="鸟语花香", [136]="春暖花开", [137]="百花齐放", [138]="和风细雨", [139]="见多识广", [140]="望而生畏", [141]="察言观色", [142]="一视同仁", [143]="一览无余", [144]="高瞻远瞩", [145]="坐井观天", [146]="举世瞩目", [147]="管中窥豹", [148]="左顾右盼", [149]="生龙活虎", [150]="龙争虎斗", [151]="龙马精神", [152]="龙飞凤舞", [153]="龙腾虎跃", [154]="龙骧虎步", [155]="画龙点睛", [156]="龙潭虎穴", [157]="龙跃凤鸣", [158]="车水马龙", [159]="鹬蚌相争", [160]="刻舟求剑", [161]="鹏程万里", [162]="守株待兔", [163]="掩耳盗铃", [164]="亡羊补牢", [165]="惊弓之鸟", [166]="杯弓蛇影", [167]="抱薪救火", [168]="微乎其微", [169]="神乎其神", [170]="天外有天", [171]="痛定思痛", [172]="数不胜数", [173]="举不胜举", [174]="人外有人", [175]="防不胜防", [176]="忍无可忍", [177]="闻所未闻", [178]="欢呼雀跃", [179]="鸦雀无声", [180]="鹏程万里", [181]="一箭双雕", [182]="风声鹤唳", [183]="鹤发鸡皮", [184]="鹤发童颜", [185]="鹤立鸡群", [186]="麻雀虽小", [187]="五脏俱全", [188]="螳螂捕蝉", [189]="黄雀在后", [190]="一唱一和", [191]="一呼百应", [192]="一干二净", [193]="一举两得", [194]="一落千丈", [195]="一模一样", [196]="一暴十寒", [197]="一日千里", [198]="一五一十", [199]="一心一意", [200]="两面三刀", [201]="三长两短", [202]="三番五次", [203]="三三两两", [204]="三头六臂", [205]="三心二意", [206]="三言两语", [207]="四分五裂", [208]="四面八方", [209]="四通八达", [210]="四平八稳", [211]="五光十色", [212]="五湖四海", [213]="五花八门", [214]="五颜六色", [215]="六神无主", [216]="七颠八倒", [217]="七零八落", [218]="七拼八凑", [219]="七上八下", [220]="七手八脚", [221]="七嘴八舌", [222]="八面玲珑", [223]="九死一生", [224]="九牛一毛", [225]="十拿九稳", [226]="十全十美", [227]="百发百中", [228]="百孔千疮", [229]="百战百胜", [230]="百依百顺", [231]="千变万化", [232]="千差万别", [233]="千军万马", [234]="千山万水", [235]="千丝万缕", [236]="千辛万苦", [237]="千言万语", [238]="千真万确", [239]="千锤百炼", [240]="千方百计", [241]="千奇百怪", [242]="千姿百态", [243]="千钧一发", [244]="千虑一得", [245]="千虑一失", [246]="千篇一律", [247]="万水千山", [248]="万无一失", [249]="万众一心", [250]="万紫千红", [251]="万死一生", [252]="不可多得", [253]="凤毛麟角", [254]="九牛一毛", [255]="绝无仅有", [256]="空前绝后", [257]="寥寥无几", [258]="寥若晨星", [259]="宁缺毋滥", [260]="前所未有", [261]="屈指可数", [262]="三三两两", [263]="铁树开花", [264]="微乎其微", [265]="一麟半爪", [266]="一丝一毫", [267]="百里挑一", [268]="沧海一粟", [269]="千古绝唱", [270]="摩肩接踵", [271]="车水马龙", [272]="川流不息", [273]="纷至沓来", [274]="花花世界", [275]="举袖为云", [276]="挥汗如雨", [277]="络绎不绝", [278]="门庭若市", [279]="万人空巷", [280]="水泄不通", [281]="人声鼎沸", [282]="人欢马叫", [283]="人山人海", [284]="震耳欲聋", [285]="座无虚席", [286]="包罗万象", [287]="琳琅满目", [288]="美不胜收", [289]="目不暇接", [290]="无奇不有", [291]="无穷无尽", [292]="无所不包", [293]="五花八门", [294]="眼花缭乱", [295]="洋洋大观", [296]="一应俱全", [297]="应有尽有", [298]="应接不暇", [299]="比比皆是", [300]="不可计数", [301]="层出不穷", [302]="绰绰有余", [303]="多多益善", [304]="多如牛毛", [305]="俯拾皆市", [306]="举不胜举", [307]="漫山遍野", [308]="星罗棋布", [309]="丰富多彩", [310]="大雨倾盆", [311]="血雨腥风", [312]="风雨交加", [313]="风调雨顺", [314]="枪林弹雨", [315]="风雨同舟", [316]="风雨无阻", [317]="和风细雨", [318]="狂风暴雨", [319]="满城风雨", [320]="滂沱大雨", [321]="春风化雨", [322]="风雨飘摇", [323]="斜风细雨", [324]="未雨绸缪", [325]="水流湍急", [326]="水平如镜", [327]="高山流水", [328]="千山万水", [329]="水滴石穿", [330]="水乳交融", [331]="滴水不漏", [332]="杯水车薪", [333]="洪水猛兽", [334]="流水无情", [335]="直言不讳", [336]="无所顾忌", [337]="拐弯抹角", [338]="真心诚意", [339]="故弄玄虚", [340]="侃侃而谈", [341]="滔滔不绝", [342]="虚情假意", [343]="推心置腹", [344]="旁敲侧击", [345]="喋喋不休", [346]="慢条斯理", [347]="含糊其词", [348]="唠唠叨叨", [349]="振振有辞", [350]="肆无忌惮", [351]="大言不惭", [352]="娓娓动听", [353]="绘声绘色", [354]="对答如流", [355]="自圆其说", [356]="闲言碎语", [357]="闭月羞花", [358]="沉鱼落雁", [359]="出水芙蓉", [360]="明眸皓齿", [361]="美如冠玉", [362]="倾国倾城", [363]="国色天香", [364]="鹤发童颜", [365]="眉清目秀", [366]="和蔼可亲", [367]="心慈面善", [368]="张牙舞爪", [369]="愁眉苦脸", [370]="冰清玉洁", [371]="雍容华贵", [372]="文质彬彬", [373]="威风凛凛", [374]="老态龙钟", [375]="虎背熊腰", [376]="如花似玉", [377]="容光焕发", [378]="落落大方", [379]="骨瘦如柴", [380]="大腹便便", [381]="面黄肌瘦", [382]="其貌不扬", [383]="蓬头垢面", [384]="弱不禁风", [385]="口若悬河", [386]="对答如流", [387]="滔滔不绝", [388]="谈笑风生", [389]="高谈阔论", [390]="豪言壮语", [391]="夸夸其谈", [392]="花言巧语", [393]="忐忑不安", [394]="心惊肉跳", [395]="心神不定", [396]="心猿意马", [397]="心慌意乱", [398]="七上八下", [399]="心急如焚", [400]="奋不顾身", [401]="舍己为人", [402]="坚强不屈", [403]="赤胆忠心", [404]="不屈不挠", [405]="忠贞不渝", [406]="誓死不二", [407]="威武不屈", [408]="舍死忘生", [409]="肝胆相照", [410]="克己奉公", [411]="一丝不苟", [412]="两袖清风", [413]="见礼忘义", [414]="永垂不朽", [415]="顶天立地", [416]="豁达大度", [417]="兢兢业业", [418]="卖国求荣", [419]="恬不知耻", [420]="贪生怕死", [421]="厚颜无耻", [422]="秋高气爽", [423]="天高云淡", [424]="秋风送爽", [425]="秋菊怒放", [426]="秋菊傲骨", [427]="秋色迷人", [428]="秋色宜人", [429]="金桂飘香", [430]="东方欲晓", [431]="旭日东升", [432]="万物初醒", [433]="空气清醒", [434]="雄鸡报晓", [435]="晨雾弥漫", [436]="晨光绚丽", [437]="苍翠挺拔", [438]="郁郁葱葱", [439]="枯木逢春", [440]="秀丽多姿", [441]="青翠欲滴", [442]="林海雪原", [443]="耸入云天", [444]="瓜果蔬菜", [445]="清香鲜嫩", [446]="青翠欲滴", [447]="果园飘香", [448]="果实累累", [449]="果实饱满", [450]="鲜嫩水灵", [451]="大雪纷飞", [452]="大雪封山", [453]="鹅毛大雪", [454]="漫天飞雪", [455]="瑞雪纷飞", [456]="林海雪原", [457]="风雪交加", [458]="雪上加霜", [459]="寒霜袭人", [460]="霜林尽染", [461]="垂露欲滴", [462]="朝露晶莹", [463]="日出露干", [464]="电光石火", [465]="雷电大作", [466]="惊天动地", [467]="春雷滚滚", [468]="电劈石击", [469]="雷电交加", [470]="阴雨连绵", [471]="牛毛细雨", [472]="秋雨连绵", [473]="随风飘洒", [474]="倾盆大雨", [475]="狂风暴雨", [476]="大雨滂沱", [477]="瓢泼大雨", [478]="大雨淋漓", [479]="暴雨如注", [480]="秋风送爽", [481]="金风送爽", [482]="北风呼啸", [483]="微风习习", [484]="寒风刺骨", [485]="风和日丽", [486]="大雾迷途", [487]="云雾茫茫", [488]="雾似轻纱", [489]="风吹雾散", [490]="云消雾散", [491]="彩云满天", [492]="天高云淡", [493]="乌云翻滚", [494]="彤云密布", [495]="彩霞缤纷", [496]="晚霞如火", [497]="朝霞灿烂", [498]="丹霞似锦", [499]="满天星斗", [500]="众星捧月", [501]="群星灿烂", [502]="万点繁星", [503]="月出东墙", [504]="月出东山", [505]="玉兔东升", [506]="月光皎洁", [507]="月色迷人", [508]="月牙初升", [509]="旭日东升", [510]="日上三竿", [511]="一轮红日", [512]="日高三尺", [513]="艳阳高照", [514]="烈日当头", [515]="骄阳似火", [516]="日影西斜", [517]="碧空万里", [518]="浩浩长空", [519]="晴空万里", [520]="万里无云", [521]="碧空如洗", [522]="涓涓细流", [523]="喧腾飞溅", [524]="悠然而下", [525]="泉水丁冬", [526]="惊涛拍岸", [527]="波涛汹涌", [528]="白浪滔天", [529]="奔腾翻卷", [530]="白浪滔天", [531]="奔腾不息", [532]="汪洋大海", [533]="湖光水色", [534]="奔腾不息", [535]="滚滚东流", [536]="一泻千里", [537]="江水茫茫", [538]="荒山野岭", [539]="寸草不生", [540]="山清水秀", [541]="青山绿水", [542]="高耸入云", [543]="心灵手巧", [544]="窗明几静", [545]="手忙脚乱", [546]="井井有条", [547]="亲密无间", [548]="形影不离", [549]="情同手足", [550]="团结友爱", [551]="朝夕相处", [552]="人山人海", [553]="人声喧哗", [554]="人声嘈杂", [555]="人如潮涌", [556]="摩肩接踵", [557]="倾盆大雨", [558]="狂风暴雨", [559]="大雨滂沱", [560]="瓢泼大雨", [561]="神情专注", [562]="学而不厌", [563]="学无止境", [564]="专心致志", [565]="日积月累", [566]="似懂非懂", [567]="普天同庆", [568]="彩旗飞舞", [569]="欢天喜地", [570]="张灯结彩", [571]="彻夜狂欢", [572]="兴高采烈", [573]="手舞足蹈", [574]="笨手笨脚", [575]="挤眉弄眼", [576]="得意忘形", [577]="象征和平", [578]="乳燕初飞", [579]="婉转悦耳", [580]="莺歌燕舞", [581]="翩然归来", [582]="鹦鹉学舌", [583]="婉转悦耳", [584]="笨嘴学舌", [585]="神气活现", [586]="昂首挺胸", [587]="肥大丰满", [588]="自由自在", [589]="引吭高歌", [590]="腾空而起", [591]="狂奔飞驰", [592]="膘肥体壮", [593]="昂首嘶鸣", [594]="瘦骨嶙峋", [595]="行动迟缓", [596]="俯首帖耳", [597]="膘肥体壮", [598]="川流不息", [599]="呼啸而过", [600]="穿梭往来", [601]="缓缓驶离", [602]="一叶扁舟", [603]="扬帆远航", [604]="乘风破浪", [605]="雾海夜航", [606]="追波逐浪", [607]="划破云层", [608]="直冲云霄", [609]="穿云而过", [610]="银鹰展翅", [611]="栩栩如生", [612]="活泼可爱", [613]="惹人喜爱", [614]="爱不释手", [615]="雨后彩虹", [616]="彩桥横空", [617]="若隐若现", [618]="光芒万丈" }  function aaDesktop.aaCode:ClickDoneBtn(index) PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaData:sendAddonMsg(301,index, "GUILD"); aaDesktop.aaCode.mainView:Hide(); aaDesktop.aaCode.codes = {[1]=0,[2]=0,[3]=0,[4]=0,[5]=0,[6]=0,[7]=0,[8]=0,[9]=0}; end; aaDesktop.aaCode.mainView = CreateFrame("Frame",nil,UIParent) do aaDesktop.aaCode.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaCode.mainView:SetBackdrop ({bgFile = "Interface\\Tooltips\\UI-Tooltip-Background",edgeFile="Interface\\Tooltips\\UI-Tooltip-Border" ,edgeSize="16", tile = true}); aaDesktop.aaCode.mainView:SetBackdropColor(0,0,0,0.5); aaDesktop.aaCode.mainView:SetWidth(aaDesktop.aaCode.width); aaDesktop.aaCode.mainView:SetHeight(aaDesktop.aaCode.height); aaDesktop.aaCode.mainView:SetPoint("BOTTOMRIGHT",0,0); aaDesktop.aaCode.mainView:SetMovable(1); aaDesktop.aaCode.mainView:EnableMouse(); aaDesktop.aaCode.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaCode.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaCode.mainView:Hide(); end; aaDesktop.aaCode.titleText = aaDesktop.aaCode.mainView:CreateFontString("titleText", "OVERLAY", "GameFontNormal") do aaDesktop.aaCode.titleText:SetText(aaData.color_blue.."请点击下图中"..aaData.color_yellow.."黄字|r"..aaData.color_blue.."(2分钟)"); aaDesktop.aaCode.titleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 30); aaDesktop.aaCode.titleText:SetPoint("TOPLEFT", aaDesktop.aaCode.mainView, "TOPLEFT", 0, -10); aaDesktop.aaCode.titleText:SetWidth(aaDesktop.aaCode.width); aaDesktop.aaCode.titleText:SetHeight(50); end; aaDesktop.aaCode.detailText = aaDesktop.aaCode.mainView:CreateFontString("detailText", "OVERLAY", "GameFontNormal") do aaDesktop.aaCode.detailText:SetText(aaData.color_red.."注意：选错3次或长时间不选，将会被系统强制下线。"); aaDesktop.aaCode.detailText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDesktop.aaCode.detailText:SetPoint("TOPLEFT", aaDesktop.aaCode.mainView, "TOPLEFT", 0, -60); aaDesktop.aaCode.detailText:SetWidth(aaDesktop.aaCode.width); aaDesktop.aaCode.detailText:SetHeight(30); end; for i=1,9 do aaDesktop.aaCode.btns[i] = CreateFrame('Button', nil, aaDesktop.aaCode.mainView, 'UIPanelButtonTemplate') do local row,tmp2 = math.modf((i-1)/3); local col = math.floor((i-1)%3); aaDesktop.aaCode.btns[i]:SetPoint('TOPLEFT', aaDesktop.aaCode.mainView, 'TOPLEFT', 10+col*(aaDesktop.aaCode.btnWidth+aaDesktop.aaCode.margin), -90-row*(aaDesktop.aaCode.btnHeight+aaDesktop.aaCode.margin)); aaDesktop.aaCode.btns[i]:SetSize(aaDesktop.aaCode.btnWidth, aaDesktop.aaCode.btnHeight); end; end; function aaDesktop.aaCode:show(msg) if msg == nil or msg == "" then return; end; msg = msg + 0; if msg and msg > 0 then aaDesktop.aaCode.mainView:Show(); for i=1,#aaDesktop.aaCode.codes do local a = math.random(618); aaDesktop.aaCode.codes[i] = a; end; local ai = math.random(9); aaDesktop.aaCode.codes[ai] = msg; for i=1,#aaDesktop.aaCode.codes do local index = aaDesktop.aaCode.codes[i]; local color = aaData.color_white; if index == msg then aaDesktop.aaCode.titleText:SetText(aaData.color_blue.."请点击["..aaDesktop.aaCode.coders[index].."](限2分钟)|r");     end; local row,tmp2 = math.modf((i-1)/3); local col = math.floor((i-1)%3);aaDesktop.aaCode.btns[i]:SetText(color..aaDesktop.aaCode.coders[index]); aaDesktop.aaCode.btns[i]:SetScript('OnClick', function() aaDesktop.aaCode:ClickDoneBtn(index); end); end; end; end;       aaDesktop.aaHuodong.width = 550; aaDesktop.aaHuodong.height = 512; aaDesktop.aaHuodong.listView = {}; aaDesktop.aaHuodong.backView4 = CreateFrame("Frame","aaDesktop.aaHuodong.backView4",UIParent) do aaDesktop.aaHuodong.backView4:SetFrameStrata("TOOLTIP"); aaDesktop.aaHuodong.backView4:SetBackdrop( { edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border", edgeSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); aaDesktop.aaHuodong.backView4:SetWidth(aaDesktop.aaHuodong.width+30); aaDesktop.aaHuodong.backView4:SetHeight(aaDesktop.aaHuodong.height); aaDesktop.aaHuodong.backView4:SetPoint("CENTER",0,0); aaDesktop.aaHuodong.backView4:EnableMouseWheel(true); aaDesktop.aaHuodong.backView4:SetToplevel(true); aaDesktop.aaHuodong.backView4:SetClampedToScreen(true); aaDesktop.aaHuodong.backView4:SetMovable(true); aaDesktop.aaHuodong.backView4:EnableMouse(true); aaDesktop.aaHuodong.backView4:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaHuodong.backView4:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaHuodong.backView4:Show(); tinsert(UISpecialFrames, "aaDesktop.aaHuodong.backView4"); end;  aaDesktop.aaHuodong.backView1 = CreateFrame("Frame","aaDesktop.aaHuodong.backView1",aaDesktop.aaHuodong.backView4) do aaDesktop.aaHuodong.backView1:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg1"}); aaDesktop.aaHuodong.backView1:SetPoint("TOPLEFT", aaDesktop.aaHuodong.backView4, "TOPLEFT",0,0); aaDesktop.aaHuodong.backView1:SetWidth(32); aaDesktop.aaHuodong.backView1:SetHeight(aaDesktop.aaHuodong.height); end; aaDesktop.aaHuodong.backView2 = CreateFrame("Frame","aaDesktop.aaHuodong.backView2",aaDesktop.aaHuodong.backView4) do aaDesktop.aaHuodong.backView2:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg2"}); aaDesktop.aaHuodong.backView2:SetPoint("TOPLEFT", aaDesktop.aaHuodong.backView4, "TOPLEFT",32,0); aaDesktop.aaHuodong.backView2:SetWidth(aaDesktop.aaHuodong.width-64); aaDesktop.aaHuodong.backView2:SetHeight(aaDesktop.aaHuodong.height); end; aaDesktop.aaHuodong.backView3 = CreateFrame("Frame","aaDesktop.aaHuodong.backView3",aaDesktop.aaHuodong.backView4) do aaDesktop.aaHuodong.backView3:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg3"}); aaDesktop.aaHuodong.backView3:SetPoint("TOPLEFT", aaDesktop.aaHuodong.backView4, "TOPLEFT",aaDesktop.aaHuodong.width - 32,0); aaDesktop.aaHuodong.backView3:SetWidth(32); aaDesktop.aaHuodong.backView3:SetHeight(aaDesktop.aaHuodong.height); end; aaDesktop.aaHuodong.backView = CreateFrame("Frame","aaDesktop.aaHuodong.backView",aaDesktop.aaHuodong.backView4) do aaDesktop.aaHuodong.backView:SetPoint("TOPLEFT", aaDesktop.aaHuodong.backView4, "TOPLEFT",0,0); aaDesktop.aaHuodong.backView:SetWidth(aaDesktop.aaHuodong.width); aaDesktop.aaHuodong.backView:SetHeight(aaDesktop.aaHuodong.height); end; aaDesktop.aaHuodong.titletext = aaDesktop.aaHuodong.backView:CreateFontString("titletext", "OVERLAY", "GameFontNormal") do aaDesktop.aaHuodong.titletext:SetPoint("TOPLEFT", aaDesktop.aaHuodong.backView, "TOPLEFT", 0, -16); aaDesktop.aaHuodong.titletext:SetWidth(550); aaDesktop.aaHuodong.titletext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 24); aaDesktop.aaHuodong.titletext:SetText("|cFF00FFFF活|r|cFF00D9FF动|r|cFF00B3FF列|r|cFF008DFF表|r"); end; aaDesktop.aaHuodong.ScrollView = CreateFrame("ScrollFrame", "aaDesktop.aaHuodong.ScrollView", aaDesktop.aaHuodong.backView) do aaDesktop.aaHuodong.ScrollView:EnableMouseWheel(true); aaDesktop.aaHuodong.ScrollView:EnableMouse(true); aaDesktop.aaHuodong.ScrollView:SetMovable(true); aaDesktop.aaHuodong.ScrollView:SetSize(aaDesktop.aaHuodong.width, aaDesktop.aaHuodong.height - 70); aaDesktop.aaHuodong.ScrollView:RegisterForDrag('LeftButton'); aaDesktop.aaHuodong.ScrollView:SetPoint('TOPLEFT', 0, -54); InterfaceOptions_AddCategory(aaDesktop.aaHuodong.ScrollView); end; aaDesktop.aaHuodong.mainView = CreateFrame("Frame","aaDesktop.aaHuodong.mainView",aaDesktop.aaHuodong.ScrollView) do aaDesktop.aaHuodong.ScrollView:SetScrollChild(aaDesktop.aaHuodong.mainView); aaDesktop.aaHuodong.mainView:EnableMouse(true); aaDesktop.aaHuodong.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaHuodong.mainView:SetWidth(aaDesktop.aaHuodong.width); aaDesktop.aaHuodong.mainView:SetHeight(aaDesktop.aaHuodong.height - 54); aaDesktop.aaHuodong.mainView:SetPoint("TOPLEFT",0,0); aaDesktop.aaHuodong.mainView:Show(); end; aaDesktop.aaHuodong.slider = CreateFrame("Slider", "aaDesktop.aaHuodong.slider", aaDesktop.aaHuodong.backView, "OptionsSliderTemplate") do aaDesktop.aaHuodong.slider:SetWidth(30); aaDesktop.aaHuodong.slider:SetPoint('TOPLEFT', aaDesktop.aaHuodong.backView, 'TOPLEFT', aaDesktop.aaHuodong.width, -34); aaDesktop.aaHuodong.slider:SetHeight(aaDesktop.aaHuodong.height-34); aaDesktop.aaHuodong.slider:SetOrientation('VERTICAL'); aaDesktop.aaHuodong.slider:SetOrientation('HORIZONTAL'); aaDesktop.aaHuodong.slider.tooltipText = ""; getglobal(aaDesktop.aaHuodong.slider:GetName() .. 'Low'):Hide(); getglobal(aaDesktop.aaHuodong.slider:GetName() .. 'High'):Hide(); getglobal(aaDesktop.aaHuodong.slider:GetName() .. 'Text'):Hide(); aaDesktop.aaHuodong.slider:SetThumbTexture("Interface\\AddOns\\aaAddon\\Icons\\aa_dropIco"); aaDesktop.aaHuodong.slider:SetMovable(true); aaDesktop.aaHuodong.slider:EnableMouseWheel(true); aaDesktop.aaHuodong.slider:RegisterForDrag('LeftButton'); aaDesktop.aaHuodong.slider:SetOrientation("VERTICAL"); aaDesktop.aaHuodong.slider:SetValueStep(9); aaDesktop.aaHuodong.slider:SetMinMaxValues(0, aaDesktop.aaHuodong.height-54); aaDesktop.aaHuodong.slider:SetValue(0); aaDesktop.aaHuodong.slider:SetScript("OnValueChanged", function(self, value) aaDesktop.aaHuodong.ScrollView:SetVerticalScroll(value); end); end; aaDesktop.aaHuodong.backView4:SetScript("OnMouseWheel", function(self, delta) local Value = aaDesktop.aaHuodong.slider:GetValue(); if (delta < 0) then aaDesktop.aaHuodong.slider:SetValue(Value + 27); else aaDesktop.aaHuodong.slider:SetValue(Value - 27); end; end); function aaDesktop.aaHuodong:CreateCell(index,id,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaHuodong.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(aaDesktop.aaHuodong.width); menuView:SetHeight(54); menuView:SetPoint("TOPLEFT",aaDesktop.aaHuodong.mainView,'TOPLEFT',x,y); menuView:Hide(); end; menuView.backView = CreateFrame("Frame","menuView.backView",menuView) do menuView.backView:SetBackdrop( { edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border", edgeSize = 16, insets = { left = 1, right = 1, top = 1, bottom = 1 } }); menuView.backView:SetPoint("TOPLEFT", menuView, "TOPLEFT",5,0); menuView.backView:SetWidth(aaDesktop.aaHuodong.width-20); menuView.backView:SetHeight(54); end; menuView.iconView = CreateFrame('Button', nil, menuView.backView, '') do menuView.iconView:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 15, -5); menuView.iconView:SetButtonState('NORMAL'); menuView.iconView:IsEnabled(); menuView.iconView:SetNormalTexture(""); menuView.iconView:SetDisabledTexture(""); menuView.iconView:SetHighlightTexture(""); menuView.iconView:SetPushedTexture(""); menuView.iconView:SetWidth(44); menuView.iconView:SetHeight(44); end; menuView.nameText = menuView:CreateFontString("menuView.nameText", "OVERLAY", "GameFontNormal") do menuView.nameText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.nameText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 44+15+10,-7); menuView.nameText:SetHeight(20); menuView.nameText:SetText(""); end; menuView.titleText = menuView:CreateFontString("menuView.titleText", "OVERLAY", "GameFontNormal") do menuView.titleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.titleText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 44+15+10, -27); menuView.titleText:SetHeight(20); menuView.titleText:SetText(""); end; menuView.timeText = menuView:CreateFontString("menuView.timeText", "OVERLAY", "GameFontNormal") do menuView.timeText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.timeText:SetPoint("TOPRIGHT", menuView, "TOPRIGHT", -70, -5); menuView.timeText:SetHeight(44); menuView.timeText:SetText(""); end; menuView.DoneButton = CreateFrame('Button', nil, menuView.backView, 'UIPanelButtonTemplate') do menuView.DoneButton:SetPoint('TOPRIGHT', menuView, 'TOPRIGHT', -20, -12); menuView.DoneButton:SetSize(50, 30); menuView.DoneButton:SetText(""); menuView.DoneButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaData:sendAddonMsg(10011, id, "GUILD"); end); end; return menuView; end; aaDesktop.aaHuodong.CancelButton = CreateFrame('Button', nil, aaDesktop.aaHuodong.backView4, 'UIPanelCloseButton') do aaDesktop.aaHuodong.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaHuodong.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaHuodong.backView4, 'TOPRIGHT', 0, 0); aaDesktop.aaHuodong.CancelButton:SetSize(34, 34); aaDesktop.aaHuodong.CancelButton:SetScript('OnClick', function() aaData:sendAddonMsg(10110,"2", "GUILD"); aaDesktop.aaHuodong:hide(); end); end; function aaDesktop.aaHuodong:reload() aaDesktop.aaHuodong.aaHuodong_dur = 0; for i=1,#aa_huodong_time do local view = aaDesktop.aaHuodong.listView[i]; if view then view:Hide(); view = nil; aaDesktop.aaHuodong.listView[i] = nil; end; end; aaDesktop.aaHuodong.slider:SetMinMaxValues(0, #aa_huodong_time * 59 * 0.5); aaDesktop.aaHuodong.mainView:SetHeight(#aa_huodong_time * 59); for i=1,#aa_huodong_time do local huodong = aa_huodong_time[i]; if huodong then local id = huodong[1]; local time = huodong[2]; if id and time then aaDesktop.aaHuodong.listView[i] = aaDesktop.aaHuodong:CreateCell(i,id,5,-10-(54+5)*(i-1)); local view = aaDesktop.aaHuodong.listView[i]; if view then view:Show(); if time < 0 then view.DoneButton:Enable(); if -time >= 600 then view.timeText:SetText(aaData.color_green.."距离结束："..aaData:secondsToxx(-time)); else view.timeText:SetText(aaData.color_red.."马上结束："..aaData:secondsToxx(-time)); end; else view.DoneButton:Disable(); if time >= 600 then view.timeText:SetText(aaData.color_blue.."距离开启："..aaData:secondsToxx(time)); else view.timeText:SetText(aaData.color_red.."马上开启："..aaData:secondsToxx(time)); end; end; local huodong_d = aa_huodong[id]; if huodong_d then local name = huodong_d[1]; local title = huodong_d[2]; local icon = huodong_d[3]; local button = huodong_d[4]; if name and title and icon and button then view.nameText:SetText(name); view.titleText:SetText(title); view.iconView:SetNormalTexture(icon); view.iconView:SetDisabledTexture(icon); view.iconView:SetHighlightTexture(icon); view.iconView:SetPushedTexture(icon); view.DoneButton:SetText(button); end; end; end; end; end; end; end;  aaDesktop.aaHuodong.aaHuodong_time = 0; aaDesktop.aaHuodong.aaHuodong_dur = 0; local function aaHuodongUpdate(btn, elapsed) local time2 = GetTime()-aaDesktop.aaHuodong.aaHuodong_time; if time2 >= 1 then aaDesktop.aaHuodong.aaHuodong_time = GetTime(); aaDesktop.aaHuodong.aaHuodong_dur = aaDesktop.aaHuodong.aaHuodong_dur + 1; for i=1,#aa_huodong_time do local huodong = aa_huodong_time[i]; if huodong then local id = huodong[1]; local time = huodong[2]; if time then if time < 0 then time = time + aaDesktop.aaHuodong.aaHuodong_dur; else time = time - aaDesktop.aaHuodong.aaHuodong_dur; end; end; if id and time then local view = aaDesktop.aaHuodong.listView[i]; if view then view:Show(); if time < 0 then view.DoneButton:Enable(); if -time >= 600 then view.timeText:SetText(aaData.color_green.."距离结束："..aaData:secondsToxx(-time)); else view.timeText:SetText(aaData.color_red.."马上结束："..aaData:secondsToxx(-time)); end; else view.DoneButton:Disable(); if time >= 600 then view.timeText:SetText(aaData.color_blue.."距离开启："..aaData:secondsToxx(time)); else view.timeText:SetText(aaData.color_red.."马上开启："..aaData:secondsToxx(time)); end; end; end; end; end; end; end; end; function aaDesktop.aaHuodong:update() for i=1,#aa_huodong_time do local huodong = aa_huodong_time[i]; if huodong then local id = huodong[1]; local time = huodong[2]; if id and time then aaDesktop.aaHuodong.listView[i] = aaDesktop.aaHuodong:CreateCell(i,id,5,-10-(54+5)*(i-1)); local view = aaDesktop.aaHuodong.listView[i]; if view then view:Show(); if time < 0 then view.DoneButton:Enable(); if -time >= 600 then view.timeText:SetText(aaData.color_green.."距离结束："..aaData:secondsToxx(-time)); else view.timeText:SetText(aaData.color_red.."马上结束："..aaData:secondsToxx(-time)); end; else view.DoneButton:Disable(); if time >= 600 then view.timeText:SetText(aaData.color_blue.."距离开启："..aaData:secondsToxx(time)); else view.timeText:SetText(aaData.color_red.."马上开启："..aaData:secondsToxx(time)); end; end; end; end; end; end; end; function aaDesktop.aaHuodong:show() aaData:sendAddonMsg(10110,"1", "GUILD"); aaDesktop.aaHuodong.backView4:Show(); end; function aaDesktop.aaHuodong:hide() aaDesktop.aaHuodong.backView4:Hide(); end;     aaDesktop.aaFanpai.msgdata = {}; local fanpaitop1 = -104; local fanpaitop2 = -64; local fanpaiIconPt = "Interface\\AddOns\\aaAddon\\Icons\\baoxiang_pt"; local fanpaiIconHj = "Interface\\AddOns\\aaAddon\\Icons\\baoxiang_hj"; local fanpaiIconFan = "Interface\\AddOns\\aaAddon\\Icons\\baoxiang_fan"; local fanpaiIconFan1 = "Interface\\AddOns\\aaAddon\\Icons\\baoxiang_fan1"; local fanpaiIconFan2 = "Interface\\AddOns\\aaAddon\\Icons\\baoxiang_fan2"; aaDesktop.aaFanpai.mainView = CreateFrame("Frame",nil,UIParent) do aaDesktop.aaFanpai.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaFanpai.mainView:SetBackdrop( { bgFile = "Interface\\DialogFrame\\UI-DialogBox-Background", edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border", edgeSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); aaDesktop.aaFanpai.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaFanpai.mainView:SetWidth(1024); aaDesktop.aaFanpai.mainView:SetHeight(640); aaDesktop.aaFanpai.mainView:SetPoint("CENTER",0,0); aaDesktop.aaFanpai.mainView:SetToplevel(true); aaDesktop.aaFanpai.mainView:SetClampedToScreen(true); aaDesktop.aaFanpai.mainView:SetMovable(true); aaDesktop.aaFanpai.mainView:EnableMouse(true); aaDesktop.aaFanpai.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaFanpai.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaFanpai.mainView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaFanpai.mainView"); end; aaDesktop.aaFanpai.mainView.bgView1 = CreateFrame("Frame",nil,aaDesktop.aaFanpai.mainView) do aaDesktop.aaFanpai.mainView.bgView1:SetFrameStrata("TOOLTIP"); aaDesktop.aaFanpai.mainView.bgView1:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\baoxiang_bj1"}); aaDesktop.aaFanpai.mainView.bgView1:SetWidth(1024); aaDesktop.aaFanpai.mainView.bgView1:SetHeight(512); aaDesktop.aaFanpai.mainView.bgView1:SetPoint("TOPLEFT",0,0); aaDesktop.aaFanpai.mainView.bgView1:Show(); end; aaDesktop.aaFanpai.mainView.bgView2 = CreateFrame("Frame",nil,aaDesktop.aaFanpai.mainView) do aaDesktop.aaFanpai.mainView.bgView2:SetFrameStrata("TOOLTIP"); aaDesktop.aaFanpai.mainView.bgView2:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\baoxiang_bj2"}); aaDesktop.aaFanpai.mainView.bgView2:SetWidth(1024); aaDesktop.aaFanpai.mainView.bgView2:SetHeight(128); aaDesktop.aaFanpai.mainView.bgView2:SetPoint("TOPLEFT",0,-512); aaDesktop.aaFanpai.mainView.bgView2:Show(); end; aaDesktop.aaFanpai.mainView.menuView1 = CreateFrame("Frame",nil,aaDesktop.aaFanpai.mainView) do aaDesktop.aaFanpai.mainView.menuView1:SetFrameStrata("TOOLTIP"); aaDesktop.aaFanpai.mainView.menuView1:SetWidth(1024); aaDesktop.aaFanpai.mainView.menuView1:SetHeight(640); aaDesktop.aaFanpai.mainView.menuView1:SetPoint("TOPLEFT",0,0); aaDesktop.aaFanpai.mainView.menuView1:Show(); end; aaDesktop.aaFanpai.mainView.menuView2 = CreateFrame("Frame",nil,aaDesktop.aaFanpai.mainView) do aaDesktop.aaFanpai.mainView.menuView2:SetFrameStrata("TOOLTIP"); aaDesktop.aaFanpai.mainView.menuView2:SetWidth(1024); aaDesktop.aaFanpai.mainView.menuView2:SetHeight(640); aaDesktop.aaFanpai.mainView.menuView2:SetPoint("TOPLEFT",0,0); aaDesktop.aaFanpai.mainView.menuView2:Hide(); end; aaDesktop.aaFanpai.mainView.menuView2.CancelButton = CreateFrame('Button', nil, aaDesktop.aaFanpai.mainView.menuView2, 'UIPanelCloseButton') do aaDesktop.aaFanpai.mainView.menuView2.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaFanpai.mainView.menuView2.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaFanpai.mainView.menuView2, 'TOPRIGHT', 0, 0); aaDesktop.aaFanpai.mainView.menuView2.CancelButton:SetSize(44, 44); aaDesktop.aaFanpai.mainView.menuView2.CancelButton:SetScript('OnClick', function() aaDesktop.aaFanpai:hide(); end); end; function aaDesktop.aaFanpai:show(msg) if msg == "{}" then else aaDesktop.aaFanpai.msgdata = loadstring("return " .. msg)(); if aaDesktop.aaFanpai.msgdata[3] ~= "" or aaDesktop.aaFanpai.msgdata[4] ~= "" then aaDesktop.aaFanpai.titletext:SetText(aaDesktop.aaFanpai.msgdata[3]); aaDesktop.aaFanpai.detailText:SetText(aaDesktop.aaFanpai.msgdata[4]); aaDesktop.aaFanpai.mainView:Show(); aaDesktop.aaFanpai.mainView:SetHeight(aaDesktop.aaFanpai.detailText:GetHeight()+44+60); end; end; end; function aaDesktop.aaFanpai:hide() aaDesktop.aaFanpai.mainView:Hide(); end; aaDesktop.aaFanpai.mainView.menuView1.titletext = aaDesktop.aaFanpai.mainView.menuView1:CreateFontString("titletext", "OVERLAY", "GameFontNormal") do aaDesktop.aaFanpai.mainView.menuView1.titletext:SetPoint("TOPLEFT", aaDesktop.aaFanpai.mainView.menuView1, "TOPLEFT", 0, -12); aaDesktop.aaFanpai.mainView.menuView1.titletext:SetWidth(1024); aaDesktop.aaFanpai.mainView.menuView1.titletext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 48); aaDesktop.aaFanpai.mainView.menuView1.titletext:SetText(aaData.color_yellow.."奖励"); end; aaDesktop.aaFanpai.mainView.menuView1.timetext = aaDesktop.aaFanpai.mainView.menuView1:CreateFontString("timetext", "OVERLAY", "GameFontNormal") do aaDesktop.aaFanpai.mainView.menuView1.timetext:SetPoint("TOPLEFT", aaDesktop.aaFanpai.mainView.menuView1, "TOPLEFT", 0, -60); aaDesktop.aaFanpai.mainView.menuView1.timetext:SetWidth(1024); aaDesktop.aaFanpai.mainView.menuView1.timetext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 48); end; aaDesktop.aaFanpai.mainView.menuView2.titletext = aaDesktop.aaFanpai.mainView.menuView2:CreateFontString("titletext", "OVERLAY", "GameFontNormal") do aaDesktop.aaFanpai.mainView.menuView2.titletext:SetPoint("TOPLEFT", aaDesktop.aaFanpai.mainView.menuView2, "TOPLEFT", 0, -12); aaDesktop.aaFanpai.mainView.menuView2.titletext:SetWidth(1024); aaDesktop.aaFanpai.mainView.menuView2.titletext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 48); aaDesktop.aaFanpai.mainView.menuView2.titletext:SetText(aaData.color_yellow.."奖励"); end; aaDesktop.aaFanpai.mainView.menuView1.detailText = aaDesktop.aaFanpai.mainView.menuView1:CreateFontString("detailText", "OVERLAY", "GameFontNormal") do aaDesktop.aaFanpai.mainView.menuView1.detailText:SetPoint("TOPLEFT", aaDesktop.aaFanpai.mainView.menuView1, "TOPLEFT", 0, -386); aaDesktop.aaFanpai.mainView.menuView1.detailText:SetWidth(1024); aaDesktop.aaFanpai.mainView.menuView1.detailText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 30); aaDesktop.aaFanpai.mainView.menuView1.detailText:SetSpacing(5); end; local CreateFanpaiBtn1 = function(index, x, y, icon) local btn = CreateFrame('Button', "OVERLAY", aaDesktop.aaFanpai.mainView.menuView1, ''); btn:SetPoint('TOPLEFT', aaDesktop.aaFanpai.mainView.menuView1, 'TOPLEFT', x, y); btn:SetButtonState('NORMAL'); btn:Enable(); btn:SetNormalTexture(icon); btn:SetDisabledTexture(icon); btn:SetHighlightTexture(icon); btn:SetPushedTexture(icon); btn:SetWidth(128); btn:SetHeight(128); btn:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); local msg = aa_fanpai1[1].."\t"..index; aaData:sendAddonMsg(1012, msg, "GUILD"); end); btn.btn = {}; btn.btn = CreateFrame('Button', "OVERLAY", btn, ''); btn.btn:SetPoint('TOPLEFT', btn, 'TOPLEFT', 49, -43/3); btn.btn:SetButtonState('NORMAL'); btn.btn:SetWidth(30); btn.btn:SetHeight(30); btn.btn:Hide(); btn.btn:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end);  btn.title = btn:CreateFontString("title", "OVERLAY", "GameFontNormal"); btn.title:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); btn.title:SetPoint("TOPLEFT", btn, "TOPLEFT", 0, -30-43/3*2+8); btn.title:SetWidth(128); btn.title:Hide(); return btn; end;  local CreateFanpaiBtn2 = function(tag, x, y, icon) local btn = CreateFrame('Button', "OVERLAY", aaDesktop.aaFanpai.mainView.menuView2, ''); btn:SetPoint('TOPLEFT', aaDesktop.aaFanpai.mainView.menuView2, 'TOPLEFT', x, y); btn:SetButtonState('NORMAL'); btn:SetNormalTexture(icon); btn:SetWidth(128); btn:SetHeight(128);  btn.icon = CreateFrame('Button', "OVERLAY", btn, ''); btn.icon:SetPoint('TOPLEFT', btn, 'TOPLEFT', 6, -2); btn.icon:SetButtonState('NORMAL'); btn.icon:SetWidth(25); btn.icon:SetHeight(25);  btn.title = btn:CreateFontString("title", "OVERLAY", "GameFontNormal"); btn.title:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); btn.title:SetPoint("TOPLEFT", btn, "TOPLEFT", 34, -2); btn.title:SetHeight(25);  btn.btn = {}; for i=1,6 do btn.btn[i] = CreateFrame('Button', "OVERLAY", btn, ''); btn.btn[i]:SetButtonState('NORMAL'); btn.btn[i]:SetWidth(30); btn.btn[i]:SetHeight(30); btn.btn[i]:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); end; return btn; end;  local UpdateFanpaiBtn1 = function() for i=1,12 do local icon = ""; local name = ""; local miyao = aa_fanpai1[1]; local guid = aa_fanpai1[2]; local btn = nil; if i > 8 then btn = aaDesktop.aaFanpai.mainView.menuView1.Btn_hj[i - 8]; btn:SetNormalTexture(fanpaiIconHj); btn:SetDisabledTexture(fanpaiIconHj); btn:SetHighlightTexture(fanpaiIconHj); btn:SetPushedTexture(fanpaiIconHj); elseif i > 4 then btn = aaDesktop.aaFanpai.mainView.menuView1.Btn_vip[i - 4]; btn:Hide(); btn.btn:Hide(); btn.title:Hide(); else btn = aaDesktop.aaFanpai.mainView.menuView1.Btn_pt[i]; btn:SetNormalTexture(fanpaiIconPt); btn:SetDisabledTexture(fanpaiIconPt); btn:SetHighlightTexture(fanpaiIconPt); btn:SetPushedTexture(fanpaiIconPt); end; btn:Enable(); local itemLink = nil; if miyao ~= nil or guid ~= nil then if  aa_fanpai2[miyao] and aa_fanpai2[miyao][guid] and aa_fanpai2[miyao][guid][i] then itemLink = aa_fanpai2[miyao][guid][i]; local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); if itemId + 0 > 0 then icon = GetItemIcon(itemId); name = itemLink; end; end; end; if icon == "" or name == "" then btn.btn:Hide(); btn.title:Hide(); else btn.btn:SetScript('OnEnter', function() if itemLink then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(btn.btn, "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",btn.btn,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end); btn:SetNormalTexture(fanpaiIconFan); btn:SetDisabledTexture(fanpaiIconFan); btn:SetHighlightTexture(fanpaiIconFan); btn:SetPushedTexture(fanpaiIconFan); btn.btn:SetNormalTexture(icon); btn.btn:SetDisabledTexture(icon); btn.btn:SetHighlightTexture(icon); btn.btn:SetPushedTexture(icon); btn.title:SetText(name); btn:Show(); btn.btn:Show(); btn.title:Show(); btn:Disable(); end; end; end;  local UpdateFanpaiBtn2 = function() local miyao = aa_fanpai1[1]; local top = -33; if miyao ~= nil and miyao ~= "" and aa_fanpai2 ~= nil and aa_fanpai2 ~= {} and aa_fanpai2[miyao] then local rtable = aa_fanpai2[miyao]; local i = 0; for guid,v in pairs(rtable) do i = i + 1; local btn = aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[i]; if btn ~= nil then local picon = aaData:getRaceIcon(guid); local pname = aaData:getPlayerClassName(guid); btn:SetNormalTexture(fanpaiIconFan1); btn.icon:SetNormalTexture(picon); btn.title:SetText(pname); if v ~= nil and v ~= {} then local count = 0; for index,itemLink in pairs(v) do local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local icon = GetItemIcon(itemId); local name = itemLink; count = count + 1; btn.btn[count]:SetNormalTexture(icon); btn.btn[count]:SetScript('OnEnter', function() if itemLink then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(btn.btn[count], "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",btn.btn[count],"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end); btn.btn[count]:Show(); end; for i=1,6 do if i <= count then btn.btn[i]:Show(); else btn.btn[i]:Hide(); end; end; if count == 1 then for i=1,6 do if i <= 1 then btn.btn[i]:SetPoint('TOPLEFT', btn, 'TOPLEFT', 49, top-29); end; end elseif count == 2 then for i=1,6 do if i <= 2 then btn.btn[i]:SetPoint('TOPLEFT', btn, 'TOPLEFT', 24+51*(i-1), top-29); end; end elseif count == 3 then for i=1,6 do if i <= 3 then btn.btn[i]:SetPoint('TOPLEFT', btn, 'TOPLEFT', 30*(i-1)+28*0.333*i, top-29); end; end elseif count > 3 then for i=1,6 do if i > 3 then btn.btn[i]:SetPoint('TOPLEFT', btn, 'TOPLEFT', 30*(i-4)+28*0.333*(i-3), top-30*1-28*0.333*2); else btn.btn[i]:SetPoint('TOPLEFT', btn, 'TOPLEFT', 30*(i-1)+28*0.333*i, top-30*0-28*0.333*1); end; end; end; end; end; end; end; end;  aaDesktop.aaFanpai.mainView.menuView1.Btn_pt = {}; aaDesktop.aaFanpai.mainView.menuView1.Btn_vip = {}; aaDesktop.aaFanpai.mainView.menuView1.Btn_hj = {}; aaDesktop.aaFanpai.mainView.menuView2.Btn_fp = {}; aaDesktop.aaFanpai.mainView.menuView1.Btn_pt[1] = CreateFanpaiBtn1(1, 102.4*1 + 128*0, fanpaitop1, fanpaiIconPt); aaDesktop.aaFanpai.mainView.menuView1.Btn_pt[2] = CreateFanpaiBtn1(2, 102.4*2 + 128*1, fanpaitop1, fanpaiIconPt); aaDesktop.aaFanpai.mainView.menuView1.Btn_pt[3] = CreateFanpaiBtn1(3, 102.4*3 + 128*2, fanpaitop1, fanpaiIconPt); aaDesktop.aaFanpai.mainView.menuView1.Btn_pt[4] = CreateFanpaiBtn1(4, 102.4*4 + 128*3, fanpaitop1, fanpaiIconPt); aaDesktop.aaFanpai.mainView.menuView1.Btn_vip[1] = CreateFanpaiBtn1(5, 102.4*1 + 128*0, fanpaitop1-138, fanpaiIconFan); aaDesktop.aaFanpai.mainView.menuView1.Btn_vip[2] = CreateFanpaiBtn1(6, 102.4*2 + 128*1, fanpaitop1-138, fanpaiIconFan); aaDesktop.aaFanpai.mainView.menuView1.Btn_vip[3] = CreateFanpaiBtn1(7, 102.4*3 + 128*2, fanpaitop1-138, fanpaiIconFan); aaDesktop.aaFanpai.mainView.menuView1.Btn_vip[4] = CreateFanpaiBtn1(8, 102.4*4 + 128*3, fanpaitop1-138, fanpaiIconFan); aaDesktop.aaFanpai.mainView.menuView1.Btn_vip[1]:Hide(); aaDesktop.aaFanpai.mainView.menuView1.Btn_vip[2]:Hide(); aaDesktop.aaFanpai.mainView.menuView1.Btn_vip[3]:Hide(); aaDesktop.aaFanpai.mainView.menuView1.Btn_vip[4]:Hide(); aaDesktop.aaFanpai.mainView.menuView1.Btn_hj[1] = CreateFanpaiBtn1(9, 102.4*1 + 128*0, fanpaitop1-366, fanpaiIconHj); aaDesktop.aaFanpai.mainView.menuView1.Btn_hj[2] = CreateFanpaiBtn1(10, 102.4*2 + 128*1, fanpaitop1-366, fanpaiIconHj); aaDesktop.aaFanpai.mainView.menuView1.Btn_hj[3] = CreateFanpaiBtn1(11, 102.4*3 + 128*2, fanpaitop1-366, fanpaiIconHj); aaDesktop.aaFanpai.mainView.menuView1.Btn_hj[4] = CreateFanpaiBtn1(12, 102.4*4 + 128*3, fanpaitop1-366, fanpaiIconHj); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[1] = CreateFanpaiBtn2(101, 16*1 + 128*0, fanpaitop2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[2] = CreateFanpaiBtn2(102, 16*2 + 128*1, fanpaitop2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[3] = CreateFanpaiBtn2(103, 16*3 + 128*2, fanpaitop2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[4] = CreateFanpaiBtn2(104, 16*4 + 128*3, fanpaitop2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[5] = CreateFanpaiBtn2(105, 16*5 + 128*4, fanpaitop2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[6] = CreateFanpaiBtn2(106, 16*6 + 128*5, fanpaitop2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[7] = CreateFanpaiBtn2(107, 16*7 + 128*6, fanpaitop2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[8] = CreateFanpaiBtn2(108, 16*1 + 128*0, fanpaitop2-(14+128)*1, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[9] = CreateFanpaiBtn2(109, 16*2 + 128*1, fanpaitop2-(14+128)*1, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[10] = CreateFanpaiBtn2(110, 16*3 + 128*2, fanpaitop2-(14+128)*1, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[11] = CreateFanpaiBtn2(111, 16*4 + 128*3, fanpaitop2-(14+128)*1, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[12] = CreateFanpaiBtn2(112, 16*5 + 128*4, fanpaitop2-(14+128)*1, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[13] = CreateFanpaiBtn2(113, 16*6 + 128*5, fanpaitop2-(14+128)*1, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[14] = CreateFanpaiBtn2(114, 16*7 + 128*6, fanpaitop2-(14+128)*1, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[15] = CreateFanpaiBtn2(115, 16*1 + 128*0, fanpaitop2-(14+128)*2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[16] = CreateFanpaiBtn2(116, 16*2 + 128*1, fanpaitop2-(14+128)*2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[17] = CreateFanpaiBtn2(117, 16*3 + 128*2, fanpaitop2-(14+128)*2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[18] = CreateFanpaiBtn2(118, 16*4 + 128*3, fanpaitop2-(14+128)*2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[19] = CreateFanpaiBtn2(119, 16*5 + 128*4, fanpaitop2-(14+128)*2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[20] = CreateFanpaiBtn2(120, 16*6 + 128*5, fanpaitop2-(14+128)*2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[21] = CreateFanpaiBtn2(121, 16*7 + 128*6, fanpaitop2-(14+128)*2, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[22] = CreateFanpaiBtn2(122, 102.4*1 + 128*0, fanpaitop2-(14+128)*3, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[23] = CreateFanpaiBtn2(123, 102.4*2 + 128*1, fanpaitop2-(14+128)*3, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[14] = CreateFanpaiBtn2(114, 102.4*3 + 128*2, fanpaitop2-(14+128)*3, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView2.Btn_fp[25] = CreateFanpaiBtn2(125, 102.4*4 + 128*3, fanpaitop2-(14+128)*3, fanpaiIconFan2); aaDesktop.aaFanpai.mainView.menuView1:Hide(); aaDesktop.aaFanpai.mainView.menuView2:Hide(); aaDesktop.aaFanpai.aaFanpai_time = 0; aaDesktop.aaFanpai.aaFanpai_dur = 0; local function aaFanpaiUpdate(btn, elapsed) local time2 = GetTime()-aaDesktop.aaFanpai.aaFanpai_time; if time2 >= 1 and aaDesktop.aaFanpai.aaFanpai_dur > -5 then aaDesktop.aaFanpai.aaFanpai_time = GetTime(); aaDesktop.aaFanpai.aaFanpai_dur = aaDesktop.aaFanpai.aaFanpai_dur - 1; aaDesktop.aaFanpai.mainView.menuView1.timetext:Hide(); if aaDesktop.aaFanpai.aaFanpai_dur == 0 then if aa_fanpai1 ~= {} and aa_fanpai1[1] ~= nil then local msg = aa_fanpai1[1].."\t"..1; aaData:sendAddonMsg(1012, msg, "GUILD"); end; end; if aaDesktop.aaFanpai.aaFanpai_dur == -3 then aaDesktop.aaFanpai.mainView.menuView1:Hide(); aaDesktop.aaFanpai.mainView.menuView2:Show(); end; if aaDesktop.aaFanpai.aaFanpai_dur > 0 then aaDesktop.aaFanpai.mainView.menuView1:Show(); aaDesktop.aaFanpai.mainView.menuView2:Hide(); aaDesktop.aaFanpai.mainView.menuView1.timetext:Show(); aaDesktop.aaFanpai.mainView.menuView1.timetext:SetText(aaData.color_white..aaDesktop.aaFanpai.aaFanpai_dur); end; if aaDesktop.aaFanpai.aaFanpai_dur > -3 and aaDesktop.aaFanpai.aaFanpai_dur < 1 then local dur = aaDesktop.aaFanpai.aaFanpai_dur + 3; aaDesktop.aaFanpai.mainView.menuView1.timetext:Show(); aaDesktop.aaFanpai.mainView.menuView1.timetext:SetText(aaData.color_red.."跳转详情("..dur..")"); end; end; end; function aaDesktop.aaFanpai:show() aaDesktop.aaFanpai.mainView:Show(); if aaDesktop.aaFanpai.aaFanpai_dur < 8 then aaDesktop.aaFanpai.mainView.menuView1:Show(); aaDesktop.aaFanpai.mainView.menuView2:Hide(); end; UpdateFanpaiBtn1(); UpdateFanpaiBtn2(); local need = ""; if worldconf[21] then local needid = worldconf[21]; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaFanpai"; need = aaData:getNeed(needid, 1); end; end; aaDesktop.aaFanpai.mainView.menuView1.detailText:SetText(need.."，可额外翻开黄金卡牌"); end;  aaDesktop.aaShop.scaleMulti = 0.85; aaDesktop.aaShop.btns = {}; aaDesktop.aaShop.selectIndex1 = 1; aaDesktop.aaShop.selectIndex2 = 1; aaDesktop.aaShop.selectIndex3 = 1; aaDesktop.aaShop.selectItem = 0; aaDesktop.aaShop.mainView = CreateFrame("Frame","aaDesktop.aaShop.mainView",UIParent) do aaDesktop.aaShop.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaShop.mainView:SetWidth(1024 * aaDesktop.aaShop.scaleMulti); aaDesktop.aaShop.mainView:SetHeight(658 * aaDesktop.aaShop.scaleMulti); aaDesktop.aaShop.mainView:SetPoint("CENTER"); aaDesktop.aaShop.mainView:SetToplevel(true); aaDesktop.aaShop.mainView:SetClampedToScreen(true); aaDesktop.aaShop.mainView:SetMovable(true); aaDesktop.aaShop.mainView:EnableMouse(true);  aaDesktop.aaShop.mainView.Background = aaDesktop.aaShop.mainView:CreateTexture(nil, "BACKGROUND") aaDesktop.aaShop.mainView.Background:SetSize(aaDesktop.aaShop.mainView:GetSize()) aaDesktop.aaShop.mainView.Background:SetPoint("CENTER", aaDesktop.aaShop.mainView, "CENTER") aaDesktop.aaShop.mainView.Background:SetTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main") aaDesktop.aaShop.mainView.Background:SetTexCoord(aaData:CoordsToTexCoords(1024, 0, 0, 1024, 658))  aaDesktop.aaShop.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaShop.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaShop.mainView:Show(); tinsert(UISpecialFrames, "aaDesktop.aaShop.mainView"); end;  aaDesktop.aaShop.mainView.Title = aaDesktop.aaShop.mainView:CreateFontString(); aaDesktop.aaShop.mainView.Title:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 14); aaDesktop.aaShop.mainView.Title:SetShadowOffset(1, -1); aaDesktop.aaShop.mainView.Title:SetPoint("TOP", aaDesktop.aaShop.mainView, "TOP", 0, -3); aaDesktop.aaShop.mainView.Title:SetText("|cffedd100商城|r");  aaDesktop.aaShop.mainView.pagetext = aaDesktop.aaShop.mainView:CreateFontString("titletext", "OVERLAY", "GameFontNormal") do aaDesktop.aaShop.mainView.pagetext:SetPoint("TOPLEFT", aaDesktop.aaShop.mainView, "TOPLEFT", 465+46, -472-68); aaDesktop.aaShop.mainView.pagetext:SetWidth(50); aaDesktop.aaShop.mainView.pagetext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaShop.mainView.pagetext:SetText(aaData.color_yellows.."1/10"); aaDesktop.aaShop.mainView.pagetext:Show(); end; aaDesktop.aaShop.mainView.pagebtn1 = CreateFrame('Button', nil, aaDesktop.aaShop.mainView, '') do aaDesktop.aaShop.mainView.pagebtn1:SetPoint('TOPLEFT', aaDesktop.aaShop.mainView, 'TOPLEFT', 420+50, -467-70); aaDesktop.aaShop.mainView.pagebtn1:SetSize(25, 25); local icon = "Interface\\AddOns\\aaAddon\\Icons\\aa-sc-buttonL"; aaDesktop.aaShop.mainView.pagebtn1:SetNormalTexture(icon); aaDesktop.aaShop.mainView.pagebtn1:SetNormalTexture(icon); aaDesktop.aaShop.mainView.pagebtn1:SetDisabledTexture(icon); aaDesktop.aaShop.mainView.pagebtn1:SetHighlightTexture(icon); aaDesktop.aaShop.mainView.pagebtn1:SetPushedTexture(icon); aaDesktop.aaShop.mainView.pagebtn1:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaDesktop.aaShop.selectIndex2 = aaDesktop.aaShop.selectIndex2 - 1; aaDesktop.aaShop.selectIndex3 = 1; aaDesktop.aaShop:reload(); end); end; aaDesktop.aaShop.mainView.pagebtn2 = CreateFrame('Button', nil, aaDesktop.aaShop.mainView, '') do aaDesktop.aaShop.mainView.pagebtn2:SetPoint('TOPLEFT', aaDesktop.aaShop.mainView, 'TOPLEFT', 527+50, -467-70); aaDesktop.aaShop.mainView.pagebtn2:SetSize(25, 25); local icon = "Interface\\AddOns\\aaAddon\\Icons\\aa-sc-buttonR"; aaDesktop.aaShop.mainView.pagebtn2:SetNormalTexture(icon); aaDesktop.aaShop.mainView.pagebtn2:SetNormalTexture(icon); aaDesktop.aaShop.mainView.pagebtn2:SetDisabledTexture(icon); aaDesktop.aaShop.mainView.pagebtn2:SetHighlightTexture(icon); aaDesktop.aaShop.mainView.pagebtn2:SetPushedTexture(icon); aaDesktop.aaShop.mainView.pagebtn2:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaDesktop.aaShop.selectIndex2 = aaDesktop.aaShop.selectIndex2 + 1; aaDesktop.aaShop.selectIndex3 = 1; aaDesktop.aaShop:reload(); end); end;  function aaDesktop.aaShop.ModelFrame_ShowPlayer(displayId) if(aaDesktop.aaShop.mainView.modelFrame.creatureModel:IsShown()) then aaDesktop.aaShop.mainView.modelFrame.creatureModel:Hide(); end;  aaDesktop.aaShop.mainView.modelFrame.playerModel:Hide(); aaDesktop.aaShop.mainView.modelFrame:Hide();  aaDesktop.aaShop.mainView.modelFrame.playerModel:SetUnit("player"); aaDesktop.aaShop.mainView.modelFrame.playerModel:Show(); aaDesktop.aaShop.mainView.modelFrame:Show(); aaDesktop.aaShop.mainView.modelFrame.playerModel:TryOn(displayId);  PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); end;  function aaDesktop.aaShop.ModelFrame_ShowCreature(displayId) if(aaDesktop.aaShop.mainView.modelFrame.playerModel:IsShown()) then aaDesktop.aaShop.mainView.modelFrame.playerModel:Hide(); end;  aaDesktop.aaShop.mainView.modelFrame.creatureModel:Hide(); aaDesktop.aaShop.mainView.modelFrame:Hide();  aaDesktop.aaShop.mainView.modelFrame.creatureModel:SetCreature(displayId); aaDesktop.aaShop.mainView.modelFrame.creatureModel:Show(); aaDesktop.aaShop.mainView.modelFrame:Show();  PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); end;  function aaDesktop.aaShop.ModelFrame_Create(parent) parent.modelFrame = CreateFrame("Frame", nil, parent); local modelFrame = parent.modelFrame; modelFrame:SetSize(230, 320); modelFrame:SetPoint("LEFT", parent, "RIGHT", 0, 0); modelFrame:Hide();  modelFrame.Background = modelFrame:CreateTexture(nil, "BACKGROUND"); modelFrame.Background:SetSize(modelFrame:GetSize()); modelFrame.Background:SetPoint("CENTER", modelFrame, "CENTER"); modelFrame.Background:SetTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); modelFrame.Background:SetTexCoord(aaData:CoordsToTexCoords(1024, 430, 658, 701, 1023));  modelFrame:SetScript( "OnHide", function() PlaySound("INTERFACESOUND_CHARWINDOWCLOSE", "Master"); end );  modelFrame:SetScript( "OnShow", function() PlaySound("INTERFACESOUND_CHARWINDOWOPEN", "Master"); end );  modelFrame.CloseButton = CreateFrame("Button", nil, modelFrame, "UIPanelCloseButton"); modelFrame.CloseButton:SetSize(28, 28); modelFrame.CloseButton:SetPoint("TOPRIGHT", modelFrame, "TOPRIGHT", 4, 3); modelFrame.CloseButton:EnableMouse(true); modelFrame.CloseButton:SetScript( "OnClick", function() PlaySound("INTERFACESOUND_CHARWINDOWCLOSE", "Master") modelFrame:Hide() end );  modelFrame.playerModel = CreateFrame("DressUpModel", nil, modelFrame); modelFrame.playerModel:SetPoint("CENTER", modelFrame, "CENTER", 0, 1); modelFrame.playerModel:SetSize(222, 267);  local turnSpeed = 34; local dragSpeed = 100; local zoomSpeed = 0.5; modelFrame.playerModel:SetPosition(0, 0, 0); modelFrame.playerModel:EnableMouse(true); modelFrame.playerModel:EnableMouseWheel(true); modelFrame.playerModel:SetScript( "OnMouseDown", function(self, button) local startPos = { GetCursorPosition(); }; if button == "LeftButton" then self:SetScript( "OnUpdate", function(self) local curX = ({ GetCursorPosition(); })[1] self:SetFacing( ((curX - startPos[1]) / turnSpeed) + self:GetFacing() ); startPos[1] = curX; end ) end; end );  modelFrame.playerModel:SetScript( "OnMouseUp", function(self, button) self:SetScript("OnUpdate", nil); end );  modelFrame.playerModel:SetScript( "OnMouseWheel", function(self, zoom) local pos = { self:GetPosition(); }; if zoom == 1 then pos[1] = pos[1] + zoomSpeed; else pos[1] = pos[1] - zoomSpeed; end;  if(pos[1] > 1) then pos[1] = 1; elseif(pos[1] < -0.5) then pos[1] = -0.5; end;  self:SetPosition(pos[1], pos[2], pos[3]); end );  modelFrame.creatureModel = CreateFrame("PlayerModel", nil, modelFrame); modelFrame.creatureModel:SetPoint("CENTER", modelFrame, "CENTER", 0, 1); modelFrame.creatureModel:SetSize(222, 267);  local turnSpeed = 34; local dragSpeed = 100; local zoomSpeed = 0.5; modelFrame.creatureModel:SetPosition(0, 0, 0); modelFrame.creatureModel:EnableMouse(true); modelFrame.creatureModel:EnableMouseWheel(true); modelFrame.creatureModel:SetScript( "OnMouseDown", function(self, button) local startPos = { GetCursorPosition(); }; if button == "LeftButton" then self:SetScript( "OnUpdate", function(self) local curX = ({ GetCursorPosition(); })[1] self:SetFacing( ((curX - startPos[1]) / turnSpeed) + self:GetFacing() ) startPos[1] = curX; end ); end; end );  modelFrame.creatureModel:SetScript( "OnMouseUp", function(self, button) self:SetScript("OnUpdate", nil); end );  modelFrame.creatureModel:SetScript( "OnMouseWheel", function(self, zoom) local pos = { self:GetPosition() }; if zoom == 1 then pos[1] = pos[1] + zoomSpeed; else pos[1] = pos[1] - zoomSpeed; end;  if(pos[1] > 1) then pos[1] = 1; elseif(pos[1] < -0.5) then pos[1] = -0.5; end;  self:SetPosition(pos[1], pos[2], pos[3]); end );  modelFrame.leftButton = CreateFrame("Button", nil, modelFrame); modelFrame.leftButton:SetSize(35, 35); modelFrame.leftButton:SetFrameLevel(modelFrame:GetFrameLevel()+2); modelFrame.leftButton:SetPoint("CENTER", modelFrame, "BOTTOM", -30, 40); modelFrame.leftButton:SetNormalTexture("Interface/buttons/ui-rotationleft-button-up.blp"); modelFrame.leftButton:SetHighlightTexture("Interface/buttons/ui-common-mousehilight.blp"); modelFrame.leftButton:SetPushedTexture("Interface/buttons/ui-rotationleft-button-down.blp");  modelFrame.leftButton:SetScript( "OnMouseDown", function(self, button) PlaySound("igInventoryRotateCharacter") self:SetScript( "OnUpdate", function(self, elapsed) if(modelFrame.playerModel:IsShown()) then modelFrame.playerModel:SetFacing(modelFrame.playerModel:GetFacing() + 0.03); end;  if(modelFrame.creatureModel:IsShown()) then modelFrame.creatureModel:SetFacing(modelFrame.creatureModel:GetFacing() + 0.03); end; end ); end );  modelFrame.leftButton:SetScript( "OnMouseUp", function(self, button) self:SetScript("OnUpdate", nil); end );  modelFrame.rightButton = CreateFrame("Button", nil, modelFrame); modelFrame.rightButton:SetSize(35, 35); modelFrame.rightButton:SetFrameLevel(modelFrame:GetFrameLevel()+2); modelFrame.rightButton:SetPoint("CENTER", modelFrame, "BOTTOM", 30, 40); modelFrame.rightButton:SetNormalTexture("Interface/buttons/ui-rotationright-button-up.blp"); modelFrame.rightButton:SetHighlightTexture("Interface/buttons/ui-common-mousehilight.blp"); modelFrame.rightButton:SetPushedTexture("Interface/buttons/ui-rotationright-button-down.blp");  modelFrame.rightButton:SetScript( "OnMouseDown", function(self, button) PlaySound("igInventoryRotateCharacter"); self:SetScript( "OnUpdate", function(self, elapsed) if(modelFrame.playerModel:IsShown()) then modelFrame.playerModel:SetFacing(modelFrame.playerModel:GetFacing() - 0.03); end;  if(modelFrame.creatureModel:IsShown()) then modelFrame.creatureModel:SetFacing(modelFrame.creatureModel:GetFacing() - 0.03); end; end ); end );  modelFrame.rightButton:SetScript( "OnMouseUp", function(self, button) self:SetScript("OnUpdate", nil); end ); end;  aaDesktop.aaShop.ModelFrame_Create(aaDesktop.aaShop.mainView);  aaDesktop.aaShop.mainView.cancelBtn = CreateFrame('Button', nil, aaDesktop.aaShop.mainView, 'UIPanelCloseButton') do aaDesktop.aaShop.mainView.cancelBtn:SetPoint('TOPRIGHT', aaDesktop.aaShop.mainView, 'TOPRIGHT', 5, 5); aaDesktop.aaShop.mainView.cancelBtn:SetSize(30, 30); aaDesktop.aaShop.mainView.cancelBtn:SetScript('OnClick', function() aaDesktop.aaShop.mainView:Hide(); end); end; function aaDesktop.aaShop:CreateCell(index,x,y) local w = 150; local h = 230; local menuView = CreateFrame("Button",nil,aaDesktop.aaShop.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(w); menuView:SetHeight(h); menuView:SetPoint("TOPLEFT", aaDesktop.aaShop.mainView, "TOPLEFT", x, y); menuView:SetNormalTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); menuView:SetHighlightTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); menuView:GetNormalTexture():SetTexCoord(aaData:CoordsToTexCoords(1024, 0, 658, 215, 1023)); menuView:GetHighlightTexture():SetTexCoord(aaData:CoordsToTexCoords(1024, 215, 658, 430, 1023)); menuView:Show(); end;  menuView.nameText = menuView:CreateFontString(); menuView.nameText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 11); menuView.nameText:SetShadowOffset(1, -1); menuView.nameText:SetPoint("CENTER", menuView, "CENTER", 0, 16); menuView.nameText:SetWidth(125); menuView.needText = menuView:CreateFontString(); menuView.needText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 13); menuView.needText:SetShadowOffset(1, -1); menuView.needText:SetPoint("CENTER", menuView, "CENTER", -3, -30);  menuView.Icon = menuView:CreateTexture(nil, "BACKGROUND"); menuView.Icon:SetSize(40, 40); menuView.Icon:SetPoint("CENTER", menuView, "CENTER", 0, 64);  menuView.Banner = CreateFrame("Frame", nil, menuView); menuView.Banner:SetSize(80, 25); menuView.Banner:SetPoint("TOPRIGHT", menuView, "TOPRIGHT", 1, 4);  menuView.Banner.Background = menuView.Banner:CreateTexture(nil, "BACKGROUND"); menuView.Banner.Background:SetSize(80, 25); menuView.Banner.Background:SetPoint("CENTER", menuView.Banner); menuView.Banner.Background:SetTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); menuView.Banner.Background:SetTexCoord(aaData:CoordsToTexCoords(1024, 961, 835, 1023, 866));  menuView.BannerText = menuView.Banner:CreateFontString(); menuView.BannerText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 11); menuView.BannerText:SetShadowOffset(1, -1); menuView.BannerText:SetPoint("CENTER", menuView.Banner.Background); menuView.BannerText:SetFormattedText("|cffffffff折扣: %i%%|r", 10);  menuView.newTag = menuView:CreateTexture(nil, "OVERLAY"); menuView.newTag:SetSize(65, 30); menuView.newTag:SetPoint("CENTER", menuView, "LEFT", 35, 90); menuView.newTag:SetTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); menuView.newTag:SetTexCoord(aaData:CoordsToTexCoords(1024, 862, 816, 961, 866)); menuView:SetScript('OnClick', function() aaDesktop.aaShop.mainView.modelFrame:Hide(); PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaDesktop.aaShop.selectIndex3 = index; local itemid = 0; local itementry = 0; local v = aa_shop2[aaDesktop.aaShop.selectIndex1]; if v ~= nil then local index = 0; for k1,v1 in pairs(v) do if v1 ~= nil and v1[1] == aaDesktop.aaShop.selectIndex2 then index = index + 1; if index ==  aaDesktop.aaShop.selectIndex3 then local shichuanEntry = v1[3]; local creatureEntry = v1[4]; if shichuanEntry ~= nil and shichuanEntry ~= "" and shichuanEntry + 0 > 0 then aaDesktop.aaShop.ModelFrame_ShowPlayer(shichuanEntry); elseif creatureEntry ~= nil and creatureEntry ~= "" and creatureEntry + 0 > 0 then aaDesktop.aaShop.ModelFrame_ShowCreature(creatureEntry); end; end; end; end; end; end);  menuView:SetScript('OnEnter', function() aaDesktop.aaShop.selectIndex3 = index; local itemid = 0; local itementry = 0; local v = aa_shop2[aaDesktop.aaShop.selectIndex1]; if v ~= nil then local index = 0; for k1,v1 in pairs(v) do if v1 ~= nil and v1[1] == aaDesktop.aaShop.selectIndex2 then index = index + 1; if index ==  aaDesktop.aaShop.selectIndex3 then local itemLink = v1[7]; if (not GameTooltip:IsVisible()) then GameTooltip:SetOwner(menuView, "ANCHOR_NONE"); end; GameTooltip:SetPoint("TOPLEFT",menuView,"TOPRIGHT", 0, 0); GameTooltip:SetHyperlink(itemLink); GameTooltip:SetToplevel(true); GameTooltip:Show(); end; end; end; end; end); menuView:SetScript('OnLeave', function() GameTooltip:Hide(); end); menuView.btn = CreateFrame('Button', nil, menuView, 'UIPanelButtonTemplate') do menuView.btn:SetPoint("CENTER", menuView, "CENTER", 0, -85) menuView.btn:SetSize(100, 20); menuView.btn:SetNormalTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); menuView.btn:SetHighlightTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); menuView.btn:SetPushedTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); menuView.btn:GetNormalTexture():SetTexCoord(aaData:CoordsToTexCoords(1024, 709, 849, 837, 873)); menuView.btn:GetHighlightTexture():SetTexCoord(aaData:CoordsToTexCoords(1024, 709, 849, 837, 873)); menuView.btn:GetPushedTexture():SetTexCoord(aaData:CoordsToTexCoords(1024, 709, 873, 837, 897)); menuView.btn.ButtonText = menuView.btn:CreateFontString(); menuView.btn.ButtonText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 11, "OUTLINE"); menuView.btn.ButtonText:SetPoint("CENTER", menuView.btn, 0, 0); menuView.btn.ButtonText:SetText("立即购买!"); menuView.btn:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaDesktop.aaShop.selectIndex3 = index; aaDesktop.aaShop:reload(); aaDesktop.aaShop.mainView:Hide(); aaDesktop.aaShop.mainView.menuView:Show(); end); end; return menuView; end; function aaDesktop.aaShop:ClickBiaoqian(index) PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); for i=1,#aaDesktop.aaShop.cellBtns do aaDesktop.aaShop.biaoqianBtns[i]:UnlockHighlight(); end; aaDesktop.aaShop.biaoqianBtns[index]:LockHighlight(); aaDesktop.aaShop.selectIndex1 = index; aaDesktop.aaShop.selectIndex2 = 1; aaDesktop.aaShop.selectIndex3 = 1; aaData:sendAddonMsg(1015, index, "GUILD"); end; function aaDesktop.aaShop:CreateBiaoqian(index,x,y) local w = 187; local h = 46.75; local menuView = CreateFrame("Button",nil,aaDesktop.aaShop.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(w); menuView:SetHeight(h); menuView:SetPoint("TOPLEFT",aaDesktop.aaShop.mainView,'TOPLEFT',x,y); menuView:SetNormalTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); menuView:SetHighlightTexture("Interface\\AddOns\\aaAddon\\Store_UI\\Frames\\StoreFrame_Main"); menuView:GetNormalTexture():SetTexCoord(aaData:CoordsToTexCoords(1024, 768, 897, 1023, 960)); menuView:GetHighlightTexture():SetTexCoord(aaData:CoordsToTexCoords(1024, 768, 960, 1023, 1023)); menuView:Show(); end; menuView.nameText = menuView:CreateFontString("menuView.nameText", "OVERLAY", "GameFontNormal") do menuView.nameText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.nameText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 40, -15); menuView.nameText:SetHeight(16); menuView.nameText:SetWidth(135); end;  menuView.Icon = menuView:CreateTexture(nil, "BACKGROUND"); menuView.Icon:SetSize(31, 31); menuView.Icon:SetPoint("LEFT", menuView, "LEFT", 6, -1);  menuView.btn = CreateFrame('Button', nil, menuView, '') do menuView.btn:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 0, 0); menuView.btn:SetSize(w, h); menuView.btn:SetScript('OnClick', function() aaDesktop.aaShop:ClickBiaoqian(index); end); end; return menuView; end;  local x_offsets = {-140, 20, 180, 340} aaDesktop.aaShop.cellBtn1 = aaDesktop.aaShop:CreateCell(1, 220, -70); aaDesktop.aaShop.cellBtn2 = aaDesktop.aaShop:CreateCell(2, 220+160*1, -70); aaDesktop.aaShop.cellBtn3 = aaDesktop.aaShop:CreateCell(3, 220+160*2, -70); aaDesktop.aaShop.cellBtn4 = aaDesktop.aaShop:CreateCell(4, 220+160*3, -70); aaDesktop.aaShop.cellBtn5 = aaDesktop.aaShop:CreateCell(5, 220, -70-230); aaDesktop.aaShop.cellBtn6 = aaDesktop.aaShop:CreateCell(6, 220+160*1, -70-230); aaDesktop.aaShop.cellBtn7 = aaDesktop.aaShop:CreateCell(7, 220+160*2, -70-230); aaDesktop.aaShop.cellBtn8 = aaDesktop.aaShop:CreateCell(8, 220+160*3, -70-230); aaDesktop.aaShop.biaoqianBtn1 = aaDesktop.aaShop:CreateBiaoqian(1, 14, -60); aaDesktop.aaShop.biaoqianBtn2 = aaDesktop.aaShop:CreateBiaoqian(2, 14, -60-36.5*1); aaDesktop.aaShop.biaoqianBtn3 = aaDesktop.aaShop:CreateBiaoqian(3, 14, -60-36.5*2); aaDesktop.aaShop.biaoqianBtn4 = aaDesktop.aaShop:CreateBiaoqian(4, 14, -60-36.5*3); aaDesktop.aaShop.biaoqianBtn5 = aaDesktop.aaShop:CreateBiaoqian(5, 14, -60-36.5*4); aaDesktop.aaShop.biaoqianBtn6 = aaDesktop.aaShop:CreateBiaoqian(2, 14, -60-36.5*5); aaDesktop.aaShop.biaoqianBtn7 = aaDesktop.aaShop:CreateBiaoqian(3, 14, -60-36.5*6); aaDesktop.aaShop.biaoqianBtn8 = aaDesktop.aaShop:CreateBiaoqian(4, 14, -60-36.5*7); aaDesktop.aaShop.biaoqianBtn9 = aaDesktop.aaShop:CreateBiaoqian(5, 14, -60-36.5*8); aaDesktop.aaShop.biaoqianBtn10 = aaDesktop.aaShop:CreateBiaoqian(3, 14, -60-36.5*9); aaDesktop.aaShop.biaoqianBtn11 = aaDesktop.aaShop:CreateBiaoqian(4, 14, -60-36.5*10); aaDesktop.aaShop.biaoqianBtn12 = aaDesktop.aaShop:CreateBiaoqian(5, 14, -60-36.5*11); aaDesktop.aaShop.cellBtns = {aaDesktop.aaShop.cellBtn1, aaDesktop.aaShop.cellBtn2, aaDesktop.aaShop.cellBtn3, aaDesktop.aaShop.cellBtn4, aaDesktop.aaShop.cellBtn5, aaDesktop.aaShop.cellBtn6, aaDesktop.aaShop.cellBtn7, aaDesktop.aaShop.cellBtn8}; aaDesktop.aaShop.biaoqianBtns = {aaDesktop.aaShop.biaoqianBtn1, aaDesktop.aaShop.biaoqianBtn2, aaDesktop.aaShop.biaoqianBtn3, aaDesktop.aaShop.biaoqianBtn4, aaDesktop.aaShop.biaoqianBtn5, aaDesktop.aaShop.biaoqianBtn6, aaDesktop.aaShop.biaoqianBtn7, aaDesktop.aaShop.biaoqianBtn8, aaDesktop.aaShop.biaoqianBtn9, aaDesktop.aaShop.biaoqianBtn10, aaDesktop.aaShop.biaoqianBtn11, aaDesktop.aaShop.biaoqianBtn12};  aaDesktop.aaShop.mainView.menuView = CreateFrame("Frame",nil,UIParent) do aaDesktop.aaShop.mainView.menuView:SetToplevel(true); aaDesktop.aaShop.mainView.menuView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-sc-queding"}); aaDesktop.aaShop.mainView.menuView:SetFrameStrata("TOOLTIP"); aaDesktop.aaShop.mainView.menuView:SetWidth(512); aaDesktop.aaShop.mainView.menuView:SetHeight(256); aaDesktop.aaShop.mainView.menuView:SetPoint("CENTER",0,0); aaDesktop.aaShop.mainView.menuView:Hide(); aaDesktop.aaShop.mainView.menuView.titletext = aaDesktop.aaShop.mainView.menuView:CreateFontString("aaDesktop.aaShop.mainView.menuView.titletext", "OVERLAY", "GameFontNormal") do aaDesktop.aaShop.mainView.menuView.titletext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDesktop.aaShop.mainView.menuView.titletext:SetPoint("TOPLEFT", aaDesktop.aaShop.mainView.menuView, "TOPLEFT", 0, -40); aaDesktop.aaShop.mainView.menuView.titletext:SetWidth(512); aaDesktop.aaShop.mainView.menuView.titletext:SetHeight(20); aaDesktop.aaShop.mainView.menuView.titletext:SetText(aaData.color_yellow.."请确认是否继续？"); aaDesktop.aaShop.mainView.menuView.titletext:Show(); end; aaDesktop.aaShop.mainView.menuView.detailtext = aaDesktop.aaShop.mainView.menuView:CreateFontString("aaDesktop.aaShop.mainView.menuView.detailtext", "OVERLAY", "GameFontNormal") do aaDesktop.aaShop.mainView.menuView.detailtext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaShop.mainView.menuView.detailtext:SetPoint("TOPLEFT", aaDesktop.aaShop.mainView.menuView, "TOPLEFT", 0, -70); aaDesktop.aaShop.mainView.menuView.detailtext:SetWidth(512); aaDesktop.aaShop.mainView.menuView.detailtext:SetHeight(80); aaDesktop.aaShop.mainView.menuView.detailtext:SetSpacing(3); aaDesktop.aaShop.mainView.menuView.detailtext:Show(); end; aaDesktop.aaShop.mainView.menuView.querenBtn = CreateFrame('Button', nil, aaDesktop.aaShop.mainView.menuView, '') do aaDesktop.aaShop.mainView.menuView.querenBtn:SetPoint('TOPLEFT', aaDesktop.aaShop.mainView.menuView, 'TOPLEFT', 108, -174); aaDesktop.aaShop.mainView.menuView.querenBtn:SetSize(128, 32); local icon = "Interface\\AddOns\\aaAddon\\Icons\\aa-sc-queren"; aaDesktop.aaShop.mainView.menuView.querenBtn:SetNormalTexture(icon); aaDesktop.aaShop.mainView.menuView.querenBtn:SetNormalTexture(icon); aaDesktop.aaShop.mainView.menuView.querenBtn:SetDisabledTexture(icon); aaDesktop.aaShop.mainView.menuView.querenBtn:SetHighlightTexture(icon); aaDesktop.aaShop.mainView.menuView.querenBtn:SetPushedTexture(icon); aaDesktop.aaShop.mainView.menuView.querenBtn:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if aa_shop2 ~= nil then local goumai = aaDesktop.aaShop.selectIndex1.."\t"..aaDesktop.aaShop.selectIndex2.."\t"..aaDesktop.aaShop.selectIndex3; aaData:sendAddonMsg(1016, goumai, "GUILD"); aaDesktop.aaShop.mainView.menuView:Hide(); aaDesktop.aaShop.mainView:Show(); end; end); end; aaDesktop.aaShop.mainView.menuView.quxiaoBtn = CreateFrame('Button', nil, aaDesktop.aaShop.mainView.menuView, 'UIPanelCloseButton') do aaDesktop.aaShop.mainView.menuView.quxiaoBtn:SetPoint('TOPLEFT', aaDesktop.aaShop.mainView.menuView, 'TOPLEFT', 279, -174); aaDesktop.aaShop.mainView.menuView.quxiaoBtn:SetSize(128, 32); aaDesktop.aaShop.mainView.menuView.quxiaoBtn:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-sc-quxiao"); aaDesktop.aaShop.mainView.menuView.quxiaoBtn:SetScript('OnClick', function() aaDesktop.aaShop.mainView.menuView:Hide(); aaDesktop.aaShop.mainView:Show(); end); end; aaDesktop.aaShop.mainView.menuView.cancelBtn = CreateFrame('Button', nil, aaDesktop.aaShop.mainView.menuView, 'UIPanelCloseButton') do aaDesktop.aaShop.mainView.menuView.cancelBtn:SetSize(44, 44); aaDesktop.aaShop.mainView.menuView.cancelBtn:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaShop.mainView.menuView.cancelBtn:SetPoint('TOPRIGHT', aaDesktop.aaShop.mainView.menuView, 'TOPRIGHT', -22, -22); aaDesktop.aaShop.mainView.menuView.cancelBtn:SetScript('OnClick', function() aaDesktop.aaShop.mainView.menuView:Hide(); aaDesktop.aaShop.mainView:Hide(); end); end; end;  function aaDesktop.aaShop:show() aaDesktop.aaShop.mainView:Show(); end; function aaDesktop.aaShop:hide() aaDesktop.aaShop.mainView.menuView:Hide(); aaDesktop.aaShop.mainView:Hide(); end; function aaDesktop.aaShop:reload() for i=1,#(aaDesktop.aaShop.cellBtns) do aaDesktop.aaShop.cellBtns[i]:Hide(); end; for i=1,#aaDesktop.aaShop.biaoqianBtns do aaDesktop.aaShop.biaoqianBtns[i]:Hide(); end; if aa_shop1 ~= nil then for k,v in pairs(aa_shop1) do if k>0 and v~=nil and v~="" and v~={} and v[1] then aaDesktop.aaShop.biaoqianBtns[k].nameText:SetText(v[1]); aaDesktop.aaShop.biaoqianBtns[k]:Show(); end if k>0 and v~=nil and v~="" and v~={} and v[2] then aaDesktop.aaShop.biaoqianBtns[k].Icon:SetTexture(v[2]); aaDesktop.aaShop.biaoqianBtns[k]:Show(); end end; local page = aa_shop1[aaDesktop.aaShop.selectIndex1]; if page and page ~= "" and page ~= {} and page[3] then if page[3] <= aaDesktop.aaShop.selectIndex2 + 0 then aaDesktop.aaShop.selectIndex2 = page[3]; end; if aaDesktop.aaShop.selectIndex2 < 1 then aaDesktop.aaShop.selectIndex2 = 1; end; local pagetext = aaDesktop.aaShop.selectIndex2.."/"..page[3]; aaDesktop.aaShop.mainView.pagetext:SetText(pagetext); end; end; if aa_shop2 ~= nil then local v1 = aa_shop2[aaDesktop.aaShop.selectIndex1]; if v1 ~= nil then local index = 0; for k,v in pairs(v1) do local ye = v[1]; local itemEntry = v[2]; local shichuanEntry = v[3]; local creatureEntry = v[4]; local isNew = v[5]; local zekou = v[6]; local itemname = v[7]; local needid = v[8]; local reward = v[9]; if ye and ye+0 > 0 then if (ye + 0) == aaDesktop.aaShop.selectIndex2 then index = index + 1; if itemEntry > 0 then local icon = GetItemIcon(itemEntry); aaDesktop.aaShop.cellBtns[index].Icon:SetTexture(icon); if itemname ~=nil and itemname ~= "" then aaDesktop.aaShop.cellBtns[index].nameText:SetText(itemname); end; local need = ""; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaShop"; need = aaData:getNeed(needid, 1); end; if need and need ~= "" then aaDesktop.aaShop.cellBtns[index].needText:SetText(need); end; aaDesktop.aaShop.cellBtns[index]:Show(); if index == aaDesktop.aaShop.selectIndex3 then local str = aaData.color_yellows.."购买："..itemname.."\n"..aaData.color_red.."需要条件：|r\n"..need; aaDesktop.aaShop.mainView.menuView.detailtext:SetText(str); end; if isNew ~= nil and isNew ~= "" and isNew + 0 > 0 then aaDesktop.aaShop.cellBtns[index].newTag:Show(); else aaDesktop.aaShop.cellBtns[index].newTag:Hide(); end; if zekou ~= nil and zekou ~= "" and zekou + 0 > 0 then aaDesktop.aaShop.cellBtns[index].Banner:Show(); aaDesktop.aaShop.cellBtns[index].Banner.Background:Show(); aaDesktop.aaShop.cellBtns[index].BannerText:Show(); aaDesktop.aaShop.cellBtns[index].BannerText:SetFormattedText("|cffffffff折扣: %i%%|r", zekou) else aaDesktop.aaShop.cellBtns[index].Banner:Hide(); aaDesktop.aaShop.cellBtns[index].Banner.Background:Hide(); aaDesktop.aaShop.cellBtns[index].BannerText:Hide(); end; end; end; end; end; end; end; end;  aaDesktop.aaHunyu.Btns = {}; aaDesktop.aaHunyu.Jihuos = {}; aaDesktop.aaHunyu.Cells = {}; aaDesktop.aaHunyu.selectMenu = 1; aaDesktop.aaHunyu.selectYe = 1; aaDesktop.aaHunyu.Ye = 0; aaDesktop.aaHunyu.mainView = CreateFrame("Frame","aaDesktop.aaHunyu.mainView",UIParent) do aaDesktop.aaHunyu.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaHunyu.mainView:SetWidth(512); aaDesktop.aaHunyu.mainView:SetHeight(512); aaDesktop.aaHunyu.mainView:SetPoint("CENTER"); aaDesktop.aaHunyu.mainView:SetToplevel(true); aaDesktop.aaHunyu.mainView:SetClampedToScreen(true); aaDesktop.aaHunyu.mainView:SetMovable(true); aaDesktop.aaHunyu.mainView:EnableMouse(true); aaDesktop.aaHunyu.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaHunyu.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaHunyu.mainView:Show(); tinsert(UISpecialFrames, "aaDesktop.aaHunyu.mainView"); end; function aaHunyuOnClickDone(index,selectItemId, selectItemEntry) local str = aaDesktop.aaHunyu.selectMenu.."\t"..index.."\t"..selectItemId.."\t"..selectItemEntry.."\t"..aaDesktop.aaHunyu.selectYe; aaData:sendAddonMsg(1018, str, "GUILD"); aaDesktop.aaHunyu:show(); end; function aaHunyuOnClickCancel() aaDesktop.aaHunyu:show(); end; function aaHunyuOnDoubleClickDone(index) local str = aaDesktop.aaHunyu.selectMenu.."\t"..index.."\t"..aaDesktop.aaHunyu.selectYe; aaData:sendAddonMsg(1019, str, "GUILD"); aaDesktop.aaHunyu:show(); end; function aaHunyuOnDoubleClickCancel() aaDesktop.aaHunyu:show(); end; function aaDesktop.aaHunyu:CreateBtn(index,x,y,w,h,image) local menuView = CreateFrame('Button', "OVERLAY",aaDesktop.aaHunyu.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetButtonState('NORMAL'); menuView:SetSize(w, h); menuView:SetPoint("TOPLEFT",x,y); menuView:IsEnabled(); menuView:SetNormalTexture(image); menuView:SetDisabledTexture(image); menuView:SetHighlightTexture(image); menuView:SetPushedTexture(image); menuView:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); local infoType, _, itemLink = GetCursorInfo(); if (infoType == "item") and index ~= 7 then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itementry, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; local selectItemId = suffixId - 0; local selectItemEntry = itementry + 0; if selectItemId > 0 and selectItemEntry > 0 then local items = aa_hunyu1[aaDesktop.aaHunyu.selectMenu]; local itemLinks = items[index]; local txt1 = ""; local txt2 = ""; if itemLinks ~= nil then local itemLink1 = itemLinks[1]; if itemLink1 ~= nil then local need_xiangqian = itemLinks[2]; local need_chaixie = itemLinks[3]; if need_xiangqian > 0 then txt1 = aaData:getNeed(need_xiangqian, 1, 1); end; if need_chaixie > 0 then txt2 = aaData:getNeed(need_chaixie, 1, 1); end; local itemString = string.match(itemLink1, "item[%-?%d:]+"); local _, itementry, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; if suffixId > 0 then local txt = "\""..aaData.color_red.."确定要将"..itemLink1..aaData.color_red.."替换为"..itemLink..aaData.color_red.."吗？|r\\n\\n".."需要条件：\\n"..txt1.."\\n"..txt2.."\","; local func1 = "\"aaHunyuOnClickDone("..index..","..selectItemId..","..selectItemEntry..")\","; local func2 = "\"aaHunyuOnClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaHunyu:hide(); return; end; end; end; local needid = itemLinks[2]; local need = ""; if needid > 0 then need = aaData:getNeed(needid, 1, 1); end; local txt = "\""..aaData.color_red.."确定镶嵌"..itemLink..aaData.color_red.."吗？|r\\n\\n需要条件：\\n"..need.."\","; local func1 = "\"aaHunyuOnClickDone("..index..","..selectItemId..","..selectItemEntry..")\","; local func2 = "\"aaHunyuOnClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaHunyu:hide(); end; end; end); menuView:SetScript('OnDoubleClick', function() local items = aa_hunyu1[aaDesktop.aaHunyu.selectMenu]; local itemLinks = items[index]; if itemLinks ~= nil and index ~= 7 then local itemLink = itemLinks[1]; local needid = itemLinks[3]; if itemLink ~= nil then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itementry, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; if suffixId > 0 then local need = ""; if needid ~= nil and needid > 0 then need = aaData:getNeed(needid, 1, 1); end; local txt = "\""..aaData.color_red.."确定拆卸"..itemLink..aaData.color_red.."吗？|r\\n\\n需要条件：\\n"..need.."\","; local func1 = "\"aaHunyuOnDoubleClickDone("..index..")\","; local func2 = "\"aaHunyuOnDoubleClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaHunyu:hide(); end; end; end; end); menuView:SetScript('OnEnter', function() local items = aa_hunyu1[aaDesktop.aaHunyu.selectMenu]; if index == 7 then local itemLink = aa_hunyu2[aaDesktop.aaHunyu.selectMenu]; if itemLink ~= nil then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(menuView, "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",menuView,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; return; end; if items ~= nil then local itemLinks = items[index]; if itemLinks ~= nil then local itemLink = itemLinks[1]; if itemLink ~= nil then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(menuView, "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",menuView,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end; end; end); menuView:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); end; return menuView; end; aaDesktop.aaHunyu.Btns[1] = aaDesktop.aaHunyu:CreateBtn(1, 321.5,-120,50,50,""); aaDesktop.aaHunyu.Btns[2] = aaDesktop.aaHunyu:CreateBtn(2, 241.5,-171,50,50,""); aaDesktop.aaHunyu.Btns[3] = aaDesktop.aaHunyu:CreateBtn(3, 242.5,-261,50,50,""); aaDesktop.aaHunyu.Btns[4] = aaDesktop.aaHunyu:CreateBtn(4, 321.5,-302,50,50,""); aaDesktop.aaHunyu.Btns[5] = aaDesktop.aaHunyu:CreateBtn(5, 400.5,-261,50,50,""); aaDesktop.aaHunyu.Btns[6] = aaDesktop.aaHunyu:CreateBtn(6, 401.5,-171,50,50,""); aaDesktop.aaHunyu.Btns[7] = aaDesktop.aaHunyu:CreateBtn(7, 311.5,-201,70,70,""); function aaDesktop.aaHunyu:CreateJihuo(index,x,y,w,h) local menuView = CreateFrame('Button', "OVERLAY",aaDesktop.aaHunyu.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetButtonState('NORMAL'); menuView:SetSize(w, h); menuView:SetPoint("TOPLEFT",x,y); menuView:IsEnabled(); menuView:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-shouji-jihuo"); menuView:SetDisabledTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-shouji-jihuo"); menuView:SetHighlightTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-shouji-jihuo"); menuView:SetPushedTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-shouji-jihuo"); menuView:SetScript('OnClick', function() local infoType, _, itemLink = GetCursorInfo(); if (infoType == "item") and index ~= 7 then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itementry, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; local selectItemId = suffixId - 0; local selectItemEntry = itementry + 0; if selectItemId > 0 and selectItemEntry > 0 then local items = aa_hunyu1[aaDesktop.aaHunyu.selectMenu]; local itemLinks = items[index]; local txt1 = ""; local txt2 = ""; if itemLinks ~= nil then local itemLink1 = itemLinks[1]; if itemLink1 ~= nil then local need_xiangqian = itemLinks[2]; local need_chaixie = itemLinks[3]; if need_xiangqian > 0 then txt1 = aaData:getNeed(need_xiangqian, 1, 1); end; if need_chaixie > 0 then txt2 = aaData:getNeed(need_chaixie, 1, 1); end; local itemString = string.match(itemLink1, "item[%-?%d:]+"); local _, itementry, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; if suffixId > 0 then local txt = "\""..aaData.color_red.."确定要将"..itemLink1..aaData.color_red.."替换为"..itemLink..aaData.color_red.."吗？|r\\n\\n".."需要条件：\\n"..txt1.."\\n"..txt2.."\","; local func1 = "\"aaHunyuOnClickDone("..index..","..selectItemId..","..selectItemEntry..")\","; local func2 = "\"aaHunyuOnClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaHunyu:hide(); return; end; end; end; local needid = itemLinks[2]; local need = ""; if needid > 0 then need = aaData:getNeed(needid, 1, 1); end; local txt = "\""..aaData.color_red.."确定镶嵌"..itemLink..aaData.color_red.."吗？|r\\n\\n需要条件：\\n"..need.."\","; local func1 = "\"aaHunyuOnClickDone("..index..","..selectItemId..","..selectItemEntry..")\","; local func2 = "\"aaHunyuOnClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaHunyu:hide(); end; end; end); menuView:SetScript('OnDoubleClick', function() local items = aa_hunyu1[aaDesktop.aaHunyu.selectMenu]; local itemLinks = items[index]; if itemLinks ~= nil and index ~= 7 then local itemLink = itemLinks[1]; local needid = itemLinks[3]; if itemLink ~= nil then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itementry, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; if suffixId > 0 then local need = ""; if needid ~= nil and needid > 0 then need = aaData:getNeed(needid, 1, 1); end; local txt = "\""..aaData.color_red.."确定拆卸"..itemLink..aaData.color_red.."吗？|r\\n\\n需要条件：\\n"..need.."\","; local func1 = "\"aaHunyuOnDoubleClickDone("..index..")\","; local func2 = "\"aaHunyuOnDoubleClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaHunyu:hide(); end; end; end; end); menuView:SetScript('OnEnter', function() local items = aa_hunyu1[aaDesktop.aaHunyu.selectMenu]; if index == 7 then local itemLink = aa_hunyu2[aaDesktop.aaHunyu.selectMenu]; if itemLink ~= nil then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(menuView, "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",menuView,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; return; end; if items ~= nil then local itemLinks = items[index]; if itemLinks ~= nil then local itemLink = itemLinks[1]; if itemLink ~= nil then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(menuView, "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",menuView,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end; end; end); menuView:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); end; return menuView; end; aaDesktop.aaHunyu.Jihuos[1] = aaDesktop.aaHunyu:CreateJihuo(1, 321.5,-120,50,50); aaDesktop.aaHunyu.Jihuos[2] = aaDesktop.aaHunyu:CreateJihuo(2, 241.5,-171,50,50); aaDesktop.aaHunyu.Jihuos[3] = aaDesktop.aaHunyu:CreateJihuo(3, 242.5,-261,50,50); aaDesktop.aaHunyu.Jihuos[4] = aaDesktop.aaHunyu:CreateJihuo(4, 321.5,-302,50,50); aaDesktop.aaHunyu.Jihuos[5] = aaDesktop.aaHunyu:CreateJihuo(5, 400.5,-261,50,50); aaDesktop.aaHunyu.Jihuos[6] = aaDesktop.aaHunyu:CreateJihuo(6, 401.5,-171,50,50); aaDesktop.aaHunyu.Jihuos[7] = aaDesktop.aaHunyu:CreateJihuo(7, 311.5,-201,70,70); aaDesktop.aaHunyu.bgView = CreateFrame("Frame",nil,aaDesktop.aaHunyu.mainView) do aaDesktop.aaHunyu.bgView:SetFrameStrata("TOOLTIP"); aaDesktop.aaHunyu.bgView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-shouji-bg"}); aaDesktop.aaHunyu.bgView:SetToplevel(true); aaDesktop.aaHunyu.bgView:SetWidth(512); aaDesktop.aaHunyu.bgView:SetHeight(512); aaDesktop.aaHunyu.bgView:SetPoint("TOPLEFT",0,0); aaDesktop.aaHunyu.bgView:Show(); end; aaDesktop.aaHunyu.bgView.titleText = aaDesktop.aaHunyu.bgView:CreateFontString("titleText", "OVERLAY", "GameFontNormal") do aaDesktop.aaHunyu.bgView.titleText:SetPoint("TOPLEFT", aaDesktop.aaHunyu.bgView, "TOPLEFT", 0, 0); aaDesktop.aaHunyu.bgView.titleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 24); aaDesktop.aaHunyu.bgView.titleText:SetWidth(512); aaDesktop.aaHunyu.bgView.titleText:SetHeight(55); aaDesktop.aaHunyu.bgView.titleText:SetText("|cFF00FFFF羁|r|cFF00D9FF绊|r|cFF00B3FF收|r|cFF008DFF集|r"); aaDesktop.aaHunyu.bgView.titleText:SetSpacing(30); end; aaDesktop.aaHunyu.bgView.kdView = CreateFrame("Frame",nil,aaDesktop.aaHunyu.bgView) do aaDesktop.aaHunyu.bgView.kdView:SetFrameStrata("TOOLTIP"); aaDesktop.aaHunyu.bgView.kdView:SetWidth(512); aaDesktop.aaHunyu.bgView.kdView:SetHeight(512); aaDesktop.aaHunyu.bgView.kdView:SetPoint("TOPLEFT",128,0); aaDesktop.aaHunyu.bgView.kdView:SetToplevel(true); aaDesktop.aaHunyu.bgView.kdView:Show(); end; aaDesktop.aaHunyu.preButton = CreateFrame('Button', nil, aaDesktop.aaHunyu.bgView, 'UIPanelButtonTemplate') do aaDesktop.aaHunyu.preButton:SetPoint('TOPLEFT', aaDesktop.aaHunyu.bgView, 'TOPLEFT', 43, -447); aaDesktop.aaHunyu.preButton:SetSize(50, 30); aaDesktop.aaHunyu.preButton:SetText("<"); aaDesktop.aaHunyu.preButton:Disable(); aaDesktop.aaHunyu.preButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if aaDesktop.aaHunyu.selectYe ~= 1 then aaDesktop.aaHunyu.selectYe = aaDesktop.aaHunyu.selectYe - 1; aaDesktop.aaHunyu.selectMenu = (aaDesktop.aaHunyu.selectYe - 1) * 6 + 1; end; aaData:sendAddonMsg(1017, aaDesktop.aaHunyu.selectYe, "GUILD"); end); end; aaDesktop.aaHunyu.sufButton = CreateFrame('Button', nil, aaDesktop.aaHunyu.bgView, 'UIPanelButtonTemplate') do aaDesktop.aaHunyu.sufButton:SetPoint('TOPLEFT', aaDesktop.aaHunyu.bgView, 'TOPLEFT', 120, -447); aaDesktop.aaHunyu.sufButton:SetSize(50, 30); aaDesktop.aaHunyu.sufButton:SetText(">"); aaDesktop.aaHunyu.sufButton:Disable(); aaDesktop.aaHunyu.sufButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if aaDesktop.aaHunyu.selectYe ~= aaDesktop.aaHunyu.Ye then aaDesktop.aaHunyu.selectYe = aaDesktop.aaHunyu.selectYe + 1; aaDesktop.aaHunyu.selectMenu = (aaDesktop.aaHunyu.selectYe - 1) * 6 + 1; end; aaData:sendAddonMsg(1017, aaDesktop.aaHunyu.selectYe, "GUILD"); end); end; function aaDesktop.aaHunyu:ClickCell(index) PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaDesktop.aaHunyu.selectIndex = index; aaDesktop.aaHunyu.selectMenu = 6 * (aaDesktop.aaHunyu.selectYe - 1) + index; for i=1,6 do local btn = aaDesktop.aaHunyu.Cells[i]; btn.biankuangView:Hide(); if i == index then btn.biankuangView:Show(); end; local items = aa_hunyu1[aaDesktop.aaHunyu.selectMenu]; if items ~= nil then local itemLinks = items[i]; if itemLinks ~= nil then local itemLink1 = itemLinks[1]; if itemLink1 ~= nil then local need_xiangqian = itemLinks[2]; local need_chaixie = itemLinks[3]; if need_xiangqian > 0 then aaData:getNeed(need_xiangqian, 1, 1); end; if need_chaixie > 0 then aaData:getNeed(need_chaixie, 1, 1); end; end; end; end; end; aaDesktop.aaHunyu:reload(); end; function aaDesktop.aaHunyu:CreateCell(index,x,y) local menuView = CreateFrame('Button', nil,aaDesktop.aaHunyu.bgView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetBackdrop ({bgFile = "Interface\\Tooltips\\UI-Tooltip-Background"}); menuView:SetBackdropColor(0,0,0,0); menuView:SetWidth(153); menuView:SetHeight(60); menuView:SetPoint("TOPLEFT",aaDesktop.aaHunyu.bgView,'TOPLEFT',x+5,y); menuView:Show(); menuView:SetScript('OnClick', function() menuView.iconView:Click(MouseButton, Down); end); end; menuView.iconView = CreateFrame('Button', nil, menuView, '') do menuView.iconView:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 5, -6); menuView.iconView:SetButtonState('NORMAL'); menuView.iconView:IsEnabled(); menuView.iconView:SetWidth(48); menuView.iconView:SetHeight(48); menuView.iconView:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); menuView.iconView:SetScript('OnClick', function() aaDesktop.aaHunyu:ClickCell(index); end); end; menuView.biankuangView = CreateFrame("Frame",nil,aaDesktop.aaHunyu.bgView) do menuView.biankuangView:SetFrameStrata("TOOLTIP"); menuView.biankuangView:SetBackdrop( { bgFile = "Interface\\DialogFrame\\UI-DialogBox-Background", edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border", edgeSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); menuView.biankuangView:SetPoint("TOPLEFT",aaDesktop.aaHunyu.bgView,'TOPLEFT',x+5-2,y+2); menuView.biankuangView:SetBackdropColor(0, 0, 0, 0.1); menuView.biankuangView:SetWidth(153+4); menuView.biankuangView:SetHeight(60+4); menuView.biankuangView:SetPoint("CENTER",0,0); menuView.biankuangView:Hide(); end; menuView.nameText = menuView:CreateFontString("menuView.nameText", "OVERLAY", "GameFontNormal") do menuView.nameText:SetFont("", 12.5); menuView.nameText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 48+8,0); menuView.nameText:SetWidth(95); menuView.nameText:SetHeight(60); end; return menuView; end; aaDesktop.aaHunyu.Cells[1] = aaDesktop.aaHunyu:CreateCell(1,26,-58 - 63 * 0); aaDesktop.aaHunyu.Cells[2] = aaDesktop.aaHunyu:CreateCell(2,26,-58 - 63 * 1); aaDesktop.aaHunyu.Cells[3] = aaDesktop.aaHunyu:CreateCell(3,26,-58 - 63 * 2); aaDesktop.aaHunyu.Cells[4] = aaDesktop.aaHunyu:CreateCell(4,26,-58 - 63 * 3); aaDesktop.aaHunyu.Cells[5] = aaDesktop.aaHunyu:CreateCell(5,26,-58 - 63 * 4); aaDesktop.aaHunyu.Cells[6] = aaDesktop.aaHunyu:CreateCell(6,26,-58 - 63 * 5); function aaDesktop.aaHunyu:reload() aaDesktop.aaHunyu.preButton:Disable(); aaDesktop.aaHunyu.sufButton:Enable(); for i=1,6 do local btn = aaDesktop.aaHunyu.Cells[i]; btn.biankuangView:Hide(); if i == (aaDesktop.aaHunyu.selectMenu - ((aaDesktop.aaHunyu.selectYe - 1) * 6)) then btn.biankuangView:Show(); end; end; if aaDesktop.aaHunyu.selectYe > 1 then aaDesktop.aaHunyu.preButton:Enable(); end; if aaDesktop.aaHunyu.selectYe == aaDesktop.aaHunyu.Ye then aaDesktop.aaHunyu.sufButton:Disable(); end; for i=1,6 do aaDesktop.aaHunyu.Btns[i]:Hide(); aaDesktop.aaHunyu.Cells[i]:Hide(); end; aaDesktop.aaHunyu.Btns[7]:Hide(); for i=((aaDesktop.aaHunyu.selectYe-1)*6+1), aaDesktop.aaHunyu.selectYe * 6 do local index = i - ((aaDesktop.aaHunyu.selectYe-1)*6); if aa_hunyu2[i] ~= nil then if aaDesktop.aaHunyu.Cells[index] ~= nil then local btn = aaDesktop.aaHunyu.Cells[index]; btn:Show(); local itemLink = aa_hunyu2[i]; btn.nameText:SetText(itemLink); local itemString = string.match(itemLink, "item[%-?%d:]+"); if itemString ~= nil then local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local image = GetItemIcon(itemId); aaData:setTextureFetter(btn.iconView, image, true); btn.iconView:SetScript('OnEnter', function() ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(btn.iconView, "ANCHOR_NONE"); end; ItemRefTooltip:SetPoint("BOTTOMLEFT",btn.iconView,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end); btn.iconView:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); end; end; local items = aa_hunyu1[i]; if items ~= nil then local count = 0; for j=1,#(aaDesktop.aaHunyu.Btns) do local itemLinks = items[j]; if itemLinks ~= nil then local itemLink = itemLinks[1]; if itemLink ~= nil then local itemString = string.match(itemLink, "item[%-?%d:]+"); if itemString ~= nil then local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; if aaDesktop.aaHunyu.Cells[index] ~= nil then local btn = aaDesktop.aaHunyu.Cells[index]; if suffixId > 0 then count = count + 1; aaData:setTextureFetter(btn.iconView, "", false); end; end; end; end; end; end; if aaDesktop.aaHunyu.Cells[index] ~= nil then local btn = aaDesktop.aaHunyu.Cells[index]; if count == 6 then aaData:setTextureFetter(btn.iconView, "", false); else aaData:setTextureFetter(btn.iconView, "", true); end; end; end; end; end; local items = nil; if aa_hunyu1[aaDesktop.aaHunyu.selectMenu] ~= nil then items = aa_hunyu1[aaDesktop.aaHunyu.selectMenu]; end; local jihuoitemLink = nil; if aa_hunyu2[aaDesktop.aaHunyu.selectMenu] ~= nil then jihuoitemLink = aa_hunyu2[aaDesktop.aaHunyu.selectMenu]; end; for i=1,7 do local jihuo = aaDesktop.aaHunyu.Jihuos[i]; jihuo:Hide(); end; if items ~= nil and jihuoitemLink ~= nil then local itemString = string.match(jihuoitemLink, "item[%-?%d:]+"); if itemString ~= nil then local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); if itemId + 0 > 0 then local image = GetItemIcon(itemId); aaData:setTextureFetter(aaDesktop.aaHunyu.Btns[7], image, true); aaDesktop.aaHunyu.Btns[7]:Show(); end; end; local count = 0; for i=1,#(aaDesktop.aaHunyu.Btns) do local itemLinks = items[i]; if itemLinks ~= nil then local itemLink = itemLinks[1]; if itemLink ~= nil then local itemString = string.match(itemLink, "item[%-?%d:]+"); if itemString ~= nil then local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; if itemId + 0 > 0 then local image = GetItemIcon(itemId); if image ~= nil and image ~= "" then local btn = aaDesktop.aaHunyu.Btns[i]; if btn ~= nil then btn:Show(); local jihuo = aaDesktop.aaHunyu.Jihuos[i]; if suffixId > 0 then jihuo:Show(); jihuo:SetToplevel(true); count = count + 1; aaData:setTextureFetter(btn, image, false); else aaData:setTextureFetter(btn, image, true); jihuo:SetToplevel(false); end; end; end; end; end; end; end; end; local jihuo7 = aaDesktop.aaHunyu.Jihuos[7]; if (#(aaDesktop.aaHunyu.Btns) - 1) == count then aaData:setTextureFetter(aaDesktop.aaHunyu.Btns[7], "", false); jihuo7:Show(); end; end; end;  function aaDesktop.aaHunyu:show() aaDesktop.aaHunyu.mainView:Show(); end; function aaDesktop.aaHunyu:hide() aaDesktop.aaHunyu.mainView:Hide(); end; aaDesktop.aaHunyu.bgView.cancelBtn = CreateFrame('Button', nil, aaDesktop.aaHunyu.bgView, 'UIPanelCloseButton') do aaDesktop.aaHunyu.bgView.cancelBtn:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaHunyu.bgView.cancelBtn:SetPoint('TOPRIGHT', aaDesktop.aaHunyu.bgView, 'TOPRIGHT', 0, 0); aaDesktop.aaHunyu.bgView.cancelBtn:SetSize(35, 35); aaDesktop.aaHunyu.bgView.cancelBtn:SetScript('OnClick', function() aaDesktop.aaHunyu:hide(); end); end;    aaDesktop.aaChuansong.mainView = CreateFrame("Frame","aaDesktop.aaChuansong.mainView",UIParent) do aaDesktop.aaChuansong.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaChuansong.mainView:SetWidth(512); aaDesktop.aaChuansong.mainView:SetHeight(512); aaDesktop.aaChuansong.mainView:SetPoint("CENTER"); aaDesktop.aaChuansong.mainView:SetToplevel(true); aaDesktop.aaChuansong.mainView:SetClampedToScreen(true); aaDesktop.aaChuansong.mainView:SetMovable(true); aaDesktop.aaChuansong.mainView:EnableMouse(true); aaDesktop.aaChuansong.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaChuansong.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaChuansong.mainView:Show(); tinsert(UISpecialFrames, "aaDesktop.aaChuansong.mainView"); end; aaDesktop.aaChuansong.bgView1 = CreateFrame("Frame","aaDesktop.aaChuansong.bgView1",aaDesktop.aaChuansong.mainView) do aaDesktop.aaChuansong.bgView1:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg1"}); aaDesktop.aaChuansong.bgView1:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT",0,0); aaDesktop.aaChuansong.bgView1:SetWidth(32); aaDesktop.aaChuansong.bgView1:SetHeight(512); end; aaDesktop.aaChuansong.bgView2 = CreateFrame("Frame","aaDesktop.aaChuansong.bgView2",aaDesktop.aaChuansong.mainView) do aaDesktop.aaChuansong.bgView2:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg2"}); aaDesktop.aaChuansong.bgView2:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT",32,0); aaDesktop.aaChuansong.bgView2:SetWidth(512-64); aaDesktop.aaChuansong.bgView2:SetHeight(512); end; aaDesktop.aaChuansong.bgView3 = CreateFrame("Frame","aaDesktop.aaChuansong.bgView3",aaDesktop.aaChuansong.mainView) do aaDesktop.aaChuansong.bgView3:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg3"}); aaDesktop.aaChuansong.bgView3:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT",512 - 32,0); aaDesktop.aaChuansong.bgView3:SetWidth(32); aaDesktop.aaChuansong.bgView3:SetHeight(512); end; aaDesktop.aaChuansong.bgView = CreateFrame("Frame",nil,aaDesktop.aaChuansong.mainView) do aaDesktop.aaChuansong.bgView:SetFrameStrata("TOOLTIP"); aaDesktop.aaChuansong.bgView:SetWidth(512); aaDesktop.aaChuansong.bgView:SetHeight(512); aaDesktop.aaChuansong.bgView:SetPoint("TOPLEFT",0,0); aaDesktop.aaChuansong.bgView:Show(); end; aaDesktop.aaChuansong.CancelButton = CreateFrame('Button', nil, aaDesktop.aaChuansong.mainView, 'UIPanelCloseButton') do aaDesktop.aaChuansong.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaChuansong.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaChuansong.mainView, 'TOPRIGHT', 0, 0); aaDesktop.aaChuansong.CancelButton:SetSize(35, 35); aaDesktop.aaChuansong.CancelButton:SetScript('OnClick', function() aaDesktop.aaChuansong:hide(); end); end; aaDesktop.aaChuansong.bgView.huodongText = aaDesktop.aaChuansong.bgView:CreateFontString("huodongText", "OVERLAY", "GameFontNormal") do aaDesktop.aaChuansong.bgView.huodongText:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT", 0, -65); aaDesktop.aaChuansong.bgView.huodongText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 25); aaDesktop.aaChuansong.bgView.huodongText:SetWidth(512); aaDesktop.aaChuansong.bgView.huodongText:SetHeight(25); aaDesktop.aaChuansong.bgView.huodongText:SetText("活动信息"); aaDesktop.aaChuansong.bgView.huodongText:SetSpacing(5); end; aaDesktop.aaChuansong.bgView.huodongText = aaDesktop.aaChuansong.bgView:CreateFontString("huodongText", "OVERLAY", "GameFontNormal") do aaDesktop.aaChuansong.bgView.huodongText:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT", 0, -270); aaDesktop.aaChuansong.bgView.huodongText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 25); aaDesktop.aaChuansong.bgView.huodongText:SetWidth(512); aaDesktop.aaChuansong.bgView.huodongText:SetHeight(25); aaDesktop.aaChuansong.bgView.huodongText:SetText("活动掉落"); aaDesktop.aaChuansong.bgView.huodongText:SetSpacing(5); end; aaDesktop.aaChuansong.bgView.titleText = aaDesktop.aaChuansong.bgView:CreateFontString("titleText", "OVERLAY", "GameFontNormal") do aaDesktop.aaChuansong.bgView.titleText:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT", 0, 0); aaDesktop.aaChuansong.bgView.titleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 60); aaDesktop.aaChuansong.bgView.titleText:SetWidth(512); aaDesktop.aaChuansong.bgView.titleText:SetHeight(60); aaDesktop.aaChuansong.bgView.titleText:SetText("对话"); aaDesktop.aaChuansong.bgView.titleText:SetSpacing(5); end; aaDesktop.aaChuansong.bgView.detailText1 = aaDesktop.aaChuansong.bgView:CreateFontString("detailText1", "OVERLAY", "GameFontNormal") do aaDesktop.aaChuansong.bgView.detailText1:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT", 70, -100); aaDesktop.aaChuansong.bgView.detailText1:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDesktop.aaChuansong.bgView.detailText1:SetHeight(30); aaDesktop.aaChuansong.bgView.detailText1:SetText(aaData.color_white.."地图说明：安安生生多"); aaDesktop.aaChuansong.bgView.detailText1:SetSpacing(5); end; aaDesktop.aaChuansong.bgView.detailText2 = aaDesktop.aaChuansong.bgView:CreateFontString("detailText2", "OVERLAY", "GameFontNormal") do aaDesktop.aaChuansong.bgView.detailText2:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT", 70, -130); aaDesktop.aaChuansong.bgView.detailText2:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDesktop.aaChuansong.bgView.detailText2:SetHeight(30); aaDesktop.aaChuansong.bgView.detailText2:SetText(aaData.color_white.."地图难度："); aaDesktop.aaChuansong.bgView.detailText2:SetSpacing(5); end; aaDesktop.aaChuansong.bgView.detailText3 = aaDesktop.aaChuansong.bgView:CreateFontString("detailText3", "OVERLAY", "GameFontNormal") do aaDesktop.aaChuansong.bgView.detailText3:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT", 70, -160); aaDesktop.aaChuansong.bgView.detailText3:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDesktop.aaChuansong.bgView.detailText3:SetHeight(30); aaDesktop.aaChuansong.bgView.detailText3:SetText(aaData.color_white.."地图掉落："); aaDesktop.aaChuansong.bgView.detailText3:SetSpacing(5); end; aaDesktop.aaChuansong.bgView.detailText4 = aaDesktop.aaChuansong.bgView:CreateFontString("detailText4", "OVERLAY", "GameFontNormal") do aaDesktop.aaChuansong.bgView.detailText4:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT", 70, -190); aaDesktop.aaChuansong.bgView.detailText4:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDesktop.aaChuansong.bgView.detailText4:SetHeight(30); aaDesktop.aaChuansong.bgView.detailText4:SetText(aaData.color_white.."进入条件："); aaDesktop.aaChuansong.bgView.detailText4:SetSpacing(5); end; aaDesktop.aaChuansong.bgView.detailText5 = aaDesktop.aaChuansong.bgView:CreateFontString("detailText5", "OVERLAY", "GameFontNormal") do aaDesktop.aaChuansong.bgView.detailText5:SetPoint("TOPLEFT", aaDesktop.aaChuansong.mainView, "TOPLEFT", 70, -220); aaDesktop.aaChuansong.bgView.detailText5:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDesktop.aaChuansong.bgView.detailText5:SetHeight(30); aaDesktop.aaChuansong.bgView.detailText5:SetText(aaData.color_white.."其他说明："); aaDesktop.aaChuansong.bgView.detailText5:SetSpacing(5); end; aaDesktop.aaChuansong.bgView.DoneButton = CreateFrame('Button', nil, aaDesktop.aaChuansong.mainView, 'UIPanelButtonTemplate') do aaDesktop.aaChuansong.bgView.DoneButton:SetPoint('CENTER', aaDesktop.aaChuansong.mainView, 'CENTER', 0, -200); aaDesktop.aaChuansong.bgView.DoneButton:SetSize(120, 40); aaDesktop.aaChuansong.bgView.DoneButton:SetText("进入地图"); aaDesktop.aaChuansong.bgView.DoneButton:SetScript('OnClick', function() aaDesktop.aaChuansong.ClickDoneBtn(); end); end; function aaDesktop.aaChuansong:ClickDoneBtn() local aa_ui_beizhu = "{[功能类型type] = {功能id,密钥}}"; local id = aa_ui[2][1]; local miyao = aa_ui[2][2]; aaData:sendAddonMsg(3001, miyao.."\t"..id, "GUILD"); aaDesktop.aaChuansong:hide(); end; aaDesktop.aaChuansong.bgView.btns = {}; for i=1,10 do aaDesktop.aaChuansong.bgView.btns[i] = CreateFrame('Button', nil, aaDesktop.aaChuansong.mainView, '') do local row,tmp2 = math.modf((i-1)/5); local col = math.floor((i-1)%5); aaDesktop.aaChuansong.bgView.btns[i]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-choujiang-cao"); aaDesktop.aaChuansong.bgView.btns[i]:SetPoint('TOPLEFT', aaDesktop.aaChuansong.mainView, 'TOPLEFT', 92+col*(50+20), -309-row*(46+19)); aaDesktop.aaChuansong.bgView.btns[i]:SetSize(46, 46); aaDesktop.aaChuansong.bgView.btns[i]:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); aaDesktop.aaChuansong.bgView.btns[i].IconText = aaDesktop.aaChuansong.bgView.btns[i]:CreateFontString("IconText", "OVERLAY", "GameFontNormal") do aaDesktop.aaChuansong.bgView.btns[i].IconText:SetPoint("TOPRIGHT", aaDesktop.aaChuansong.bgView.btns[i], "TOPRIGHT", -2, -26); aaDesktop.aaChuansong.bgView.btns[i].IconText:SetHeight(20); aaDesktop.aaChuansong.bgView.btns[i].IconText:SetFont("", 15); end; aaDesktop.aaChuansong.bgView.btns[i]:Show(); end; end; function aaDesktop.aaChuansong:show(aa_chuansong) local title = aa_chuansong[3]; local detail = aa_chuansong[4]; local detai2 = aa_chuansong[5]; local detai3 = aa_chuansong[6]; local detai4 = aa_chuansong[7]; local detai5 = aa_chuansong[8]; local items = aa_chuansong[9]; aaDesktop.aaChuansong.bgView.titleText:SetText(title); aaDesktop.aaChuansong.bgView.detailText1:SetText(detail); aaDesktop.aaChuansong.bgView.detailText2:SetText(detai2); aaDesktop.aaChuansong.bgView.detailText3:SetText(detai3); aaDesktop.aaChuansong.bgView.detailText4:SetText(detai4); aaDesktop.aaChuansong.bgView.detailText5:SetText(detai5); local index = 0 if items ~= nil and items ~= "" then local fugai = aaData:toVectorString2(items); for i,v in pairs(fugai) do index = index + 1; aaDesktop.aaChuansong.bgView.btns[index]:Show(); local icon = GetItemIcon(i); if icon ~= nil and icon ~= "" then aaDesktop.aaChuansong.bgView.btns[index]:SetNormalTexture(icon); if v + 0 > 1 then aaDesktop.aaChuansong.bgView.btns[index].IconText:SetText(aaData.color_white..v); end; aaDesktop.aaChuansong.bgView.btns[index]:SetScript('OnEnter', function() local itemLink = i; if itemLink then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(aaDesktop.aaChuansong.bgView.btns[index], "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",aaDesktop.aaChuansong.bgView.btns[index],"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end); end; end; end; aaDesktop.aaChuansong.mainView:Show(); end; function aaDesktop.aaChuansong:hide() aaDesktop.aaChuansong.mainView:Hide(); end;       aaDesktop.aaBianshen.btns = {}; aaDesktop.aaBianshen.values = {}; aaDesktop.aaBianshen.selectLan = 101; aaDesktop.aaBianshen.selectIndex = 1; aaDesktop.aaBianshen.baocun = {0,0,0,0,0,0}; aaDesktop.aaBianshen.mainView = CreateFrame("Frame","aaDesktop.aaBianshen.mainView",UIParent) do aaDesktop.aaBianshen.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaBianshen.mainView:SetWidth(512); aaDesktop.aaBianshen.mainView:SetHeight(512); aaDesktop.aaBianshen.mainView:SetPoint("CENTER"); aaDesktop.aaBianshen.mainView:SetToplevel(true); aaDesktop.aaBianshen.mainView:SetClampedToScreen(true); aaDesktop.aaBianshen.mainView:SetMovable(true); aaDesktop.aaBianshen.mainView:EnableMouse(true); aaDesktop.aaBianshen.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaBianshen.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaBianshen.mainView:Show(); tinsert(UISpecialFrames, "aaDesktop.aaBianshen.mainView"); end; aaDesktop.aaBianshen.bgView = CreateFrame("Frame",nil,aaDesktop.aaBianshen.mainView) do aaDesktop.aaBianshen.bgView:SetFrameStrata("TOOLTIP"); aaDesktop.aaBianshen.bgView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-shenqi-bg"}); aaDesktop.aaBianshen.bgView:SetWidth(512); aaDesktop.aaBianshen.bgView:SetHeight(512); aaDesktop.aaBianshen.bgView:SetPoint("TOPLEFT",0,0); aaDesktop.aaBianshen.bgView:Show(); end; aaDesktop.aaBianshen.CancelButton = CreateFrame('Button', nil, aaDesktop.aaBianshen.mainView, 'UIPanelCloseButton') do aaDesktop.aaBianshen.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaBianshen.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaBianshen.mainView, 'TOPRIGHT', 0, 0); aaDesktop.aaBianshen.CancelButton:SetSize(35, 35); aaDesktop.aaBianshen.CancelButton:SetScript('OnClick', function() aaDesktop.aaBianshen:hide(); end); end; aaDesktop.aaBianshen.titleText = aaDesktop.aaBianshen.bgView:CreateFontString("titleText", "OVERLAY", "GameFontNormal") do aaDesktop.aaBianshen.titleText:SetPoint("TOPLEFT", aaDesktop.aaBianshen.mainView, "TOPLEFT", 0, 0); aaDesktop.aaBianshen.titleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 24); aaDesktop.aaBianshen.titleText:SetWidth(512); aaDesktop.aaBianshen.titleText:SetHeight(55); aaDesktop.aaBianshen.titleText:SetText(aaData.color_yellows.."时装兑换"); aaDesktop.aaBianshen.titleText:SetSpacing(5); end; aaDesktop.aaBianshen.titleText1 = aaDesktop.aaBianshen.bgView:CreateFontString("titleText1", "OVERLAY", "GameFontNormal") do aaDesktop.aaBianshen.titleText1:SetPoint("TOPLEFT", aaDesktop.aaBianshen.mainView, "TOPLEFT", 300, -412); aaDesktop.aaBianshen.titleText1:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDesktop.aaBianshen.titleText1:SetHeight(20); aaDesktop.aaBianshen.titleText1:SetText(aaData.color_yellows.."兑换需要"); aaDesktop.aaBianshen.titleText1:SetSpacing(5); end; aaDesktop.aaBianshen.modelView = CreateFrame("PlayerModel", nil, aaDesktop.aaBianshen.mainView) do aaDesktop.aaBianshen.modelView:SetPoint("TOPLEFT",aaDesktop.aaBianshen.mainView,"TOPLEFT",178,-60); aaDesktop.aaBianshen.modelView:SetHeight(346); aaDesktop.aaBianshen.modelView:SetWidth(312); local turnSpeed = 34; local dragSpeed = 100; local zoomSpeed = 0.5; aaDesktop.aaBianshen.modelView:SetPosition(0, 0, 0); aaDesktop.aaBianshen.modelView:EnableMouse(true); aaDesktop.aaBianshen.modelView:EnableMouseWheel(true); aaDesktop.aaBianshen.modelView:SetScript( "OnMouseDown", function(self, button) local startPos = { GetCursorPosition(); }; if button == "LeftButton" then self:SetScript( "OnUpdate", function(self) local curX = ({ GetCursorPosition(); })[1] self:SetFacing( ((curX - startPos[1]) / turnSpeed) + self:GetFacing() ); startPos[1] = curX; end ); end; end );  aaDesktop.aaBianshen.modelView:SetScript( "OnMouseUp", function(self, button) self:SetScript("OnUpdate", nil); end );  aaDesktop.aaBianshen.modelView:SetScript( "OnMouseWheel", function(self, zoom) local pos = { self:GetPosition(); }; if zoom == 1 then pos[1] = pos[1] + zoomSpeed; else pos[1] = pos[1] - zoomSpeed; end;  if(pos[1] > 1) then pos[1] = 1; elseif(pos[1] < -0.5) then pos[1] = -0.5; end;  self:SetPosition(pos[1], pos[2], pos[3]); end ); aaDesktop.aaBianshen.modelView.leftButton = CreateFrame("Button", nil, aaDesktop.aaBianshen.modelView); aaDesktop.aaBianshen.modelView.leftButton:SetSize(35, 35); aaDesktop.aaBianshen.modelView.leftButton:SetFrameLevel(aaDesktop.aaBianshen.modelView:GetFrameLevel()+2); aaDesktop.aaBianshen.modelView.leftButton:SetPoint("CENTER", aaDesktop.aaBianshen.modelView, "TOP", -130, -40); aaDesktop.aaBianshen.modelView.leftButton:SetNormalTexture("Interface/buttons/ui-rotationleft-button-up.blp"); aaDesktop.aaBianshen.modelView.leftButton:SetHighlightTexture("Interface/buttons/ui-common-mousehilight.blp"); aaDesktop.aaBianshen.modelView.leftButton:SetPushedTexture("Interface/buttons/ui-rotationleft-button-down.blp");  aaDesktop.aaBianshen.modelView.leftButton:SetScript( "OnMouseDown", function(self, button) PlaySound("igInventoryRotateCharacter"); self:SetScript( "OnUpdate", function(self, elapsed) if(aaDesktop.aaBianshen.modelView:IsShown()) then aaDesktop.aaBianshen.modelView:SetFacing(aaDesktop.aaBianshen.modelView:GetFacing() + 0.03); end; end ); end );  aaDesktop.aaBianshen.modelView.leftButton:SetScript( "OnMouseUp", function(self, button) self:SetScript("OnUpdate", nil); end ); aaDesktop.aaBianshen.modelView.rightButton = CreateFrame("Button", nil, aaDesktop.aaBianshen.modelView); aaDesktop.aaBianshen.modelView.rightButton:SetSize(35, 35); aaDesktop.aaBianshen.modelView.rightButton:SetFrameLevel(aaDesktop.aaBianshen.modelView:GetFrameLevel()+2); aaDesktop.aaBianshen.modelView.rightButton:SetPoint("CENTER", aaDesktop.aaBianshen.modelView, "TOP", -90, -40); aaDesktop.aaBianshen.modelView.rightButton:SetNormalTexture("Interface/buttons/ui-rotationright-button-up.blp"); aaDesktop.aaBianshen.modelView.rightButton:SetHighlightTexture("Interface/buttons/ui-common-mousehilight.blp"); aaDesktop.aaBianshen.modelView.rightButton:SetPushedTexture("Interface/buttons/ui-rotationright-button-down.blp");  aaDesktop.aaBianshen.modelView.rightButton:SetScript( "OnMouseDown", function(self, button) PlaySound("igInventoryRotateCharacter") self:SetScript("OnUpdate", function(self, elapsed) if(aaDesktop.aaBianshen.modelView:IsShown()) then aaDesktop.aaBianshen.modelView:SetFacing(aaDesktop.aaBianshen.modelView:GetFacing() - 0.03); end; end ); end );  aaDesktop.aaBianshen.modelView.rightButton:SetScript("OnMouseUp", function(self, button) self:SetScript("OnUpdate", nil); end ); end; aaDesktop.aaBianshen.preButton = CreateFrame('Button', nil, aaDesktop.aaBianshen.bgView, 'UIPanelButtonTemplate') do aaDesktop.aaBianshen.preButton:SetPoint('TOPLEFT', aaDesktop.aaBianshen.bgView, 'TOPLEFT', 33, -447); aaDesktop.aaBianshen.preButton:SetSize(50, 30); aaDesktop.aaBianshen.preButton:SetText("<"); aaDesktop.aaBianshen.preButton:Disable(); aaDesktop.aaBianshen.preButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if aaDesktop.aaBianshen.selectLan ~= 101 then aaDesktop.aaBianshen.selectLan = aaDesktop.aaBianshen.selectLan - 1; end; for i=1,6 do local btn = aaDesktop.aaBianshen.btns[i]; btn.biankuangView:Hide(); end; aaDesktop.aaBianshen.preButton:Disable(); aaData:sendAddonMsg(3023, aaDesktop.aaBianshen.selectLan.."\t"..aaDesktop.aaBianshen.selectIndex, "GUILD"); end); end; aaDesktop.aaBianshen.sufButton = CreateFrame('Button', nil, aaDesktop.aaBianshen.bgView, 'UIPanelButtonTemplate') do aaDesktop.aaBianshen.sufButton:SetPoint('TOPLEFT', aaDesktop.aaBianshen.bgView, 'TOPLEFT', 100, -447); aaDesktop.aaBianshen.sufButton:SetSize(50, 30); aaDesktop.aaBianshen.sufButton:SetText(">"); aaDesktop.aaBianshen.sufButton:Disable(); aaDesktop.aaBianshen.sufButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); for i=1,6 do local btn = aaDesktop.aaBianshen.btns[i]; btn.biankuangView:Hide(); end; aaDesktop.aaBianshen.selectLan = aaDesktop.aaBianshen.selectLan + 1; aaDesktop.aaBianshen.sufButton:Disable(); aaData:sendAddonMsg(3023, aaDesktop.aaBianshen.selectLan.."\t"..aaDesktop.aaBianshen.selectIndex, "GUILD"); end); end; aaDesktop.aaBianshen.saveButton1 = CreateFrame('Button', nil, aaDesktop.aaBianshen.bgView, 'UIPanelButtonTemplate') do aaDesktop.aaBianshen.saveButton1:SetPoint('TOPLEFT', aaDesktop.aaBianshen.bgView, 'TOPLEFT', 280, -370); aaDesktop.aaBianshen.saveButton1:SetSize(100, 33); aaDesktop.aaBianshen.saveButton1:SetText("保存外观"); aaDesktop.aaBianshen.saveButton1:SetScript('OnClick', function() aaData:sendAddonMsg(3021, aaDesktop.aaBianshen.selectLan.."\t"..aaDesktop.aaBianshen.selectIndex, "GUILD"); end); end; function aaBianshenlickDone() aaData:sendAddonMsg(3020, aaDesktop.aaBianshen.selectLan.."\t"..aaDesktop.aaBianshen.selectIndex, "GUILD"); aaDesktop.aaBianshen:show(); for i=1,6 do local btn = aaDesktop.aaBianshen.btns[i]; btn.biankuangView:Hide(); if i == aaDesktop.aaBianshen.selectIndex then btn.biankuangView:Show(); end; end; local value = aaDesktop.aaBianshen.values[aaDesktop.aaBianshen.selectLan]; if value ~= nil then local vs = value[aaDesktop.aaBianshen.selectIndex]; if vs ~= nil and vs[5] ~= nil and vs[5] ~= "" then aaDesktop.aaBianshen.modelView:SetCreature(vs[5]); end; end; end; function aaBianshenOnClickCancel() aaDesktop.aaBianshen:show(); for i=1,6 do local btn = aaDesktop.aaBianshen.btns[i]; btn.biankuangView:Hide(); if i == aaDesktop.aaBianshen.selectIndex then btn.biankuangView:Show(); end; end; local value = aaDesktop.aaBianshen.values[aaDesktop.aaBianshen.selectLan]; if value ~= nil then local vs = value[aaDesktop.aaBianshen.selectIndex]; if vs ~= nil and vs[5] ~= nil and vs[5] ~= "" then aaDesktop.aaBianshen.modelView:SetCreature(vs[5]); end; end; end; function aaDesktop.aaBianshen:CreateCell(index,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaBianshen.bgView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetBackdrop ({bgFile = "Interface\\Tooltips\\UI-Tooltip-Background"}); menuView:SetBackdropColor(0,0,0,0); menuView:SetWidth(150); menuView:SetHeight(60); menuView:SetPoint("TOPLEFT",aaDesktop.aaBianshen.bgView,'TOPLEFT',x+5,y); menuView:Show(); end; menuView.iconView = CreateFrame('Button', nil, menuView, '') do menuView.iconView:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 5, -6); menuView.iconView:SetButtonState('NORMAL'); menuView.iconView:IsEnabled(); menuView.iconView:SetWidth(48); menuView.iconView:SetHeight(48); menuView.iconView:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); menuView.iconView:SetScript('OnClick', function() aaDesktop.aaBianshen.selectIndex = index; for i=1,6 do local btn = aaDesktop.aaBianshen.btns[i]; btn.biankuangView:Hide(); if i == index then btn.biankuangView:Show(); end; end; if aaDesktop.aaBianshen.baocun[aaDesktop.aaBianshen.selectIndex] == 1 then aaDesktop.aaBianshen.saveButton1:Enable(); else aaDesktop.aaBianshen.saveButton1:Disable(); end; aaDesktop.aaBianshen:show();   local value = aaDesktop.aaBianshen.values[aaDesktop.aaBianshen.selectLan]; if value ~= nil then local vs = value[aaDesktop.aaBianshen.selectIndex]; if vs ~= nil and vs[5] ~= nil and vs[5] ~= "" then aaDesktop.aaBianshen.modelView:SetCreature(vs[5]); end; end; end); end; menuView.biankuangView = CreateFrame("Frame",nil,aaDesktop.aaBianshen.bgView) do menuView.biankuangView:SetFrameStrata("TOOLTIP"); menuView.biankuangView:SetBackdrop( { bgFile = "Interface\\DialogFrame\\UI-DialogBox-Background", edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border", edgeSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); menuView.biankuangView:SetPoint("TOPLEFT",aaDesktop.aaBianshen.bgView,'TOPLEFT',x+5-2,y+2); menuView.biankuangView:SetBackdropColor(0, 0, 0, 0.1); menuView.biankuangView:SetWidth(150+4); menuView.biankuangView:SetHeight(60+4); menuView.biankuangView:SetPoint("CENTER",0,0); menuView.biankuangView:Hide(); end; menuView.nameText = menuView:CreateFontString("menuView.nameText", "OVERLAY", "GameFontNormal") do menuView.nameText:SetFont("", 12.5); menuView.nameText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 48+8,0); menuView.nameText:SetWidth(95); menuView.nameText:SetHeight(30); end;  menuView.DoneButton = CreateFrame('Button', nil, menuView, 'UIPanelButtonTemplate') do menuView.DoneButton:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 48+20, -30); menuView.DoneButton:SetSize(70, 25); menuView.DoneButton:SetText("激活"); menuView.DoneButton:SetScript('OnClick', function() aaDesktop.aaBianshen.selectIndex = index; if menuView.DoneButton:GetText() == "属性重置" then local txt = "\""..aaData.color_red.."属性重置会覆盖现有时装属性。".."\","; local func1 = "\"aaBianshenlickDone\","; local func2 = "\"aaBianshenOnClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaBianshen:hide(); else local txt = "\""..aaData.color_red.."激活后将永久获得时装属性。".."\","; local func1 = "\"aaBianshenlickDone\","; local func2 = "\"aaBianshenOnClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaBianshen:hide(); end; end); end; return menuView; end; aaDesktop.aaBianshen.btns[1] = aaDesktop.aaBianshen:CreateCell(1,12,-58 - 63 * 0); aaDesktop.aaBianshen.btns[2] = aaDesktop.aaBianshen:CreateCell(2,12,-58 - 63 * 1); aaDesktop.aaBianshen.btns[3] = aaDesktop.aaBianshen:CreateCell(3,12,-58 - 63 * 2); aaDesktop.aaBianshen.btns[4] = aaDesktop.aaBianshen:CreateCell(4,12,-58 - 63 * 3); aaDesktop.aaBianshen.btns[5] = aaDesktop.aaBianshen:CreateCell(5,12,-58 - 63 * 4); aaDesktop.aaBianshen.btns[6] = aaDesktop.aaBianshen:CreateCell(6,12,-58 - 63 * 5); aaDesktop.aaBianshen.bgView.btns = {}; for i=1,5 do aaDesktop.aaBianshen.bgView.btns[i] = CreateFrame('Button', nil, aaDesktop.aaBianshen.mainView, '') do local row,tmp2 = math.modf((i-1)/5); local col = math.floor((i-1)%5); aaDesktop.aaBianshen.bgView.btns[i]:SetPoint('TOPLEFT', aaDesktop.aaBianshen.mainView, 'TOPLEFT', 174+col*(48+20), -443-row*(46+19)); aaDesktop.aaBianshen.bgView.btns[i]:SetSize(48, 48); aaDesktop.aaBianshen.bgView.btns[i]:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); local icon = GetItemIcon(25); aaDesktop.aaBianshen.bgView.btns[i]:SetNormalTexture(icon); aaDesktop.aaBianshen.bgView.btns[i].IconText = aaDesktop.aaBianshen.bgView.btns[i]:CreateFontString("IconText", "OVERLAY", "GameFontNormal") do aaDesktop.aaBianshen.bgView.btns[i].IconText:SetPoint("TOPRIGHT", aaDesktop.aaBianshen.bgView.btns[i], "TOPRIGHT", -2, -26); aaDesktop.aaBianshen.bgView.btns[i].IconText:SetHeight(20); aaDesktop.aaBianshen.bgView.btns[i].IconText:SetFont("", 15); aaDesktop.aaBianshen.bgView.btns[i].IconText:SetText("999"); end; aaDesktop.aaBianshen.bgView.btns[i]:Show(); end; end; function aaDesktop.aaBianshen:show(values) if values == nil then values = aaDesktop.aaBianshen.values; else aaDesktop.aaBianshen.values = values; end; aaDesktop.aaBianshen.mainView:Show(); local value = values[aaDesktop.aaBianshen.selectLan]; if value ~= nil then for i=1,6 do local btn = aaDesktop.aaBianshen.btns[i]; btn:Hide(); local vs = value[i]; if vs ~= nil then if i == 1 then if vs[3] ~= nil and vs[3] + 0 > 6 then aaDesktop.aaBianshen.selectLan = vs[3]+0; end; local maxLan = vs[4]; if maxLan ~= nil and maxLan + 0 > 0 then if aaDesktop.aaBianshen.selectLan == 101 then aaDesktop.aaBianshen.preButton:Disable(); elseif maxLan > 1 then aaDesktop.aaBianshen.preButton:Enable(); end; if aaDesktop.aaBianshen.selectLan - 100 < maxLan then aaDesktop.aaBianshen.sufButton:Enable(); else aaDesktop.aaBianshen.sufButton:Disable(); end; end; end; local itemLink = vs[1]; if itemLink ~= nil then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; if itemId + 0 > 0 then local image = GetItemIcon(itemId); if image ~= nil and image ~= "" then btn:Show(); aaData:setTextureFetter(btn.iconView, image, true); btn.DoneButton:SetText("激活"); btn.iconView:SetScript('OnEnter', function() if itemLink then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(btn, "ANCHOR_NONE"); end; ItemRefTooltip:SetPoint("BOTTOMLEFT",btn,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end); aaDesktop.aaBianshen.baocun[i] = 0; if suffixId > 0 then aaData:setTextureFetter(btn.iconView, image, false); btn.DoneButton:SetText("属性重置"); aaDesktop.aaBianshen.baocun[i] = 1; end; btn.nameText:SetText(aaData.color_white..itemLink); end; end; end; end; end; for i=1,5 do aaDesktop.aaBianshen.bgView.btns[i]:Hide(); end; local vs = value[aaDesktop.aaBianshen.selectIndex]; if vs ~= nil and vs[2] ~= nil then local items = vs[2]; local index = 0; local fugai = aaData:toVectorString2(items); for i,v in pairs(fugai) do index = index + 1; local btn = aaDesktop.aaBianshen.bgView.btns[index]; btn:Show(); local icon = GetItemIcon(i); if icon ~= nil and icon ~= "" then btn:SetNormalTexture(icon); if v + 0 > 1 then btn.IconText:Show(); btn.IconText:SetText(aaData.color_white..v); else btn.IconText:Hide(); end; btn:SetScript('OnEnter', function() local itemLink = i; if itemLink then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(btn, "ANCHOR_NONE"); end; ItemRefTooltip:SetPoint("BOTTOMLEFT",btn,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end); end; end; end; if aaDesktop.aaBianshen.baocun[aaDesktop.aaBianshen.selectIndex] == 1 then aaDesktop.aaBianshen.saveButton1:Enable(); else aaDesktop.aaBianshen.saveButton1:Disable(); end; end; end; function aaDesktop.aaBianshen:hide() aaDesktop.aaBianshen.mainView:Hide(); end;       aaDesktop.aaShenqi.btns = {}; aaDesktop.aaShenqi_time = 0; aaDesktop.aaShenqi.values = {}; local aaShenqi_time = 0; aaDesktop.aaShenqi.selectLan = 201; aaDesktop.aaShenqi.selectIndex = 1; aaDesktop.aaShenqi.image = {"","","","","",""}; aaDesktop.aaShenqi.imagecount = {1,1,1,1,1,1}; aaDesktop.aaShenqi.mainView = CreateFrame("Frame","aaDesktop.aaShenqi.mainView",UIParent) do aaDesktop.aaShenqi.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaShenqi.mainView:SetWidth(512); aaDesktop.aaShenqi.mainView:SetHeight(512); aaDesktop.aaShenqi.mainView:SetPoint("CENTER"); aaDesktop.aaShenqi.mainView:SetToplevel(true); aaDesktop.aaShenqi.mainView:SetClampedToScreen(true); aaDesktop.aaShenqi.mainView:SetMovable(true); aaDesktop.aaShenqi.mainView:EnableMouse(true); aaDesktop.aaShenqi.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaShenqi.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaShenqi.mainView:Show(); tinsert(UISpecialFrames, "aaDesktop.aaShenqi.mainView"); end; aaDesktop.aaShenqi.bgView = CreateFrame("Frame",nil,aaDesktop.aaShenqi.mainView) do aaDesktop.aaShenqi.bgView:SetFrameStrata("TOOLTIP"); aaDesktop.aaShenqi.bgView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-shenqi-bg"}); aaDesktop.aaShenqi.bgView:SetWidth(512); aaDesktop.aaShenqi.bgView:SetHeight(512); aaDesktop.aaShenqi.bgView:SetPoint("TOPLEFT",0,0); aaDesktop.aaShenqi.bgView:Show(); end; aaDesktop.aaShenqi.titleText = aaDesktop.aaShenqi.bgView:CreateFontString("titleText", "OVERLAY", "GameFontNormal") do aaDesktop.aaShenqi.titleText:SetPoint("TOPLEFT", aaDesktop.aaShenqi.mainView, "TOPLEFT", 0, 0); aaDesktop.aaShenqi.titleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 24); aaDesktop.aaShenqi.titleText:SetWidth(512); aaDesktop.aaShenqi.titleText:SetHeight(55); aaDesktop.aaShenqi.titleText:SetText(aaData.color_yellows.."神器兑换"); aaDesktop.aaShenqi.titleText:SetSpacing(5); end; aaDesktop.aaShenqi.titleText1 = aaDesktop.aaShenqi.bgView:CreateFontString("titleText1", "OVERLAY", "GameFontNormal") do aaDesktop.aaShenqi.titleText1:SetPoint("TOPLEFT", aaDesktop.aaShenqi.mainView, "TOPLEFT", 300, -412); aaDesktop.aaShenqi.titleText1:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 20); aaDesktop.aaShenqi.titleText1:SetHeight(20); aaDesktop.aaShenqi.titleText1:SetText(aaData.color_yellows.."兑换需要"); aaDesktop.aaShenqi.titleText1:SetSpacing(5); end; aaDesktop.aaShenqi.CancelButton = CreateFrame('Button', nil, aaDesktop.aaShenqi.mainView, 'UIPanelCloseButton') do aaDesktop.aaShenqi.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaShenqi.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaShenqi.mainView, 'TOPRIGHT', 0, 0); aaDesktop.aaShenqi.CancelButton:SetSize(35, 35); aaDesktop.aaShenqi.CancelButton:SetScript('OnClick', function() aaDesktop.aaShenqi:hide(); end); end; aaDesktop.aaShenqi.modelView = CreateFrame("Frame",nil,aaDesktop.aaShenqi.bgView) do aaDesktop.aaShenqi.modelView:SetFrameStrata("TOOLTIP"); aaDesktop.aaShenqi.modelView:SetWidth(256); aaDesktop.aaShenqi.modelView:SetHeight(256); aaDesktop.aaShenqi.modelView:SetPoint("TOPLEFT",205,-110); aaDesktop.aaShenqi.modelView:Show(); end; aaDesktop.aaShenqi.preButton = CreateFrame('Button', nil, aaDesktop.aaShenqi.bgView, 'UIPanelButtonTemplate') do aaDesktop.aaShenqi.preButton:SetPoint('TOPLEFT', aaDesktop.aaShenqi.bgView, 'TOPLEFT', 33, -447); aaDesktop.aaShenqi.preButton:SetSize(50, 30); aaDesktop.aaShenqi.preButton:SetText("<"); aaDesktop.aaShenqi.preButton:Disable(); aaDesktop.aaShenqi.preButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if aaDesktop.aaShenqi.selectLan ~= 201 then aaDesktop.aaShenqi.selectLan = aaDesktop.aaShenqi.selectLan - 1; end; for i=1,6 do local btn = aaDesktop.aaShenqi.btns[i]; btn.biankuangView:Hide(); end; aaDesktop.aaShenqi.preButton:Disable(); aaData:sendAddonMsg(3031, aaDesktop.aaShenqi.selectLan.."\t"..aaDesktop.aaShenqi.selectIndex, "GUILD"); end); end; aaDesktop.aaShenqi.sufButton = CreateFrame('Button', nil, aaDesktop.aaShenqi.bgView, 'UIPanelButtonTemplate') do aaDesktop.aaShenqi.sufButton:SetPoint('TOPLEFT', aaDesktop.aaShenqi.bgView, 'TOPLEFT', 100, -447); aaDesktop.aaShenqi.sufButton:SetSize(50, 30); aaDesktop.aaShenqi.sufButton:SetText(">"); aaDesktop.aaShenqi.sufButton:Disable(); aaDesktop.aaShenqi.sufButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); for i=1,6 do local btn = aaDesktop.aaShenqi.btns[i]; btn.biankuangView:Hide(); end; aaDesktop.aaShenqi.selectLan = aaDesktop.aaShenqi.selectLan + 1; aaDesktop.aaShenqi.sufButton:Disable(); aaData:sendAddonMsg(3031, aaDesktop.aaShenqi.selectLan.."\t"..aaDesktop.aaShenqi.selectIndex, "GUILD"); end); end; local aaShenqiIndex = 1; local function aaShenqiFrameUpdateTime(btn, elapsed) if aaDesktop.aaShenqi.mainView:IsShown() then local time2 = GetTime()-aaDesktop.aaShenqi_time; if time2 >= 0.12 then aaDesktop.aaShenqi_time = GetTime(); local count = aaDesktop.aaShenqi.imagecount[aaDesktop.aaShenqi.selectIndex]; if aaShenqiIndex > count then aaShenqiIndex = 1; end; local v = aaDesktop.aaShenqi.image[aaDesktop.aaShenqi.selectIndex]; local image = v..aaShenqiIndex; aaDesktop.aaShenqi.modelView:SetBackdrop({bgFile="Interface\\AddOns\\aaAddon\\shenqi\\"..image}); aaShenqiIndex = aaShenqiIndex + 1; end; end; end; function aaShenqilickDone() aaData:sendAddonMsg(3030, aaDesktop.aaShenqi.selectLan.."\t"..aaDesktop.aaShenqi.selectIndex, "GUILD"); aaDesktop.aaShenqi:show(); for i=1,6 do local btn = aaDesktop.aaShenqi.btns[i]; btn.biankuangView:Hide(); if i == aaDesktop.aaShenqi.selectIndex then btn.biankuangView:Show(); end; end; end; function aaShenqiOnClickCancel() aaDesktop.aaShenqi:show(); for i=1,6 do local btn = aaDesktop.aaShenqi.btns[i]; btn.biankuangView:Hide(); if i == aaDesktop.aaShenqi.selectIndex then btn.biankuangView:Show(); end; end; end; function aaDesktop.aaShenqi:CreateCell(index,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaShenqi.bgView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetBackdrop ({bgFile = "Interface\\Tooltips\\UI-Tooltip-Background"}); menuView:SetBackdropColor(0,0,0,0); menuView:SetWidth(150); menuView:SetHeight(60); menuView:SetPoint("TOPLEFT",aaDesktop.aaShenqi.bgView,'TOPLEFT',x+5,y); menuView:Show(); end; menuView.iconView = CreateFrame('Button', nil, menuView, '') do menuView.iconView:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 5, -6); menuView.iconView:SetButtonState('NORMAL'); menuView.iconView:IsEnabled(); menuView.iconView:SetWidth(48); menuView.iconView:SetHeight(48); menuView.iconView:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); menuView.iconView:SetScript('OnClick', function() aaDesktop.aaShenqi.selectIndex = index; for i=1,6 do local btn = aaDesktop.aaShenqi.btns[i]; btn.biankuangView:Hide(); if i == index then btn.biankuangView:Show(); end; end; aaDesktop.aaShenqi:show(); end); end; menuView.biankuangView = CreateFrame("Frame",nil,aaDesktop.aaShenqi.bgView) do menuView.biankuangView:SetFrameStrata("TOOLTIP"); menuView.biankuangView:SetBackdrop( { bgFile = "Interface\\DialogFrame\\UI-DialogBox-Background", edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border", edgeSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); menuView.biankuangView:SetPoint("TOPLEFT",aaDesktop.aaShenqi.bgView,'TOPLEFT',x+5-2,y+2); menuView.biankuangView:SetBackdropColor(0, 0, 0, 0.1); menuView.biankuangView:SetWidth(150+4); menuView.biankuangView:SetHeight(60+4); menuView.biankuangView:SetPoint("CENTER",0,0); menuView.biankuangView:Hide(); end; menuView.nameText = menuView:CreateFontString("menuView.nameText", "OVERLAY", "GameFontNormal") do menuView.nameText:SetFont("", 12.5); menuView.nameText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 48+8,0); menuView.nameText:SetWidth(95); menuView.nameText:SetHeight(30); end;  menuView.DoneButton = CreateFrame('Button', nil, menuView, 'UIPanelButtonTemplate') do menuView.DoneButton:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 48+20, -30); menuView.DoneButton:SetSize(70, 25); menuView.DoneButton:SetText("激活"); menuView.DoneButton:SetScript('OnClick', function() aaDesktop.aaShenqi.selectIndex = index; if menuView.DoneButton:GetText() == "升级" then local txt = "\""..aaData.color_red.."升级会加强当前属性。".."\","; local func1 = "\"aaShenqilickDone\","; local func2 = "\"aaShenqiOnClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaShenqi:hide(); elseif menuView.DoneButton:GetText() == "激活" then local txt = "\""..aaData.color_red.."激活后将永久获得神器属性。".."\","; local func1 = "\"aaShenqilickDone\","; local func2 = "\"aaShenqiOnClickCancel\""; local msg = "{-1,0,\"请问是否继续？\","..txt..func1..func2.."}"; aaDesktop.aaDialog:show(msg); aaDesktop.aaShenqi:hide(); end; end); end; return menuView; end; aaDesktop.aaShenqi.btns[1] = aaDesktop.aaShenqi:CreateCell(1,12,-58 - 63 * 0); aaDesktop.aaShenqi.btns[2] = aaDesktop.aaShenqi:CreateCell(2,12,-58 - 63 * 1); aaDesktop.aaShenqi.btns[3] = aaDesktop.aaShenqi:CreateCell(3,12,-58 - 63 * 2); aaDesktop.aaShenqi.btns[4] = aaDesktop.aaShenqi:CreateCell(4,12,-58 - 63 * 3); aaDesktop.aaShenqi.btns[5] = aaDesktop.aaShenqi:CreateCell(5,12,-58 - 63 * 4); aaDesktop.aaShenqi.btns[6] = aaDesktop.aaShenqi:CreateCell(6,12,-58 - 63 * 5); aaDesktop.aaShenqi.bgView.btns = {}; for i=1,5 do aaDesktop.aaShenqi.bgView.btns[i] = CreateFrame('Button', nil, aaDesktop.aaShenqi.mainView, '') do local row,tmp2 = math.modf((i-1)/5); local col = math.floor((i-1)%5); aaDesktop.aaShenqi.bgView.btns[i]:SetPoint('TOPLEFT', aaDesktop.aaShenqi.mainView, 'TOPLEFT', 174+col*(48+20), -443-row*(46+19)); aaDesktop.aaShenqi.bgView.btns[i]:SetSize(48, 48); aaDesktop.aaShenqi.bgView.btns[i]:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); local icon = GetItemIcon(25); aaDesktop.aaShenqi.bgView.btns[i]:SetNormalTexture(icon); aaDesktop.aaShenqi.bgView.btns[i].IconText = aaDesktop.aaShenqi.bgView.btns[i]:CreateFontString("IconText", "OVERLAY", "GameFontNormal") do aaDesktop.aaShenqi.bgView.btns[i].IconText:SetPoint("TOPRIGHT", aaDesktop.aaShenqi.bgView.btns[i], "TOPRIGHT", -2, -26); aaDesktop.aaShenqi.bgView.btns[i].IconText:SetHeight(20); aaDesktop.aaShenqi.bgView.btns[i].IconText:SetFont("", 15); aaDesktop.aaShenqi.bgView.btns[i].IconText:SetText("999"); end; aaDesktop.aaShenqi.bgView.btns[i]:Show(); end; end; function aaDesktop.aaShenqi:show(values) if values == nil then values = aaDesktop.aaShenqi.values; else aaDesktop.aaShenqi.values = values; end; aaDesktop.aaShenqi.mainView:Show(); local value = values[aaDesktop.aaShenqi.selectLan]; if value ~= nil then for i=1,6 do local btn = aaDesktop.aaShenqi.btns[i]; btn:Hide(); local vs = value[i]; if vs ~= nil then aaDesktop.aaShenqi.image[i] = vs[5]; aaDesktop.aaShenqi.imagecount[i] = vs[6]; if i == 1 then if vs[3] ~= nil and vs[3] + 0 > 6 then aaDesktop.aaShenqi.selectLan = vs[3]+0; end; local maxLan = vs[4]; if maxLan ~= nil and maxLan + 0 > 0 then if aaDesktop.aaShenqi.selectLan == 201 then aaDesktop.aaShenqi.preButton:Disable(); elseif maxLan > 1 then aaDesktop.aaShenqi.preButton:Enable(); end; if aaDesktop.aaShenqi.selectLan - 200 < maxLan then aaDesktop.aaShenqi.sufButton:Enable(); else aaDesktop.aaShenqi.sufButton:Disable(); end; end; end; local itemLink = vs[1]; if itemLink ~= nil then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; if itemId + 0 > 0 then local image = GetItemIcon(itemId); if image ~= nil and image ~= "" then btn:Show(); aaData:setTextureFetter(btn.iconView, image, true); btn.DoneButton:SetText("激活"); btn.iconView:SetScript('OnEnter', function() if itemLink then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(btn, "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",btn,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end); local next = vs[9]; if next == 1 then aaData:setTextureFetter(btn.iconView, image, false); btn.DoneButton:SetText("升级"); btn.DoneButton:Enable(); elseif next == 2 then aaData:setTextureFetter(btn.iconView, image, false); btn.DoneButton:SetText("已完成"); btn.DoneButton:Disable(); elseif next == 0 then aaData:setTextureFetter(btn.iconView, image, true); btn.DoneButton:SetText("激活"); btn.DoneButton:Enable(); end; btn.nameText:SetText(aaData.color_white..itemLink); end; end; end; end; end; for i=1,5 do aaDesktop.aaShenqi.bgView.btns[i]:Hide(); end; local vs = value[aaDesktop.aaShenqi.selectIndex]; if vs ~= nil then local items = vs[2]; if items ~= nil and items ~= "" then local index = 0; local fugai = aaData:toVectorString2(items); for i,v in pairs(fugai) do index = index + 1; local btn = aaDesktop.aaShenqi.bgView.btns[index]; btn:Show(); local icon = GetItemIcon(i); if icon ~= nil and icon ~= "" then btn:SetNormalTexture(icon); if v + 0 > 1 then btn.IconText:Show(); btn.IconText:SetText(aaData.color_white..v); else btn.IconText:Hide(); end; btn:SetScript('OnEnter', function() local itemLink = i; if itemLink then ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(btn, "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",btn,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end; end); end; end; end; local x = vs[7]; local y = vs[8]; aaDesktop.aaShenqi.modelView:SetPoint("TOPLEFT",205 + x,-110 + y); end; end; end; function aaDesktop.aaShenqi:hide() aaDesktop.aaShenqi.mainView:Hide(); end;  aaDesktop.aaJuanxian.Value3041 = {}; aaDesktop.aaJuanxian.Value3042 = {}; aaDesktop.aaJuanxian.Value3043 = {}; aaDesktop.aaJuanxian.danwei = ""; aaDesktop.aaJuanxian.zuishao = 0; aaDesktop.aaJuanxian.CancelButton = {}; function aaDesktop.aaJuanxian:ClickDoneBtn() aaData:sendAddonMsg(10004, "0", "GUILD"); end; aaDesktop.aaJuanxian.mainView = CreateFrame("Frame","aaDesktop.aaJuanxian.mainView",UIParent) do aaDesktop.aaJuanxian.mainView:SetFrameStrata("TOOLTIP"); aaDesktop.aaJuanxian.mainView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-juanxian-bg"}); aaDesktop.aaJuanxian.mainView:SetWidth(512); aaDesktop.aaJuanxian.mainView:SetHeight(512); aaDesktop.aaJuanxian.mainView:SetPoint("CENTER"); aaDesktop.aaJuanxian.mainView:SetToplevel(true); aaDesktop.aaJuanxian.mainView:SetClampedToScreen(true); aaDesktop.aaJuanxian.mainView:SetMovable(true); aaDesktop.aaJuanxian.mainView:EnableMouse(true); aaDesktop.aaJuanxian.mainView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaJuanxian.mainView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaJuanxian.mainView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaJuanxian.mainView"); end; local titlewidth = 360;local titletop = -40; aaDesktop.aaJuanxian.title1 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title1", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title1:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaJuanxian.title1:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 18,titletop); aaDesktop.aaJuanxian.title1:SetWidth(358); aaDesktop.aaJuanxian.title1:SetHeight(50); end; aaDesktop.aaJuanxian.title2 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title2", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title2:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaJuanxian.title2:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 18 + 360,titletop); aaDesktop.aaJuanxian.title2:SetWidth(118); aaDesktop.aaJuanxian.title2:SetHeight(50); end; local jxx1 = 80; local jxx2 = 123; local jxx3 = 121; local jxx4 = 480 - jxx1 - jxx2 - jxx3; aaDesktop.aaJuanxian.title11 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title11", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title11:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJuanxian.title11:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 16,titletop - 50 - 5); aaDesktop.aaJuanxian.title11:SetWidth(jxx1); aaDesktop.aaJuanxian.title11:SetHeight(20); aaDesktop.aaJuanxian.title11:SetText(aaData.color_yellows.."排名"); end; aaDesktop.aaJuanxian.title12 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title12", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title12:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJuanxian.title12:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 16 + jxx1,titletop - 50 - 5); aaDesktop.aaJuanxian.title12:SetWidth(jxx2); aaDesktop.aaJuanxian.title12:SetHeight(20); aaDesktop.aaJuanxian.title12:SetText(aaData.color_yellows.."玩家信息"); end; aaDesktop.aaJuanxian.title13 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title13", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title13:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJuanxian.title13:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 16 + jxx1 + jxx2,titletop - 50 - 5); aaDesktop.aaJuanxian.title13:SetWidth(jxx3); aaDesktop.aaJuanxian.title13:SetHeight(20); aaDesktop.aaJuanxian.title13:SetText(aaData.color_yellows.."捐献数量"); end; aaDesktop.aaJuanxian.title14 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title14", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title14:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJuanxian.title14:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 16 + jxx1 + jxx2 + jxx3,titletop - 50 - 5); aaDesktop.aaJuanxian.title14:SetWidth(jxx4); aaDesktop.aaJuanxian.title14:SetHeight(20); aaDesktop.aaJuanxian.title14:SetText(aaData.color_yellows.."专属称号"); end; function aaDesktop.aaJuanxian:CreateCell(id,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaJuanxian.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetBackdrop ({bgFile = "Interface\\Tooltips\\UI-Tooltip-Background"}); menuView:SetBackdropColor(0,0,0,0.5); menuView:SetWidth(480); menuView:SetHeight(44); menuView:SetPoint("TOPLEFT",aaDesktop.aaJuanxian.mainView,'TOPLEFT',x,y); menuView:Show(); end; menuView.paimingText = menuView:CreateFontString("menuView.paimingText", "OVERLAY", "GameFontNormal") do menuView.paimingText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.paimingText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 0,0); menuView.paimingText:SetWidth(jxx1); menuView.paimingText:SetHeight(44); end; menuView.wanjiaText = menuView:CreateFontString("menuView.wanjiaText", "OVERLAY", "GameFontNormal") do menuView.wanjiaText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.wanjiaText:SetPoint("TOPLEFT", menuView, "TOPLEFT", jxx1, 0); menuView.wanjiaText:SetHeight(44); menuView.wanjiaText:SetWidth(jxx2); end; menuView.jxText = menuView:CreateFontString("menuView.jxText", "OVERLAY", "GameFontNormal") do menuView.jxText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.jxText:SetPoint("TOPLEFT", menuView, "TOPLEFT", jxx1 + jxx2, 0); menuView.jxText:SetHeight(44); menuView.jxText:SetWidth(jxx3); end; menuView.btn = CreateFrame('Button', nil, menuView, '') do menuView.btn:SetPoint('TOPLEFT', menuView, 'TOPLEFT', jxx1 + jxx2 + jxx3 + ((480 - jxx1 - jxx2 - jxx3) * 0.5 - 22), -2); menuView.btn:SetSize(40, 40); menuView.btn:SetText(""); menuView.btn:SetScript('OnLeave', function() ItemRefTooltip:Hide(); end); end; return menuView; end; aaDesktop.aaJuanxian.paimingBtns = {}; aaDesktop.aaJuanxian.shuliangTitles = {}; aaDesktop.aaJuanxian.paimingBtns[1] = aaDesktop.aaJuanxian:CreateCell(1,16,titletop - 28 - 5 - 50); aaDesktop.aaJuanxian.paimingBtns[2] = aaDesktop.aaJuanxian:CreateCell(2,16,titletop - 28 - 5 - 50 - 44 * 1 - 2); aaDesktop.aaJuanxian.paimingBtns[3] = aaDesktop.aaJuanxian:CreateCell(3,16,titletop - 28 - 5 - 50 - 44 * 2 - 4); aaDesktop.aaJuanxian.paimingBtns[4] = aaDesktop.aaJuanxian:CreateCell(4,16,titletop - 28 - 5 - 50 - 44 * 3 - 6); aaDesktop.aaJuanxian.paimingBtns[5] = aaDesktop.aaJuanxian:CreateCell(5,16,titletop - 28 - 5 - 50 - 44 * 4 - 8); aaDesktop.aaJuanxian.title20 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title20", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title20:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaJuanxian.title20:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 18,titletop - 28 - 5 - 50 - 44 * 5 - 18 * 0 - 10); aaDesktop.aaJuanxian.title20:SetHeight(18); aaDesktop.aaJuanxian.title20:SetText(aaData.color_yellows.."捐献说明："); end; aaDesktop.aaJuanxian.title21 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title21", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title21:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaJuanxian.title21:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 18,titletop - 28 - 5 - 50 - 44 * 5 - 18 * 1 - 10); aaDesktop.aaJuanxian.title21:SetHeight(18); end; aaDesktop.aaJuanxian.title22 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title22", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title22:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaJuanxian.title22:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 18,titletop - 28 - 5 - 50 - 44 * 5 - 18 * 2 - 10); aaDesktop.aaJuanxian.title22:SetHeight(18); end; aaDesktop.aaJuanxian.title23 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title23", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title23:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaJuanxian.title23:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 18,titletop - 28 - 5 - 50 - 44 * 5 - 18 * 3 - 10); aaDesktop.aaJuanxian.title23:SetHeight(18); end; aaDesktop.aaJuanxian.title24 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title24", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title24:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaJuanxian.title24:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 18,titletop - 28 - 5 - 50 - 44 * 5 - 18 * 4 - 10); aaDesktop.aaJuanxian.title24:SetHeight(18); end; aaDesktop.aaJuanxian.title25 = aaDesktop.aaJuanxian.mainView:CreateFontString("aaDesktop.aaJuanxian.title25", "OVERLAY", "GameFontNormal") do aaDesktop.aaJuanxian.title25:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaJuanxian.title25:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 18,titletop - 28 - 5 - 50 - 44 * 5 - 18 * 5 - 10); aaDesktop.aaJuanxian.title25:SetHeight(18); end; aaDesktop.aaJuanxian.shuliangTitles[1] = aaDesktop.aaJuanxian.title21; aaDesktop.aaJuanxian.shuliangTitles[2] = aaDesktop.aaJuanxian.title22; aaDesktop.aaJuanxian.shuliangTitles[3] = aaDesktop.aaJuanxian.title23; aaDesktop.aaJuanxian.shuliangTitles[4] = aaDesktop.aaJuanxian.title24; aaDesktop.aaJuanxian.shuliangTitles[5] = aaDesktop.aaJuanxian.title25; aaDesktop.aaJuanxian.nameEditBox = CreateFrame('EditBox', "aaDesktop.aaJuanxian.nameEditBox", aaDesktop.aaJuanxian.mainView, 'InputBoxTemplate') do aaDesktop.aaJuanxian.nameEditBox:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 15); aaDesktop.aaJuanxian.nameEditBox:SetWidth(300); aaDesktop.aaJuanxian.nameEditBox:SetHeight(30); aaDesktop.aaJuanxian.nameEditBox:SetMaxLetters(36); aaDesktop.aaJuanxian.nameEditBox:SetPoint("TOPLEFT", aaDesktop.aaJuanxian.mainView, "TOPLEFT", 18, titletop - 28 - 5 - 50 - 44 * 5 - 18 * 6 - 15); aaDesktop.aaJuanxian.nameEditBox:SetText("输入捐献数量。"); end; aaDesktop.aaJuanxian.btn = CreateFrame('Button', nil, aaDesktop.aaJuanxian.mainView, 'UIPanelButtonTemplate') do aaDesktop.aaJuanxian.btn:SetPoint('TOPLEFT', aaDesktop.aaJuanxian.mainView, 'TOPLEFT', 18 + 300 + 20, titletop - 28 - 5 - 50 - 44 * 5 - 18 * 6 - 10); aaDesktop.aaJuanxian.btn:SetSize(100, 40); aaDesktop.aaJuanxian.btn:SetText("确认捐献"); aaDesktop.aaJuanxian.btn:SetScript('OnClick', function() local dj = aaDesktop.aaJuanxian.nameEditBox:GetText(); aaData:sendAddonMsg(3041, dj, "GUILD"); end); end; function aaDesktop.aaJuanxian:reload3041(rtable) local geren = 0; if rtable[1] ~= nil then aaDesktop.aaJuanxian.danwei = rtable[1]; end; if rtable[2] ~= nil then geren = rtable[2]; end; if rtable[3] ~= nil then aaDesktop.aaJuanxian.zuishao = rtable[3]; end; aaDesktop.aaJuanxian.title1:SetText(aaData.color_white.."第一次捐献最少"..aaDesktop.aaJuanxian.zuishao..aaDesktop.aaJuanxian.danwei.."，后续可捐献任意额度。捐献"..aaDesktop.aaJuanxian.zuishao..aaDesktop.aaJuanxian.danwei.."才能参与排名获取专属称号。"); aaDesktop.aaJuanxian.title2:SetText(aaData.color_yellows.."当前捐献：\n"..geren..aaDesktop.aaJuanxian.danwei); aaDesktop.aaJuanxian.title20:SetText(aaData.color_yellows.."捐献说明：捐献对应的"..aaDesktop.aaJuanxian.danwei.."，可获得以下永久属性加成，属性可叠加！"); end; function aaDesktop.aaJuanxian:reload3042(rtable) for i=1,#aaDesktop.aaJuanxian.paimingBtns do local btn = aaDesktop.aaJuanxian.paimingBtns[i]; if btn ~= nil then local vs = rtable[i]; if rtable[i] ~= nil then local vs = rtable[i]; if vs ~= nil then local name = vs[1]; local jx = vs[2]; local itemLink = vs[3]; btn.paimingText:SetText(aaData.color_white..i..""); btn.wanjiaText:SetText(aaData.color_white..name); if jx == 0 then btn.jxText:SetText(""); else btn.jxText:SetText(aaData.color_white..jx..""); end; if itemLink ~= nil then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local icon = ""; if itemId + 0 > 0 then icon = GetItemIcon(itemId); end;  btn.btn:SetNormalTexture(icon); btn.btn:SetDisabledTexture(icon); btn.btn:SetHighlightTexture(icon); btn.btn:SetPushedTexture(icon); btn.btn:SetScript('OnEnter', function() ShowUIPanel(ItemRefTooltip); ItemRefTooltip:SetToplevel(true); if (not ItemRefTooltip:IsVisible()) then ItemRefTooltip:SetOwner(btn.btn, "ANCHOR_NONE"); end ItemRefTooltip:SetPoint("BOTTOMLEFT",btn.btn,"TOPRIGHT"); ItemRefTooltip:ClearLines(); ItemRefTooltip:SetHyperlink(itemLink); ItemRefTooltip:SetToplevel(true); ItemRefTooltip:Show(); end); end; end; end; end; end; end; function aaDesktop.aaJuanxian:reload3043(rtable) local paixu = {}; for k,v in pairs(rtable) do table.insert(paixu,k); end; table.sort(paixu,function(a,b)return (tonumber(a)<tonumber(b)) end); for i=1,#paixu do local title = aaDesktop.aaJuanxian.shuliangTitles[i]; local shuliang = paixu[i]; if rtable[shuliang] ~= nil then local v = rtable[shuliang]; if v ~= nil then local vs = v; local isOk = vs[1]; local detail = vs[2]; local jihuo0 = aaData.color_red.."[未激活]"; local jihuo1 = aaData.color_green.."[已激活]"; local dj = aaData.color_yellows.." "..shuliang..aaDesktop.aaJuanxian.danwei.."永久激活："..detail; if isOk == 0 then title:SetText(jihuo0..dj); else title:SetText(jihuo1..dj); end; end; end; end; end; aaDesktop.aaJuanxian.CancelButton = CreateFrame('Button', nil, aaDesktop.aaJuanxian.mainView, 'UIPanelCloseButton') do aaDesktop.aaJuanxian.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaJuanxian.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaJuanxian.mainView, 'TOPRIGHT', 0, 0); aaDesktop.aaJuanxian.CancelButton:SetSize(44, 44); aaDesktop.aaJuanxian.CancelButton:SetScript('OnClick', function() aaDesktop.aaJuanxian:hide(); end); end; function aaDesktop.aaJuanxian:show() aaDesktop.aaJuanxian.mainView:Show(); aaData:sendAddonMsg(3040, "1", "GUILD"); end; function aaDesktop.aaJuanxian:hide() aaDesktop.aaJuanxian.mainView:Hide(); end;  aaDesktop.aaJLLeichong = {}; aaDesktop.aaJLLeichong.LevelViews = {}; aaDesktop.aaJLLeichong.levels = {}; local titletop = -100;local titleleft = 50; function aaDesktop.aaJLLeichong:ClickDoneBtn(index,btn) local level = aaDesktop.aaJLLeichong.levels[index]; aaData:sendAddonMsg(10005, level, "GUILD"); end; aaDesktop.aaJLLeichong.backView = CreateFrame("Frame","aaDesktop.aaJLLeichong.backView",UIParent) do aaDesktop.aaJLLeichong.backView:SetFrameStrata("TOOLTIP"); aaDesktop.aaJLLeichong.backView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-lcjl"}); aaDesktop.aaJLLeichong.backView:SetWidth(512); aaDesktop.aaJLLeichong.backView:SetHeight(512); aaDesktop.aaJLLeichong.backView:SetPoint("CENTER"); aaDesktop.aaJLLeichong.backView:EnableMouseWheel(true); aaDesktop.aaJLLeichong.backView:SetToplevel(true); aaDesktop.aaJLLeichong.backView:SetClampedToScreen(true); aaDesktop.aaJLLeichong.backView:SetMovable(true); aaDesktop.aaJLLeichong.backView:EnableMouse(true); aaDesktop.aaJLLeichong.backView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaJLLeichong.backView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaJLLeichong.backView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaJLLeichong.backView"); end; aaDesktop.aaJLLeichong.ScrollView = CreateFrame("ScrollFrame", "aaDesktop.aaJLLeichong.ScrollView", aaDesktop.aaJLLeichong.backView) do aaDesktop.aaJLLeichong.ScrollView:EnableMouseWheel(true); aaDesktop.aaJLLeichong.ScrollView:EnableMouse(true); aaDesktop.aaJLLeichong.ScrollView:SetMovable(true); aaDesktop.aaJLLeichong.ScrollView:SetSize(512-50,352); aaDesktop.aaJLLeichong.ScrollView:RegisterForDrag('LeftButton'); aaDesktop.aaJLLeichong.ScrollView:SetPoint('TOPLEFT', 0, -110); InterfaceOptions_AddCategory(aaDesktop.aaJLLeichong.ScrollView); end; aaDesktop.aaJLLeichong.mainView = CreateFrame("Frame","aaDesktop.aaJLLeichong.mainView",aaDesktop.aaJLLeichong.ScrollView) do aaDesktop.aaJLLeichong.ScrollView:SetScrollChild(aaDesktop.aaJLLeichong.mainView); aaDesktop.aaJLLeichong.mainView:EnableMouse(true); aaDesktop.aaJLLeichong.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaJLLeichong.mainView:SetWidth(512-50); aaDesktop.aaJLLeichong.mainView:SetHeight(352); aaDesktop.aaJLLeichong.mainView:SetPoint("TOPLEFT",0,0); aaDesktop.aaJLLeichong.mainView:Show(); end; aaDesktop.aaJLLeichong.slider = CreateFrame("Slider", "aaDesktop.aaJLLeichong.slider", aaDesktop.aaJLLeichong.backView, "OptionsSliderTemplate") do aaDesktop.aaJLLeichong.slider:SetWidth(30); aaDesktop.aaJLLeichong.slider:SetPoint('TOPLEFT', aaDesktop.aaJLLeichong.backView, 'TOPLEFT', 512 - 50, -110); aaDesktop.aaJLLeichong.slider:SetHeight(352); aaDesktop.aaJLLeichong.slider:SetOrientation('VERTICAL'); aaDesktop.aaJLLeichong.slider:SetOrientation('HORIZONTAL'); aaDesktop.aaJLLeichong.slider.tooltipText = ""; getglobal(aaDesktop.aaJLLeichong.slider:GetName() .. 'Low'):Hide(); getglobal(aaDesktop.aaJLLeichong.slider:GetName() .. 'High'):Hide(); getglobal(aaDesktop.aaJLLeichong.slider:GetName() .. 'Text'):Hide(); aaDesktop.aaJLLeichong.slider:SetThumbTexture("Interface\\AddOns\\aaAddon\\Icons\\aa_dropIco"); aaDesktop.aaJLLeichong.slider:SetMovable(true); aaDesktop.aaJLLeichong.slider:EnableMouseWheel(true); aaDesktop.aaJLLeichong.slider:RegisterForDrag('LeftButton'); aaDesktop.aaJLLeichong.slider:SetOrientation("VERTICAL"); aaDesktop.aaJLLeichong.slider:SetValueStep(9); aaDesktop.aaJLLeichong.slider:SetMinMaxValues(0, 352); aaDesktop.aaJLLeichong.slider:SetValue(0); aaDesktop.aaJLLeichong.slider:SetScript("OnValueChanged", function(self, value) aaDesktop.aaJLLeichong.ScrollView:SetVerticalScroll(value); end); end; aaDesktop.aaJLLeichong.backView:SetScript("OnMouseWheel", function(self, delta) local Value = aaDesktop.aaJLLeichong.slider:GetValue(); if (delta < 0) then aaDesktop.aaJLLeichong.slider:SetValue(Value + 27); else aaDesktop.aaJLLeichong.slider:SetValue(Value - 27); end; end); local titlewidth1 = 80;local titlewidth2 = 262;local titlewidth3 = 80;local titletop = -52;local titletop1 = titletop-30; aaDesktop.aaJLLeichong.title = aaDesktop.aaJLLeichong.backView:CreateFontString("aaDesktop.aaJLLeichong.title", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLLeichong.title:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLLeichong.title:SetPoint("TOPLEFT", aaDesktop.aaJLLeichong.backView, "TOPLEFT", 45,titletop); aaDesktop.aaJLLeichong.title:SetWidth(titlewidth1+titlewidth2+titlewidth3); aaDesktop.aaJLLeichong.title:SetHeight(20); aaDesktop.aaJLLeichong.title:SetSpacing(5); aaDesktop.aaJLLeichong.title:SetText(aaData.color_green..""); end; aaDesktop.aaJLLeichong.leveltitle = aaDesktop.aaJLLeichong.backView:CreateFontString("aaDesktop.aaJLLeichong.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLLeichong.leveltitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLLeichong.leveltitle:SetPoint("TOPLEFT", aaDesktop.aaJLLeichong.backView, "TOPLEFT", 45,titletop1); aaDesktop.aaJLLeichong.leveltitle:SetWidth(titlewidth1); aaDesktop.aaJLLeichong.leveltitle:SetHeight(20); aaDesktop.aaJLLeichong.leveltitle:SetSpacing(5); aaDesktop.aaJLLeichong.leveltitle:SetText(aaData.color_green.."累计充值"); end; aaDesktop.aaJLLeichong.jltitle = aaDesktop.aaJLLeichong.backView:CreateFontString("aaDesktop.aaJLLeichong.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLLeichong.jltitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLLeichong.jltitle:SetPoint("TOPLEFT", aaDesktop.aaJLLeichong.backView, "TOPLEFT", 45+titlewidth1,titletop1); aaDesktop.aaJLLeichong.jltitle:SetWidth(titlewidth2); aaDesktop.aaJLLeichong.jltitle:SetHeight(20); aaDesktop.aaJLLeichong.jltitle:SetSpacing(5); aaDesktop.aaJLLeichong.jltitle:SetText(aaData.color_green.."奖励"); end; aaDesktop.aaJLLeichong.zttitle = aaDesktop.aaJLLeichong.backView:CreateFontString("aaDesktop.aaJLLeichong.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLLeichong.zttitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLLeichong.zttitle:SetPoint("TOPLEFT", aaDesktop.aaJLLeichong.backView, "TOPLEFT", 45+titlewidth1+titlewidth2,titletop1); aaDesktop.aaJLLeichong.zttitle:SetWidth(titlewidth3); aaDesktop.aaJLLeichong.zttitle:SetHeight(20); aaDesktop.aaJLLeichong.zttitle:SetSpacing(5); aaDesktop.aaJLLeichong.zttitle:SetText(aaData.color_green.."状态"); end; function aaDesktop.aaJLLeichong:CreateCell(index,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaJLLeichong.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(titlewidth1+titlewidth2+titlewidth3); menuView:SetHeight(30); menuView:SetPoint("TOPLEFT",aaDesktop.aaJLLeichong.mainView,'TOPLEFT',x,y); menuView:Hide(); end; menuView.levelText = menuView:CreateFontString("menuView.levelText", "OVERLAY", "GameFontNormal") do menuView.levelText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); menuView.levelText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 0,0); menuView.levelText:SetWidth(titlewidth1); menuView.levelText:SetHeight(30); menuView.levelText:SetSpacing(5); menuView.levelText:SetText(aaData.color_blue.."Lv888"); end; menuView.itemText = menuView:CreateFontString("menuView.itemText", "OVERLAY", "GameFontNormal") do menuView.itemText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); menuView.itemText:SetPoint("TOPLEFT", menuView, "TOPLEFT", titlewidth1,0); menuView.itemText:SetWidth(titlewidth2); menuView.itemText:SetHeight(30); menuView.itemText:SetSpacing(5); menuView.itemText:SetText(aaData.color_blue.."Lv888"); end; local btnwidth = 70; local btnheight = 30; menuView.levelBtn = CreateFrame('Button', nil, menuView, 'UIPanelButtonTemplate') do menuView.levelBtn:SetPoint('TOPLEFT', menuView, 'TOPLEFT', titlewidth1+titlewidth2+(titlewidth3-btnwidth)/2, 0); menuView.levelBtn:SetSize(btnwidth, btnheight); menuView.levelBtn:Disable(); menuView.levelBtn:SetText("已领取"); menuView.levelBtn:SetScript('OnClick', function() aaDesktop.aaJLLeichong:ClickDoneBtn(index,menuView.levelBtn); end); end; return menuView; end; local top = 0; local topspace = -35; for i=1,150 do aaDesktop.aaJLLeichong.LevelViews[i] = aaDesktop.aaJLLeichong:CreateCell(i,45,top+topspace*(i-1)); end; function aaDesktop.aaJLLeichong:reload() local index = 1; aaDesktop.aaJLLeichong.levels = {}; for k,v in pairs(aa_jlleichong) do aaDesktop.aaJLLeichong.levels[index] = k; index = index + 1; end; aaDesktop.aaJLLeichong.slider:SetMinMaxValues(0, #aaDesktop.aaJLLeichong.levels * 35 * 0.5); aaDesktop.aaJLLeichong.mainView:SetHeight(#aaDesktop.aaJLLeichong.levels * 35); table.sort(aaDesktop.aaJLLeichong.levels); index = 1; for i = 1,#aaDesktop.aaJLLeichong.levels do local k = aaDesktop.aaJLLeichong.levels[i]; local v = aa_jlleichong[k]; if k>0 and v~=nil and v~="" and v~={} then aaDesktop.aaJLLeichong.LevelViews[index]:Show(); local isOk = v[1]+0; local jfall = v[2]+0; local level = k+0; local reward = v[3]; aaDesktop.aaJLLeichong.title:SetText("当前累计充值："..aaData.color_blue..jfall..worldconf[15].."|r"); aaDesktop.aaJLLeichong.LevelViews[index].levelText:SetText(level); aaDesktop.aaJLLeichong.LevelViews[index].itemText:SetText(reward); aaDesktop.aaJLLeichong.LevelViews[index]:Show(); if isOk == 0 then aaDesktop.aaJLLeichong.LevelViews[index].levelBtn:SetText("领取"); aaDesktop.aaJLLeichong.LevelViews[index].levelBtn:Enable(); elseif isOk == 1 then aaDesktop.aaJLLeichong.LevelViews[index].levelBtn:SetText("已领取"); aaDesktop.aaJLLeichong.LevelViews[index].levelBtn:Disable(); elseif isOk == 2 then aaDesktop.aaJLLeichong.LevelViews[index].levelBtn:SetText("未达到"); aaDesktop.aaJLLeichong.LevelViews[index].levelBtn:Disable(); end; index = index + 1; else aaDesktop.aaJLLeichong.LevelViews[index]:Hide(); end; end; end; local CancelButton = CreateFrame('Button', nil, aaDesktop.aaJLLeichong.backView, 'UIPanelCloseButton') do CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); CancelButton:EnableMouse(true); CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaJLLeichong.backView, 'TOPRIGHT', -10, -10); CancelButton:SetSize(44, 44); CancelButton:SetScript('OnClick', function() aaDesktop.aaJLLeichong:hide(); end); end; function aaDesktop.aaJLLeichong:show() aaDesktop.aaJLLeichong.backView:Show(); aaDesktop.aaJLLeichong:reload(); end; function aaDesktop.aaJLLeichong:hide() aaDesktop.aaJLLeichong.backView:Hide(); aaDesktop.aaJLLeichong:reload(); end;   aaDesktop.aaJLQiandao = {}; aaDesktop.aaJLQiandao.LevelViews = {}; aaDesktop.aaJLQiandao.levels = {}; local titlewidth1 = 80;local titlewidth2 = 262;local titlewidth3 = 80;local titletop = -82;local titletop1 = titletop-30; local titletop = -100;local titleleft = 50; function aaDesktop.aaJLQiandao:ClickDoneBtn(index,btn) local level = aaDesktop.aaJLQiandao.levels[index]; aaData:sendAddonMsg(10006, level, "GUILD"); end; function aaDesktop.aaJLQiandao:ClickQDBtn() aaData:sendAddonMsg(10006, 999, "GUILD"); end; aaDesktop.aaJLQiandao.backView = CreateFrame("Frame","aaDesktop.aaJLQiandao.backView",UIParent) do aaDesktop.aaJLQiandao.backView:SetFrameStrata("TOOLTIP"); aaDesktop.aaJLQiandao.backView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-qdjl"}); aaDesktop.aaJLQiandao.backView:SetWidth(512); aaDesktop.aaJLQiandao.backView:SetHeight(512); aaDesktop.aaJLQiandao.backView:SetPoint("CENTER"); aaDesktop.aaJLQiandao.backView:EnableMouseWheel(true); aaDesktop.aaJLQiandao.backView:SetToplevel(true); aaDesktop.aaJLQiandao.backView:SetClampedToScreen(true); aaDesktop.aaJLQiandao.backView:SetMovable(true); aaDesktop.aaJLQiandao.backView:EnableMouse(true); aaDesktop.aaJLQiandao.backView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaJLQiandao.backView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaJLQiandao.backView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaJLQiandao.backView"); end; aaDesktop.aaJLQiandao.ScrollView = CreateFrame("ScrollFrame", "aaDesktop.aaJLQiandao.ScrollView", aaDesktop.aaJLQiandao.backView) do aaDesktop.aaJLQiandao.ScrollView:EnableMouseWheel(true); aaDesktop.aaJLQiandao.ScrollView:EnableMouse(true); aaDesktop.aaJLQiandao.ScrollView:SetMovable(true); aaDesktop.aaJLQiandao.ScrollView:SetSize(512-50,310); aaDesktop.aaJLQiandao.ScrollView:RegisterForDrag('LeftButton'); aaDesktop.aaJLQiandao.ScrollView:SetPoint('TOPLEFT', 0, titletop1); InterfaceOptions_AddCategory(aaDesktop.aaJLQiandao.ScrollView); end; aaDesktop.aaJLQiandao.mainView = CreateFrame("Frame","aaDesktop.aaJLQiandao.mainView",aaDesktop.aaJLQiandao.ScrollView) do aaDesktop.aaJLQiandao.ScrollView:SetScrollChild(aaDesktop.aaJLQiandao.mainView); aaDesktop.aaJLQiandao.mainView:EnableMouse(true); aaDesktop.aaJLQiandao.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaJLQiandao.mainView:SetWidth(512-50); aaDesktop.aaJLQiandao.mainView:SetHeight(310); aaDesktop.aaJLQiandao.mainView:SetPoint("TOPLEFT",0,0); aaDesktop.aaJLQiandao.mainView:Show(); end; aaDesktop.aaJLQiandao.slider = CreateFrame("Slider", "aaDesktop.aaJLQiandao.slider", aaDesktop.aaJLQiandao.backView, "OptionsSliderTemplate") do aaDesktop.aaJLQiandao.slider:SetWidth(30); aaDesktop.aaJLQiandao.slider:SetPoint('TOPLEFT', aaDesktop.aaJLQiandao.backView, 'TOPLEFT', 512 - 50, titletop1); aaDesktop.aaJLQiandao.slider:SetHeight(310); aaDesktop.aaJLQiandao.slider:SetOrientation('VERTICAL'); aaDesktop.aaJLQiandao.slider:SetOrientation('HORIZONTAL'); aaDesktop.aaJLQiandao.slider.tooltipText = ""; getglobal(aaDesktop.aaJLQiandao.slider:GetName() .. 'Low'):Hide(); getglobal(aaDesktop.aaJLQiandao.slider:GetName() .. 'High'):Hide(); getglobal(aaDesktop.aaJLQiandao.slider:GetName() .. 'Text'):Hide(); aaDesktop.aaJLQiandao.slider:SetThumbTexture("Interface\\AddOns\\aaAddon\\Icons\\aa_dropIco"); aaDesktop.aaJLQiandao.slider:SetMovable(true); aaDesktop.aaJLQiandao.slider:EnableMouseWheel(true); aaDesktop.aaJLQiandao.slider:RegisterForDrag('LeftButton'); aaDesktop.aaJLQiandao.slider:SetOrientation("VERTICAL"); aaDesktop.aaJLQiandao.slider:SetValueStep(9); aaDesktop.aaJLQiandao.slider:SetMinMaxValues(0, 310); aaDesktop.aaJLQiandao.slider:SetValue(0); aaDesktop.aaJLQiandao.slider:SetScript("OnValueChanged", function(self, value) aaDesktop.aaJLQiandao.ScrollView:SetVerticalScroll(value); end); end; aaDesktop.aaJLQiandao.backView:SetScript("OnMouseWheel", function(self, delta) local Value = aaDesktop.aaJLQiandao.slider:GetValue(); if (delta < 0) then aaDesktop.aaJLQiandao.slider:SetValue(Value + 27); else aaDesktop.aaJLQiandao.slider:SetValue(Value - 27); end; end); aaDesktop.aaJLQiandao.title = aaDesktop.aaJLQiandao.backView:CreateFontString("aaDesktop.aaJLQiandao.title", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLQiandao.title:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLQiandao.title:SetPoint("TOPLEFT", aaDesktop.aaJLQiandao.backView, "TOPLEFT", 45,titletop+50); aaDesktop.aaJLQiandao.title:SetWidth(titlewidth1+titlewidth2+titlewidth3); aaDesktop.aaJLQiandao.title:SetHeight(20); aaDesktop.aaJLQiandao.title:SetSpacing(5); aaDesktop.aaJLQiandao.title:SetText(""); end; aaDesktop.aaJLQiandao.leveltitle = aaDesktop.aaJLQiandao.backView:CreateFontString("aaDesktop.aaJLQiandao.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLQiandao.leveltitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLQiandao.leveltitle:SetPoint("TOPLEFT", aaDesktop.aaJLQiandao.backView, "TOPLEFT", 45,titletop+20); aaDesktop.aaJLQiandao.leveltitle:SetWidth(titlewidth1); aaDesktop.aaJLQiandao.leveltitle:SetHeight(20); aaDesktop.aaJLQiandao.leveltitle:SetSpacing(5); aaDesktop.aaJLQiandao.leveltitle:SetText(aaData.color_green.."累计天数"); end; aaDesktop.aaJLQiandao.jltitle = aaDesktop.aaJLQiandao.backView:CreateFontString("aaDesktop.aaJLQiandao.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLQiandao.jltitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLQiandao.jltitle:SetPoint("TOPLEFT", aaDesktop.aaJLQiandao.backView, "TOPLEFT", 45+titlewidth1,titletop+20); aaDesktop.aaJLQiandao.jltitle:SetWidth(titlewidth2); aaDesktop.aaJLQiandao.jltitle:SetHeight(20); aaDesktop.aaJLQiandao.jltitle:SetSpacing(5); aaDesktop.aaJLQiandao.jltitle:SetText(aaData.color_green.."奖励"); end; aaDesktop.aaJLQiandao.zttitle = aaDesktop.aaJLQiandao.backView:CreateFontString("aaDesktop.aaJLQiandao.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLQiandao.zttitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLQiandao.zttitle:SetPoint("TOPLEFT", aaDesktop.aaJLQiandao.backView, "TOPLEFT", 45+titlewidth1+titlewidth2,titletop+20); aaDesktop.aaJLQiandao.zttitle:SetWidth(titlewidth3); aaDesktop.aaJLQiandao.zttitle:SetHeight(20); aaDesktop.aaJLQiandao.zttitle:SetSpacing(5); aaDesktop.aaJLQiandao.zttitle:SetText(aaData.color_green.."状态"); end; aaDesktop.aaJLQiandao.btn = CreateFrame('Button', nil, aaDesktop.aaJLQiandao.backView, 'UIPanelButtonTemplate') do aaDesktop.aaJLQiandao.btn:SetPoint('TOPLEFT', aaDesktop.aaJLQiandao.backView, 'TOPLEFT', (512-80)/2, titletop1-300-8); aaDesktop.aaJLQiandao.btn:SetSize(80, 40); aaDesktop.aaJLQiandao.btn:Disable(); aaDesktop.aaJLQiandao.btn:SetText("点击签到"); aaDesktop.aaJLQiandao.btn:SetScript('OnClick', function() aaDesktop.aaJLQiandao:ClickQDBtn(); end); end; function aaDesktop.aaJLQiandao:CreateCell(index,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaJLQiandao.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(titlewidth1+titlewidth2+titlewidth3); menuView:SetHeight(30); menuView:SetPoint("TOPLEFT",aaDesktop.aaJLQiandao.mainView,'TOPLEFT',x,y); menuView:Hide(); end; menuView.levelText = menuView:CreateFontString("menuView.levelText", "OVERLAY", "GameFontNormal") do menuView.levelText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); menuView.levelText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 0,0); menuView.levelText:SetWidth(titlewidth1); menuView.levelText:SetHeight(30); menuView.levelText:SetSpacing(5); menuView.levelText:SetText(aaData.color_blue.."Lv888"); end; menuView.itemText = menuView:CreateFontString("menuView.itemText", "OVERLAY", "GameFontNormal") do menuView.itemText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); menuView.itemText:SetPoint("TOPLEFT", menuView, "TOPLEFT", titlewidth1,0); menuView.itemText:SetWidth(titlewidth2); menuView.itemText:SetHeight(30); menuView.itemText:SetSpacing(5); menuView.itemText:SetText(aaData.color_blue.."Lv888"); end; local btnwidth = 70; local btnheight = 30; menuView.levelBtn = CreateFrame('Button', nil, menuView, 'UIPanelButtonTemplate') do menuView.levelBtn:SetPoint('TOPLEFT', menuView, 'TOPLEFT', titlewidth1+titlewidth2+(titlewidth3-btnwidth)/2, 0); menuView.levelBtn:SetSize(btnwidth, btnheight); menuView.levelBtn:Disable(); menuView.levelBtn:SetText("已领取"); menuView.levelBtn:SetScript('OnClick', function() aaDesktop.aaJLQiandao:ClickDoneBtn(index,menuView.levelBtn); end); end; return menuView; end; local top = 0; local topspace = -35; for i=1,150 do aaDesktop.aaJLQiandao.LevelViews[i] = aaDesktop.aaJLQiandao:CreateCell(i,45,top+topspace*(i-1)); end; function aaDesktop.aaJLQiandao:reload() aaDesktop.aaJLQiandao.levels = {}; for i=1, 150 do aaDesktop.aaJLQiandao.LevelViews[i]:Hide(); end; local index = 1; local fugaikey = {}; for i,v in pairs(aa_jlqiandao) do local value = aa_jlqiandao[i]; if value ~= nil then table.insert(fugaikey,i); end; end; table.sort(fugaikey,function(a,b)return (tonumber(a)<tonumber(b)) end); for i=1,#fugaikey do local k = fugaikey[i]; local v = aa_jlqiandao[k] aaDesktop.aaJLQiandao.LevelViews[index]:Show(); local isOk = v[1]+0; local jfall = v[2]+0; local level = k+0; local isOkqd = v[3]; local reward = v[4]; aaDesktop.aaJLQiandao.title:SetText("已签到天数："..aaData.color_blue..jfall.."天|r"); aaDesktop.aaJLQiandao.LevelViews[index].levelText:SetText(level.."天"); aaDesktop.aaJLQiandao.LevelViews[index].itemText:SetText(reward); aaDesktop.aaJLQiandao.LevelViews[index]:Show(); if isOkqd == 0 then aaDesktop.aaJLQiandao.btn:SetText("点击签到"); aaDesktop.aaJLQiandao.btn:Enable(); else aaDesktop.aaJLQiandao.btn:SetText("已签到"); aaDesktop.aaJLQiandao.btn:Disable(); end; if isOk == 0 then aaDesktop.aaJLQiandao.LevelViews[index].levelBtn:SetText("领取"); aaDesktop.aaJLQiandao.LevelViews[index].levelBtn:Enable(); elseif isOk == 1 then aaDesktop.aaJLQiandao.LevelViews[index].levelBtn:SetText("已领取"); aaDesktop.aaJLQiandao.LevelViews[index].levelBtn:Disable(); elseif isOk == 2 then aaDesktop.aaJLQiandao.LevelViews[index].levelBtn:SetText("未达到"); aaDesktop.aaJLQiandao.LevelViews[index].levelBtn:Disable(); end; aaDesktop.aaJLQiandao.levels[index] = k; index = index + 1; end; aaDesktop.aaJLQiandao.slider:SetMinMaxValues(0, #aa_jlqiandao * 45 * 0.5); aaDesktop.aaJLQiandao.mainView:SetHeight(#aa_jlqiandao * 45); end; local CancelButton = CreateFrame('Button', nil, aaDesktop.aaJLQiandao.backView, 'UIPanelCloseButton') do CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaJLQiandao.backView, 'TOPRIGHT', -10, -10); CancelButton:SetSize(44, 44); CancelButton:SetScript('OnClick', function() aaDesktop.aaJLQiandao:hide(); end); end; function aaDesktop.aaJLQiandao:show() aaDesktop.aaJLQiandao.backView:Show(); aaDesktop.aaJLQiandao:reload(); end; function aaDesktop.aaJLQiandao:hide() aaDesktop.aaJLQiandao.backView:Hide(); aaDesktop.aaJLQiandao:reload(); end;   aaDesktop.aaJLLevel = {}; aaDesktop.aaJLLevel.LevelViews = {}; aaDesktop.aaJLLevel.levels = {}; local titleleft = 50;local titlewidth1 = 80;local titlewidth2 = 262;local titlewidth3 = 80;local titletop = -82; function aaDesktop.aaJLLevel:ClickDoneBtn(index,btn) local level = aaDesktop.aaJLLevel.levels[index]; aaData:sendAddonMsg(10002, level, "GUILD"); end; aaDesktop.aaJLLevel.backView = CreateFrame("Frame","aaDesktop.aaJLLevel.backView",UIParent) do aaDesktop.aaJLLevel.backView:SetFrameStrata("TOOLTIP"); aaDesktop.aaJLLevel.backView:SetBackdrop ({bgFile="Interface\\AddOns\\aaAddon\\Icons\\aa-sjjl"}); aaDesktop.aaJLLevel.backView:SetWidth(512); aaDesktop.aaJLLevel.backView:SetHeight(512); aaDesktop.aaJLLevel.backView:SetPoint("CENTER"); aaDesktop.aaJLLevel.backView:EnableMouseWheel(true); aaDesktop.aaJLLevel.backView:SetToplevel(true); aaDesktop.aaJLLevel.backView:SetClampedToScreen(true); aaDesktop.aaJLLevel.backView:SetMovable(true); aaDesktop.aaJLLevel.backView:EnableMouse(true); aaDesktop.aaJLLevel.backView:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaJLLevel.backView:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaJLLevel.backView:Hide(); tinsert(UISpecialFrames, "aaDesktop.aaJLLevel.backView"); end; aaDesktop.aaJLLevel.ScrollView = CreateFrame("ScrollFrame", "aaDesktop.aaJLLevel.ScrollView", aaDesktop.aaJLLevel.backView) do aaDesktop.aaJLLevel.ScrollView:EnableMouseWheel(true); aaDesktop.aaJLLevel.ScrollView:EnableMouse(true); aaDesktop.aaJLLevel.ScrollView:SetMovable(true); aaDesktop.aaJLLevel.ScrollView:SetSize(512-50,350); aaDesktop.aaJLLevel.ScrollView:RegisterForDrag('LeftButton'); aaDesktop.aaJLLevel.ScrollView:SetPoint('TOPLEFT', 0, titletop-20); InterfaceOptions_AddCategory(aaDesktop.aaJLLevel.ScrollView); end; aaDesktop.aaJLLevel.mainView = CreateFrame("Frame","aaDesktop.aaJLLevel.mainView",aaDesktop.aaJLLevel.ScrollView) do aaDesktop.aaJLLevel.ScrollView:SetScrollChild(aaDesktop.aaJLLevel.mainView); aaDesktop.aaJLLevel.mainView:EnableMouse(true); aaDesktop.aaJLLevel.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaJLLevel.mainView:SetWidth(512-50); aaDesktop.aaJLLevel.mainView:SetHeight(350); aaDesktop.aaJLLevel.mainView:SetPoint("TOPLEFT",0,0); aaDesktop.aaJLLevel.mainView:Show(); end;  aaDesktop.aaJLLevel.slider = CreateFrame("Slider", "aaDesktop.aaJLLevel.slider", aaDesktop.aaJLLevel.backView, "OptionsSliderTemplate") do aaDesktop.aaJLLevel.slider:SetWidth(30); aaDesktop.aaJLLevel.slider:SetPoint('TOPLEFT', aaDesktop.aaJLLevel.backView, 'TOPLEFT', 512 - 50, titletop-20); aaDesktop.aaJLLevel.slider:SetHeight(350); aaDesktop.aaJLLevel.slider:SetOrientation('VERTICAL'); aaDesktop.aaJLLevel.slider:SetOrientation('HORIZONTAL'); aaDesktop.aaJLLevel.slider.tooltipText = ""; getglobal(aaDesktop.aaJLLevel.slider:GetName() .. 'Low'):Hide(); getglobal(aaDesktop.aaJLLevel.slider:GetName() .. 'High'):Hide(); getglobal(aaDesktop.aaJLLevel.slider:GetName() .. 'Text'):Hide(); aaDesktop.aaJLLevel.slider:SetThumbTexture("Interface\\AddOns\\aaAddon\\Icons\\aa_dropIco"); aaDesktop.aaJLLevel.slider:SetMovable(true); aaDesktop.aaJLLevel.slider:EnableMouseWheel(true); aaDesktop.aaJLLevel.slider:RegisterForDrag('LeftButton'); aaDesktop.aaJLLevel.slider:SetOrientation("VERTICAL"); aaDesktop.aaJLLevel.slider:SetValueStep(9); aaDesktop.aaJLLevel.slider:SetMinMaxValues(0, 350); aaDesktop.aaJLLevel.slider:SetValue(0); aaDesktop.aaJLLevel.slider:SetScript("OnValueChanged", function(self, value) aaDesktop.aaJLLevel.ScrollView:SetVerticalScroll(value); end); end; aaDesktop.aaJLLevel.backView:SetScript("OnMouseWheel", function(self, delta) local Value = aaDesktop.aaJLLevel.slider:GetValue(); if (delta < 0) then aaDesktop.aaJLLevel.slider:SetValue(Value + 27); else aaDesktop.aaJLLevel.slider:SetValue(Value - 27); end; end); aaDesktop.aaJLLevel.leveltitle = aaDesktop.aaJLLevel.backView:CreateFontString("aaDesktop.aaJLLevel.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLLevel.leveltitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLLevel.leveltitle:SetPoint("TOPLEFT", aaDesktop.aaJLLevel.backView, "TOPLEFT", 45,titletop); aaDesktop.aaJLLevel.leveltitle:SetWidth(titlewidth1); aaDesktop.aaJLLevel.leveltitle:SetHeight(20); aaDesktop.aaJLLevel.leveltitle:SetSpacing(5); aaDesktop.aaJLLevel.leveltitle:SetText(aaData.color_green.."等级"); end; aaDesktop.aaJLLevel.jltitle = aaDesktop.aaJLLevel.backView:CreateFontString("aaDesktop.aaJLLevel.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLLevel.jltitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLLevel.jltitle:SetPoint("TOPLEFT", aaDesktop.aaJLLevel.backView, "TOPLEFT", 45+titlewidth1,titletop); aaDesktop.aaJLLevel.jltitle:SetWidth(titlewidth2); aaDesktop.aaJLLevel.jltitle:SetHeight(20); aaDesktop.aaJLLevel.jltitle:SetSpacing(5); aaDesktop.aaJLLevel.jltitle:SetText(aaData.color_green.."奖励"); end; aaDesktop.aaJLLevel.zttitle = aaDesktop.aaJLLevel.backView:CreateFontString("aaDesktop.aaJLLevel.leveltitle", "OVERLAY", "GameFontNormal") do aaDesktop.aaJLLevel.zttitle:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJLLevel.zttitle:SetPoint("TOPLEFT", aaDesktop.aaJLLevel.backView, "TOPLEFT", 45+titlewidth1+titlewidth2,titletop); aaDesktop.aaJLLevel.zttitle:SetWidth(titlewidth3); aaDesktop.aaJLLevel.zttitle:SetHeight(20); aaDesktop.aaJLLevel.zttitle:SetSpacing(5); aaDesktop.aaJLLevel.zttitle:SetText(aaData.color_green.."状态"); end; function aaDesktop.aaJLLevel:CreateCell(index,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaJLLevel.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(titlewidth1+titlewidth2+titlewidth3); menuView:SetHeight(30); menuView:SetPoint("TOPLEFT",aaDesktop.aaJLLevel.mainView,'TOPLEFT',x,y); menuView:Hide(); end; menuView.levelText = menuView:CreateFontString("menuView.levelText", "OVERLAY", "GameFontNormal") do menuView.levelText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); menuView.levelText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 0,0); menuView.levelText:SetWidth(titlewidth1); menuView.levelText:SetHeight(30); menuView.levelText:SetSpacing(5); menuView.levelText:SetText(aaData.color_blue.."Lv888"); end; menuView.itemText = menuView:CreateFontString("menuView.itemText", "OVERLAY", "GameFontNormal") do menuView.itemText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); menuView.itemText:SetPoint("TOPLEFT", menuView, "TOPLEFT", titlewidth1,0); menuView.itemText:SetWidth(titlewidth2); menuView.itemText:SetHeight(30); menuView.itemText:SetSpacing(5); menuView.itemText:SetText(aaData.color_blue.."Lv888"); end; local btnwidth = 70; local btnheight = 30; menuView.levelBtn = CreateFrame('Button', nil, menuView, 'UIPanelButtonTemplate') do menuView.levelBtn:SetPoint('TOPLEFT', menuView, 'TOPLEFT', titlewidth1+titlewidth2+(titlewidth3-btnwidth)/2, 0); menuView.levelBtn:SetSize(btnwidth, btnheight); menuView.levelBtn:Disable(); menuView.levelBtn:SetText("已领取"); menuView.levelBtn:SetScript('OnClick', function() aaDesktop.aaJLLevel:ClickDoneBtn(index,menuView.levelBtn); end); end; return menuView; end; local top = 0; local topspace = -35; for i=1,150 do aaDesktop.aaJLLevel.LevelViews[i] = aaDesktop.aaJLLevel:CreateCell(i,45,top+topspace*(i-1)); end; function aaDesktop.aaJLLevel:reload() local index = 1; aaDesktop.aaJLLevel.levels = {}; for k,v in pairs(aa_jllevel) do aaDesktop.aaJLLevel.levels[index] = k; index = index + 1; end; aaDesktop.aaJLLevel.slider:SetMinMaxValues(0, #aaDesktop.aaJLLevel.levels * 35 * 0.5); aaDesktop.aaJLLevel.mainView:SetHeight(#aaDesktop.aaJLLevel.levels * 35); table.sort(aaDesktop.aaJLLevel.levels); index = 1; for i = 1,#aaDesktop.aaJLLevel.levels do local k = aaDesktop.aaJLLevel.levels[i]; local v = aa_jllevel[k]; if k>0 and v~=nil and v~="" and v~={} then aaDesktop.aaJLLevel.LevelViews[index]:Show(); local isOk = v[1]+0; local type = v[2]+0; local level = k+0; local reward = v[3]; aaDesktop.aaJLLevel.LevelViews[index].levelText:SetText("Lv"..level); aaDesktop.aaJLLevel.LevelViews[index].itemText:SetText(reward); if isOk == 0 then aaDesktop.aaJLLevel.LevelViews[index].levelBtn:SetText("领取"); aaDesktop.aaJLLevel.LevelViews[index].levelBtn:Enable(); elseif isOk == 1 then aaDesktop.aaJLLevel.LevelViews[index].levelBtn:SetText("已领取"); aaDesktop.aaJLLevel.LevelViews[index].levelBtn:Disable(); elseif isOk == 2 then aaDesktop.aaJLLevel.LevelViews[index].levelBtn:SetText("未达到"); aaDesktop.aaJLLevel.LevelViews[index].levelBtn:Disable(); end; if type == 0 then aaDesktop.aaJLLevel.leveltitle:SetText(aaData.color_green.."等级"); elseif type == 1 then aaDesktop.aaJLLevel.leveltitle:SetText(aaData.color_green.."Vip等级"); elseif type == 2 then aaDesktop.aaJLLevel.leveltitle:SetText(aaData.color_green.."军衔等级"); elseif type == 3 then aaDesktop.aaJLLevel.leveltitle:SetText(aaData.color_green.."斗气等级"); elseif type == 4 then aaDesktop.aaJLLevel.leveltitle:SetText(aaData.color_green.."巅峰等级"); end index = index + 1; else aaDesktop.aaJLLevel.LevelViews[index]:Hide(); end; end; end; local CancelButton = CreateFrame('Button', nil, aaDesktop.aaJLLevel.backView, 'UIPanelCloseButton') do CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); CancelButton:EnableMouse(true); CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaJLLevel.backView, 'TOPRIGHT', -10, -10); CancelButton:SetSize(44, 44); CancelButton:SetScript('OnClick', function() aaDesktop.aaJLLevel:hide(); end); end; function aaDesktop.aaJLLevel:show() aaDesktop.aaJLLevel.backView:Show(); aaDesktop.aaJLLevel:reload(); end; function aaDesktop.aaJLLevel:hide() aaDesktop.aaJLLevel.backView:Hide(); aaDesktop.aaJLLevel:reload(); end;    aaDesktop.aaJiJieHao.menuWidth = 320; aaDesktop.aaJiJieHao.menuHeight = 512; aaDesktop.aaJiJieHao.menuListView = {}; aaDesktop.aaJiJieHao.width = 768; aaDesktop.aaJiJieHao.height = 512; aaDesktop.aaJiJieHao.itemWidth = 59.07; aaDesktop.aaJiJieHao.listView = {}; aaDesktop.aaJiJieHao.selectMenuData = {};   aaDesktop.aaJiJieHao.menuBackView4 = CreateFrame("Frame","aaDesktop.aaJiJieHao.menuBackView4",UIParent) do aaDesktop.aaJiJieHao.menuBackView4:SetFrameStrata("TOOLTIP"); aaDesktop.aaJiJieHao.menuBackView4:SetBackdrop( { edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border", edgeSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); aaDesktop.aaJiJieHao.menuBackView4:SetWidth(aaDesktop.aaJiJieHao.menuWidth+30); aaDesktop.aaJiJieHao.menuBackView4:SetHeight(aaDesktop.aaJiJieHao.menuHeight); aaDesktop.aaJiJieHao.menuBackView4:SetPoint("CENTER",0,0); aaDesktop.aaJiJieHao.menuBackView4:EnableMouseWheel(true); aaDesktop.aaJiJieHao.menuBackView4:SetToplevel(true); aaDesktop.aaJiJieHao.menuBackView4:SetClampedToScreen(true); aaDesktop.aaJiJieHao.menuBackView4:SetMovable(true); aaDesktop.aaJiJieHao.menuBackView4:EnableMouse(true); aaDesktop.aaJiJieHao.menuBackView4:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaJiJieHao.menuBackView4:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaJiJieHao.menuBackView4:Show(); tinsert(UISpecialFrames, "aaDesktop.aaJiJieHao.menuBackView4"); end;  aaDesktop.aaJiJieHao.menuBackView1 = CreateFrame("Frame","aaDesktop.aaJiJieHao.menuBackView1",aaDesktop.aaJiJieHao.menuBackView4) do aaDesktop.aaJiJieHao.menuBackView1:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg1"}); aaDesktop.aaJiJieHao.menuBackView1:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.menuBackView4, "TOPLEFT",0,0); aaDesktop.aaJiJieHao.menuBackView1:SetWidth(32); aaDesktop.aaJiJieHao.menuBackView1:SetHeight(aaDesktop.aaJiJieHao.height); end; aaDesktop.aaJiJieHao.menuBackView2 = CreateFrame("Frame","aaDesktop.aaJiJieHao.menuBackView2",aaDesktop.aaJiJieHao.menuBackView4) do aaDesktop.aaJiJieHao.menuBackView2:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg2"}); aaDesktop.aaJiJieHao.menuBackView2:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.menuBackView4, "TOPLEFT",32,0); aaDesktop.aaJiJieHao.menuBackView2:SetWidth(aaDesktop.aaJiJieHao.menuWidth-64); aaDesktop.aaJiJieHao.menuBackView2:SetHeight(aaDesktop.aaJiJieHao.menuHeight); end; aaDesktop.aaJiJieHao.menuBackView3 = CreateFrame("Frame","aaDesktop.aaJiJieHao.menuBackView3",aaDesktop.aaJiJieHao.menuBackView4) do aaDesktop.aaJiJieHao.menuBackView3:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg3"}); aaDesktop.aaJiJieHao.menuBackView3:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.menuBackView4, "TOPLEFT",aaDesktop.aaJiJieHao.menuWidth - 32,0); aaDesktop.aaJiJieHao.menuBackView3:SetWidth(32); aaDesktop.aaJiJieHao.menuBackView3:SetHeight(aaDesktop.aaJiJieHao.menuHeight); end; aaDesktop.aaJiJieHao.menuBackView = CreateFrame("Frame","aaDesktop.aaJiJieHao.menuBackView",aaDesktop.aaJiJieHao.menuBackView4) do aaDesktop.aaJiJieHao.menuBackView:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.menuBackView4, "TOPLEFT",0,0); aaDesktop.aaJiJieHao.menuBackView:SetWidth(aaDesktop.aaJiJieHao.menuWidth); aaDesktop.aaJiJieHao.menuBackView:SetHeight(aaDesktop.aaJiJieHao.menuHeight); end;  aaDesktop.aaJiJieHao.menuScrollView = CreateFrame("ScrollFrame", "aaDesktop.aaJiJieHao.menuScrollView", aaDesktop.aaJiJieHao.menuBackView) do aaDesktop.aaJiJieHao.menuScrollView:EnableMouseWheel(true); aaDesktop.aaJiJieHao.menuScrollView:EnableMouse(true); aaDesktop.aaJiJieHao.menuScrollView:SetMovable(true); aaDesktop.aaJiJieHao.menuScrollView:SetSize(aaDesktop.aaJiJieHao.menuWidth, aaDesktop.aaJiJieHao.menuHeight - 84 - 45); aaDesktop.aaJiJieHao.menuScrollView:RegisterForDrag('LeftButton'); aaDesktop.aaJiJieHao.menuScrollView:SetPoint('TOPLEFT', 0, -84); InterfaceOptions_AddCategory(aaDesktop.aaJiJieHao.menuScrollView); end; aaDesktop.aaJiJieHao.menuMainView = CreateFrame("Frame","aaDesktop.aaJiJieHao.menuMainView",aaDesktop.aaJiJieHao.menuScrollView) do aaDesktop.aaJiJieHao.menuScrollView:SetScrollChild(aaDesktop.aaJiJieHao.menuMainView); aaDesktop.aaJiJieHao.menuMainView:EnableMouse(true); aaDesktop.aaJiJieHao.menuMainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaJiJieHao.menuMainView:SetWidth(aaDesktop.aaJiJieHao.menuWidth); aaDesktop.aaJiJieHao.menuMainView:SetHeight(aaDesktop.aaJiJieHao.menuHeight - 64 - 45); aaDesktop.aaJiJieHao.menuMainView:SetPoint("TOPLEFT",0, 0); aaDesktop.aaJiJieHao.menuMainView:Show(); end; aaDesktop.aaJiJieHao.menuSlider = CreateFrame("slider", "aaDesktop.aaJiJieHao.menuSlider", aaDesktop.aaJiJieHao.menuBackView, "OptionsSliderTemplate") do aaDesktop.aaJiJieHao.menuSlider:SetWidth(30); aaDesktop.aaJiJieHao.menuSlider:SetPoint('TOPLEFT', aaDesktop.aaJiJieHao.menuBackView, 'TOPLEFT', aaDesktop.aaJiJieHao.menuWidth, -34); aaDesktop.aaJiJieHao.menuSlider:SetHeight(aaDesktop.aaJiJieHao.menuHeight-34); aaDesktop.aaJiJieHao.menuSlider:SetOrientation('VERTICAL'); aaDesktop.aaJiJieHao.menuSlider:SetOrientation('HORIZONTAL'); aaDesktop.aaJiJieHao.menuSlider.tooltipText = ""; getglobal(aaDesktop.aaJiJieHao.menuSlider:GetName() .. 'Low'):Hide(); getglobal(aaDesktop.aaJiJieHao.menuSlider:GetName() .. 'High'):Hide(); getglobal(aaDesktop.aaJiJieHao.menuSlider:GetName() .. 'Text'):Hide(); aaDesktop.aaJiJieHao.menuSlider:SetThumbTexture("Interface\\AddOns\\aaAddon\\Icons\\aa_dropIco"); aaDesktop.aaJiJieHao.menuSlider:SetMovable(true); aaDesktop.aaJiJieHao.menuSlider:EnableMouseWheel(true); aaDesktop.aaJiJieHao.menuSlider:RegisterForDrag('LeftButton'); aaDesktop.aaJiJieHao.menuSlider:SetOrientation("VERTICAL"); aaDesktop.aaJiJieHao.menuSlider:SetValueStep(9); aaDesktop.aaJiJieHao.menuSlider:SetMinMaxValues(0, aaDesktop.aaJiJieHao.menuHeight); aaDesktop.aaJiJieHao.menuSlider:SetValue(0); aaDesktop.aaJiJieHao.menuSlider:SetScript("OnValueChanged", function(self, value) aaDesktop.aaJiJieHao.menuScrollView:SetVerticalScroll(value); end); end; aaDesktop.aaJiJieHao.menutitletext = aaDesktop.aaJiJieHao.menuBackView:CreateFontString("aaDesktop.aaJiJieHao.menutitletext", "OVERLAY", "GameFontNormal") do aaDesktop.aaJiJieHao.menutitletext:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.menuBackView, "TOPLEFT", 0, -5); aaDesktop.aaJiJieHao.menutitletext:SetWidth(aaDesktop.aaJiJieHao.menuWidth); aaDesktop.aaJiJieHao.menutitletext:SetHeight(44); aaDesktop.aaJiJieHao.menutitletext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJiJieHao.menutitletext:SetText(aaData.color_white.."在列表中选择你要创建的活动地图"); end; aaDesktop.aaJiJieHao.menuEditBox = CreateFrame('EditBox', "aaDesktop.aaJiJieHao.menuEditBox", aaDesktop.aaJiJieHao.menuBackView, 'InputBoxTemplate') do aaDesktop.aaJiJieHao.menuEditBox:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaJiJieHao.menuEditBox:SetWidth(aaDesktop.aaJiJieHao.menuWidth - 34); aaDesktop.aaJiJieHao.menuEditBox:SetHeight(20); aaDesktop.aaJiJieHao.menuEditBox:SetMaxLetters(100); aaDesktop.aaJiJieHao.menuEditBox:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.menuBackView, "TOPLEFT", 21, -54); aaDesktop.aaJiJieHao.menuEditBox:SetText("输入活动说明"); end; aaDesktop.aaJiJieHao.menuCreateButton = CreateFrame('Button', nil, aaDesktop.aaJiJieHao.menuBackView4, 'UIPanelButtonTemplate') do aaDesktop.aaJiJieHao.menuCreateButton:SetPoint('TOPLEFT', aaDesktop.aaJiJieHao.menuBackView, 'TOPLEFT', 90, -472); aaDesktop.aaJiJieHao.menuCreateButton:SetSize(60, 30); aaDesktop.aaJiJieHao.menuCreateButton:SetText("创建"); aaDesktop.aaJiJieHao.menuCreateButton:SetScript('OnClick', function() if aaDesktop.aaJiJieHao.selectMenuData[4] ~= nil then local id = aaDesktop.aaJiJieHao.selectMenuData[1]; local text = aaDesktop.aaJiJieHao.menuEditBox:GetText(); local msg = id.."\t"..text; aaData:sendAddonMsg(3052, msg, "GUILD"); aaDesktop.aaJiJieHao:hideMenu(); aaDesktop.aaJiJieHao:show(); aaData:sendAddonMsg(3050, "1", "GUILD"); end; end); end; aaDesktop.aaJiJieHao.menuBackButton = CreateFrame('Button', nil, aaDesktop.aaJiJieHao.menuBackView4, 'UIPanelButtonTemplate') do aaDesktop.aaJiJieHao.menuBackButton:SetPoint('TOPLEFT', aaDesktop.aaJiJieHao.menuBackView, 'TOPLEFT', 170, -472); aaDesktop.aaJiJieHao.menuBackButton:SetSize(60, 30); aaDesktop.aaJiJieHao.menuBackButton:SetText("返回"); aaDesktop.aaJiJieHao.menuBackButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); aaDesktop.aaJiJieHao:hideMenu(); aaDesktop.aaJiJieHao:show(); aaData:sendAddonMsg(3050, "1", "GUILD"); end); end; aaDesktop.aaJiJieHao.menuBackView4:SetScript("OnMouseWheel", function(self, delta) local Value = aaDesktop.aaJiJieHao.menuSlider:GetValue(); if (delta < 0) then aaDesktop.aaJiJieHao.menuSlider:SetValue(Value + 27); else aaDesktop.aaJiJieHao.menuSlider:SetValue(Value - 27); end; end); aaDesktop.aaJiJieHao.menuCancelButton = CreateFrame('Button', nil, aaDesktop.aaJiJieHao.menuBackView4, 'UIPanelCloseButton') do aaDesktop.aaJiJieHao.menuCancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaJiJieHao.menuCancelButton:SetPoint('TOPRIGHT', aaDesktop.aaJiJieHao.menuBackView4, 'TOPRIGHT', 0, 0); aaDesktop.aaJiJieHao.menuCancelButton:SetSize(34, 34); aaDesktop.aaJiJieHao.menuCancelButton:SetScript('OnClick', function() aaDesktop.aaJiJieHao:hideMenu(); aaDesktop.aaJiJieHao:show(); aaData:sendAddonMsg(3050, "1", "GUILD"); end); end;  function aaDesktop.aaJiJieHao:menuCreateCell(index,id,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaJiJieHao.menuMainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(aaDesktop.aaJiJieHao.menuWidth); menuView:SetHeight(44); menuView:SetPoint("TOPLEFT",aaDesktop.aaJiJieHao.menuMainView,'TOPLEFT',x,y); menuView:EnableMouse(true); menuView:SetScript("OnMouseDown",function() aaDesktop.aaJiJieHao.selectMenuData = aa_ui_jijie1[index]; local text = menuView.nameText:GetText(); aaDesktop.aaJiJieHao.menutitletext:SetText(text); for i=1,#aaDesktop.aaJiJieHao.menuListView do local view = aaDesktop.aaJiJieHao.menuListView[i].backView; if view then view:SetBackdrop( { edgeSize = 16, insets = { left = 1, right = 1, top = 1, bottom = 1 } }); view:SetBackdropColor(0,0,0,0.8); end; local view = aaDesktop.aaJiJieHao.menuListView[index].backView; view:SetBackdrop( { edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border" }); view:SetBackdropColor(0,0,0,1); end; end); menuView:Show(); end; menuView.backView = CreateFrame("Frame","menuView.backView",menuView) do menuView.backView:SetBackdrop( { edgeSize = 16, insets = { left = 1, right = 1, top = 1, bottom = 1 } }); menuView.backView:SetBackdropColor(0,0,0,0.5); menuView.backView:SetPoint("TOPLEFT", menuView, "TOPLEFT",10,0); menuView.backView:SetWidth(aaDesktop.aaJiJieHao.menuWidth-20); menuView.backView:SetHeight(54); end; menuView.iconView = CreateFrame('Button', nil, menuView, '') do menuView.iconView:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 20, -10); menuView.iconView:SetButtonState('NORMAL'); menuView.iconView:IsEnabled(); menuView.iconView:SetNormalTexture("Interface\\ICONS\\c3 (544).blp:30"); menuView.iconView:SetWidth(30); menuView.iconView:SetHeight(30); end; menuView.nameText = menuView:CreateFontString("menuView.nameText", "OVERLAY", "GameFontNormal") do menuView.nameText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.nameText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 36+15+5,-8); menuView.nameText:SetHeight(18); menuView.nameText:SetText("|cFFFF0000『 大秘境·熔火之心 』|r"); end; menuView.titleText = menuView:CreateFontString("menuView.titleText", "OVERLAY", "GameFontNormal") do menuView.titleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.titleText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 36+15+5, -26); menuView.titleText:SetHeight(18); menuView.titleText:SetText(aaData.color_white.."AA暗黑魔兽，开服一条龙服务QQ643125009"); end; return menuView; end;  function aaDesktop.aaJiJieHao:showMenu() aaDesktop.aaJiJieHao.menuSlider:SetMinMaxValues(0, #aa_ui_jijie1 * 44 * 0.5); aaDesktop.aaJiJieHao.menuMainView:SetHeight(#aa_ui_jijie1 * 44); for i=1,#aaDesktop.aaJiJieHao.menuListView do aaDesktop.aaJiJieHao.menuListView[i]:Hide(); aaDesktop.aaJiJieHao.menuListView[i] = nil; end; for i=1,#aa_ui_jijie1 do aaDesktop.aaJiJieHao.menuListView[i] = aaDesktop.aaJiJieHao:menuCreateCell(i,i,4,-(44+5)*(i-1)); end; local index = 0; for k,v in pairs(aa_ui_jijie1) do if v[4] ~= nil then index = index + 1; local id = v[1]; local icon = v[2]; local name = v[3]; local title = v[4]; aaDesktop.aaJiJieHao.menuListView[index].iconView:SetNormalTexture(icon); aaDesktop.aaJiJieHao.menuListView[index].nameText:SetText(name); aaDesktop.aaJiJieHao.menuListView[index].titleText:SetText(title); end; end; aaDesktop.aaJiJieHao.menuBackView4:Show(); end; function aaDesktop.aaJiJieHao:hideMenu() aaDesktop.aaJiJieHao.menuBackView4:Hide(); end;   aaDesktop.aaJiJieHao.backView4 = CreateFrame("Frame","aaDesktop.aaJiJieHao.backView4",UIParent) do aaDesktop.aaJiJieHao.backView4:SetFrameStrata("TOOLTIP"); aaDesktop.aaJiJieHao.backView4:SetWidth(aaDesktop.aaJiJieHao.width+30); aaDesktop.aaJiJieHao.backView4:SetHeight(aaDesktop.aaJiJieHao.height); aaDesktop.aaJiJieHao.backView4:SetPoint("CENTER",0,0); aaDesktop.aaJiJieHao.backView4:EnableMouseWheel(true); aaDesktop.aaJiJieHao.backView4:SetToplevel(true); aaDesktop.aaJiJieHao.backView4:SetClampedToScreen(true); aaDesktop.aaJiJieHao.backView4:SetMovable(true); aaDesktop.aaJiJieHao.backView4:EnableMouse(true); aaDesktop.aaJiJieHao.backView4:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaJiJieHao.backView4:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaJiJieHao.backView4:Show(); tinsert(UISpecialFrames, "aaDesktop.aaJiJieHao.backView4"); end; aaDesktop.aaJiJieHao.backView1 = CreateFrame("Frame","aaDesktop.aaJiJieHao.backView1",aaDesktop.aaJiJieHao.backView4) do aaDesktop.aaJiJieHao.backView1:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg1"}); aaDesktop.aaJiJieHao.backView1:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.backView4, "TOPLEFT",0,0); aaDesktop.aaJiJieHao.backView1:SetWidth(32); aaDesktop.aaJiJieHao.backView1:SetHeight(aaDesktop.aaJiJieHao.height); end; aaDesktop.aaJiJieHao.backView2 = CreateFrame("Frame","aaDesktop.aaJiJieHao.backView2",aaDesktop.aaJiJieHao.backView4) do aaDesktop.aaJiJieHao.backView2:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg2"}); aaDesktop.aaJiJieHao.backView2:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.backView4, "TOPLEFT",32,0); aaDesktop.aaJiJieHao.backView2:SetWidth(aaDesktop.aaJiJieHao.width - 64); aaDesktop.aaJiJieHao.backView2:SetHeight(aaDesktop.aaJiJieHao.height); end; aaDesktop.aaJiJieHao.backView3 = CreateFrame("Frame","aaDesktop.aaJiJieHao.backView3",aaDesktop.aaJiJieHao.backView4) do aaDesktop.aaJiJieHao.backView3:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg3"}); aaDesktop.aaJiJieHao.backView3:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.backView4, "TOPLEFT",aaDesktop.aaJiJieHao.width - 32,0); aaDesktop.aaJiJieHao.backView3:SetWidth(32); aaDesktop.aaJiJieHao.backView3:SetHeight(aaDesktop.aaJiJieHao.height); end; aaDesktop.aaJiJieHao.backView = CreateFrame("Frame","aaDesktop.aaJiJieHao.backView",aaDesktop.aaJiJieHao.backView4) do aaDesktop.aaJiJieHao.backView:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.backView4, "TOPLEFT",0,0); aaDesktop.aaJiJieHao.backView:SetWidth(aaDesktop.aaJiJieHao.width); aaDesktop.aaJiJieHao.backView:SetHeight(aaDesktop.aaJiJieHao.height); end; aaDesktop.aaJiJieHao.placeHolder = aaDesktop.aaJiJieHao.backView:CreateFontString("aaDesktop.aaJiJieHao.titletext1", "OVERLAY", "GameFontNormal") do aaDesktop.aaJiJieHao.placeHolder:SetPoint("CENTER", aaDesktop.aaJiJieHao.backView, "CENTER", 0, 0); aaDesktop.aaJiJieHao.placeHolder:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 24); aaDesktop.aaJiJieHao.placeHolder:SetText(aaData.color_red.."当前无任何活动信息，请先创建一个活动"); end; aaDesktop.aaJiJieHao.titletext1 = aaDesktop.aaJiJieHao.backView:CreateFontString("aaDesktop.aaJiJieHao.titletext1", "OVERLAY", "GameFontNormal") do aaDesktop.aaJiJieHao.titletext1:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.backView, "TOPLEFT", 5, -20); aaDesktop.aaJiJieHao.titletext1:SetWidth(aaDesktop.aaJiJieHao.itemWidth * 5); aaDesktop.aaJiJieHao.titletext1:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJiJieHao.titletext1:SetText(aaData.color_white.."活动信息"); end; aaDesktop.aaJiJieHao.titletext2 = aaDesktop.aaJiJieHao.backView:CreateFontString("aaDesktop.aaJiJieHao.titletext2", "OVERLAY", "GameFontNormal") do aaDesktop.aaJiJieHao.titletext2:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.backView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 5 + 5*2, -20); aaDesktop.aaJiJieHao.titletext2:SetWidth(aaDesktop.aaJiJieHao.itemWidth * 1.5 + 10); aaDesktop.aaJiJieHao.titletext2:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJiJieHao.titletext2:SetText(aaData.color_white.."队长"); end; aaDesktop.aaJiJieHao.titletext3 = aaDesktop.aaJiJieHao.backView:CreateFontString("aaDesktop.aaJiJieHao.titletext3", "OVERLAY", "GameFontNormal") do aaDesktop.aaJiJieHao.titletext3:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.backView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + 5*5, -20); aaDesktop.aaJiJieHao.titletext3:SetWidth(aaDesktop.aaJiJieHao.itemWidth * 3); aaDesktop.aaJiJieHao.titletext3:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJiJieHao.titletext3:SetText(aaData.color_white.."队伍"); end; aaDesktop.aaJiJieHao.titletext3 = aaDesktop.aaJiJieHao.backView:CreateFontString("aaDesktop.aaJiJieHao.titletext3", "OVERLAY", "GameFontNormal") do aaDesktop.aaJiJieHao.titletext3:SetPoint("TOPLEFT", aaDesktop.aaJiJieHao.backView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 9.5 + 5*6, -20); aaDesktop.aaJiJieHao.titletext3:SetWidth(aaDesktop.aaJiJieHao.itemWidth * 1 + 10); aaDesktop.aaJiJieHao.titletext3:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); aaDesktop.aaJiJieHao.titletext3:SetText(aaData.color_white.."开启时间"); end; aaDesktop.aaJiJieHao.createButton = CreateFrame('Button', nil, aaDesktop.aaJiJieHao.backView, 'UIPanelButtonTemplate') do aaDesktop.aaJiJieHao.createButton:SetPoint('TOPLEFT', aaDesktop.aaJiJieHao.backView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 10.5 + 5*8, -14); aaDesktop.aaJiJieHao.createButton:SetSize(aaDesktop.aaJiJieHao.itemWidth * 1.5, 30); aaDesktop.aaJiJieHao.createButton:SetText("创建活动"); aaDesktop.aaJiJieHao.createButton:SetScript('OnClick', function() aaDesktop.aaJiJieHao:hide(); aaDesktop.aaJiJieHao:showMenu(); end); end; aaDesktop.aaJiJieHao.ScrollView = CreateFrame("ScrollFrame", "aaDesktop.aaJiJieHao.ScrollView", aaDesktop.aaJiJieHao.backView) do aaDesktop.aaJiJieHao.ScrollView:EnableMouseWheel(true); aaDesktop.aaJiJieHao.ScrollView:EnableMouse(true); aaDesktop.aaJiJieHao.ScrollView:SetMovable(true); aaDesktop.aaJiJieHao.ScrollView:SetSize(aaDesktop.aaJiJieHao.width, aaDesktop.aaJiJieHao.height - 54); aaDesktop.aaJiJieHao.ScrollView:RegisterForDrag('LeftButton'); aaDesktop.aaJiJieHao.ScrollView:SetPoint('TOPLEFT', 0, -54); InterfaceOptions_AddCategory(aaDesktop.aaJiJieHao.ScrollView); end; aaDesktop.aaJiJieHao.mainView = CreateFrame("Frame","aaDesktop.aaJiJieHao.mainView",aaDesktop.aaJiJieHao.ScrollView) do aaDesktop.aaJiJieHao.ScrollView:SetScrollChild(aaDesktop.aaJiJieHao.mainView); aaDesktop.aaJiJieHao.mainView:EnableMouse(true); aaDesktop.aaJiJieHao.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaJiJieHao.mainView:SetWidth(aaDesktop.aaJiJieHao.width); aaDesktop.aaJiJieHao.mainView:SetHeight(aaDesktop.aaJiJieHao.height - 54); aaDesktop.aaJiJieHao.mainView:SetPoint("TOPLEFT",0,0); aaDesktop.aaJiJieHao.mainView:Show(); end; aaDesktop.aaJiJieHao.slider = CreateFrame("Slider", "aaDesktop.aaJiJieHao.slider", aaDesktop.aaJiJieHao.backView, "OptionsSliderTemplate") do aaDesktop.aaJiJieHao.slider:SetWidth(30); aaDesktop.aaJiJieHao.slider:SetPoint('TOPLEFT', aaDesktop.aaJiJieHao.backView, 'TOPLEFT', aaDesktop.aaJiJieHao.width, -34); aaDesktop.aaJiJieHao.slider:SetHeight(aaDesktop.aaJiJieHao.height-34); aaDesktop.aaJiJieHao.slider:SetOrientation('VERTICAL'); aaDesktop.aaJiJieHao.slider:SetOrientation('HORIZONTAL'); aaDesktop.aaJiJieHao.slider.tooltipText = ""; getglobal(aaDesktop.aaJiJieHao.slider:GetName() .. 'Low'):Hide(); getglobal(aaDesktop.aaJiJieHao.slider:GetName() .. 'High'):Hide(); getglobal(aaDesktop.aaJiJieHao.slider:GetName() .. 'Text'):Hide(); aaDesktop.aaJiJieHao.slider:SetThumbTexture("Interface\\AddOns\\aaAddon\\Icons\\aa_dropIco"); aaDesktop.aaJiJieHao.slider:SetMovable(true); aaDesktop.aaJiJieHao.slider:EnableMouseWheel(true); aaDesktop.aaJiJieHao.slider:RegisterForDrag('LeftButton'); aaDesktop.aaJiJieHao.slider:SetOrientation("VERTICAL"); aaDesktop.aaJiJieHao.slider:SetValueStep(9); aaDesktop.aaJiJieHao.slider:SetMinMaxValues(0, aaDesktop.aaJiJieHao.height-34); aaDesktop.aaJiJieHao.slider:SetValue(0); aaDesktop.aaJiJieHao.slider:SetScript("OnValueChanged", function(self, value) aaDesktop.aaJiJieHao.ScrollView:SetVerticalScroll(value); end); end; aaDesktop.aaJiJieHao.backView4:SetScript("OnMouseWheel", function(self, delta) local Value = aaDesktop.aaJiJieHao.slider:GetValue(); if (delta < 0) then aaDesktop.aaJiJieHao.slider:SetValue(Value + 27); else aaDesktop.aaJiJieHao.slider:SetValue(Value - 27); end; end); function aaDesktop.aaJiJieHao:CreateCell(index,id,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaJiJieHao.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(aaDesktop.aaJiJieHao.width); menuView:SetHeight(54); menuView:SetPoint("TOPLEFT",aaDesktop.aaJiJieHao.mainView,'TOPLEFT',x,y); menuView:Show(); end; menuView.backView = CreateFrame("Frame","menuView.backView",menuView) do menuView.backView:SetBackdrop( { edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border", edgeSize = 16, insets = { left = 1, right = 1, top = 1, bottom = 1 } }); menuView.backView:SetPoint("TOPLEFT", menuView, "TOPLEFT",10,0); menuView.backView:SetWidth(aaDesktop.aaJiJieHao.width-20); menuView.backView:SetHeight(54); end; menuView.iconView = CreateFrame('Button', nil, menuView, '') do menuView.iconView:SetPoint('TOPLEFT', menuView, 'TOPLEFT', 20, -5); menuView.iconView:SetButtonState('NORMAL'); menuView.iconView:IsEnabled(); menuView.iconView:SetWidth(44); menuView.iconView:SetHeight(44); end; menuView.nameText = menuView:CreateFontString("menuView.nameText", "OVERLAY", "GameFontNormal") do menuView.nameText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.nameText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 44+15+10,-5); menuView.nameText:SetHeight(20); end; menuView.titleText = menuView:CreateFontString("menuView.titleText", "OVERLAY", "GameFontNormal") do menuView.titleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.titleText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 44+15+10, -25); menuView.titleText:SetHeight(20); end; menuView.duizhangText = menuView:CreateFontString("menuView.duizhangText", "OVERLAY", "GameFontNormal") do menuView.duizhangText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 18); menuView.duizhangText:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 5 + 5*2, -5); menuView.duizhangText:SetHeight(44); menuView.duizhangText:SetWidth(aaDesktop.aaJiJieHao.itemWidth*1.5 + 10); end; local itemWiteh = 18; local fontSize = 14; menuView.icon1 = CreateFrame('Button', nil, menuView, '') do menuView.icon1:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + 5*5, -5); menuView.icon1:SetSize(itemWiteh, itemWiteh); local icontxt = aaData.class_spellicon[1]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon1:SetNormalTexture(icon); menuView.icon1:SetText(""); end; menuView.count1 = menuView:CreateFontString("menuView.count1", "OVERLAY", "GameFontNormal") do menuView.count1:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count1:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + itemWiteh + 5*5, -5); menuView.count1:SetHeight(itemWiteh); menuView.count1:SetWidth(itemWiteh); menuView.count1:SetText("3"); end; menuView.icon2 = CreateFrame('Button', nil, menuView, '') do menuView.icon2:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*1 + 5*5, -5); menuView.icon2:SetSize(itemWiteh, itemWiteh); local icontxt = aaData.class_spellicon[2]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon2:SetNormalTexture(icon); menuView.icon2:SetText(""); end; menuView.count2 = menuView:CreateFontString("menuView.count2", "OVERLAY", "GameFontNormal") do menuView.count2:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count2:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*1 + itemWiteh + 5*5, -5); menuView.count2:SetHeight(itemWiteh); menuView.count2:SetWidth(itemWiteh); menuView.count2:SetText("5"); end; menuView.icon3 = CreateFrame('Button', nil, menuView, '') do menuView.icon3:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*2 + 5*5, -5); menuView.icon3:SetSize(itemWiteh, itemWiteh); local icontxt = aaData.class_spellicon[3]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon3:SetNormalTexture(icon); menuView.icon3:SetText(""); end; menuView.count3 = menuView:CreateFontString("menuView.count3", "OVERLAY", "GameFontNormal") do menuView.count3:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count3:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*2 +itemWiteh + 5*5, -5); menuView.count3:SetHeight(itemWiteh); menuView.count3:SetWidth(itemWiteh); menuView.count3:SetText(aaData.color_white.."0"); end; menuView.icon4 = CreateFrame('Button', nil, menuView, '') do menuView.icon4:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*3 + 5*5, -5); menuView.icon4:SetSize(itemWiteh, itemWiteh); local icontxt = aaData.class_spellicon[4]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon4:SetNormalTexture(icon); menuView.icon4:SetText(""); end; menuView.count4 = menuView:CreateFontString("menuView.count4", "OVERLAY", "GameFontNormal") do menuView.count4:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count4:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*3 +itemWiteh + 5*5, -5); menuView.count4:SetHeight(itemWiteh); menuView.count4:SetWidth(itemWiteh); menuView.count4:SetText(aaData.color_white.."0"); end; menuView.icon5 = CreateFrame('Button', nil, menuView, '') do menuView.icon5:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*4 + 5*5, -5); menuView.icon5:SetSize(itemWiteh, itemWiteh); local icontxt = aaData.class_spellicon[5]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon5:SetNormalTexture(icon); menuView.icon5:SetText(""); end; menuView.count5 = menuView:CreateFontString("menuView.count5", "OVERLAY", "GameFontNormal") do menuView.count5:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count5:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*4 +itemWiteh + 5*5, -5); menuView.count5:SetHeight(itemWiteh); menuView.count5:SetWidth(itemWiteh); menuView.count5:SetText(aaData.color_white.."0"); end; menuView.icon6 = CreateFrame('Button', nil, menuView, '') do menuView.icon6:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + 5*5, -32); menuView.icon6:SetSize(18, 18); local icontxt = aaData.class_spellicon[6]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon6:SetNormalTexture(icon); menuView.icon6:SetText(""); end; menuView.count6 = menuView:CreateFontString("menuView.count6", "OVERLAY", "GameFontNormal") do menuView.count6:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count6:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + itemWiteh + 5*5, -32); menuView.count6:SetHeight(itemWiteh); menuView.count6:SetWidth(itemWiteh); menuView.count6:SetText(aaData.color_white.."0"); end; menuView.icon7 = CreateFrame('Button', nil, menuView, '') do menuView.icon7:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*1 + 5*5, -32); menuView.icon7:SetSize(itemWiteh, itemWiteh); local icontxt = aaData.class_spellicon[7]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon7:SetNormalTexture(icon); menuView.icon7:SetText(""); end; menuView.count7 = menuView:CreateFontString("menuView.count7", "OVERLAY", "GameFontNormal") do menuView.count7:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count7:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*1 + itemWiteh + 5*5, -32); menuView.count7:SetHeight(itemWiteh); menuView.count7:SetWidth(itemWiteh); menuView.count7:SetText(aaData.color_white.."0"); end; menuView.icon8 = CreateFrame('Button', nil, menuView, '') do menuView.icon8:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*2 + 5*5, -32); menuView.icon8:SetSize(itemWiteh, itemWiteh); local icontxt = aaData.class_spellicon[8]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon8:SetNormalTexture(icon); menuView.icon8:SetText(""); end; menuView.count8 = menuView:CreateFontString("menuView.count8", "OVERLAY", "GameFontNormal") do menuView.count8:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count8:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*2 +itemWiteh + 5*5, -32); menuView.count8:SetHeight(itemWiteh); menuView.count8:SetWidth(itemWiteh); menuView.count8:SetText(aaData.color_white.."0"); end; menuView.icon9 = CreateFrame('Button', nil, menuView, '') do menuView.icon9:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*3 + 5*5, -32); menuView.icon9:SetSize(itemWiteh, itemWiteh); local icontxt = aaData.class_spellicon[9]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon9:SetNormalTexture(icon); menuView.icon9:SetText(""); end; menuView.count9 = menuView:CreateFontString("menuView.count9", "OVERLAY", "GameFontNormal") do menuView.count9:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count9:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*3 +itemWiteh + 5*5, -32); menuView.count9:SetHeight(itemWiteh); menuView.count9:SetWidth(itemWiteh); menuView.count9:SetText(aaData.color_white.."0"); end; menuView.icon10 = CreateFrame('Button', nil, menuView, '') do menuView.icon10:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*4 + 5*5, -32); menuView.icon10:SetSize(itemWiteh, itemWiteh); local icontxt = aaData.class_spellicon[11]; local icon = "Interface\\AddOns\\aaAddon\\Icons\\"..icontxt; menuView.icon10:SetNormalTexture(icon); menuView.icon10:SetText(""); end; menuView.count10 = menuView:CreateFontString("menuView.count10", "OVERLAY", "GameFontNormal") do menuView.count10:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", fontSize); menuView.count10:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 6.5 + (itemWiteh+itemWiteh)*4 +itemWiteh + 5*5, -32); menuView.count10:SetHeight(itemWiteh); menuView.count10:SetWidth(itemWiteh); menuView.count10:SetText(aaData.color_white.."0"); end; menuView.timeText = menuView:CreateFontString("menuView.timeText", "OVERLAY", "GameFontNormal") do menuView.timeText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.timeText:SetPoint("TOPLEFT", menuView, "TOPLEFT", aaDesktop.aaJiJieHao.itemWidth * 9.5 + 5*7, -5); menuView.timeText:SetHeight(44); menuView.timeText:SetWidth(aaDesktop.aaJiJieHao.itemWidth); menuView.timeText:SetText("2:00"); end; menuView.zuduiButton = CreateFrame('Button', nil, menuView, 'UIPanelButtonTemplate') do menuView.zuduiButton:SetPoint('TOPLEFT', menuView, 'TOPLEFT', aaDesktop.aaJiJieHao.itemWidth * 10.5 + 5*8, -12); menuView.zuduiButton:SetSize(aaDesktop.aaJiJieHao.itemWidth * 1.5, 30); menuView.zuduiButton:SetText("加入活动"); menuView.zuduiButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); local text = menuView.zuduiButton:GetText(); if text == "加入活动" then aaData:sendAddonMsg(3053, index, "GUILD"); else aaData:sendAddonMsg(3054, index, "GUILD"); end; end); end; return menuView; end; aaDesktop.aaJiJieHao.CancelButton = CreateFrame('Button', nil, aaDesktop.aaJiJieHao.backView4, 'UIPanelCloseButton') do aaDesktop.aaJiJieHao.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaJiJieHao.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaJiJieHao.backView4, 'TOPRIGHT', 0, 0); aaDesktop.aaJiJieHao.CancelButton:SetSize(34, 34); aaDesktop.aaJiJieHao.CancelButton:SetScript('OnClick', function() aaData:sendAddonMsg(10110,"2", "GUILD"); aaDesktop.aaJiJieHao:hide(); end); end;  function aaDesktop.aaJiJieHao:reload() aaDesktop.aaJiJieHao.aaJiJieHao_dur = 0; aaDesktop.aaJiJieHao.slider:SetMinMaxValues(0, #aa_ui_jijie2 * 54 * 0.5); aaDesktop.aaJiJieHao.mainView:SetHeight(#aa_ui_jijie2 * 54); if #aa_ui_jijie2 > 0 then aaDesktop.aaJiJieHao.placeHolder:Hide(); else aaDesktop.aaJiJieHao.placeHolder:Show(); end; for i=1,#aaDesktop.aaJiJieHao.listView do aaDesktop.aaJiJieHao.listView[i]:Hide(); aaDesktop.aaJiJieHao.listView[i] = nil; end; for i=1,#aa_ui_jijie2 do aaDesktop.aaJiJieHao.listView[i] = aaDesktop.aaJiJieHao:CreateCell(i,i,0,-(54+5)*(i-1)); end; local index = 0; local isOk = 0; for k,v in pairs(aa_ui_jijie2) do local index = k; if v[5] ~= nil then local id = v[1]; if aa_ui_jijie1[id] ~= nil then local vv = aa_ui_jijie1[id]; if vv[4] ~= nil then local id = vv[1]; local icon = vv[2]; local name = vv[3]; local title = vv[4]; aaDesktop.aaJiJieHao.listView[index].nameText:SetText(name); aaDesktop.aaJiJieHao.listView[index].iconView:SetNormalTexture(icon); end; end; local title = v[2]; local name = v[3]; local duiwu1 = v[4]; local duiwu2 = v[5]; local duiwu3 = v[6]; local duiwu4 = v[7]; local duiwu5 = v[8]; local duiwu6 = v[9]; local duiwu7 = v[10]; local duiwu8 = v[11]; local duiwu9 = v[12]; local duiwu10 = v[13]; local isJiaru = v[14]; local time = v[15]; aaDesktop.aaJiJieHao.listView[index].titleText:SetText(aaData.color_white..title); aaDesktop.aaJiJieHao.listView[index].duizhangText:SetText(name); local msg = ""; if time < 60 then msg = aaData.color_red..aaData:secondsTox(time); else msg = aaData.color_white..aaData:secondsTox(time); end; aaDesktop.aaJiJieHao.listView[index].timeText:SetText(msg); if duiwu1 == 0 then duiwu1 = aaData.color_white..duiwu1; end; if duiwu2 == 0 then duiwu2 = aaData.color_white..duiwu2; end; if duiwu3 == 0 then duiwu3 = aaData.color_white..duiwu3; end; if duiwu4 == 0 then duiwu4 = aaData.color_white..duiwu4; end; if duiwu5 == 0 then duiwu5 = aaData.color_white..duiwu5; end; if duiwu6 == 0 then duiwu6 = aaData.color_white..duiwu6; end; if duiwu7 == 0 then duiwu7 = aaData.color_white..duiwu7; end; if duiwu8 == 0 then duiwu8 = aaData.color_white..duiwu8; end; if duiwu9 == 0 then duiwu9 = aaData.color_white..duiwu9; end; if duiwu10 == 0 then duiwu10 = aaData.color_white..duiwu10; end; aaDesktop.aaJiJieHao.listView[index].count1:SetText(duiwu1); aaDesktop.aaJiJieHao.listView[index].count2:SetText(duiwu2); aaDesktop.aaJiJieHao.listView[index].count3:SetText(duiwu3); aaDesktop.aaJiJieHao.listView[index].count4:SetText(duiwu4); aaDesktop.aaJiJieHao.listView[index].count5:SetText(duiwu5); aaDesktop.aaJiJieHao.listView[index].count6:SetText(duiwu6); aaDesktop.aaJiJieHao.listView[index].count7:SetText(duiwu7); aaDesktop.aaJiJieHao.listView[index].count8:SetText(duiwu8); aaDesktop.aaJiJieHao.listView[index].count9:SetText(duiwu9); aaDesktop.aaJiJieHao.listView[index].count10:SetText(duiwu10); if isJiaru == 1 then aaDesktop.aaJiJieHao.listView[index].zuduiButton:SetText("离开活动"); isOk = 1; else aaDesktop.aaJiJieHao.listView[index].zuduiButton:SetText("加入活动"); end; index = index + 1; end; end; if isOk == 1 then for i=1,#aa_ui_jijie2 do local btn = aaDesktop.aaJiJieHao.listView[i].zuduiButton; if btn:GetText() == "离开活动" then btn:Enable(); else btn:Disable(); end; end; aaDesktop.aaJiJieHao.createButton:Disable(); else aaDesktop.aaJiJieHao.createButton:Enable(); end; end;  aaDesktop.aaJiJieHao.aaJiJieHao_time = 0; aaDesktop.aaJiJieHao.aaJiJieHao_dur = 0; local function aaJiJieHaoUpdate(btn, elapsed) if aaDesktop.aaJiJieHao.backView:IsShown() then else return; end; local time2 = GetTime()-aaDesktop.aaJiJieHao.aaJiJieHao_time; if time2 >= 1 then aaDesktop.aaJiJieHao.aaJiJieHao_time = GetTime(); aaDesktop.aaJiJieHao.aaJiJieHao_dur = aaDesktop.aaJiJieHao.aaJiJieHao_dur + 1; local index = 0; for k,v in pairs(aa_ui_jijie2) do local index = k; if v[15] ~= nil then local id = v[1]; local time = v[15]; time = time - aaDesktop.aaJiJieHao.aaJiJieHao_dur; if time < 0 then time = 0; end; local msg = ""; if time < 60 then msg = aaData.color_red..aaData:secondsTox(time); else msg = aaData.color_white..aaData:secondsTox(time); end; aaDesktop.aaJiJieHao.listView[index].timeText:SetText(msg); end; end; end; end; function aaDesktop.aaJiJieHao:show() aaDesktop.aaJiJieHao.backView4:Show(); end; function aaDesktop.aaJiJieHao:hide() aaDesktop.aaJiJieHao.backView4:Hide(); end;     aaDesktop.aaXilian.width = 384; aaDesktop.aaXilian.height = 512; aaDesktop.aaXilian.listView = {}; aaDesktop.aaXilian.selectItemId = 0; aaDesktop.aaXilian.selectItemEntry = 0; aaDesktop.aaXilian.selectItemLink = nil; aaDesktop.aaXilian.spells = {}; aaDesktop.aaXilian.values = {}; aaDesktop.aaXilian.selectMenu = 0; aaDesktop.aaXilian.backView4 = CreateFrame("Frame","aaDesktop.aaXilian.backView4",UIParent) do aaDesktop.aaXilian.backView4:SetFrameStrata("TOOLTIP"); aaDesktop.aaXilian.backView4:SetBackdrop( { edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border", edgeSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); aaDesktop.aaXilian.backView4:SetWidth(aaDesktop.aaXilian.width+30); aaDesktop.aaXilian.backView4:SetHeight(aaDesktop.aaXilian.height); aaDesktop.aaXilian.backView4:SetPoint("CENTER",0,0); aaDesktop.aaXilian.backView4:EnableMouseWheel(true); aaDesktop.aaXilian.backView4:SetToplevel(true); aaDesktop.aaXilian.backView4:SetClampedToScreen(true); aaDesktop.aaXilian.backView4:SetMovable(true); aaDesktop.aaXilian.backView4:EnableMouse(true); aaDesktop.aaXilian.backView4:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaXilian.backView4:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaXilian.backView4:Show(); tinsert(UISpecialFrames, "aaDesktop.aaXilian.backView4"); end; aaDesktop.aaXilian.backView1 = CreateFrame("Frame","aaDesktop.aaXilian.backView1",aaDesktop.aaXilian.backView4) do aaDesktop.aaXilian.backView1:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-xl-bg1"}); aaDesktop.aaXilian.backView1:SetPoint("TOPLEFT", aaDesktop.aaXilian.backView4, "TOPLEFT",0,0); aaDesktop.aaXilian.backView1:SetWidth(256); aaDesktop.aaXilian.backView1:SetHeight(aaDesktop.aaXilian.height); end; aaDesktop.aaXilian.backView2 = CreateFrame("Frame","aaDesktop.aaXilian.backView2",aaDesktop.aaXilian.backView4) do aaDesktop.aaXilian.backView2:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-xl-bg2"}); aaDesktop.aaXilian.backView2:SetPoint("TOPLEFT", aaDesktop.aaXilian.backView4, "TOPLEFT",256,0); aaDesktop.aaXilian.backView2:SetWidth(aaDesktop.aaXilian.width-256); aaDesktop.aaXilian.backView2:SetHeight(aaDesktop.aaXilian.height); end; aaDesktop.aaXilian.backView = CreateFrame("Frame","aaDesktop.aaXilian.backView",aaDesktop.aaXilian.backView4) do aaDesktop.aaXilian.backView:SetPoint("TOPLEFT", aaDesktop.aaXilian.backView4, "TOPLEFT",0,0); aaDesktop.aaXilian.backView:SetWidth(aaDesktop.aaXilian.width); aaDesktop.aaXilian.backView:SetHeight(aaDesktop.aaXilian.height); end; aaDesktop.aaXilian.titletext = aaDesktop.aaXilian.backView:CreateFontString("titletext", "OVERLAY", "GameFontNormal") do aaDesktop.aaXilian.titletext:SetPoint("TOPLEFT", aaDesktop.aaXilian.backView, "TOPLEFT", 35, -94); aaDesktop.aaXilian.titletext:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 14); aaDesktop.aaXilian.titletext:SetText("|cFF00FFFF锁|r|cFF00D9FF定|r|cFF00B3FF洗|r|cFF008DFF炼|r|cFFFF8000：放入需要洗炼的装备。|r"); end; aaDesktop.aaXilian.titleButton1 = CreateFrame('Button', nil, aaDesktop.aaXilian.backView, '') do aaDesktop.aaXilian.titleButton1:SetPoint('TOPLEFT', aaDesktop.aaXilian.backView, 'TOPLEFT', -36, -45); aaDesktop.aaXilian.titleButton1:SetSize(50, 50); aaDesktop.aaXilian.titleButton1:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-xl-1"); aaDesktop.aaXilian.titleButton1:SetScript('OnClick', function() aaDesktop.aaXilian.selectMenu = 0; aaDesktop.aaXilian:reload(); aaData:setTextureFetter(aaDesktop.aaXilian.titleButton1, "Interface\\AddOns\\aaAddon\\Icons\\aa-xl-1", false); aaData:setTextureFetter(aaDesktop.aaXilian.titleButton2, "Interface\\AddOns\\aaAddon\\Icons\\aa-xl-2", true); end); aaDesktop.aaXilian.titleButton1:SetScript('OnEnter', function() if (not GameTooltip:IsVisible()) then GameTooltip:SetOwner(aaDesktop.aaXilian.titleButton1, "ANCHOR_NONE"); end GameTooltip:SetPoint("BOTTOMRIGHT",aaDesktop.aaXilian.titleButton1,"BOTTOMLEFT"); GameTooltip:SetText("词条洗炼"); GameTooltip:SetToplevel(true); GameTooltip:Show(); end); aaDesktop.aaXilian.titleButton1:SetScript('OnLeave', function() GameTooltip:Hide(); end); end; aaDesktop.aaXilian.titleButton2 = CreateFrame('Button', nil, aaDesktop.aaXilian.backView, '') do aaDesktop.aaXilian.titleButton2:SetPoint('TOPLEFT', aaDesktop.aaXilian.backView, 'TOPLEFT', -36, -93); aaDesktop.aaXilian.titleButton2:SetSize(50, 50); aaDesktop.aaXilian.titleButton2:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-xl-2"); aaDesktop.aaXilian.titleButton2:SetScript('OnClick', function() aaDesktop.aaXilian.selectMenu = 1; aaDesktop.aaXilian:reload(); aaData:setTextureFetter(aaDesktop.aaXilian.titleButton1, "Interface\\AddOns\\aaAddon\\Icons\\aa-xl-1", true); aaData:setTextureFetter(aaDesktop.aaXilian.titleButton2, "Interface\\AddOns\\aaAddon\\Icons\\aa-xl-2", false); end); aaDesktop.aaXilian.titleButton2:SetScript('OnEnter', function() if (not GameTooltip:IsVisible()) then GameTooltip:SetOwner(aaDesktop.aaXilian.titleButton2, "ANCHOR_NONE"); end GameTooltip:SetPoint("BOTTOMRIGHT",aaDesktop.aaXilian.titleButton2,"BOTTOMLEFT"); GameTooltip:SetText("属性洗炼"); GameTooltip:SetToplevel(true); GameTooltip:Show(); end); aaDesktop.aaXilian.titleButton2:SetScript('OnLeave', function() GameTooltip:Hide(); end); local image = GetItemIcon(itemId); aaData:setTextureFetter(aaDesktop.aaXilian.titleButton2, "Interface\\AddOns\\aaAddon\\Icons\\aa-xl-2", true); end; aaDesktop.aaXilian.cishuText = aaDesktop.aaXilian.backView:CreateFontString("aaDesktop.aaXilian.cishuText", "OVERLAY", "GameFontNormal") do aaDesktop.aaXilian.cishuText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 14); aaDesktop.aaXilian.cishuText:SetPoint("TOPLEFT", aaDesktop.aaXilian.backView, "TOPLEFT", 35, -410); end; aaDesktop.aaXilian.needText = aaDesktop.aaXilian.backView:CreateFontString("aaDesktop.aaXilian.needText", "OVERLAY", "GameFontNormal") do aaDesktop.aaXilian.needText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 14); aaDesktop.aaXilian.needText:SetPoint("TOPLEFT", aaDesktop.aaXilian.backView, "TOPLEFT", 35, -429); end; aaDesktop.aaXilian.doneButton = CreateFrame('Button', nil, aaDesktop.aaXilian.backView, 'UIPanelButtonTemplate') do aaDesktop.aaXilian.doneButton:SetPoint('TOPLEFT', aaDesktop.aaXilian.backView, 'TOPLEFT', 137, -470); aaDesktop.aaXilian.doneButton:SetSize(110, 30); aaDesktop.aaXilian.doneButton:SetText("开始洗炼"); aaDesktop.aaXilian.doneButton:SetScript('OnClick', function() if aaDesktop.aaXilian.selectItemEntry == 0 then return; end; if aaDesktop.aaXilian.selectMenu == 0 then aaData:sendAddonMsg(3063, aaDesktop.aaXilian.selectItemId.."\t"..aaDesktop.aaXilian.selectItemEntry, "GUILD"); elseif aaDesktop.aaXilian.selectMenu == 1 then aaData:sendAddonMsg(3064, aaDesktop.aaXilian.selectItemId.."\t"..aaDesktop.aaXilian.selectItemEntry, "GUILD"); end; end); end; aaDesktop.aaXilian.ScrollView = CreateFrame("ScrollFrame", "aaDesktop.aaXilian.ScrollView", aaDesktop.aaXilian.backView) do aaDesktop.aaXilian.ScrollView:EnableMouseWheel(true); aaDesktop.aaXilian.ScrollView:EnableMouse(true); aaDesktop.aaXilian.ScrollView:SetMovable(true); aaDesktop.aaXilian.ScrollView:SetSize(aaDesktop.aaXilian.width, aaDesktop.aaXilian.height - 95 - 120 - 30); aaDesktop.aaXilian.ScrollView:RegisterForDrag('LeftButton'); aaDesktop.aaXilian.ScrollView:SetPoint('TOPLEFT', 30, -125); InterfaceOptions_AddCategory(aaDesktop.aaXilian.ScrollView); end; aaDesktop.aaXilian.mainView = CreateFrame("Frame","aaDesktop.aaXilian.mainView",aaDesktop.aaXilian.ScrollView) do aaDesktop.aaXilian.ScrollView:SetScrollChild(aaDesktop.aaXilian.mainView); aaDesktop.aaXilian.mainView:EnableMouse(true); aaDesktop.aaXilian.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaXilian.mainView:SetWidth(aaDesktop.aaXilian.width); aaDesktop.aaXilian.mainView:SetHeight(aaDesktop.aaXilian.height - 54); aaDesktop.aaXilian.mainView:SetPoint("TOPLEFT",0,0); aaDesktop.aaXilian.mainView:Show(); end; aaDesktop.aaXilian.ItemButton = CreateFrame('Button', nil, aaDesktop.aaXilian.backView, '') do aaDesktop.aaXilian.ItemButton:SetPoint('TOPLEFT', aaDesktop.aaXilian.backView, 'TOPLEFT', 173, -36); aaDesktop.aaXilian.ItemButton:SetSize(40, 40); aaDesktop.aaXilian.ItemButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-choujiang-cao"); aaDesktop.aaXilian.ItemButton:SetScript('OnClick', function() local infoType, _, itemLink = GetCursorInfo(); if (infoType == "item") then aaDesktop.aaXilian.selectItemLink = itemLink; local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itementry, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; aaDesktop.aaXilian.selectItemId = suffixId - 0; aaDesktop.aaXilian.selectItemEntry = itementry + 0; if aaDesktop.aaXilian.selectItemEntry > 0 then local icon = GetItemIcon(itementry); aaDesktop.aaXilian.ItemButton:SetNormalTexture(icon); ClearCursor(); end; else aaDesktop.aaXilian.ItemButton:SetNormalTexture(""); aaDesktop.aaXilian.selectItemLink = nil; aaDesktop.aaXilian.selectItemId = 0; aaDesktop.aaXilian.selectItemEntry = 0; aaDesktop.aaXilian.slider:SetMinMaxValues(0, 0); aaDesktop.aaXilian.cishuText:SetText(""); aaDesktop.aaXilian.needText:SetText(""); end; aaDesktop.aaXilian:reload(); end); aaDesktop.aaXilian.ItemButton:SetScript('OnEnter', function() if aaDesktop.aaXilian.selectItemLink ~= nil then if (not GameTooltip:IsVisible()) then GameTooltip:SetOwner(aaDesktop.aaXilian.ItemButton, "ANCHOR_NONE"); end GameTooltip:SetPoint("BOTTOMLEFT",aaDesktop.aaXilian.ItemButton,"TOPRIGHT"); GameTooltip:SetHyperlink(aaDesktop.aaXilian.selectItemLink); GameTooltip:SetToplevel(true); GameTooltip:Show(); end; end); aaDesktop.aaXilian.ItemButton:SetScript('OnLeave', function() GameTooltip:Hide(); end); aaDesktop.aaXilian.ItemButton:Show(); end; aaDesktop.aaXilian.slider = CreateFrame("Slider", "aaDesktop.aaXilian.slider", aaDesktop.aaXilian.backView, "OptionsSliderTemplate") do aaDesktop.aaXilian.slider:SetWidth(30); aaDesktop.aaXilian.slider:SetPoint('TOPLEFT', aaDesktop.aaXilian.backView, 'TOPLEFT', aaDesktop.aaXilian.width, -34); aaDesktop.aaXilian.slider:SetHeight(aaDesktop.aaXilian.height-34); aaDesktop.aaXilian.slider:SetOrientation('VERTICAL'); aaDesktop.aaXilian.slider:SetOrientation('HORIZONTAL'); aaDesktop.aaXilian.slider.tooltipText = ""; getglobal(aaDesktop.aaXilian.slider:GetName() .. 'Low'):Hide(); getglobal(aaDesktop.aaXilian.slider:GetName() .. 'High'):Hide(); getglobal(aaDesktop.aaXilian.slider:GetName() .. 'Text'):Hide(); aaDesktop.aaXilian.slider:SetThumbTexture("Interface\\AddOns\\aaAddon\\Icons\\aa_dropIco"); aaDesktop.aaXilian.slider:SetMovable(true); aaDesktop.aaXilian.slider:EnableMouseWheel(true); aaDesktop.aaXilian.slider:RegisterForDrag('LeftButton'); aaDesktop.aaXilian.slider:SetOrientation("VERTICAL"); aaDesktop.aaXilian.slider:SetValueStep(9); aaDesktop.aaXilian.slider:SetMinMaxValues(0, aaDesktop.aaXilian.height-54); aaDesktop.aaXilian.slider:SetValue(0); aaDesktop.aaXilian.slider:SetScript("OnValueChanged", function(self, value) aaDesktop.aaXilian.ScrollView:SetVerticalScroll(value); end); end; aaDesktop.aaXilian.backView4:SetScript("OnMouseWheel", function(self, delta) local Value = aaDesktop.aaXilian.slider:GetValue(); if (delta < 0) then aaDesktop.aaXilian.slider:SetValue(Value + 27); else aaDesktop.aaXilian.slider:SetValue(Value - 27); end; end); function aaDesktop.aaXilian:CreateCell(index,id,x,y) local menuView = CreateFrame("Frame",nil,aaDesktop.aaXilian.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(aaDesktop.aaXilian.width); menuView:SetHeight(54); menuView:SetPoint("TOPLEFT",aaDesktop.aaXilian.mainView,'TOPLEFT',x+5,y); menuView:Hide(); end; menuView.backView = CreateFrame("Frame","menuView.backView",menuView) do menuView.backView:SetBackdrop({ edgeFile = 'Interface\\Tooltips\\UI-Tooltip-Border', tile = true, edgeSize = 16, tileSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); menuView.backView:SetPoint("TOPLEFT", menuView, "TOPLEFT",10,0); menuView.backView:SetWidth(aaDesktop.aaXilian.width-90); menuView.backView:SetHeight(54); end; menuView.titleText = menuView:CreateFontString("menuView.titleText", "OVERLAY", "GameFontNormal") do menuView.titleText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 14); menuView.titleText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 15, -2); menuView.titleText:SetWidth(aaDesktop.aaXilian.width-133); menuView.titleText:SetHeight(50); end; menuView.DoneButton = CreateFrame('Button', nil, menuView.backView, '') do menuView.DoneButton:SetPoint('TOPRIGHT', menuView, 'TOPRIGHT', -83, -7); menuView.DoneButton:SetSize(40, 40); menuView.DoneButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-xl-suo"); menuView.DoneButton:SetScript('OnClick', function() PlaySound("INTERFACESOUND_GAMESCROLLBUTTON", "Master"); if aaDesktop.aaXilian.selectMenu == 0 then aaData:sendAddonMsg(3061, aaDesktop.aaXilian.selectItemId.."\t"..aaDesktop.aaXilian.selectItemEntry.."\t"..index-1, "GUILD"); elseif aaDesktop.aaXilian.selectMenu == 1 then aaData:sendAddonMsg(3062, aaDesktop.aaXilian.selectItemId.."\t"..aaDesktop.aaXilian.selectItemEntry.."\t"..index-1, "GUILD"); end; end); end; return menuView; end; aaDesktop.aaXilian.CancelButton = CreateFrame('Button', nil, aaDesktop.aaXilian.backView4, 'UIPanelCloseButton') do aaDesktop.aaXilian.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaXilian.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaXilian.backView4, 'TOPRIGHT', 0, 0); aaDesktop.aaXilian.CancelButton:SetSize(34, 34); aaDesktop.aaXilian.CancelButton:SetScript('OnClick', function() aaData:sendAddonMsg(10110,"2", "GUILD"); aaDesktop.aaXilian:hide(); aaDesktop.aaXilian.selectItemId = 0; aaDesktop.aaXilian.selectItemEntry = 0; aaDesktop.aaXilian.selectItemLink = nil; aaDesktop.aaXilian.ItemButton:SetNormalTexture(""); end); end; for i=1,30 do aaDesktop.aaXilian.listView[i] = aaDesktop.aaXilian:CreateCell(i,i,0,-(54+5)*(i-1)); end; function aaDesktop.aaXilian:reload() for i=1,#aaDesktop.aaXilian.listView do aaDesktop.aaXilian.listView[i]:Hide(); aaDesktop.aaXilian.listView[i].DoneButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-xl-suo"); end; if aaDesktop.aaXilian.selectItemLink == nil then return; end; local item = aaData:getItem(aaDesktop.aaXilian.selectItemId, aaDesktop.aaXilian.selectItemEntry); if item == nil then return; end; local count = 0; if aaDesktop.aaXilian.selectMenu == 0 then local index_spell = 0; local fumospell = aaData:toVectorInt(item[26]); local values = item[40]; local count_values = aaData:toVectorInt(values); for i=1,#count_values do local isOk = count_values[i] + 0; if isOk == 1 then count = count + 1; aaDesktop.aaXilian.listView[i].DoneButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw-1"); end; end; for i=1,#fumospell do local fwid = fumospell[i] + 0; if fwid and fwid > 0 and spells[fwid] then text = spells[fwid][1]; if text and text ~= "" then index_spell = index_spell + 1; aaDesktop.aaXilian.spells[index_spell] = text; end; end; end; for i=1,index_spell do local text = aaDesktop.aaXilian.spells[i]; aaDesktop.aaXilian.listView[i].titleText:SetText(text); aaDesktop.aaXilian.listView[i]:Show(); end; aaDesktop.aaXilian.slider:SetMinMaxValues(0, #aaDesktop.aaXilian.spells * 54 * 0.5); aaDesktop.aaXilian.cishuText:SetText("剩余洗炼次数："..aaData.color_white..item[29]); local need1 = ""; if item[31] ~= nil then local needid = item[31]; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaXilian"; need1 = aaData:getNeed(needid, 1, 0, count + 1); end; end; aaDesktop.aaXilian.needText:SetText(need1); if #aaDesktop.aaXilian.spells <= count then aaDesktop.aaXilian.doneButton:Disable(); else aaDesktop.aaXilian.doneButton:Enable(); end; elseif aaDesktop.aaXilian.selectMenu == 1 then local fumovalue = aaData:toVectorInt2m(item[28]); local values = item[41]; local count_values = aaData:toVectorInt(values); for i=1,#count_values do local isOk = count_values[i] + 0; if isOk == 1 then count = count + 1; aaDesktop.aaXilian.listView[i].DoneButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\aa-dz-fw-1"); end; end; local index_value = 0; for i,v in pairs(fumovalue) do local fmid = nil; local fmvalue = nil; if v then for k1, v1 in pairs(v) do fmid = k1; fmvalue = v1; end end; local fmtype = nil; if fmid and stats[fmid] then fmtype = stats[fmid][1]; if fmvalue then if fmtype == 999999 then local text = stats[fmid][2]; index_value = index_value + 1; aaDesktop.aaXilian.values[index_value] = text; elseif fmtype == 500 or fmtype == 501 or fmtype == 502 or fmtype == 503 or fmtype == 504 or fmtype == 505 or fmtype == 506 or fmtype == 507 or type == 519 or type == 520  or type == 521  or type == 528  or type == 529  or type == 530 or fmtype == 538 or fmtype == 545 or fmtype == 201 or fmtype == 203 or fmtype == 205 or fmtype == 207 or fmtype == 209 or fmtype == 211 or fmtype == 213 or fmtype == 215 or fmtype == 217 or fmtype == 219 or fmtype == 221 or fmtype == 228 or fmtype == 229 or fmtype == 230 or fmtype == 301 or fmtype == 303 or fmtype == 305 or fmtype == 307 or fmtype == 309 or fmtype == 311 or fmtype == 313 or fmtype == 315 or fmtype == 317 or fmtype == 319 or fmtype == 321 or fmtype == 328 or fmtype == 329 or fmtype == 330 or fmtype == 400 or fmtype == 401 or fmtype == 403 or fmtype == 405 or fmtype == 406 or fmtype == 500 or fmtype == 501 or fmtype == 503 or fmtype == 504 or fmtype == 505 or fmtype == 506 or fmtype == 507 or fmtype == 519 or fmtype == 520  or fmtype == 521  or fmtype == 528  or fmtype == 529  or fmtype == 530 or fmtype == 538 or fmtype == 545 then if fmvalue and fmvalue > 0 then local text = stats[fmid][2]; index_value = index_value + 1; aaDesktop.aaXilian.values[index_value] = "+ "..fmvalue.."% "..text; end; else if fmvalue and fmvalue > 0 then local text = stats[fmid][2]; index_value = index_value + 1; aaDesktop.aaXilian.values[index_value] = "+ "..fmvalue.." "..text; end; end; end; end; end; for i=1,index_value do local text = aaDesktop.aaXilian.values[i]; aaDesktop.aaXilian.listView[i].titleText:SetText(text); aaDesktop.aaXilian.listView[i]:Show(); end; aaDesktop.aaXilian.slider:SetMinMaxValues(0, #aaDesktop.aaXilian.values * 54 * 0.5); aaDesktop.aaXilian.cishuText:SetText("剩余洗炼次数："..aaData.color_white..item[29]); local need2 = ""; if item[30] then local needid = item[30]; if needid and needid ~= "" and needid > 0 then aaData.reload_need[needid] = "aaXilian"; need2 = aaData:getNeed(needid, 1, 0, count + 1); end; end; aaDesktop.aaXilian.needText:SetText(need2); if #aaDesktop.aaXilian.values <= count then aaDesktop.aaXilian.doneButton:Disable(); else aaDesktop.aaXilian.doneButton:Enable(); end; end; end;  function aaDesktop.aaXilian:show() aaDesktop.aaXilian.backView4:Show(); end; function aaDesktop.aaXilian:hide() aaDesktop.aaXilian.backView4:Hide(); end;   aaDesktop.aaZiyuan.mainView = CreateFrame("Frame", "aaDesktop.aaZiyuan.mainView", UIParent) do aaDesktop.aaZiyuan.mainView:SetPoint("CENTER", UIParent, 'TOP',0, 0); aaDesktop.aaZiyuan.mainView:SetWidth(180); aaDesktop.aaZiyuan.mainView:SetHeight(200); aaDesktop.aaZiyuan.mainView:SetToplevel(true); aaDesktop.aaZiyuan.mainView:SetClampedToScreen(true); aaDesktop.aaZiyuan.mainView:Hide();  aaDesktop.aaZiyuan.mainView.Title_A = aaDesktop.aaZiyuan.mainView:CreateFontString(); aaDesktop.aaZiyuan.mainView.Title_A:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 14); aaDesktop.aaZiyuan.mainView.Title_A:SetShadowOffset(1, -1); aaDesktop.aaZiyuan.mainView.Title_A:SetPoint("TOPLEFT", aaDesktop.aaZiyuan.mainView, 30, -25.5); aaDesktop.aaZiyuan.mainView.Title_A:SetText(aaData.color_yellows.."基地：0  资源：0/1600");  aaDesktop.aaZiyuan.mainView.Title_H = aaDesktop.aaZiyuan.mainView:CreateFontString(); aaDesktop.aaZiyuan.mainView.Title_H:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 14); aaDesktop.aaZiyuan.mainView.Title_H:SetShadowOffset(1, -1); aaDesktop.aaZiyuan.mainView.Title_H:SetPoint("TOPLEFT", aaDesktop.aaZiyuan.mainView, 30, -55.5); aaDesktop.aaZiyuan.mainView.Title_H:SetText(aaData.color_yellows.."基地：0  资源：0/1600");  aaDesktop.aaZiyuan.mainView.Icon_A = CreateFrame("Button", nil, aaDesktop.aaZiyuan.mainView); aaDesktop.aaZiyuan.mainView.Icon_A:SetSize(25, 25); aaDesktop.aaZiyuan.mainView.Icon_A:SetPoint("TOPLEFT", aaDesktop.aaZiyuan.mainView, "TOPLEFT", 0, -20); local icon = GetSpellIcon(14268); aaDesktop.aaZiyuan.mainView.Icon_A:SetNormalTexture(icon);  aaDesktop.aaZiyuan.mainView.Icon_A:SetScript('OnEnter', function() if (not GameTooltip:IsVisible()) then GameTooltip:SetOwner(aaDesktop.aaZiyuan.mainView.Icon_A, "ANCHOR_NONE"); end; GameTooltip:SetPoint("BOTTOMRIGHT",aaDesktop.aaZiyuan.mainView.Icon_A,"BOTTOMLEFT"); GameTooltip:SetText("联盟资源"); GameTooltip:SetToplevel(true); GameTooltip:Show(); end); aaDesktop.aaZiyuan.mainView.Icon_A:SetScript('OnLeave', function() GameTooltip:Hide(); end);  aaDesktop.aaZiyuan.mainView.Icon_H = CreateFrame("Button", nil, aaDesktop.aaZiyuan.mainView); aaDesktop.aaZiyuan.mainView.Icon_H:SetSize(25, 25); aaDesktop.aaZiyuan.mainView.Icon_H:SetPoint("TOPLEFT", aaDesktop.aaZiyuan.mainView, "TOPLEFT", 0, -50); icon = GetSpellIcon(14267); aaDesktop.aaZiyuan.mainView.Icon_H:SetNormalTexture(icon);   aaDesktop.aaZiyuan.mainView.Icon_H:SetScript('OnEnter', function() if (not GameTooltip:IsVisible()) then GameTooltip:SetOwner(aaDesktop.aaZiyuan.mainView.Icon_H, "ANCHOR_NONE"); end; GameTooltip:SetPoint("BOTTOMRIGHT",aaDesktop.aaZiyuan.mainView.Icon_H,"BOTTOMLEFT"); GameTooltip:SetText("部落资源"); GameTooltip:SetToplevel(true); GameTooltip:Show(); end); aaDesktop.aaZiyuan.mainView.Icon_H:SetScript('OnLeave', function() GameTooltip:Hide(); end); end;  function aaDesktop.aaZiyuan:show(rtable) aaDesktop.aaZiyuan.mainView:Show(); if rtable ~= nil and rtable[1] ~= nil and rtable[2] ~= nil and rtable[3] ~=nil and rtable[4] ~=nil and rtable[5] ~=nil then local fen_a = rtable[1]; local fen_h = rtable[2]; local zl_a = rtable[3]; local zl_h = rtable[4]; local fen_max = rtable[5]; aaDesktop.aaZiyuan.mainView.Title_A:SetText(aaData.color_yellows.."基地："..zl_a.." 资源："..fen_a.."/"..fen_max); aaDesktop.aaZiyuan.mainView.Title_H:SetText(aaData.color_yellows.."基地："..zl_h.." 资源："..fen_h.."/"..fen_max); end; end; function aaDesktop.aaZiyuan:hide() aaDesktop.aaZiyuan.mainView:Hide(); end;  aaDesktop.aaGongcheng.Icons = {}; aaDesktop.aaGongcheng.Titles = {}; aaDesktop.aaGongcheng.texts = {}; aaDesktop.aaGongcheng.dians = {}; aaDesktop.aaGongcheng.ziyuan = 0; aaDesktop.aaGongcheng.time = 0; aaDesktop.aaGongcheng.killa = 0; aaDesktop.aaGongcheng.killb = 0; aaDesktop.aaGongcheng.count = 0; aaDesktop.aaGongcheng.count_time = 0; aaDesktop.aaGongcheng.mainView = CreateFrame("Frame", "aaDesktop.aaGongcheng.mainView", UIParent) do aaDesktop.aaGongcheng.mainView:SetPoint("CENTER", UIParent, 'TOP',0, 0); aaDesktop.aaGongcheng.mainView:SetWidth(165); aaDesktop.aaGongcheng.mainView:SetHeight(500); aaDesktop.aaGongcheng.mainView:SetToplevel(true); aaDesktop.aaGongcheng.mainView:SetClampedToScreen(true); aaDesktop.aaGongcheng.mainView:Show(); end;  for i=1,30 do local icon = CreateFrame("Button", nil, aaDesktop.aaGongcheng.mainView); icon:SetSize(25, 25); icon:SetPoint("TOPLEFT", aaDesktop.aaGongcheng.mainView, "TOPLEFT", 0, -20 - 30 * (i-1)); icon:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\gongcheng_1"); aaDesktop.aaGongcheng.Icons[i] = icon; icon:Hide();  local title = aaDesktop.aaGongcheng.mainView:CreateFontString(); title:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 14); title:SetShadowOffset(1, -1); title:SetPoint("TOPLEFT", aaDesktop.aaGongcheng.mainView, 30, -25.5 - 30*(i-1)); aaDesktop.aaGongcheng.Titles[i] = title; title:Hide(); end;  function aaDesktop.aaGongcheng:show(rtable1, rtable2) for i=1,30 do aaDesktop.aaGongcheng.Icons[i]:Hide(); aaDesktop.aaGongcheng.Titles[i]:Hide(); end; aaDesktop.aaGongcheng.mainView:Show(); if rtable2 ~= nil then aaDesktop.aaGongcheng.killa = rtable2[1]; aaDesktop.aaGongcheng.killb = rtable2[2]; aaDesktop.aaGongcheng.time = rtable2[3]; aaDesktop.aaGongcheng.ziyuan = rtable2[4]; end; if rtable1 ~= nil then aaDesktop.aaGongcheng.count = #rtable1*0.5; for i=1,aaDesktop.aaGongcheng.count do aaDesktop.aaGongcheng.texts[i] = rtable1[(i-1)*2 + 1]; aaDesktop.aaGongcheng.dians[i] = rtable1[(i-1)*2 + 2]; end; end; for i=1,aaDesktop.aaGongcheng.count do aaDesktop.aaGongcheng.Icons[i]:Show(); aaDesktop.aaGongcheng.Titles[i]:Show(); aaDesktop.aaGongcheng.Icons[i]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\gongcheng_3"); aaDesktop.aaGongcheng.Titles[i]:SetText(aaData.color_yellows..aaDesktop.aaGongcheng.texts[i].." "..aaDesktop.aaGongcheng.dians[i].."/"..aaDesktop.aaGongcheng.ziyuan); end; aaDesktop.aaGongcheng.Icons[aaDesktop.aaGongcheng.count+1]:Show(); aaDesktop.aaGongcheng.Icons[aaDesktop.aaGongcheng.count+1]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\gongcheng_1"); aaDesktop.aaGongcheng.Titles[aaDesktop.aaGongcheng.count+1]:Show(); aaDesktop.aaGongcheng.Titles[aaDesktop.aaGongcheng.count+1]:SetText(aaData.color_yellows.."守城方杀敌 "..aaDesktop.aaGongcheng.killa); aaDesktop.aaGongcheng.Icons[aaDesktop.aaGongcheng.count+2]:Show(); aaDesktop.aaGongcheng.Icons[aaDesktop.aaGongcheng.count+2]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\gongcheng_1"); aaDesktop.aaGongcheng.Titles[aaDesktop.aaGongcheng.count+2]:Show(); aaDesktop.aaGongcheng.Titles[aaDesktop.aaGongcheng.count+2]:SetText(aaData.color_yellows.."攻城方杀敌 "..aaDesktop.aaGongcheng.killb); aaDesktop.aaGongcheng.Icons[aaDesktop.aaGongcheng.count+3]:Show(); aaDesktop.aaGongcheng.Icons[aaDesktop.aaGongcheng.count+3]:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\gongcheng_2"); aaDesktop.aaGongcheng.Titles[aaDesktop.aaGongcheng.count+3]:Show(); aaDesktop.aaGongcheng.Titles[aaDesktop.aaGongcheng.count+3]:SetText(aaData.color_yellows.."剩余时间 "..aaData:secondsTox(aaDesktop.aaGongcheng.time)); aaDesktop.aaGongcheng.count_time = aaDesktop.aaGongcheng.count+3; end; function aaDesktop.aaGongcheng:hide() aaDesktop.aaGongcheng.mainView:Hide(); end;     aaDesktop.aaHuoyue.width = 650; aaDesktop.aaHuoyue.height = 490; aaDesktop.aaHuoyue.width_c = aaDesktop.aaHuoyue.width - 40; aaDesktop.aaHuoyue.height_c = 54; aaDesktop.aaHuoyue.icon_key = {}; aaDesktop.aaHuoyue.listView = {}; aaDesktop.aaHuoyue.listView_huoyue = {}; aaDesktop.aaHuoyue.names = {}; aaDesktop.aaHuoyue.jindus = {}; aaDesktop.aaHuoyue.huoyues = {}; aaDesktop.aaHuoyue.wanchengs = {}; aaDesktop.aaHuoyue.wanchengqingkuangs = {}; aaDesktop.aaHuoyue.shuomings = {}; aaDesktop.aaHuoyue.detail_jindus = {}; aaDesktop.aaHuoyue.myhuoyue = 0; aaDesktop.aaHuoyue.dangqianhuoyue = 0; aaDesktop.aaHuoyue.allhuoyue = 0; aaDesktop.aaHuoyue.icons = {}; aaDesktop.aaHuoyue.icon_status = {}; aaDesktop.aaHuoyue.detail_huoyues = {}; aaDesktop.aaHuoyue.backView4 = CreateFrame("Frame","aaDesktop.aaHuoyue.backView4",UIParent) do aaDesktop.aaHuoyue.backView4:SetFrameStrata("TOOLTIP"); aaDesktop.aaHuoyue.backView4:SetBackdrop( { edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border", edgeSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); aaDesktop.aaHuoyue.backView4:SetWidth(aaDesktop.aaHuoyue.width+30); aaDesktop.aaHuoyue.backView4:SetHeight(aaDesktop.aaHuoyue.height); aaDesktop.aaHuoyue.backView4:SetPoint("CENTER",0,0); aaDesktop.aaHuoyue.backView4:EnableMouseWheel(true); aaDesktop.aaHuoyue.backView4:SetToplevel(true); aaDesktop.aaHuoyue.backView4:SetClampedToScreen(true); aaDesktop.aaHuoyue.backView4:SetMovable(true); aaDesktop.aaHuoyue.backView4:EnableMouse(true); aaDesktop.aaHuoyue.backView4:SetScript("OnMouseDown",function() this:StartMoving(); end); aaDesktop.aaHuoyue.backView4:SetScript("OnMouseUp",function() this:StopMovingOrSizing(); end); aaDesktop.aaHuoyue.backView4:Show(); tinsert(UISpecialFrames, "aaDesktop.aaHuoyue.backView4"); end;  aaDesktop.aaHuoyue.backView1 = CreateFrame("Frame","aaDesktop.aaHuoyue.backView1",aaDesktop.aaHuoyue.backView4) do aaDesktop.aaHuoyue.backView1:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg1"}); aaDesktop.aaHuoyue.backView1:SetPoint("TOPLEFT", aaDesktop.aaHuoyue.backView4, "TOPLEFT",0,0); aaDesktop.aaHuoyue.backView1:SetWidth(32); aaDesktop.aaHuoyue.backView1:SetHeight(aaDesktop.aaHuoyue.height); end; aaDesktop.aaHuoyue.backView2 = CreateFrame("Frame","aaDesktop.aaHuoyue.backView2",aaDesktop.aaHuoyue.backView4) do aaDesktop.aaHuoyue.backView2:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg2"}); aaDesktop.aaHuoyue.backView2:SetPoint("TOPLEFT", aaDesktop.aaHuoyue.backView4, "TOPLEFT",32,0); aaDesktop.aaHuoyue.backView2:SetWidth(aaDesktop.aaHuoyue.width-64); aaDesktop.aaHuoyue.backView2:SetHeight(aaDesktop.aaHuoyue.height); end; aaDesktop.aaHuoyue.backView3 = CreateFrame("Frame","aaDesktop.aaHuoyue.backView3",aaDesktop.aaHuoyue.backView4) do aaDesktop.aaHuoyue.backView3:SetBackdrop({bgFile = "Interface\\AddOns\\aaAddon\\Icons\\aa-tongyong-bg3"}); aaDesktop.aaHuoyue.backView3:SetPoint("TOPLEFT", aaDesktop.aaHuoyue.backView4, "TOPLEFT",aaDesktop.aaHuoyue.width - 32,0); aaDesktop.aaHuoyue.backView3:SetWidth(32); aaDesktop.aaHuoyue.backView3:SetHeight(aaDesktop.aaHuoyue.height); end; aaDesktop.aaHuoyue.backView = CreateFrame("Frame","aaDesktop.aaHuoyue.backView",aaDesktop.aaHuoyue.backView4) do aaDesktop.aaHuoyue.backView:SetPoint("TOPLEFT", aaDesktop.aaHuoyue.backView4, "TOPLEFT",0,0); aaDesktop.aaHuoyue.backView:SetWidth(aaDesktop.aaHuoyue.width); aaDesktop.aaHuoyue.backView:SetHeight(aaDesktop.aaHuoyue.height); end;  aaDesktop.aaHuoyue.nameText = aaDesktop.aaHuoyue.backView:CreateFontString("aaDesktop.aaHuoyue.nameText", "OVERLAY", "GameFontNormal") do aaDesktop.aaHuoyue.nameText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaHuoyue.nameText:SetPoint("TOPLEFT", aaDesktop.aaHuoyue.backView, "TOPLEFT", 0, 0); aaDesktop.aaHuoyue.nameText:SetHeight(aaDesktop.aaHuoyue.height_c); aaDesktop.aaHuoyue.nameText:SetWidth(aaDesktop.aaHuoyue.width_c * 3 / 9); aaDesktop.aaHuoyue.nameText:SetText("|cFF00D9FF任务名称"); end; aaDesktop.aaHuoyue.jinduText = aaDesktop.aaHuoyue.backView:CreateFontString("aaDesktop.aaHuoyue.jinduText", "OVERLAY", "GameFontNormal") do aaDesktop.aaHuoyue.jinduText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaHuoyue.jinduText:SetPoint("TOPLEFT", aaDesktop.aaHuoyue.backView, "TOPLEFT", aaDesktop.aaHuoyue.width_c * 3 / 9, 0); aaDesktop.aaHuoyue.jinduText:SetHeight(aaDesktop.aaHuoyue.height_c); aaDesktop.aaHuoyue.jinduText:SetWidth(aaDesktop.aaHuoyue.width_c * 1 / 9); aaDesktop.aaHuoyue.jinduText:SetText("|cFF00D9FF完成进度"); end; aaDesktop.aaHuoyue.huoyueText = aaDesktop.aaHuoyue.backView:CreateFontString("aaDesktop.aaHuoyue.huoyueText", "OVERLAY", "GameFontNormal") do aaDesktop.aaHuoyue.huoyueText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaHuoyue.huoyueText:SetPoint("TOPLEFT", aaDesktop.aaHuoyue.backView, "TOPLEFT", aaDesktop.aaHuoyue.width_c * 4 / 9, 0); aaDesktop.aaHuoyue.huoyueText:SetHeight(aaDesktop.aaHuoyue.height_c); aaDesktop.aaHuoyue.huoyueText:SetWidth(aaDesktop.aaHuoyue.width_c * 1 / 9); aaDesktop.aaHuoyue.huoyueText:SetText("|cFF00D9FF活跃度"); end; aaDesktop.aaHuoyue.wanchengText = aaDesktop.aaHuoyue.backView:CreateFontString("aaDesktop.aaHuoyue.wanchengText", "OVERLAY", "GameFontNormal") do aaDesktop.aaHuoyue.wanchengText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaHuoyue.wanchengText:SetPoint("TOPLEFT", aaDesktop.aaHuoyue.backView, "TOPLEFT", aaDesktop.aaHuoyue.width_c * 5 / 9, 0); aaDesktop.aaHuoyue.wanchengText:SetHeight(aaDesktop.aaHuoyue.height_c); aaDesktop.aaHuoyue.wanchengText:SetWidth(aaDesktop.aaHuoyue.width_c * 1 / 9); aaDesktop.aaHuoyue.wanchengText:SetText("|cFF00D9FF完成情况"); end; aaDesktop.aaHuoyue.shuomingText = aaDesktop.aaHuoyue.backView:CreateFontString("aaDesktop.aaHuoyue.shuomingText", "OVERLAY", "GameFontNormal") do aaDesktop.aaHuoyue.shuomingText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); aaDesktop.aaHuoyue.shuomingText:SetPoint("TOPLEFT", aaDesktop.aaHuoyue.backView, "TOPLEFT", aaDesktop.aaHuoyue.width_c * 6 / 9, 0); aaDesktop.aaHuoyue.shuomingText:SetHeight(aaDesktop.aaHuoyue.height_c); aaDesktop.aaHuoyue.shuomingText:SetWidth(aaDesktop.aaHuoyue.width_c * 3 / 9); aaDesktop.aaHuoyue.shuomingText:SetText("|cFF00D9FF说明"); end; aaDesktop.aaHuoyue.ScrollView = CreateFrame("ScrollFrame", "aaDesktop.aaHuoyue.ScrollView", aaDesktop.aaHuoyue.backView) do aaDesktop.aaHuoyue.ScrollView:EnableMouseWheel(true); aaDesktop.aaHuoyue.ScrollView:EnableMouse(true); aaDesktop.aaHuoyue.ScrollView:SetMovable(true); aaDesktop.aaHuoyue.ScrollView:SetSize(aaDesktop.aaHuoyue.width, aaDesktop.aaHuoyue.height - 170); aaDesktop.aaHuoyue.ScrollView:RegisterForDrag('LeftButton'); aaDesktop.aaHuoyue.ScrollView:SetPoint('TOPLEFT', 0, -54); InterfaceOptions_AddCategory(aaDesktop.aaHuoyue.ScrollView); end; aaDesktop.aaHuoyue.mainView = CreateFrame("Frame","aaDesktop.aaHuoyue.mainView",aaDesktop.aaHuoyue.ScrollView) do aaDesktop.aaHuoyue.ScrollView:SetScrollChild(aaDesktop.aaHuoyue.mainView); aaDesktop.aaHuoyue.mainView:EnableMouse(true); aaDesktop.aaHuoyue.mainView:SetBackdropColor(1, 1, 1, 0.5); aaDesktop.aaHuoyue.mainView:SetWidth(aaDesktop.aaHuoyue.width); aaDesktop.aaHuoyue.mainView:SetHeight(aaDesktop.aaHuoyue.height - 170); aaDesktop.aaHuoyue.mainView:SetPoint("TOPLEFT",0,0); aaDesktop.aaHuoyue.mainView:Show(); end; aaDesktop.aaHuoyue.slider = CreateFrame("Slider", "aaDesktop.aaHuoyue.slider", aaDesktop.aaHuoyue.backView, "OptionsSliderTemplate") do aaDesktop.aaHuoyue.slider:SetWidth(30); aaDesktop.aaHuoyue.slider:SetPoint('TOPLEFT', aaDesktop.aaHuoyue.backView, 'TOPLEFT', aaDesktop.aaHuoyue.width, -34); aaDesktop.aaHuoyue.slider:SetHeight(aaDesktop.aaHuoyue.height-34); aaDesktop.aaHuoyue.slider:SetOrientation('VERTICAL'); aaDesktop.aaHuoyue.slider:SetOrientation('HORIZONTAL'); aaDesktop.aaHuoyue.slider.tooltipText = ""; getglobal(aaDesktop.aaHuoyue.slider:GetName() .. 'Low'):Hide(); getglobal(aaDesktop.aaHuoyue.slider:GetName() .. 'High'):Hide(); getglobal(aaDesktop.aaHuoyue.slider:GetName() .. 'Text'):Hide(); aaDesktop.aaHuoyue.slider:SetThumbTexture("Interface\\AddOns\\aaAddon\\Icons\\aa_dropIco"); aaDesktop.aaHuoyue.slider:SetMovable(true); aaDesktop.aaHuoyue.slider:EnableMouseWheel(true); aaDesktop.aaHuoyue.slider:RegisterForDrag('LeftButton'); aaDesktop.aaHuoyue.slider:SetOrientation("VERTICAL"); aaDesktop.aaHuoyue.slider:SetValueStep(9); aaDesktop.aaHuoyue.slider:SetMinMaxValues(0, 50); aaDesktop.aaHuoyue.slider:SetValue(0); aaDesktop.aaHuoyue.slider:SetScript("OnValueChanged", function(self, value) aaDesktop.aaHuoyue.ScrollView:SetVerticalScroll(value); end); end; aaDesktop.aaHuoyue.backView4:SetScript("OnMouseWheel", function(self, delta) local Value = aaDesktop.aaHuoyue.slider:GetValue(); if (delta < 0) then aaDesktop.aaHuoyue.slider:SetValue(Value + 27); else aaDesktop.aaHuoyue.slider:SetValue(Value - 27); end; end); function aaDesktop.aaHuoyue:CreateCell(index,id,x,y) local height = 40; local width = aaDesktop.aaHuoyue.width-40; local menuView = CreateFrame("Frame",nil,aaDesktop.aaHuoyue.mainView) do menuView:SetFrameStrata("TOOLTIP"); menuView:SetWidth(aaDesktop.aaHuoyue.width); menuView:SetHeight(height); menuView:SetPoint("TOPLEFT",aaDesktop.aaHuoyue.mainView,'TOPLEFT',x,y); menuView:Show(); end; menuView.backView = CreateFrame("Frame","menuView.backView",menuView) do menuView.backView:SetBackdrop({ bgFile = 'Interface\\DialogFrame\\UI-DialogBox-Background', edgeFile = 'Interface\\Tooltips\\UI-Tooltip-Border', tile = true, edgeSize = 16, tileSize = 16, insets = { left = 4, right = 4, top = 4, bottom = 4 } }); menuView.backView:SetBackdropColor(0, 0, 0, 0); menuView.backView:SetPoint("TOPLEFT", menuView, "TOPLEFT",20,0); menuView.backView:SetWidth(width); menuView.backView:SetHeight(height); end; menuView.nameText = menuView:CreateFontString("menuView.nameText", "OVERLAY", "GameFontNormal") do menuView.nameText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.nameText:SetPoint("TOPLEFT", menuView, "TOPLEFT", 0, 0); menuView.nameText:SetHeight(height); menuView.nameText:SetWidth(width * 3 / 9); menuView.nameText:SetText("在线120分钟"); end; menuView.jinduText = menuView:CreateFontString("menuView.jinduText", "OVERLAY", "GameFontNormal") do menuView.jinduText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.jinduText:SetPoint("TOPLEFT", menuView, "TOPLEFT", width * 3 / 9, 0); menuView.jinduText:SetHeight(height); menuView.jinduText:SetWidth(width * 1 / 9); menuView.jinduText:SetText(aaData.color_white.."6/"..aaData.color_green.."120"); end; menuView.huoyueText = menuView:CreateFontString("menuView.huoyueText", "OVERLAY", "GameFontNormal") do menuView.huoyueText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.huoyueText:SetPoint("TOPLEFT", menuView, "TOPLEFT", width * 4 / 9, 0); menuView.huoyueText:SetHeight(height); menuView.huoyueText:SetWidth(width * 1 / 9); menuView.huoyueText:SetText(aaData.color_green.."10"); end; menuView.wanchengText = menuView:CreateFontString("menuView.wanchengText", "OVERLAY", "GameFontNormal") do menuView.wanchengText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.wanchengText:SetPoint("TOPLEFT", menuView, "TOPLEFT", width * 5 / 9, 0); menuView.wanchengText:SetHeight(height); menuView.wanchengText:SetWidth(width * 1 / 9); menuView.wanchengText:SetText("|cFF00D9FF未完成|r"); end; menuView.shuomingText = menuView:CreateFontString("menuView.shuomingText", "OVERLAY", "GameFontNormal") do menuView.shuomingText:SetFont("Interface\\AddOns\\aaAddon\\Font\\aaFont.TTF", 16); menuView.shuomingText:SetPoint("TOPLEFT", menuView, "TOPLEFT", width * 6 / 9, 0); menuView.shuomingText:SetHeight(height); menuView.shuomingText:SetWidth(width * 3 / 9); menuView.shuomingText:SetText(aaData.color_white.."说明"); end; return menuView; end;  function aaDesktop.aaHuoyue:CreateCell_Huoyue(index) local btn = CreateFrame("Button", "aaDesktop.aaHuoyue.btn", aaDesktop.aaHuoyue.backView); btn:SetSize(40, 40); btn:EnableMouse(true); btn:SetNormalTexture("Interface\\ICONS\\Achievement_Level_10");  btn:SetScript("OnEnter", function(self) GameTooltip:SetOwner(self, "ANCHOR_RIGHT"); GameTooltip.default = 1; GameTooltip:SetText(index); GameTooltip:Show(); GameTooltip:SetToplevel(true); end); btn:SetScript("OnLeave",function(self) GameTooltip:Hide(); end); return btn; end;  aaDesktop.aaHuoyue.ActiveRewardsButtonBar = CreateFrame("Button", "aaDesktop.aaHuoyue.ActiveRewardsButtonBar", aaDesktop.aaHuoyue.backView) do aaDesktop.aaHuoyue.ActiveRewardsButtonBar:SetSize(550, 40) aaDesktop.aaHuoyue.ActiveRewardsButtonBar:SetPoint("CENTER",aaDesktop.aaHuoyue.backView, 0, -155) aaDesktop.aaHuoyue.ActiveRewardsButtonBar:EnableMouse(true) aaDesktop.aaHuoyue.ActiveRewardsButtonBar:SetNormalTexture("Interface\\GLUES\\LoadingBar\\Loading-BarBorder")  local progress = aaDesktop.aaHuoyue.ActiveRewardsButtonBar:CreateFontString(nil, "OVERLAY", "GameFontHighlight"); progress:SetHeight(14); progress:SetPoint("CENTER", 0, 0);  aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne = CreateFrame("StatusBar", "aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne", aaDesktop.aaHuoyue.ActiveRewardsButtonBar, nil) aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne:SetOrientation("HORIZONTAL") aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne:SetSize(485, 18) aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne:SetPoint("CENTER") aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne:SetStatusBarColor(0 / 255, 255 / 255, 255 / 255, 1)  aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne.progress = progress; aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne:SetStatusBarTexture("Interface\\TargetingFrame\\UI-StatusBar") aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne:Show(); end;  aaDesktop.aaHuoyue.CancelButton = CreateFrame('Button', nil, aaDesktop.aaHuoyue.backView4, 'UIPanelCloseButton') do aaDesktop.aaHuoyue.CancelButton:SetNormalTexture("Interface\\AddOns\\aaAddon\\Icons\\cha"); aaDesktop.aaHuoyue.CancelButton:SetPoint('TOPRIGHT', aaDesktop.aaHuoyue.backView4, 'TOPRIGHT', 0, 0); aaDesktop.aaHuoyue.CancelButton:SetSize(34, 34); aaDesktop.aaHuoyue.CancelButton:SetScript('OnClick', function() aaData:sendAddonMsg(10110,"2", "GUILD"); aaDesktop.aaHuoyue:hide(); end); end;  for i=1,100 do aaDesktop.aaHuoyue.listView[i] = aaDesktop.aaHuoyue:CreateCell(i,i,0,-(40+5)*(i-1)); aaDesktop.aaHuoyue.wanchengs[i] = 0; aaDesktop.aaHuoyue.wanchengqingkuangs[i] = 0; end;  for i=1,100 do aaDesktop.aaHuoyue.listView_huoyue[i] = aaDesktop.aaHuoyue:CreateCell_Huoyue(i); end;  function aaDesktop.aaHuoyue:reload(rtable1,rtable2,rtable3,rtable4,rtable5) if rtable1 ~= nil then local fugaikey = {}; for i,v in pairs(rtable1) do local value = rtable1[i]; if value ~= nil then table.insert(fugaikey,i); end; end; table.sort(fugaikey,function(a,b)return (tonumber(a)<tonumber(b)) end); for i=1,#fugaikey do local key = fugaikey[i]; local value = rtable1[key] aaDesktop.aaHuoyue.names[key] = value[1]; aaDesktop.aaHuoyue.jindus[key] = value[2]; aaDesktop.aaHuoyue.huoyues[key] = value[3];  if aaDesktop.aaHuoyue.wanchengs[key] >= aaDesktop.aaHuoyue.jindus[key] then aaDesktop.aaHuoyue.wanchengqingkuangs[key] = 1; end;  aaDesktop.aaHuoyue.shuomings[key] = value[4]; end; end; if rtable2 ~= nil then aaDesktop.aaHuoyue.icon_key = {}; for i,v in pairs(rtable2) do local value = rtable2[i]; if value ~= nil then table.insert(aaDesktop.aaHuoyue.icon_key,i); end; end; table.sort(aaDesktop.aaHuoyue.icon_key,function(a,b)return (tonumber(a)<tonumber(b)) end); local allhuoyue = 0; for i=1,#aaDesktop.aaHuoyue.icon_key do local key = aaDesktop.aaHuoyue.icon_key[i] + 0; allhuoyue = allhuoyue + key + 0; local value = rtable2[key] aaDesktop.aaHuoyue.detail_jindus[key] = key; aaDesktop.aaHuoyue.icons[key] = value[1]; aaDesktop.aaHuoyue.detail_huoyues[key] = value[2]; end; aaDesktop.aaHuoyue.allhuoyue = allhuoyue; aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne:SetMinMaxValues(0, aaDesktop.aaHuoyue.allhuoyue); end; if rtable3 ~= nil then if rtable3[1] ~= nil and rtable3[1] ~= "" then aaDesktop.aaHuoyue.dangqianhuoyue = rtable3[1]; aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne:SetValue(aaDesktop.aaHuoyue.dangqianhuoyue); end; end; if rtable4 ~= nil then for i=1,100 do if rtable4[i] ~= nil then aaDesktop.aaHuoyue.wanchengs[i] = rtable4[i][1]; if aaDesktop.aaHuoyue.wanchengs[i] >= aaDesktop.aaHuoyue.jindus[i] then aaDesktop.aaHuoyue.wanchengqingkuangs[i] = 1; end; end; end; end; if rtable5 ~= nil then for i=1,#aaDesktop.aaHuoyue.icon_key do if aaDesktop.aaHuoyue.icon_key[i] ~= nil and aaDesktop.aaHuoyue.icon_key[i] ~= "" then local key = aaDesktop.aaHuoyue.icon_key[i] + 0; if rtable5[key] ~= nil and rtable5[key] ~= "" then if rtable5[key][1] ~= nil and rtable5[key][1] ~= "" and rtable5[key][1] == 1 then aaData:setTextureFetter(aaDesktop.aaHuoyue.listView_huoyue[i], aaDesktop.aaHuoyue.icons[key], false); end; end; end; end; end;  for i=1,100 do if rtable1 ~= nil then if aaDesktop.aaHuoyue.names[i] ~= nil and aaDesktop.aaHuoyue.names[i] ~= "" then aaDesktop.aaHuoyue.listView[i]:Show(); aaDesktop.aaHuoyue.listView[i].nameText:SetText(aaDesktop.aaHuoyue.names[i]); aaDesktop.aaHuoyue.listView[i].jinduText:SetText(aaData.color_white..aaDesktop.aaHuoyue.wanchengs[i].."/"..aaData.color_green..aaDesktop.aaHuoyue.jindus[i]); aaDesktop.aaHuoyue.listView[i].huoyueText:SetText(aaData.color_green..aaDesktop.aaHuoyue.huoyues[i]); aaDesktop.aaHuoyue.listView[i].shuomingText:SetText(aaData.color_green..aaDesktop.aaHuoyue.shuomings[i]); if aaDesktop.aaHuoyue.wanchengqingkuangs[i] == 1 then aaDesktop.aaHuoyue.listView[i].wanchengText:SetText("|cFF00D9FF已完成|r"); end; else aaDesktop.aaHuoyue.listView[i]:Hide(); end; end;  if rtable2 ~= nil then if aaDesktop.aaHuoyue.icon_key[i] ~= nil and aaDesktop.aaHuoyue.icon_key[i] ~= "" then local key = aaDesktop.aaHuoyue.icon_key[i] + 0; if aaDesktop.aaHuoyue.icons[key] ~= nil and aaDesktop.aaHuoyue.icons[key] ~= "" then local count = #aaDesktop.aaHuoyue.icon_key; aaDesktop.aaHuoyue.listView_huoyue[i]:Show(); local kong = (aaDesktop.aaHuoyue.width - (40 * count)) / (count + 1); aaDesktop.aaHuoyue.listView_huoyue[i]:SetPoint("TOPLEFT",aaDesktop.aaHuoyue.backView, kong + (40 + kong)*(i - 1), -490 + 40 + 20); aaDesktop.aaHuoyue.listView_huoyue[i]:SetNormalTexture(aaDesktop.aaHuoyue.icons[key]); aaData:setTextureFetter(aaDesktop.aaHuoyue.listView_huoyue[i], aaDesktop.aaHuoyue.icons[key], true); else aaDesktop.aaHuoyue.listView_huoyue[i]:Hide(); end; end; end;  if rtable4 ~= nil then if aaDesktop.aaHuoyue.wanchengs[i] ~= nil and aaDesktop.aaHuoyue.wanchengs[i] ~= "" and aaDesktop.aaHuoyue.names[i] ~= nil and aaDesktop.aaHuoyue.names[i] ~= "" then aaDesktop.aaHuoyue.listView[i].jinduText:SetText(aaData.color_white..aaDesktop.aaHuoyue.wanchengs[i].."/"..aaData.color_green..aaDesktop.aaHuoyue.jindus[i]); if aaDesktop.aaHuoyue.wanchengqingkuangs[i] == 1 then aaDesktop.aaHuoyue.listView[i].wanchengText:SetText(aaData.color_green.."已完成|r"); end; end; end; end; if #aaDesktop.aaHuoyue.names > 0 then aaDesktop.aaHuoyue.slider:SetMinMaxValues(0, #aaDesktop.aaHuoyue.names * 40 * 0.5); end; aaDesktop.aaHuoyue.ActiveRewardsButtonBar.MyStatusBarOne.progress:SetText(string.format('|cFFFFFF00当前活跃度:|r|cFFFFFFFF%s/%s|r', aaDesktop.aaHuoyue.dangqianhuoyue ,aaDesktop.aaHuoyue.allhuoyue)); end; function aaDesktop.aaHuoyue:show() aaDesktop.aaHuoyue.backView4:Show(); end; function aaDesktop.aaHuoyue:hide() aaDesktop.aaHuoyue.backView4:Hide(); end;    aaDesktop.aaColor_time = 0; aaDesktop.aaColor_dur = 0; local function aaColorUpdate(btn, elapsed) local time2 = GetTime()-aaDesktop.aaColor_time; if aaDesktop.aaColor_dur == 9 then aaDesktop.aaColor_dur = 0; end; if time2 >= 1 then aaDesktop.aaColor_dur = aaDesktop.aaColor_dur + 1; aaDesktop.aaColor_time = GetTime(); aaData.randColor = aaData.colors[aaDesktop.aaColor_dur];  if aaDesktop.aaGongcheng.count_time > 0 and aaDesktop.aaGongcheng.time > 0 then aaDesktop.aaGongcheng.time = aaDesktop.aaGongcheng.time -1; aaDesktop.aaGongcheng.Titles[aaDesktop.aaGongcheng.count_time]:SetText(aaData.color_yellows.."剩余时间 "..aaData:secondsTox(aaDesktop.aaGongcheng.time)); else aaDesktop.aaGongcheng:hide(); end; end; end;  local function aaTimeUpdate(btn, elapsed) aaFanpaiUpdate(btn, elapsed); aaHuodongUpdate(btn, elapsed); aaJiJieHaoUpdate(btn, elapsed); aaColorUpdate(btn, elapsed); aaMapFrameUpdateTime(btn, elapsed); aaShenqiFrameUpdateTime(btn, elapsed); end; aaDesktop.timeView = CreateFrame("Cooldown",nil,UIParent) do aaDesktop.timeView:SetFrameStrata("TOOLTIP"); aaDesktop.timeView:SetCooldown(GetTime(), GetTime()*GetTime()); aaDesktop.timeView:SetScript("OnUpdate", aaTimeUpdate); end;