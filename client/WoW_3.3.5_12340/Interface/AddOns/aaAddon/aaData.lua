aaData = {}; aaData.frame = nil; aaData.updateTime = GetTime(); aaData.randColor = ""; aaData.reload_need = {}; aaData.reload_reward = {}; aaData.reload_dz = {}; aaData.need_conf = { [1]="等级", [2]="军衔等级", [3]="斗气等级", [4]="巅峰等级", [5]="会员等级", [6]="累计积分", [7]="金钱", [8]="泡点", [9]="魔币", [10]="积分", [11]="战场积分", [12]="荣誉点数", [13]="成就点数", [14]="方式", [15]="物品", [16]="物品等级", [17]="物品品质", [18]="物品鉴定等级", [19]="物品强化等级", [20]="物品成长等级", [21]="物品随机属性等级", [22]="物品随机技能等级", [23]="宠物进化等级", [24]="宠物强化等级", [25]="宠物觉醒等级", [26]="完成指定任务", [27]="完成指定成就", [28]="学习指定技能", [29]="携带指定光环", [30]="性别", [31]="阵营", [32]="种族", [33]="职业", [34]="指定公会", [35]="所在地图", [36]="所在范围", [37]="所在区域" }; aaData.reward_conf = { [1]="几率", [2]="经验", [3]="军衔经验", [4]="斗气等级", [5]="巅峰经验", [6]="成长经验", [7]="金钱", [8]="泡点", [9]="魔币", [10]="积分", [11]="战场积分", [12]="荣誉点数", [13]="成就点数", [14]="物品", [15]="技能", [16]="携带指定光环", [17]="传送", [18]="会员等级", [19]="天赋点数", [20]="军衔点数", [21]="斗气点数", [22]="巅峰点数", [23]="头衔", [24]="命令" }; aaData.class_spellicon = { [1]="ClassIcon_Warrior", [2]="ClassIcon_Paladin", [3]="ClassIcon_Hunter", [4]="ClassIcon_Rogue", [5]="ClassIcon_Priest", [6]="ClassIcon_DeathKnight", [7]="ClassIcon_Shaman", [8]="ClassIcon_Mage", [9]="ClassIcon_Warlock", [10]="ClassIcon_Monk", [11]="ClassIcon_Druid" }; aaData.subclass_name = { [0] = "", [1] = "头部", [2] = "脖子", [3] = "肩", [4] = "衬衫", [5] = "胸部1", [6] = "腰", [7] = "裤子", [8] = "脚", [9] = "手腕", [10] = "手", [11] = "手指", [12] = "饰品", [13] = "武器", [14] = "副手(盾)", [15] = "远程(弓)", [16] = "后背", [17] = "双手", [18] = "袋子", [19] = "战袍", [20] = "胸部2", [21] = "主手", [22] = "副手", [23] = "副手物品", [24] = "弹药", [25] = "投掷", [26] = "远程(弩,枪械,魔杖)", [27] = "箭袋", [28] = "圣物" }; aaData.colors = { [1] = "|cff00FFFF", [2] = "|cff7788FF", [3] = "|cff00FF00", [4] = "|cffFFFF00", [5] = "|cffF0B42A", [6] = "|cffFF0000", [7] = "|cffFF00FF", [8] = "|cffFFFFFF", [9] = "|cffFFFEFD", [10] = "|cff717172" }; aaData.color_blue = aaData.colors[1]; aaData.color_blues = aaData.colors[2]; aaData.color_green = aaData.colors[3]; aaData.color_yellow = aaData.colors[4]; aaData.color_yellows = aaData.colors[5]; aaData.color_red = aaData.colors[6]; aaData.color_reds = aaData.colors[7]; aaData.color_white = aaData.colors[8]; aaData.color_white1 = aaData.colors[9]; aaData.color_gray = aaData.colors[10];  function aaData:CoordsToTexCoords(size, xTop, yTop, xBottom, yBottom) local magic = (1/size)/2; local Top = (yTop/size) + magic; local Left = (xTop/size) + magic; local Bottom = (yBottom/size) - magic; local Right = (xBottom/size) - magic; return Left, Right, Top, Bottom; end;  function aaData:setTextureFetter(button, file, desaturated) if button ~= nil then if button.texture1 == nil then button.texture1 = button:CreateTexture('ButtonTexture'); button.texture1:SetAllPoints(button); button:SetNormalTexture(button.texture1); end; if file ~= "" then button.texture1:SetTexture(file); end; button.texture1:SetDesaturated(desaturated); end; end;  function aaData:getRaceIcon(guid) local raceIcon = ""; local locClass, engClass, locRace, engRace, gender, name, server = GetPlayerInfoByGUID(guid); if locRace == "血精灵" then if gender == 2 then raceIcon = "Interface\\ICONS\\Achievement_Character_Bloodelf_Male"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Bloodelf_Female"; end; elseif locRace == "德莱尼" then if gender == 3 then raceIcon = "Interface\\ICONS\\Achievement_Character_Draenei_Female"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Draenei_Male"; end; elseif locRace == "矮人" then if gender == 3 then raceIcon = "Interface\\ICONS\\Achievement_Character_Dwarf_Female"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Dwarf_Male"; end; elseif locRace == "侏儒" then if gender == 3 then raceIcon = "Interface\\ICONS\\Achievement_Character_Gnome_Female"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Gnome_Male"; end; elseif locRace == "人类" then if gender == 3 then raceIcon = "Interface\\ICONS\\Achievement_Character_Human_Female"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Human_Male"; end; elseif locRace == "暗夜精灵" then if gender == 3 then raceIcon = "Interface\\ICONS\\Achievement_Character_Nightelf_Female"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Nightelf_Male"; end; elseif locRace == "兽人" then if gender == 3 then raceIcon = "Interface\\ICONS\\Achievement_Character_Orc_Female"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Orc_Male"; end; elseif locRace == "牛头人" then if gender == 3 then raceIcon = "Interface\\ICONS\\Achievement_Character_Tauren_Female"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Tauren_Male"; end; elseif locRace == "巨魔" then if gender == 3 then raceIcon = "Interface\\ICONS\\Achievement_Character_Troll_Female"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Troll_Male"; end; elseif locRace == "亡灵" then if gender == 3 then raceIcon = "Interface\\ICONS\\Achievement_Character_Undead_Female"; else raceIcon = "Interface\\ICONS\\Achievement_Character_Undead_Male"; end; end; return raceIcon; end; function aaData:getPlayerRaceName(guid) local raceColor = ""; local locClass, engClass, locRace, engRace, gender, name, server = GetPlayerInfoByGUID(guid); if locRace == "血精灵" then raceColor = "|cFFFF1717"; elseif locRace == "德莱尼" then raceColor = "|cFF0177EC"; elseif locRace == "矮人" then raceColor = "|cFF0177EC"; elseif locRace == "侏儒" then raceColor = "|cFF0177EC"; elseif locRace == "人类" then raceColor = "|cFF0177EC"; elseif locRace == "暗夜精灵" then raceColor = "|cFF0177EC"; elseif locRace == "兽人" then raceColor = "|cFFFF1717"; elseif locRace == "牛头人" then raceColor = "|cFFFF1717"; elseif locRace == "巨魔" then raceColor = "|cFFFF1717"; elseif locRace == "亡灵" then raceColor = "|cFFFF1717"; end; if name == nil then name = "玩家姓名"; end; return raceColor..name.."|r"; end; function aaData:getPlayerClassName(guid) local classColor = ""; local locClass, engClass, locRace, engRace, gender, name, server = GetPlayerInfoByGUID(guid); if engClass == "DRUID" then classColor = "|cffff7d0a"; elseif engClass == "HUNTER" then classColor = "|cffabd473"; elseif engClass == "MAGE" then classColor = "|cff69ccf0"; elseif engClass == "PALADIN" then classColor = "|cfff58cba"; elseif engClass == "PRIEST" then classColor = "|cffffffff"; elseif engClass == "ROGUE" then classColor = "|cfffff569"; elseif engClass == "SHAMAN" then classColor = "|cff0070de"; elseif engClass == "WARLOCK" then classColor = "|cff9482c9"; elseif engClass == "WARRIOR" then classColor = "|cffc79c6e"; elseif engClass == "DEATHKNIGHT" then classColor = "|cffc41f3b"; elseif engClass == "MONK" then classColor = "|cff00ff96"; end; if name == nil then name = "玩家姓名"; end; return classColor..name.."|r"; end; function aaData:secondsTox(s) local f = math.modf( s / 60 ); local r = s - f * 60; if f > 0 then return math.modf(f).."分"..math.modf(r).."秒"; end; return math.modf(r).."秒"; end; function aaData:secondsToxx(s) local h = math.modf( s / 3600 ); local f = math.modf((s - h * 3600) / 60); local r = s - h * 3600 - f * 60; if h > 0 then return math.modf(h).."时"..math.modf(f).."分"..math.modf(r).."秒"; end; if f > 0 then return math.modf(f).."分"..math.modf(r).."秒"; end; return math.modf(r).."秒"; end; function aaData:getItem(itemid, itementry) if itementry == 0 then return nil; end; if items[itemid] == nil or items[itemid][itementry] == nil or items[itemid][itementry][7] == 0 or items[itemid][itementry][7] == 0 then local itemDisplay = aaData:getItemDisplay(itementry); if itemDisplay ~= nil and itemDisplay[7] > 0 then return itemDisplay; end; return nil; end; return items[itemid][itementry]; end; function aaData:getItemDisplay(itementry) if itementry == 0 then return nil; end; if item_displays[itementry] == nil then return nil; end; return item_displays[itementry]; end; function aaData:getAuctionName() local name = ""; if worldconf[17] == 1 then name = worldconf[13]; elseif worldconf[17] == 2 then name = worldconf[14]; elseif worldconf[17] == 3 then name = worldconf[15]; elseif worldconf[17] == 4 then name = worldconf[16]; else name = "铜币"; end return name; end; function aaData:RemoveRepetition(TableData) local bExist = {}; for v, k in pairs(TableData) do bExist[k] = true; end; local result = {}; for v, k in pairs(bExist) do table.insert(result, v); end; return result; end; function aaData:toVectorInt(n) if n ~= nil then local fwids = {}; string.gsub(n,'[^'..","..']+',function (w) table.insert(fwids, w); end); return fwids; else return {}; end; end; function aaData:in_Vector(value, tbl) for i=1,#tbl do if tbl[i] == value then return true; end; end; return false; end; function aaData:toVectorInt2(n) if n ~= nil then local fwids = {}; string.gsub(n,'[^'..","..']+',function (w) local i = 1; local key = 0; local value = 0; string.gsub(w,'[^'.." "..']+',function (m) if i == 1 then key = m+0; else value = m+0; end; i = i+1; end); if key ~= 0 then fwids[key+0] = value+0; end; end); return fwids; else return {}; end; end; function aaData:toVectorString2(n) if n ~= nil then local fwids = {}; string.gsub(n,'[^'..","..']+',function (w) local i = 1; local key = ""; local value = 0; string.gsub(w,'[^'.." "..']+',function (m) if i == 1 then key = m; else value = m+0; end; i = i+1; end); if key ~= 0 then fwids[key] = value+0; end; end); return fwids; else return {}; end; end; function aaData:toVectorInt2m(n) if n ~= nil then local fwids = {}; local j = 1; string.gsub(n,'[^'..","..']+',function (w) local i = 1; local key = 0; local value = 0; string.gsub(w,'[^'.." "..']+',function (m) if i == 1 then key = m+0; else value = m+0; end; i = i+1; end); if key ~= 0 then local vs = {}; vs[key+0] = value+0; fwids[j] = vs; j = j+1; end; end); return fwids; else return {}; end; end; function aaData:toint(n) if n ~= nil then local s = tostring(n); local i,j = s:find('%.'); if i then return tonumber(s:sub(1,i-1)); else return n; end; else return 0; end; end; function aaData:getHttpSpell(k, k1) local item = aaData:getItem(k, k1); if item then local spellids = ""; if item[16] ~= "" and item[16] ~= "0" and item[16] ~= 0 then local qhtext1 = item[16]; local qhids = {}; string.gsub(qhtext1,'[^'..","..']+',function (w) table.insert(qhids,w); end); if qhids ~= {} then qhids = aaData:RemoveRepetition(qhids); end; for i=1,#qhids do local spellid = qhids[i] + 0; if spellid ~= "" and spellid ~= "0" and spellid ~= 0 then spellids = spellids..spellid.."\t"; if spells[spellid] then spellids = spellids..spells[spellid][2].."\t"; else spellids = spellids.."0".."\t"; end; end; end; end; if item[24] ~= "" and item[24] ~= "0" and item[24] ~= 0 then local qhtext1 = item[24]; local qhids = {}; string.gsub(qhtext1,'[^'..","..']+',function (w) table.insert(qhids,w); end); for i=1,#qhids do local spellid = qhids[i] + 0; if spellid ~= "" and spellid ~= "0" and spellid ~= 0 then spellids = spellids..spellid.."\t"; if spells[spellid] then spellids = spellids..spells[spellid][2].."\t"; else spellids = spellids.."0".."\t"; end; end; end; end; if item[26] ~= "" and item[26] ~= "0" and item[26] ~= 0 then local qhtext1 = item[26]; local qhids = {}; string.gsub(qhtext1,'[^'..","..']+',function (w) table.insert(qhids,w); end); for i=1,#qhids do local spellid = qhids[i] + 0; if spellid ~= "" and spellid ~= "0" and spellid ~= 0 then spellids = spellids..spellid.."\t"; if spells[spellid] then spellids = spellids..spells[spellid][2].."\t"; else spellids = spellids.."0".."\t"; end; end; end; end; if spellids ~= "" then aaData:sendAddonMsg(11, spellids, "GUILD"); end; end; end; function aaData:getAuctionName() local name = ""; if worldconf[17] == 1 then name = worldconf[13]; elseif worldconf[17] == 2 then name = worldconf[14]; elseif worldconf[17] == 3 then name = worldconf[15]; elseif worldconf[17] == 4 then name = worldconf[16]; else name = "铜币"; end return name; end; function aaData:getItemName(entry) local name = GetItemInfo(entry); if name == nil and itemtemplates[entry] then name = itemtemplates[entry][10]; end; if name == nil then aaData:sendAddonMsg(13, entry, "GUILD"); name = ""; end; return name; end; local _needs = {}; function aaData:getNeed(needid, dian, huhuang, count) if count == nil or count == 0 then count = 1; end; local needtext = ""; if needid then needid = needid + 0; end; if needid and needid > 0 then local need = needs[needid]; if need and need ~= nil then if type(need) == "string" then needtext = need; else local fs = ""; if need[13] == nil or need[13] == "0" or need[13] == "" or need[13] == 0 then if dian == 1 then fs = "消耗"; else fs = "· 消耗"; end; else if dian == 1 then fs = "持有"; else fs = "· 持有"; end; end; for i=1,#need do if aaData.need_conf[i] == "金钱" or aaData.need_conf[i] == worldconf[13] or aaData.need_conf[i] == worldconf[14] or aaData.need_conf[i] == worldconf[15] or aaData.need_conf[i] == "战场积分" or aaData.need_conf[i] == "荣誉点数" or aaData.need_conf[i] == "成就点数" then if need[i] > 0 then local count_need = need[i] + 0; count_need = count_need * count; if needtext ~= "" then if huhuang == 1 then needtext = needtext.."\\n"; else needtext = needtext.."\n"; end; end; if aaData.need_conf[i] == "金钱" then local jinbi = math.modf(count_need / 10000); local yinbistr = count_need - jinbi * 10000; local yinbi = math.modf(yinbistr/100); local tongbi = count_need - jinbi * 10000 - yinbi * 100; local str = ""; if jinbi > 0 then str = str..jinbi.."金"; end; if yinbi > 0 then str = str..yinbi.."银"; end; if tongbi > 0 then str = str..tongbi.."铜"; end; if dian == 1 then needtext = needtext..aaData.color_red.."消耗"..aaData.color_blue.."["..aaData.need_conf[i].."]"..aaData.color_yellow.." x"..str; else needtext = needtext..aaData.color_red.."· 消耗"..aaData.color_blue.."["..aaData.need_conf[i].."]"..aaData.color_yellow.." x"..str; end; else if dian == 1 then needtext = needtext..aaData.color_red.."消耗"..aaData.color_blue.."["..aaData.need_conf[i].."]"..aaData.color_yellow.." x"..count_need; else needtext = needtext..aaData.color_red.."· 消耗"..aaData.color_blue.."["..aaData.need_conf[i].."]"..aaData.color_yellow.." x"..count_need; end; end; end; elseif aaData.need_conf[i] == "物品" then local fugaikey = {}; local items = need[i]; if items and items ~= "" then if needtext ~= "" then if huhuang == 1 then needtext = needtext.."\\n"; else needtext = needtext.."\n"; end; end; local fugai = aaData:toVectorInt2(items); for i,v in pairs(fugai) do local value = fugai[i]+0; if value > 0 then table.insert(fugaikey,i); end; end; table.sort(fugaikey,function(a,b)return (tonumber(a)<tonumber(b)) end); for i=1,#fugaikey do local itementry = fugaikey[i]; local itemcount = fugai[itementry]; itemcount = itemcount * count; if itemcount + 0 > 0 then if i == #fugaikey then needtext = needtext..aaData.color_red..fs..aaData.color_blue.."["..aaData:getItemName(itementry).."]"..aaData.color_yellow.." x"..itemcount; else needtext = needtext..aaData.color_red..fs..aaData.color_blue.."["..aaData:getItemName(itementry).."]"..aaData.color_yellow.." x"..itemcount.."\n"; end; end; end; end; else local miaoshu = ""; if aaData.need_conf[i] == "性别" then if need[i] == 1 then miaoshu = "男"; elseif need[i] == 2 then miaoshu = "女"; end; elseif aaData.need_conf[i] == "阵营" then if need[i] == 67 then miaoshu = "部落"; elseif need[i] == 469 then miaoshu = "联盟"; end; elseif aaData.need_conf[i] == "种族" then local zz = {[1]="人类",[2]="兽人",[3]="矮人",[4]="暗夜精灵",[5]="亡灵",[6]="牛头人",[7]="侏儒",[8]="巨魔",[9]="",[10]="血精灵",[11]="德莱尼"}; if need[i] > 0 then miaoshu = zz[need[i]]; end; elseif aaData.need_conf[i] == "职业" then local zy = {[1]="|cffc79c6e战士|r",[2]="|cfff58cba圣骑士|r",[3]="|cffabd473猎人|r",[4]="|cfffff569潜行者|r",[5]="|cffffffff牧师|r",[6]="|cffc41f3b死亡骑士|r",[7]="|cff0070de萨满|r",[8]="|cff69ccf0法师|r",[9]="|cff9482c9术士|r",[10]="",[11]="|cffff7d0a德鲁伊|r"}; if need[i] > 0 then miaoshu = zy[need[i]]; end; elseif need[i] ~= 0 and need[i] ~= "" and need[i] ~= "0" and need[i] ~= -1 then miaoshu = "x"..need[i]; end; if miaoshu ~= "" then if needtext ~= "" then if huhuang == 1 then needtext = needtext.."\\n"; else needtext = needtext.."\n"; end; end; if dian == 1 then needtext = needtext..aaData.color_red.."需要"..aaData.color_blue.."["..aaData.need_conf[i].."]|r "..aaData.color_yellow..miaoshu; else needtext = needtext..aaData.color_red.."· 需要"..aaData.color_blue.."["..aaData.need_conf[i].."]|r "..aaData.color_yellow..miaoshu; end; end; end; end; end; elseif _needs[needid] == nil or _needs[needid] == 0 then aaData:sendAddonMsg(19, needid, "GUILD"); _needs[needid] = 1; end; end; return needtext; end; local _rewards = {}; function aaData:getReward(rewardid) local rewardtext = ""; if rewardid then rewardid = rewardid + 0; end; if rewardid and rewardid > 0 then local reward = rewards[rewardid]; if reward and reward ~= nil then if type(reward) == "string" then rewardtext = reward; elseif reward[1] ~= nil and reward[2] == nil then rewardtext = reward[1]; else for i=1,#reward do if aaData.reward_conf[i] == "数量" or aaData.reward_conf[i] == "几率" then elseif aaData.reward_conf[i] == "物品" then local fugaikey = {}; local items = reward[i]; if items and items ~= "" then if rewardtext ~= "" then rewardtext = rewardtext.."\n"; end; local fugai = aaData:toVectorInt2(items); for i,v in pairs(fugai) do local value = fugai[i]+0; if value > 0 then table.insert(fugaikey,i); end; end; table.sort(fugaikey,function(a,b)return (tonumber(a)<tonumber(b)) end); for i=1,#fugaikey do local itementry = fugaikey[i]; local itemcount = fugai[itementry]; if itemcount + 0 > 0 then if i == #fugaikey then rewardtext = rewardtext..aaData.color_yellow.."· 获得"..aaData.color_blue.."[|r"..aaData:getItemName(itementry)..aaData.color_blue.."]|r"..aaData.color_yellow.." x"..itemcount; else rewardtext = rewardtext..aaData.color_yellow.."· 获得"..aaData.color_blue.."[|r"..aaData:getItemName(itementry)..aaData.color_blue.."]|r"..aaData.color_yellow.." x"..itemcount.."\n"; end;  end; end; end; elseif aaData.reward_conf[i] == "技能" then local spellid = reward[i]; if spellid ~= "" and spellid ~= 0 and spellid ~= "0" then if rewardtext ~= "" then rewardtext = rewardtext.."\n"; end; local spelltext = ""; string.gsub(spellid,'[^'..","..']+',function (w) if GetSpellInfo(w) ~= nil then spelltext = spelltext.."["..GetSpellInfo(w).."]"; end; end); if spelltext ~= "" then rewardtext = rewardtext..aaData.color_yellow.."· 学习"..aaData.color_blue..spelltext; end; end; else if reward[i] ~= 0 and reward[i] ~= "" and reward[i] ~= "0" then if rewardtext ~= "" then rewardtext = rewardtext.."\n"; end; if aaData.reward_conf[i] == "金钱" then local money = reward[i] + 0; local jinbi = math.modf(money / 10000); local yinbistr = money - jinbi * 10000; local yinbi = math.modf(yinbistr/100); local tongbi = money - jinbi * 10000 - yinbi * 100; local str = ""; if jinbi > 0 then str = str..jinbi.."金"; end; if yinbi > 0 then str = str..yinbi.."银"; end; if tongbi > 0 then str = str..tongbi.."铜"; end; rewardtext = rewardtext..aaData.color_yellow.."· 获得"..aaData.color_blue.."["..aaData.reward_conf[i].."]"..aaData.color_yellow.." x"..str; else rewardtext = rewardtext..aaData.color_yellow.."· 获得"..aaData.color_blue.."["..aaData.reward_conf[i].."]"..aaData.color_yellow.." x"..reward[i]; end; end; end; end; end; elseif _rewards[rewardid] == nil or _rewards[rewardid] == 0 then aaData:sendAddonMsg(20, rewardid, "GUILD"); _rewards[rewardid] = 1; end; end; return rewardtext; end; function aaData:sendAddonMsg(str1,str2,str3) SendAddonMessage(str1,str2,str3); end; function aaData:get_star(num) if num == 0 then return "无"; end; local star = ""; local pn = string.format("%d",num/10)+0; local sn = num%10; if pn == 0 then for i=1,num do star = star.."★"; end; return aaData.color_red..star; end; for i = 1,pn do star = star.."★"; end; star = aaData.color_reds..star; local star1 = ""; for i = 1,sn do star1 = star1.."★"; end; star1 = aaData.color_red..star1; star = star..star1; return star; end; function aaData:get_quality(itemid, itementry) local item = aaData:getItem(itemid, itementry); if item then local qualityid = item[7]; if qualityid and qualityid > 0 and nonsuch[qualityid] then return nonsuch[qualityid][1]; end; end; return ""; end; function aaData:get_quality_textpre(itemid, itementry) local item = aaData:getItem(itemid, itementry); if item then local qualityid = item[7]; if qualityid and qualityid > 0 and nonsuch[qualityid] then return nonsuch[qualityid][2]; end; end; return ""; end; function aaData:get_quality_textsuf(itemid, itementry) local item = aaData:getItem(itemid, itementry); if item then local qualityid = item[7]; if qualityid and qualityid > 0 and nonsuch[qualityid] then return nonsuch[qualityid][3]; end; end; return ""; end; function aaData:get_quality_text(itemid, itementry) local quality = aaData:get_quality(itemid, itementry) if qualityid == "" then return ""; end; return aaData:get_quality(itemid, itementry); end; function aaData:get_dbname(itemid, itementry, name) if name == nil then return ""; end; return aaData:get_quality_textpre(itemid, itementry)..name..aaData:get_quality_textsuf(itemid, itementry).."|r"; end; function aaData:get_name(itemid, itementry, name) local item = aaData:getItem(itemid, itementry); if item then local name1 = item[4]; if name1 and name1 ~= "" then return aaData:get_quality_textpre(itemid, itementry)..name1; end; end; return aaData:get_dbname(itemid, itementry, name); end; function aaData:get_linkname(itemLink) if itemLink == nil then return ""; end; local itemString = string.match(itemLink, "item[%-?%d:]+"); if itemString ~= nil then local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; if suffixId < 0 then suffixId = 0; end; local _, name1, _= strsplit("[", itemLink); local itemName, _= strsplit("]", name1); aaData:get_name(suffixId, itemId, name1); local name =aaData.get_name(suffixId, itemId, itemName); return name; end; return ""; end; function aaData:getWidth(inputstr) local lenInByte = #inputstr; local width = 0; local i = 1; local line = 1; local res = ""; local fontsize = 1; while (i<=lenInByte) do local curByte = string.byte(inputstr, i); local byteCount = 1; if curByte>0 and curByte<=127 then byteCount = 1; elseif curByte>=192 and curByte<223 then byteCount = 2; elseif curByte>=224 and curByte<=239 then byteCount = 3; elseif curByte>=240 and curByte<=247 then byteCount = 4; end; local char = string.sub(inputstr, i, i+byteCount-1); res = res..char; i = i + byteCount; if byteCount == 1 then width = width + fontsize * 0.5; else width = width + fontsize; end; end; return width; end; function aaData:autoLine(inputstr, num) local lenInByte = #inputstr; local width = 0; local i = 1; local line = 1; local res = ""; local fontsize = 1; while (i<=lenInByte) do local curByte = string.byte(inputstr, i); local curByte_next = string.byte(inputstr, i+1); local byteCount = 1; if curByte>0 and curByte<=127 then byteCount = 1; elseif curByte>=192 and curByte<223 then byteCount = 2; elseif curByte>=224 and curByte<=239 then byteCount = 3; elseif curByte>=240 and curByte<=247 then byteCount = 4; end; if curByte == 124 and (curByte_next == 99 or curByte_next == 67) then byteCount = 10; end; local char = string.sub(inputstr, i, i+byteCount-1); res = res..char; i = i + byteCount; if byteCount == 1 then width = width + fontsize * 0.5; else width = width + fontsize; end; local num1 = num; if line == 1 then num1 = num; end; if width >= num1 then res = res.."\n"; width = 0; line = line + 1; end; end; return res; end; function aaData:GetAllHttpItemDisplay() local msg = "0"; if item_displays ~= nil then msg = ""; local i = 0; local max = 0; for k,v in pairs(item_displays) do max = max + 1; end; for k,v in pairs(item_displays) do i = i + 1; local entry = k; if i == max then msg = msg..entry.."\t"..v[42]; else msg = msg..entry.."\t"..v[42].."\t"; end; end; if msg == "" then msg = "0"; end; end; aaData:sendAddonMsg(3110, msg, "GUILD"); end; function aaData:GetAllHttpItem() local itemids = ""; local itementrys = ""; local i = 1; for bag = 0,4 do for slot = 1,GetContainerNumSlots(bag) do local itemLink = GetContainerItemLink(bag,slot); if itemLink then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; itemids = itemids..suffixId.."\t"..itemId.."\t"; local item = aaData:getItem(suffixId, itemId); if item then itemids = itemids..item[42].."\t"; else itemids = itemids.."0".."\t"; end; itementrys = itementrys..itemId.."\t"; i = i + 1; end; end; end; for i = 0,23 do local itemLink = GetInventoryItemLink("player", i); if itemLink then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; itemids = itemids..suffixId.."\t"..itemId.."\t"; local item = aaData:getItem(suffixId, itemId); if item then itemids = itemids..item[42].."\t"; else itemids = itemids.."0".."\t"; end; itementrys = itementrys..itemId.."\t"; i = i + 1; end; end; for i = 40,74 do local itemLink = GetInventoryItemLink("player", i); if itemLink then local itemString = string.match(itemLink, "item[%-?%d:]+"); local _, itemId, _, _, suffixId1, suffixId2, _, _, _, _= strsplit(":", itemString); local suffixId = (suffixId1 - 5000) * 10000 + suffixId2 - 5000; itemids = itemids..suffixId.."\t"..itemId.."\t"; local item = aaData:getItem(suffixId, itemId); if item then itemids = itemids..item[42].."\t"; else itemids = itemids.."0".."\t"; end; itementrys = itementrys..itemId.."\t"; i = i + 1; end; end; aaData:sendAddonMsg(12, itemids, "GUILD"); aaData:sendAddonMsg(13, itementrys, "GUILD"); end; function aaData:GetHttpItem(itemid, itementry) local itemid1 = ""; local item = aaData:getItem(itemid, itementry); if item then itemid1 = itemid.."\t"..itementry.."\t"..item[42]; else itemid1 = itemid.."\t"..itementry.."\t"..0; end; aaData:sendAddonMsg(12, itemid1, "GUILD"); if item ~=nil and item[38] ~= nil then if item[38] + 0 > 0 then local itemset = item[38]; aaData:sendAddonMsg(27, itemset, "GUILD"); end; end; end; function ONADDONMSG(self, event, prefix, msg, Type, sender) if event == "PLAYER_LOGIN" then if items == nil then items = {}; end; if itemtemplates == nil then itemtemplates = {}; end; if spells == nil then spells = {}; end; if nonsuch == nil then nonsuch = {}; end; if upgrade == nil then upgrade = {}; end; if itemlevels == nil then itemlevels = {}; end; if rune == nil then rune = {}; end; if stats == nil then stats = {}; end; if needs == nil then needs = {}; end; if rewards == nil then rewards = {}; end; if worldconf == nil then worldconf = {}; end; if vendors == nil then vendors = {}; end; if aa_desktop == nil then aa_desktop = {}; end; if aa_jllevel == nil then aa_jllevel = {}; end; if aa_jlshouchong == nil then aa_jlshouchong = {}; end; if aa_jlleichong == nil then aa_jlleichong = {}; end; if aa_jllicai == nil then aa_jllicai = {}; end; if aa_jlqiandao == nil then aa_jlqiandao = {}; end; if aa_jlchoujiang == nil then aa_jlchoujiang = {}; end; if aa_fw == nil then aa_fw = {}; end; if aa_bs == nil then aa_bs = {}; end; if aa_fwzh == nil then aa_fwzh = {}; end; if aa_bosstitle == nil then aa_bosstitle = {}; end; if aa_bossdetail == nil then aa_bossdetail = {}; end; if aa_choujiang1 == nil then aa_choujiang1 = {}; end; if aa_choujiang2 == nil then aa_choujiang2 = {}; end; if aa_choujiang3 == nil then aa_choujiang3 = {}; end; if aa_jindu == nil then aa_jindu = {}; end; if aa_item_huishou == nil then aa_item_huishou = {}; end; if aa_huodong == nil then aa_huodong = {}; end; if aa_huodong_time == nil then aa_huodong_time = {}; end; if aa_userinfo == nil then aa_userinfo = {}; end; if aa_fanpai1 == nil then aa_fanpai1 = {}; end; if aa_fanpai2 == nil then aa_fanpai2 = {}; end; if aa_shop1 == nil then aa_shop1 = {}; end; if aa_shop2 == nil then aa_shop2 = {}; end; if aa_hunyu1 == nil then aa_hunyu1 = {}; end; if aa_hunyu2 == nil then aa_hunyu2 = {}; end; if aa_ui == nil then aa_ui = {}; end; if aa_shenqi == nil then aa_shenqi = {}; end; if aa_itemsets == nil then aa_itemsets = {}; end; if aa_itemset_list == nil then aa_itemset_list = {}; end; if aa_itemset_conf == nil then aa_itemset_conf = {}; end; if item_displays == nil then item_displays = {}; end; aa_ui_jijie1 = {}; aa_ui_jijie2 = {}; aaData:sendAddonMsg(14, "0", "GUILD"); aaData:sendAddonMsg(15, "0", "GUILD"); aaData:sendAddonMsg(16, "0", "GUILD"); aaData:sendAddonMsg(17, "0", "GUILD"); aaData:sendAddonMsg(18, "0", "GUILD"); aaData:sendAddonMsg(21, "0", "GUILD"); aaData:sendAddonMsg(22, "0", "GUILD"); aaData:sendAddonMsg(23, "0", "GUILD"); aaData:sendAddonMsg(24, "0", "GUILD"); aaData:sendAddonMsg(26, "0", "GUILD"); aaData:sendAddonMsg(28, "0", "GUILD"); aaData:sendAddonMsg(29, "0", "GUILD"); aaData:sendAddonMsg(1000, "0", "GUILD"); aaData:sendAddonMsg(1002, "0", "GUILD"); aaData:sendAddonMsg(1003, "0", "GUILD"); aaData:sendAddonMsg(1004, "0", "GUILD"); aaData:sendAddonMsg(1005, "0", "GUILD"); aaData:sendAddonMsg(1006, "0", "GUILD"); aaData:sendAddonMsg(1011, "0", "GUILD"); aaData:sendAddonMsg(1014, "0", "GUILD"); aaData:sendAddonMsg(1020, "0", "GUILD"); aaData:sendAddonMsg(3051, "0", "GUILD"); aaData:sendAddonMsg(1017, "1", "GUILD"); aaData:sendAddonMsg(3090, "0", "GUILD"); aaData:GetAllHttpItemDisplay(); elseif event == "ZONE_CHANGED" then aaDesktop.aaMapFrame:hide(); aaDesktop.aaZiyuan:hide(); aaDesktop.aaGongcheng:hide(); elseif event == "CHAT_MSG_ADDON" and sender == UnitName("player") then if prefix == "11" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do spells[k] = rtable[k]; end; end; if aaDesktop.aaXilian.selectItemLick ~= "" then aaDesktop.aaXilian:reload(); end elseif prefix == "12" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do if rtable[k] then if items[k] == nil then items[k] = {}; end; for k1,v1 in pairs(rtable[k]) do items[k][k1] = rtable[k][k1]; aaData:getHttpSpell(k, k1); end; if k > 0 and aaDesktop.aaXilian.selectItemId == k then aaDesktop.aaXilian:reload(); end; end; if aaData.reload_dz[k] == "aaDzFrame" then aaDzFrame:reload(); aaData.reload_dz[k] = ""; end; end; end; elseif prefix == "25" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do aa_item_huishou[k] = v; end; end; elseif prefix == "13" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do itemtemplates[k] = rtable[k]; end; end; elseif prefix == "14" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do nonsuch[k] = rtable[k]; end; end; elseif prefix == "15" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do upgrade[k] = rtable[k]; end; end; elseif prefix == "17" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do stats[k] = rtable[k]; end; end; elseif prefix == "18" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then worldconf = rtable; if worldconf[13] then aaData.reward_conf[8] = worldconf[13]; aaData.need_conf[8] = worldconf[13]; end; if worldconf[14] then aaData.reward_conf[9] = worldconf[14]; aaData.need_conf[9] = worldconf[14]; end; if worldconf[15] then aaData.reward_conf[10] = worldconf[15]; aaData.need_conf[6] = "累计"..worldconf[15]; aaData.need_conf[10] = worldconf[15]; end; end; elseif prefix == "19" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do needs[k] = rtable[k]; local needid = k; if aaData.reload_need[needid] ~= nil then if aaData.reload_need[needid] == "aaDzFrame" then aaDzFrame:reload(); elseif aaData.reload_need[needid] == "aaFanpai" then aaDesktop.aaFanpai:show(); elseif aaData.reload_need[needid] == "aaShop" then aaDesktop.aaShop:reload(); elseif aaData.reload_need[needid] == "aaPetFrame" then aaPetFrame:reload(); elseif aaData.reload_need[needid] == "aaXilian" then aaDesktop.aaXilian:reload(); end; end; end; end; elseif prefix == "20" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do rewards[k] = rtable[k]; local rewardid = k; if aaData.reload_reward[rewardid] ~= nil then if aaData.reload_reward[rewardid] == "aaMapFrame" then aaDesktop.aaMapFrame:show(); elseif aaData.reload_reward[rewardid] == "aaBoss" then aaDesktop.aaBoss:reload() end; end; end; end; elseif prefix == "21" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do aa_fw[k] = rtable[k]; end; end; elseif prefix == "22" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do aa_fwzh[k] = rtable[k]; end; end; elseif prefix == "23" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for i=1,#rtable do table.insert(itemlevels,rtable[i]); end; end; elseif prefix == "24" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do if vendors[k] == nil then vendors[k] = {}; end; for k2,v2 in pairs(v) do vendors[k][k2] = v2; end; end; end; elseif prefix == "26" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do aa_bs[k] = rtable[k]; end; end; elseif prefix == "27" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable ~=nil then for k,v in pairs(rtable) do if aa_itemsets[k] == nil then aa_itemsets[k] = {}; end; aa_itemsets[k] = v; end; end; elseif prefix == "28" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do if v[4] ~= nil then local zu = v[2]; if aa_itemset_list[zu] == nil then aa_itemset_list[zu] = {}; end; if aa_itemset_list[zu][k] == nil then aa_itemset_list[zu][k] = {}; end; aa_itemset_list[zu][k] = v; end; end; end; elseif prefix == "29" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable ~=nil then for k,v in pairs(rtable) do if aa_itemset_conf[k] == nil then aa_itemset_conf[k] = {}; end; aa_itemset_conf[k] = v; end; end; elseif prefix == "202" then if msg ~= nil then aaDesktop.aaDialog:show(msg); end; elseif prefix == "301" then if msg ~= nil then aaDesktop.aaCode:show(msg); end; elseif prefix == "999" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; local type = 0; local values = ""; if rtable then for k,v in pairs(rtable) do type = k + 0; values = v; end; if values ~= nil and values ~= "" then if type == 1 then local id = values[1] + 0; if id > 0 then aaDesktop:ClickMenuBtn(id); end; elseif type == 2 then local id = values[1] + 0; local miyao = values[2]; if aa_ui[type] == nil then aa_ui[type] = {}; end; aa_ui[type][1] = id; aa_ui[type][2] = miyao; aaDesktop.aaChuansong:show(values); end; end; end; elseif prefix == "1000" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_desktop = rtable; end; aaDesktop:show(); aaDesktop.IconBtton99:Show(); elseif prefix == "1002" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_jllevel = rtable; end; aaDesktop.aaJLLevel:reload(); elseif prefix == "1003" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_jllicai = rtable; end; aaDesktop.aaJLLicai:reload(); elseif prefix == "1004" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_jlshouchong = rtable; end; aaDesktop.aaJLShouchong:reload(); elseif prefix == "1005" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_jlleichong = rtable; end; aaDesktop.aaJLLeichong:reload(); elseif prefix == "1006" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do aa_jlqiandao[k] = v; end; end; aaDesktop.aaJLQiandao:reload(); elseif prefix == "1008" then aa_bossdetail = {}; if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do aa_bossdetail[k] = v; end; aaDesktop.aaBoss:show(); end; elseif prefix == "1009" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_bosstitle = rtable; aaDesktop.aaBoss:show(); end; elseif prefix == "1010" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_jindu = rtable; if msg == "{}" or msg == "" or msg == "0" then aaDesktop.aaMapFrame:hide(); else aaDesktop.aaMapFrame:show(); end; else aaDesktop.aaMapFrame:hide(); end; elseif prefix == "1011" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do aa_huodong[k] = rtable[k]; end; end; aa_huodong_time = {}; aaDesktop.aaHuodong:reload(); elseif prefix == "10011" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_huodong_time = rtable; end; aaDesktop.aaHuodong:reload(); elseif prefix == "10012" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_userinfo = rtable; end; elseif prefix == "1012" then aa_fanpai2 = {}; aaDesktop.aaFanpai.aaFanpai_time = 0; aaDesktop.aaFanpai.aaFanpai_dur = 6; if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_fanpai1 = rtable; end; aaDesktop.aaFanpai:show(); elseif prefix == "1013" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do if aa_fanpai2[k] == nil then aa_fanpai2[k] = {}; end; for k1,v1 in pairs(v) do if aa_fanpai2[k][k1] == nil then aa_fanpai2[k][k1] = {}; end; for k2,v2 in pairs(v1) do if aa_fanpai2[k][k1][k2] == nil then aa_fanpai2[k][k1][k2] = {}; end; aa_fanpai2[k][k1][k2] = v2; end; end; end; end; aaDesktop.aaFanpai:show(); elseif prefix == "1014" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_shop1 = rtable; end; aaDesktop.aaShop:reload(); elseif prefix == "1015" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do if aa_shop2[k] == nil then aa_shop2[k] = {}; end; for k1,v1 in pairs(v) do aa_shop2[k][k1] = v1; end; end; end; aaDesktop.aaShop:reload(); elseif prefix == "1017" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do aa_hunyu1[k] = v; end; end; aaDesktop.aaHunyu:reload(); elseif prefix == "1020" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_hunyu2 = rtable; end; aaDesktop.aaHunyu:reload(); elseif prefix == "1021" then if msg ~= nil then rtable = loadstring("return " .. msg)(); if rtable[1] ~= nil then aaDesktop.aaHunyu.selectYe = rtable[1]; end; if rtable[2] ~= nil then aaDesktop.aaHunyu.Ye = rtable[2]; end; aaDesktop.aaHunyu:reload(rtable); end; aaDesktop.aaHunyu:reload(); elseif prefix == "10071" then aa_choujiang1 = {}; if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_choujiang1 = rtable; end; aaDesktop.aaChoujiang:reload(); elseif prefix == "10072" then aa_choujiang2 = {}; if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_choujiang2 = rtable; end; aaDesktop.aaChoujiang:reload(); elseif prefix == "10073" then aa_choujiang3 = {}; if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aa_choujiang3 = rtable; end; aaDesktop.aaChoujiang:reload(); elseif prefix == "3020" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaBianshen:show(rtable); end; elseif prefix == "3030" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaShenqi:show(rtable); end; elseif prefix == "3041" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaJuanxian:reload3041(rtable); end; elseif prefix == "3042" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaJuanxian:reload3042(rtable); end; elseif prefix == "3043" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaJuanxian:reload3043(rtable); end; elseif prefix == "3044" then aaData:sendAddonMsg(3040, "1", "GUILD"); elseif prefix == "1" or prefix == "2" or prefix == "3" or prefix == "4" or prefix == "5" or prefix == "6" or prefix == "7" or prefix == "8" or prefix == "9" or prefix == "10" then aaDzFrame:CallBack(prefix); elseif prefix == "3050" then if msg == "{}" then aa_ui_jijie2 = {}; end; if msg ~= nil then rtable = loadstring("return " .. msg)(); end; local max = 0; if rtable then for k,v in pairs(rtable) do if max < k then max = k; end; aa_ui_jijie2[k] = rtable[k]; end; for i=1, #aa_ui_jijie2 do if i > max then if aa_ui_jijie2[i] ~= nil then aa_ui_jijie2[i] = nil; end; end; end; end; aaDesktop.aaJiJieHao:reload(); elseif prefix == "3051" then if msg == "{}" then aa_ui_jijie1 = {}; end; local max = 0; if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do if max < k then max = k; end; aa_ui_jijie1[k] = rtable[k]; end; for i=1, #aa_ui_jijie1 do if i > max then if aa_ui_jijie1[i] ~= nil then aa_ui_jijie1[i] = nil; end; end; end; end; elseif prefix == "3070" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaZiyuan:show(rtable); end; elseif prefix == "3080" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaGongcheng:show(rtable, nil); end; elseif prefix == "3081" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaGongcheng:show(nil, rtable); end; elseif prefix == "30901" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaHuoyue:reload(rtable,nil,nil,nil,nil); end; elseif prefix == "30902" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaHuoyue:reload(nil,rtable,nil,nil,nil); end; elseif prefix == "30911" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaHuoyue:reload(nil,nil,rtable,nil,nil); end; elseif prefix == "30912" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaHuoyue:reload(nil,nil,nil,rtable,nil); end; elseif prefix == "30913" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then aaDesktop.aaHuoyue:reload(nil,nil,nil,nil,rtable); end; elseif prefix == "3100" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable[1] ~= nil and rtable[2] ~= nil then aaDzTooltip.selectVendorEntry = rtable[1]; aaDzTooltip.selectCreatureEntry = rtable[2]; end; elseif prefix == "3110" then if msg ~= nil then rtable = loadstring("return " .. msg)(); end; if rtable then for k,v in pairs(rtable) do item_displays[k] = v; end; end; end; end; end; do aaData.frame = CreateFrame("Frame"); aaData.frame:RegisterEvent("CHAT_MSG_ADDON"); aaData.frame:RegisterEvent("PLAYER_LOGIN"); aaData.frame:SetScript("OnEvent", ONADDONMSG); aaData.frame:RegisterEvent("ZONE_CHANGED"); end;